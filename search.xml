<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Alist æ­å»ºä¸ªäººç½‘ç›˜æŒ‚è½½æœ¬åœ°æ–‡ä»¶</title>
    <url>/2023/05/24/Alist%20%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%9B%98%E6%8C%82%E8%BD%BD%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h1>windows ç‰ˆæœ¬éƒ¨ç½² ALis</h1>
<h2 id="â¬‡ï¸ä¸‹è½½ï¼š">â¬‡ï¸ä¸‹è½½ï¼š</h2>
<div class="note info no-icon modern"><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/alist-org/alist/releases">https://github.com/alist-org/alist/releases</a></p>
</div>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121011229023.png" alt="image-20260121011229023"></p>
<p>ä¸‹è½½ä¹‹åè§£å‹æ‰“å¼€</p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121011311789.png" alt="image-20260121011311789"></p>
<h2 id="ğŸƒè¿è¡Œ">ğŸƒè¿è¡Œ</h2>
<ol>
<li>åœ¨è§£å‹ä¹‹åçš„é‚£ä¸ªç›®å½•ä¸‹é¢æ‰“å¼€ cmdï¼Œè¾“å…¥ï¼š.\alist.exe server è¿è¡Œç¨‹åº</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">.\alist.exe server</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æŸ¥çœ‹ç”¨æˆ·åå’Œå¯†ç ï¼š</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">.\alist.exe admin</span><br></pre></td></tr></table></figure>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121011350310.png" alt="image-20260121011350310"></p>
<ol start="3">
<li>å†æ¬¡è¿è¡Œ alistï¼šåœ¨ alist ç›®å½•ä¸‹æ‰“å¼€ cmd è¿è¡Œ</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å†æ¬¡å¯åŠ¨alist</span></span><br><span class="line">alist start</span><br></pre></td></tr></table></figure>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121011409219.png" alt="image-20260121011409219"></p>
<ol start="4">
<li>æ‰“å¼€æµè§ˆå™¨è¾“å…¥ï¼š127.0.0.1:5244</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">127.0.0.1:5244</span><br></pre></td></tr></table></figure>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121011550827.png" alt="image-20260121011550827"></p>
<ol start="5">
<li>ä¿®æ”¹å¯†ç ï¼šç‚¹å‡»é¡µé¢ä¸‹é¢çš„ç®¡ç†</li>
</ol>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121011613960.png" alt="image-20260121011613960"></p>
<h2 id="æŒ‚è½½æœ¬åœ°æ–‡ä»¶">æŒ‚è½½æœ¬åœ°æ–‡ä»¶</h2>
<ol>
<li>æ·»åŠ å­˜å‚¨</li>
</ol>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121011638646.png" alt="image-20260121011638646"></p>
<ol start="2">
<li>è®¾ç½®ä½ è¦æŒ‚è½½æœ¬åœ°æ–‡ä»¶çš„è·¯å¾„ï¼šæ¯”å¦‚æˆ‘è¦æŒ‚è½½ D:\IDM\ ä¸‹è½½</li>
</ol>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121011658440.png" alt="image-20260121011658440"></p>
<ol start="3">
<li>æäº¤å³å¯ï¼Œå¦‚å›¾å³æŒ‚è½½æˆåŠŸ</li>
</ol>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121011711749.png" alt="image-20260121011711749"></p>
<ol start="4">
<li>æŒ‚è½½æˆåŠŸ</li>
</ol>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121011725399.png" alt="image-20260121011725399"></p>
<h2 id="ä¸º-AList-æ·»åŠ å¿«æ·å¯åŠ¨å’Œæš‚åœ">ä¸º AList æ·»åŠ å¿«æ·å¯åŠ¨å’Œæš‚åœ</h2>
<p>åœ¨ alist ç›®å½•ä¸‹å»ºä¸¤ä¸ªæ–‡æœ¬ï¼Œåç¼€æ”¹ä¸º vbsï¼Œå‘é€å¿«æ·æ–¹å¼åˆ°æ¡Œé¢å³å¯ã€‚</p>
<p>start.vbs</p>
<figure class="highlight vbscript"><table><tr><td class="code"><pre><span class="line">#å¿«æ·è¿è¡Œ</span><br><span class="line"></span><br><span class="line"><span class="keyword">Dim</span> ws</span><br><span class="line"><span class="keyword">Set</span> ws = Wscript.<span class="built_in">CreateObject</span>(<span class="string">&quot;Wscript.Shell&quot;</span>)</span><br><span class="line">ws.run <span class="string">&quot;alist.exe server&quot;</span>,vbhide</span><br><span class="line">Wscript.quit</span><br></pre></td></tr></table></figure>
<p>stop.vbs</p>
<figure class="highlight vbscript"><table><tr><td class="code"><pre><span class="line">#å¿«æ·æš‚åœ</span><br><span class="line"></span><br><span class="line"><span class="keyword">Dim</span> ws</span><br><span class="line"><span class="keyword">Set</span> ws = Wscript.<span class="built_in">CreateObject</span>(<span class="string">&quot;Wscript.Shell&quot;</span>)</span><br><span class="line">ws.run <span class="string">&quot;taskkill /f /im alist.exe&quot;</span>,<span class="number">0</span></span><br><span class="line">Wscript.quit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="æŒ‚è½½é˜¿é‡Œäº‘ç›˜">æŒ‚è½½é˜¿é‡Œäº‘ç›˜</h2>
<p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://alist.nn.ci/zh/guide/drivers/aliyundrive_open.html">é˜¿é‡Œäº‘ç›˜ Open | AList æ–‡æ¡£ (nn.ci)</a></p>
<h2 id="å¤–ç½‘è®¿é—®">å¤–ç½‘è®¿é—®</h2>
<p>å¦‚æœæ²¡æœ‰äº‘æœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡å†…ç½‘ç©¿é€çš„æ–¹å¼è¾¾åˆ°å¤–ç½‘è®¿é—®</p>
<p>æ¨±èŠ±ç©¿é€ï¼š[SakuraFrp (<a href="http://natfrp.com">natfrp.com</a>)](<a href="https://www.natfrp.com/user/">SakuraFrp (natfrp.com)</a>)</p>
]]></content>
      <categories>
        <category>Records</category>
      </categories>
      <tags>
        <tag>Alist</tag>
      </tags>
  </entry>
  <entry>
    <title>Aop</title>
    <url>/2025/09/15/Aop/</url>
    <content><![CDATA[<h2 id="Aop">Aop</h2>
<ol>
<li>åˆ‡é¢ï¼šç”¨äºå®ç°é€šçŸ¥æ–¹æ³•çš„ç±»</li>
<li>æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼šåœ¨æ ¸å¿ƒä¸šåŠ¡ä¸­åˆ†ç¦»å‡ºæ¥çš„éæ ¸å¿ƒä¸šåŠ¡ï¼Œé€šçŸ¥æ–¹æ³•çš„æ–¹æ³•ä½“</li>
<li>è¿æ¥ç‚¹ï¼šç”¨æ¥è¿è¡Œé€šçŸ¥æ–¹æ³•çš„ä½ç½®</li>
<li>åˆ‡å…¥ç‚¹ï¼šç”¨åˆ‡å…¥è¡¨è¾¾å¼è®¡ç®—å‡ºè¿æ¥ç‚¹ã€‚</li>
<li>é€šçŸ¥:æ¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹éœ€è¦åŒ…è£…æˆä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±å«åšé€šçŸ¥</li>
</ol>
<h3 id="åŸºäºæ³¨è§£">åŸºäºæ³¨è§£</h3>
<h4 id="å¼€å¯è‡ªåŠ¨ä»£ç†">å¼€å¯è‡ªåŠ¨ä»£ç†</h4>
<p><code> &lt;aop:aspectj-autoproxy /&gt;</code></p>
<p>@Aspectï¼šåˆ‡é¢æ ‡è®°</p>
<ol>
<li>
<p>é€šçŸ¥ï¼š</p>
<ol>
<li>
<p>@Before	:å‰ç½®</p>
<p>å‚æ•°ï¼šJoinPoint joinPoint</p>
</li>
<li>
<p>@AfterReturning(returning=â€œresultâ€)  ï¼šè¿”å›</p>
<p>å‚æ•°ï¼šObject result</p>
</li>
<li>
<p>@AfterThrowing(throwing=â€œeâ€) :  å¼‚å¸¸</p>
<p>å‚æ•°ï¼šException|Throwable e</p>
</li>
<li>
<p>@After</p>
</li>
<li>
<p>@Around()</p>
<p>å‚æ•°ï¼šProceedingJoinPoint joinPoint</p>
</li>
</ol>
</li>
<li>
<p>åˆ‡å…¥ç‚¹ï¼š</p>
<p>@Pointcut(â€œexecution=(public int zornage.online.Entity.User.toString(int i))â€)  =  (â€œ* zorange.onlineâ€¦*(â€¦)â€)</p>
</li>
<li>
<p>ä¼˜å…ˆçº§</p>
<p>@round(â€œ1â€)  è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œé»˜è®¤ä¸ºIntegeræœ€å¤§å€¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OneAspect</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ‡ç‚¹</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public  int online.zorange.annotation.CalculatorImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Before(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="comment">// è·å–æ–¹æ³•åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        <span class="comment">// è·å–å‚æ•°</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰ç½®é€šçŸ¥&quot;</span>+name+<span class="string">&quot;æ–¹æ³•æ‰§è¡Œäº†&quot;</span>+args[<span class="number">0</span>]+<span class="string">&quot;,&quot;</span>+args[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@After(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®é€šçŸ¥&quot;</span>+name+<span class="string">&quot;æ–¹æ³•æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®è¿”å›å€¼å‚æ•° returning = &quot;result&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint // è¿æ¥ç‚¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result // è¿”å›å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;pointCut()&quot;,returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">afterReturning</span><span class="params">(JoinPoint joinPoint ,Object result)</span>&#123;</span><br><span class="line">        joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿”å›é€šçŸ¥ ,ç»“æœï¼š&quot;</span>+result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼‚å¸¸é€šçŸ¥</span></span><br><span class="line"><span class="comment">     * è®¾ç½®å¼‚å¸¸å‚æ•° throwing = &quot;e&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterThrowing(pointcut = &quot;pointCut()&quot;,throwing = &quot;e&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">afterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼‚å¸¸é€šçŸ¥&quot;</span>+name+<span class="string">&quot;æ–¹æ³•æŠ›å‡ºå¼‚å¸¸äº†&quot;</span>+e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¯ç»•é€šçŸ¥</span></span><br><span class="line"><span class="comment">     * å¿…é¡»æœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="comment">     * æœ‰ä¸€ä¸ªä¸“é—¨çš„å‚æ•° ProceedingJoinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="comment">// è·å–æ–¹æ³•åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        <span class="comment">// è·å–å‚æ•°</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å‰ç½®é€šçŸ¥</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥&quot;</span>+name+<span class="string">&quot;æ–¹æ³•æ‰§è¡Œäº†&quot;</span>+<span class="string">&quot;å‚æ•°ï¼š&quot;</span>+ Arrays.toString(args));</span><br><span class="line">            <span class="comment">// æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">            result = joinPoint.proceed();</span><br><span class="line">            <span class="comment">// è¿”å›é€šçŸ¥</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥&quot;</span>+name+<span class="string">&quot;æ–¹æ³•æ‰§è¡Œäº†&quot;</span>+<span class="string">&quot;ç»“æœï¼š&quot;</span>+result);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Throwable e)&#123;</span><br><span class="line">            <span class="comment">// å¼‚å¸¸é€šçŸ¥</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥&quot;</span>+name+<span class="string">&quot;æ–¹æ³•æ‰§è¡Œäº†&quot;</span>+<span class="string">&quot;å¼‚å¸¸ï¼š&quot;</span>+e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// åç½®é€šçŸ¥</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥&quot;</span>+name+<span class="string">&quot;æ–¹æ³•æ‰§è¡Œäº†&quot;</span>+<span class="string">&quot;æœ€ç»ˆæ‰§è¡Œ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="åŸºäºé…ç½®æ–‡ä»¶">åŸºäºé…ç½®æ–‡ä»¶</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®ç›®æ ‡ç±»çš„bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;calculatorPure&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.aop.imp.CalculatorPureImpl&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- é…ç½®åˆ‡é¢ç±»çš„bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;logAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.aop.aspect.LogAspect&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- é…ç½®AOP --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;logPointCut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *..*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- aop:aspectæ ‡ç­¾ï¼šé…ç½®åˆ‡é¢ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- refå±æ€§ï¼šå…³è”åˆ‡é¢ç±»çš„bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;logAspect&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- aop:beforeæ ‡ç­¾ï¼šé…ç½®å‰ç½®é€šçŸ¥ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- methodå±æ€§ï¼šæŒ‡å®šå‰ç½®é€šçŸ¥çš„æ–¹æ³•å --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- pointcut-refå±æ€§ï¼šå¼•ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;printLogBeforeCore&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;logPointCut&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- aop:after-returningæ ‡ç­¾ï¼šé…ç½®è¿”å›é€šçŸ¥ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- returningå±æ€§ï¼šæŒ‡å®šé€šçŸ¥æ–¹æ³•ä¸­ç”¨æ¥æ¥æ”¶ç›®æ ‡æ–¹æ³•è¿”å›å€¼çš„å‚æ•°å --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span></span></span><br><span class="line"><span class="tag">                <span class="attr">method</span>=<span class="string">&quot;printLogAfterCoreSuccess&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">pointcut-ref</span>=<span class="string">&quot;logPointCut&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">returning</span>=<span class="string">&quot;targetMethodReturnValue&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- aop:after-throwingæ ‡ç­¾ï¼šé…ç½®å¼‚å¸¸é€šçŸ¥ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- throwingå±æ€§ï¼šæŒ‡å®šé€šçŸ¥æ–¹æ³•ä¸­ç”¨æ¥æ¥æ”¶ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„å¼‚å¸¸å¯¹è±¡çš„å‚æ•°å --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span></span></span><br><span class="line"><span class="tag">                <span class="attr">method</span>=<span class="string">&quot;printLogAfterCoreException&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">pointcut-ref</span>=<span class="string">&quot;logPointCut&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">throwing</span>=<span class="string">&quot;targetMethodException&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- aop:afteræ ‡ç­¾ï¼šé…ç½®åç½®é€šçŸ¥ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;printLogCoreFinallyEnd&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;logPointCut&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- aop:aroundæ ‡ç­¾ï¼šé…ç½®ç¯ç»•é€šçŸ¥ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;aop:around method=&quot;â€¦â€¦&quot; pointcut-ref=&quot;logPointCut&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="å£°æ˜æ—¶äº‹åŠ¡">å£°æ˜æ—¶äº‹åŠ¡</h2>
<blockquote>
<p><strong>ç¼–ç¨‹å¼äº‹åŠ¡</strong>ï¼šéœ€è¦æ‰‹åŠ¨å»å®ç°äº‹åŠ¡çš„åŠŸèƒ½å‘¢</p>
</blockquote>
<blockquote>
<p><strong>å£°æ˜å¼äº‹åŠ¡</strong>ï¼šåªéœ€è¦å£°æ˜äº‹åŠ¡ï¼Œå…·ä½“çš„åŠŸèƒ½ç”±æ¡†æ¶å®Œæˆã€‚</p>
</blockquote>
<p>äº‹åŠ¡ç‰¹æ€§ï¼š</p>
<ol>
<li>
<p><strong>åŸå­æ€§</strong>ï¼šäº‹åŠ¡è¢«è§†ä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„å•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</p>
</li>
<li>
<p><strong>ä¸€è‡´æ€§</strong>ï¼šäº‹åŠ¡å°†æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§è½¬æ¢åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€</p>
</li>
<li>
<p><strong>éš”ç¦»æ€§</strong>ï¼šå¤šä¸ªå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¸ä¼šå¹²æ‰°ï¼Œ</p>
<ol>
<li><strong>éš”ç¦»çº§åˆ«</strong>ï¼š
<ol>
<li><strong>è¯»æœªæäº¤ (Read Uncommitted)</strong>ï¼šæä¾›äº†æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå¯èƒ½å¯¼è‡´è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li>
<li><strong>è¯»å·²æäº¤ (Read Committed)</strong>ï¼šé˜²æ­¢è„è¯»ï¼Œä½†ä»ç„¶å¯èƒ½é‡åˆ°ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li>
<li><strong>å¯é‡å¤è¯» (Repeatable Read)</strong>ï¼šé˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†ä»ç„¶å¯èƒ½å‘ç”Ÿå¹»è¯»ã€‚==å¯¹æ­£åœ¨æ“ä½œçš„æ•°æ®åŠ é”ã€‚==</li>
<li><strong>åºåˆ—åŒ– (Serializable)</strong>ï¼šé˜²æ­¢æ‰€æœ‰å¹¶å‘é—®é¢˜ï¼Œä½†å¯èƒ½ä¼šå¼•èµ·è¾ƒé«˜çš„é”å®šå¼€é”€ã€‚==å¯¹è¡¨åŠ é”==</li>
</ol>
</li>
<li>è„è¯»ï¼šè¯»åˆ°äº†æœªæäº¤çš„æ•°æ®</li>
<li>ä¸å¯é‡å¤è¯»ï¼šåªèƒ½è¯»åˆ°å·²ç»æäº¤çš„æ•°æ®ï¼Œè¯»ä¸¤æ¬¡çš„æ•°æ®å¯èƒ½ä¸ä¸€æ ·</li>
<li>å¹»è¯»ï¼šå¯¹æ²¡æœ‰åŠ é”çš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œå½“å…¶ä»–äº‹åŠ¡æ“ä½œäº†ä¹‹åï¼Œå¯èƒ½ä¸¤æ¬¡è¯»åˆ°æ•°æ®ä¸ä¸€æ ·ã€‚</li>
</ol>
</li>
<li>
<p><strong>æŒä¹…æ€§</strong>ï¼š</p>
<p>ä¸€æ—¦äº‹åŠ¡è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ”¹å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå¹¶ä¸”ä¸èƒ½å› ä¸ºä»»ä½•ç³»ç»Ÿæ•…éšœè€Œä¸¢å¤±ã€‚</p>
<p>å³ä½¿æ˜¯åœ¨ç³»ç»Ÿå´©æºƒä¹‹åï¼Œä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå®ƒçš„ç»“æœä¹Ÿå¿…é¡»æ˜¯å¯ç”¨çš„ã€‚</p>
</li>
</ol>
<h3 id="åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡">åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡</h3>
<ol>
<li>
<p><strong>é…ç½®äº‹åŠ¡ç®¡ç†å™¨</strong></p>
<p>é…ç½®è¿æ¥å¯¹è±¡ï¼Œä¾èµ–æ•°æ®æº: å› ä¸ºäº‹çš„å¼€å¯æ˜¯Connectionå¯¹è±¡å¼€å¯çš„ï¼Œæ‰€ä»¥äº‹åŠ¡ç®¡ç†å°±ä¾èµ–æ•°æ®æºç®¡ç†å¯¹è±¡ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;DataSourceTransactionManager&quot;</span> &gt;</span></span><br><span class="line"> //æ•°æ®æº   </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;DataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>å¼€å¯äº‹åŠ¡æ³¨è§£é©±åŠ¨</strong>(è¿æ¥ç‚¹)</p>
<p>@Transactional   æ ‡è®°è¿æ¥ç‚¹çš„æ³¨è§£ã€‚ä¸€èˆ¬æ˜¯åŠ åœ¨Serviceå±‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>â€‹	==æ ‡è®°ä½ç½®==ï¼šç±»æˆ–æ–¹æ³•ã€‚</p>
<h3 id="å£°æ˜å¼äº‹åŠ¡å±æ€§">å£°æ˜å¼äº‹åŠ¡å±æ€§</h3>
<ol>
<li>
<p><strong>äº‹åŠ¡åªè¯»</strong>ï¼šreadOnly=â€œfalseâ€</p>
<p>åŠŸèƒ½ï¼šå¯¹äº==å…¨éƒ¨éƒ½æ˜¯æŸ¥è¯¢çš„æ“ä½œ==ï¼Œå¯ä»¥è®¾ç½®äº‹åŠ¡åªè¯»ï¼Œæ­¤æ—¶ä¼šé€šçŸ¥æ•°æ®åº“å½“å‰æ“ä½œä¸ºåªè¯»æ“ä½œï¼Œä¼šä»==æ•°æ®åº“å±‚é¢==ä¼˜åŒ–å½“å‰æ“ä½œã€‚æé«˜æ•ˆç‡. è‹¥æ“ä½œä¸­å­˜åœ¨å¢åˆ æ”¹æ“ä½œæ—¶ï¼Œä¼šæŠ¥é”™ Connection is read only</p>
<blockquote>
<p>æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼Œä¼šå¯¹è¡¨åŠ é”ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>è¶…æ—¶æ—¶é—´</strong>ï¼šè¶…æ—¶å›æ»šï¼Œé‡Šæ”¾èµ„æº</p>
<p>timeout=â€œ-1â€</p>
<p>-1:ä¸€ç›´ç­‰ ï¼Œé»˜è®¤å•ä½ç§’ã€‚</p>
<p>åœºæ™¯ï¼šäº‹åŠ¡è¶…è¿‡æŒ‡å®šæ—¶é—´æœªæ‰§è¡Œå®Œæ¯•ã€‚å¼ºåˆ¶å›æ»šï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸TransactionTimeOutException</p>
</li>
<li>
<p><strong>å›æ»šç­–ç•¥</strong>ï¼š</p>
<p>rollBackFor = å­—èŠ‚ç å¯¹è±¡</p>
<p>rollBackForClassName  = å…¨ç±»å</p>
<p>noRollBackFor</p>
<p>noRollBackForClassName</p>
<p>é»˜è®¤æ‰€æœ‰è¿è¡Œæ—¶å¼‚å¸¸å›æ»šã€‚</p>
<p>è®¾ç½®è§¦å‘æˆ–ä¸è§¦å‘å›æ»šçš„å¼‚å¸¸ç±»å‹ï¼š</p>
</li>
<li>
<p><strong>éš”ç¦»çº§åˆ«</strong>:</p>
<p>isoLation=â€œDEFAULTâ€</p>
<ol>
<li>DEFAULT:é»˜è®¤éš”ç¦»çº§åˆ«ï¼Œæ•°æ®åº“å†³å®š</li>
<li>READ_UNCOMMITTED  ä¸å¯é‡å¤è¯»</li>
<li>READ_COMMITTED</li>
<li>Repeatable Read  å¯é‡å¤è¯»</li>
<li>SERVILAZIABLE åºåˆ—åŒ–</li>
</ol>
</li>
<li>
<p><strong>ä¼ æ’­è¡Œä¸º</strong>ï¼š</p>
<p>propagation =&quot;REQUIRED &quot;</p>
<ol>
<li>
<p>REQUIRED   è°ƒç”¨è€…çš„äº‹åŠ¡</p>
</li>
<li>
<p>REQUIRES_NEW   è¢«è°ƒç”¨è€…çš„äº‹åŠ¡</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>REQUIRED 
é»˜è®¤å€¼</td>
<td>å½“å‰æ–¹æ³•å¿…é¡»å·¥ä½œåœ¨äº‹åŠ¡ä¸­ 
å¦‚æœå½“å‰çº¿ç¨‹ä¸Šæœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡å¯ç”¨ï¼Œé‚£ä¹ˆå°±åœ¨è¿™ä¸ªäº‹åŠ¡ä¸­è¿è¡Œ 
å¦‚æœå½“å‰çº¿ç¨‹ä¸Šæ²¡æœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡ï¼Œé‚£ä¹ˆå°±è‡ªå·±å¼€å¯æ–°äº‹åŠ¡ï¼Œåœ¨æ–°äº‹åŠ¡ä¸­è¿è¡Œ 
æ‰€ä»¥å½“å‰æ–¹æ³•æœ‰å¯èƒ½å’Œå…¶ä»–æ–¹æ³•å…±ç”¨äº‹åŠ¡ 
åœ¨å…±ç”¨äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼šå½“å‰æ–¹æ³•ä¼šå› ä¸ºå…¶ä»–æ–¹æ³•å›æ»šè€Œå—è¿ç´¯</td>
</tr>
<tr>
<td>REQUIRES_NEW</td>
<td>å½“å‰æ–¹æ³•å¿…é¡»å·¥ä½œåœ¨äº‹åŠ¡ä¸­ 
ä¸ç®¡å½“å‰çº¿ç¨‹ä¸Šæ˜¯å¦æœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡ï¼Œéƒ½è¦å¼€å¯æ–°äº‹åŠ¡ 
åœ¨æ–°äº‹åŠ¡ä¸­è¿è¡Œ 
ä¸ä¼šå’Œå…¶ä»–æ–¹æ³•å…±ç”¨äº‹åŠ¡ï¼Œé¿å…è¢«å…¶ä»–æ–¹æ³•è¿ç´¯</td>
</tr>
</tbody>
</table>
</li>
</ol>
<p>è¢«ä¼ æ’­çš„äº‹åŠ¡ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯äº‹åŠ¡æ˜¯å…¶è°ƒç”¨è€…çš„äº‹åŠ¡ã€‚</p>
<p>A-&gt;B,Aå’ŒBéƒ½æœ‰äº‹åŠ¡ï¼Œé»˜è®¤Bä½¿ç”¨çš„Açš„äº‹åŠ¡ã€‚==é’ˆå¯¹Bäº‹åŠ¡è®¾ç½®==ï¼Œä¸”å¿…é¡»ä¸ºä¸åŒç±»ä¸­çš„æ–¹æ³•ã€‚</p>
</li>
</ol>
<h3 id="åŸºäºXMlçš„å£°æ˜å¼äº‹åŠ¡">åŸºäºXMlçš„å£°æ˜å¼äº‹åŠ¡</h3>
<ol>
<li>
<p><strong>é…ç½®äº‹åŠ¡ç®¡ç†å™¨</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;DataSourceTransactionManager&quot;</span> &gt;</span></span><br><span class="line"> //æ•°æ®æº   </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;DataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>è®¾ç½®äº‹åŠ¡é€šçŸ¥</strong> (è¿æ¥ç‚¹)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;tx&quot;</span> <span class="attr">tranaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">    //äº‹åŠ¡å±æ€§,å¿…é¡»æŒ‡å®šã€‚</span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;menthod()&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:method</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;add*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:method</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">&lt;aop:advisor&gt; æ ‡ç­¾ï¼šç”¨äºå°†ä¸€ä¸ªå·²ç»å®šä¹‰å¥½çš„Adviceå’Œä¸€ä¸ªPointcutç»‘å®šåœ¨ä¸€èµ·ã€‚</span></span><br><span class="line"><span class="comment">Advisoræ˜¯ä¸€ä¸ªç®€å•çš„åˆ‡é¢å®ç°ï¼Œå®ƒåªéœ€è¦ä¸€ä¸ªAdviceå’Œä¸€ä¸ªPointcutå°±å¯ä»¥å·¥ä½œã€‚</span></span><br><span class="line"><span class="comment">åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡advice-refå±æ€§å¼•ç”¨ä¸€ä¸ªå·²ç»å®šä¹‰å¥½çš„Adviceï¼Œé€šè¿‡pointcut-expressionæˆ–pointcut-refå±æ€§æ¥æŒ‡å®šPointcutã€‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    //</span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;tx&quot;</span> </span></span><br><span class="line"><span class="tag">                 <span class="attr">pointcut</span>=<span class="string">&quot;excution(* online.zorange.service..*(..) )&quot;</span>&gt;</span>				<span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Dockerå®‰è£…</title>
    <url>/2025/09/15/Docker%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="æ›´æ–°yumæº">æ›´æ–°yumæº</h2>
<h3 id="æ­¥éª¤-1ï¼šå¤‡ä»½ç°æœ‰çš„-YUM-æºé…ç½®">æ­¥éª¤ 1ï¼šå¤‡ä»½ç°æœ‰çš„ YUM æºé…ç½®</h3>
<p>é¦–å…ˆï¼Œå¤‡ä»½å½“å‰çš„ YUM æºé…ç½®æ–‡ä»¶ï¼Œä»¥é˜²éœ€è¦æ¢å¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure>
<h3 id="æ­¥éª¤-2ï¼šä¸‹è½½é˜¿é‡Œäº‘çš„-YUM-æºé…ç½®æ–‡ä»¶">æ­¥éª¤ 2ï¼šä¸‹è½½é˜¿é‡Œäº‘çš„ YUM æºé…ç½®æ–‡ä»¶</h3>
<p>ä½¿ç”¨ wget ä¸‹è½½é˜¿é‡Œäº‘çš„ CentOS 7 YUM æºé…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure>
<h3 id="æ­¥éª¤-3ï¼šæ¸…é™¤ç¼“å­˜å¹¶ç”Ÿæˆæ–°çš„ç¼“å­˜">æ­¥éª¤ 3ï¼šæ¸…é™¤ç¼“å­˜å¹¶ç”Ÿæˆæ–°çš„ç¼“å­˜</h3>
<p>æ¸…é™¤æ—§çš„ YUM ç¼“å­˜å¹¶ç”Ÿæˆæ–°çš„ç¼“å­˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  sudo yum clean all</span><br><span class="line">sudo yum makecache</span><br></pre></td></tr></table></figure>
<h3 id="æ­¥éª¤-4ï¼šéªŒè¯-YUM-æºæ˜¯å¦é…ç½®æˆåŠŸ">æ­¥éª¤ 4ï¼šéªŒè¯ YUM æºæ˜¯å¦é…ç½®æˆåŠŸ</h3>
<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å¯ç”¨çš„æ›´æ–°åŒ…ï¼Œç¡®ä¿æ–°æºé…ç½®æ­£ç¡®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum repolist</span><br></pre></td></tr></table></figure>
<p>å®Œæˆåçš„æ•ˆæœ</p>
<p>ä½ ç°åœ¨å·²ç»æˆåŠŸå°† CentOS 7 çš„ YUM æºåˆ‡æ¢ä¸ºé˜¿é‡Œäº‘é•œåƒæºã€‚è¿™å°†æé«˜ä¸‹è½½é€Ÿåº¦å’Œè½¯ä»¶åŒ…æ›´æ–°çš„æ•ˆç‡ï¼Œå› ä¸ºé˜¿é‡Œäº‘çš„é•œåƒæœåŠ¡å™¨é€šå¸¸æ¯”å®˜æ–¹æºæ›´å¿«ï¼Œç‰¹åˆ«æ˜¯åœ¨å›½å†…ã€‚</p>
<h3 id="wegtä¸å­˜åœ¨">wegtä¸å­˜åœ¨</h3>
<h4 id="ä¸‹è½½é˜¿é‡Œäº‘-YUM-ä»“åº“é…ç½®æ–‡ä»¶">ä¸‹è½½é˜¿é‡Œäº‘ YUM ä»“åº“é…ç½®æ–‡ä»¶</h4>
<p>ç”±äºä½ æ— æ³•ä½¿ç”¨ yum å®‰è£… wgetï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ·»åŠ é˜¿é‡Œäº‘çš„ YUM ä»“åº“é…ç½®æ–‡ä»¶ã€‚</p>
<p>è¿›å…¥ /etc/yum.repos.d/ ç›®å½•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-curlï¼ˆé€šå¸¸æ˜¯é»˜è®¤å®‰è£…çš„ï¼‰æ¥ä¸‹è½½é˜¿é‡Œäº‘çš„-YUM-é…ç½®æ–‡ä»¶ï¼š">ä½¿ç”¨ curlï¼ˆé€šå¸¸æ˜¯é»˜è®¤å®‰è£…çš„ï¼‰æ¥ä¸‹è½½é˜¿é‡Œäº‘çš„ YUM é…ç½®æ–‡ä»¶ï¼š</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo curl -o CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure>
<h4 id="æ¸…é™¤-YUM-ç¼“å­˜å¹¶ç”Ÿæˆæ–°ç¼“å­˜">æ¸…é™¤ YUM ç¼“å­˜å¹¶ç”Ÿæˆæ–°ç¼“å­˜</h4>
<p>é…ç½®å®Œ YUM ä»“åº“åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¸…é™¤æ—§ç¼“å­˜å¹¶ç”Ÿæˆæ–°ç¼“å­˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  sudo yum clean all</span><br><span class="line">sudo yum makecache</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‹è½½Docker">ä¸‹è½½Docker</h2>
<h3 id="æ­¥éª¤-1ï¼šæ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…">æ­¥éª¤ 1ï¼šæ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…</h3>
<p>é¦–å…ˆï¼Œç¡®ä¿ä½ çš„ç³»ç»Ÿè½¯ä»¶åŒ…æ˜¯æœ€æ–°çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum update -y</span><br></pre></td></tr></table></figure>
<h3 id="æ­¥éª¤-2ï¼šå®‰è£…ä¾èµ–åŒ…">æ­¥éª¤ 2ï¼šå®‰è£…ä¾èµ–åŒ…</h3>
<p>å®‰è£…ä¸€äº›å¿…è¦çš„ä¾èµ–åŒ…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>
<h3 id="æ­¥éª¤-3ï¼šæ·»åŠ -Docker-ä»“åº“">æ­¥éª¤ 3ï¼šæ·»åŠ  Docker ä»“åº“</h3>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ  Docker é˜¿é‡Œäº‘ä»“åº“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
<h3 id="æ­¥éª¤-4ï¼šå®‰è£…-Docker">æ­¥éª¤ 4ï¼šå®‰è£… Docker</h3>
<p>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Dockerï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum install  docker-ce docker-ce-cli containerd.io  -y</span><br></pre></td></tr></table></figure>
<h3 id="æ­¥éª¤-5ï¼šå¯åŠ¨-Docker-æœåŠ¡">æ­¥éª¤ 5ï¼šå¯åŠ¨ Docker æœåŠ¡</h3>
<p>å®‰è£…å®Œæˆåï¼Œå¯åŠ¨ Docker æœåŠ¡å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  sudo systemctl start docker</span><br><span class="line">sudo systemctl enable docker</span><br></pre></td></tr></table></figure>
<h3 id="æ­¥éª¤-6ï¼šéªŒè¯-Docker-å®‰è£…">æ­¥éª¤ 6ï¼šéªŒè¯ Docker å®‰è£…</h3>
<p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ Docker æ˜¯å¦å·²æ­£ç¡®å®‰è£…å¹¶æ­£åœ¨è¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker --version</span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥è¿è¡Œä¸€ä¸ªæµ‹è¯•å®¹å™¨æ¥ç¡®è®¤ Docker æ­£å¸¸å·¥ä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>
<h3 id="å…¶ä»–æ³¨æ„äº‹é¡¹">å…¶ä»–æ³¨æ„äº‹é¡¹</h3>
<p>é˜²ç«å¢™é…ç½®ï¼šå¦‚æœä½ çš„é˜²ç«å¢™å¯ç”¨äº†ï¼Œç¡®ä¿ Docker çš„ç½‘ç»œé€šä¿¡ç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ è®¡åˆ’åœ¨è¿™å°æœºå™¨ä¸Šè¿è¡Œ Docker æœåŠ¡å¹¶å¯¹å¤–æä¾›æœåŠ¡ã€‚</p>
<p>ç”¨æˆ·æƒé™ï¼šå¦‚æœä½ å¸Œæœ›å½“å‰ç”¨æˆ·æ— éœ€ sudo æƒé™å°±å¯ä»¥è¿è¡Œ Docker å‘½ä»¤ï¼Œå¯ä»¥å°†è¯¥ç”¨æˆ·æ·»åŠ åˆ° docker ç”¨æˆ·ç»„ï¼š<br>
sudo usermod -aG docker $USER<br>
ç„¶åé€€å‡ºå¹¶é‡æ–°ç™»å½•ä»¥åº”ç”¨æ›´æ”¹ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Echarts</title>
    <url>/2023/11/01/Echarts/</url>
    <content><![CDATA[<p><a href="https://echarts.apache.org/zh/index.html">Echarts å®˜ç½‘</a>																																							â­</p>
<h2 id="ğŸ“–å®‰è£…">ğŸ“–å®‰è£…</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm i echarts -S</span><br></pre></td></tr></table></figure>
<h2 id="ğŸ”—å¼•å…¥">ğŸ”—å¼•å…¥</h2>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&quot;echarts&quot;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="ä¾‹å­ï¼š">ä¾‹å­ï¼š</h2>
<h3 id="åç«¯æ¥å£">åç«¯æ¥å£</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.Quarter;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.common.Result;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.entity.User;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/echarts&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EchartsController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/get&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;x&quot;</span>, CollUtil.newArrayList(<span class="string">&quot;Mon&quot;</span>, <span class="string">&quot;Tue&quot;</span>, <span class="string">&quot;Wed&quot;</span>, <span class="string">&quot;Thu&quot;</span>, <span class="string">&quot;Fri&quot;</span>, <span class="string">&quot;Sat&quot;</span>, <span class="string">&quot;Sun&quot;</span>));</span><br><span class="line">        map.put(<span class="string">&quot;y&quot;</span>, CollUtil.newArrayList(<span class="number">820</span>, <span class="number">932</span>, <span class="number">901</span>, <span class="number">934</span>, <span class="number">1290</span>, <span class="number">1330</span>, <span class="number">1320</span>));</span><br><span class="line">        <span class="keyword">return</span> Result.success(map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å„å­£åº¦æ–°å¢ç”¨æˆ·æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;members&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">members</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;User&gt; users=userService.list();</span><br><span class="line">        <span class="type">int</span> q1=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> q2=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> q3=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> q4=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(User user : users)&#123;</span><br><span class="line">            Date creatTime=user.getCreatTime();</span><br><span class="line">            <span class="comment">//è·å–å­£åº¦</span></span><br><span class="line">            Quarter quarter= DateUtil.quarterEnum(creatTime);</span><br><span class="line">            <span class="keyword">switch</span> (quarter)&#123;</span><br><span class="line">                <span class="keyword">case</span> Q1: q1++;<span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Q2: q2++;<span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Q3: q3++;<span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Q4: q4++;<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.success(CollUtil.newArrayList(q1,q2,q3,q4));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="å‰ç«¯">å‰ç«¯</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;!--      el-colï¼š--&gt;</span><br><span class="line">  &lt;!--      el-colæ˜¯element-uiä¸­çš„æ …æ ¼å¸ƒå±€ç»„ä»¶ï¼Œç”¨äºå°†é¡µé¢åˆ†å‰²æˆ24åˆ—ï¼Œé€šè¿‡æ§åˆ¶el-colçš„spanå±æ€§æ¥æ§åˆ¶å…ƒç´ å æ®çš„åˆ—æ•°--&gt;</span><br><span class="line">  &lt;!--      ä¾‹å¦‚ï¼šel-col :span=&quot;12&quot;è¡¨ç¤ºå…ƒç´ å æ®12åˆ—ï¼Œå æ®ä¸€åŠçš„å®½åº¦--&gt;</span><br><span class="line">  &lt;el-row&gt;</span><br><span class="line">      &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">        &lt;div id=&quot;main&quot; style=&quot;width: 600px;height:600px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">      &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">        &lt;div id=&quot;pie&quot; style=&quot;width: 600px;height:600px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import  * as  echarts from &#x27;echarts&#x27;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Home&quot;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123; //é¡µé¢å…ƒç´ æ¸²æŸ“ä¹‹åå†è§¦å‘</span><br><span class="line">    //æŠ˜çº¿å›¾</span><br><span class="line">    const chartDom = document.getElementById(&#x27;main&#x27;);</span><br><span class="line">    const myChart = echarts.init(chartDom);</span><br><span class="line">    let option;</span><br><span class="line">    option = &#123;</span><br><span class="line">      title:&#123;</span><br><span class="line">        text:&#x27;ä¼šå‘˜ç»Ÿè®¡&#x27;,</span><br><span class="line">        subtext:&#x27;å„å­£åº¦ä¼šå‘˜ç»Ÿè®¡&#x27;,</span><br><span class="line">        left:&#x27;center&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">      xAxis: &#123;</span><br><span class="line">        type: &#x27;category&#x27;,</span><br><span class="line">        data: [&#x27;ç¬¬ä¸€å­£åº¦&#x27;, &#x27;ç¬¬äºŒå­£åº¦&#x27;, &#x27;ç¬¬ä¸‰å­£åº¦&#x27;, &#x27;ç¬¬å››å­£åº¦&#x27;]</span><br><span class="line">      &#125;,</span><br><span class="line">      yAxis: &#123;</span><br><span class="line">        type: &#x27;value&#x27;</span><br><span class="line">      &#125;,</span><br><span class="line">      series: [</span><br><span class="line">        &#123;</span><br><span class="line">          data: [],</span><br><span class="line">          type: &#x27;line&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          data: [],</span><br><span class="line">          type: &#x27;bar&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    //é¥¼å›¾</span><br><span class="line">    const pieDom = document.getElementById(&#x27;pie&#x27;);</span><br><span class="line">    const pieChar = echarts.init(pieDom);</span><br><span class="line">    let peiOption = &#123;</span><br><span class="line">      title:&#123;</span><br><span class="line">        text:&#x27;ä¼šå‘˜ç»Ÿè®¡&#x27;,</span><br><span class="line">        subtext:&#x27;æ¯”ä¾‹å›¾&#x27;,</span><br><span class="line">        left:&#x27;center&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">      legend: &#123;</span><br><span class="line">        top: &#x27;bottom&#x27;</span><br><span class="line">      &#125;,</span><br><span class="line">      toolbox: &#123;</span><br><span class="line">        show: true,</span><br><span class="line">        feature: &#123;</span><br><span class="line">          mark: &#123; show: true &#125;,</span><br><span class="line">          dataView: &#123; show: true, readOnly: false &#125;,</span><br><span class="line">          restore: &#123; show: true &#125;,</span><br><span class="line">          saveAsImage: &#123; show: true &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      series: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: &#x27;pie&#x27;,</span><br><span class="line">          radius: [50, 250],</span><br><span class="line">          center: [&#x27;50%&#x27;, &#x27;50%&#x27;],</span><br><span class="line">          roseType: &#x27;area&#x27;,</span><br><span class="line">          itemStyle: &#123;</span><br><span class="line">            borderRadius: 8</span><br><span class="line">          &#125;,</span><br><span class="line">          data: []</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    //å¼‚æ­¥è¯·æ±‚æ•°æ®</span><br><span class="line">    this.request.get(&quot;/echarts/members&quot;).then(res=&gt;&#123;</span><br><span class="line">      console.log(res)</span><br><span class="line">      option.series[0].data = res.data</span><br><span class="line">      option.series[1].data = res.data</span><br><span class="line">      // æ•°æ®æ›´æ–°åï¼Œéœ€è¦åˆ·æ–°å›¾è¡¨</span><br><span class="line">      myChart.setOption(option);</span><br><span class="line"></span><br><span class="line">      peiOption.series[0].data = [</span><br><span class="line">        &#123;name:&#x27;ç¬¬ä¸€å­£åº¦&#x27; ,value:res.data[0]&#125;,</span><br><span class="line">        &#123;name:&#x27;ç¬¬äºŒå­£åº¦&#x27; ,value:res.data[1]&#125;,</span><br><span class="line">        &#123;name:&#x27;ç¬¬ä¸‰å­£åº¦&#x27; ,value:res.data[2]&#125;,</span><br><span class="line">        &#123;name:&#x27;ç¬¬å››å­£åº¦&#x27; ,value:res.data[3]&#125;,</span><br><span class="line">      ]</span><br><span class="line">      pieChar.setOption(peiOption);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Echarts</tag>
      </tags>
  </entry>
  <entry>
    <title>Elasticsearch</title>
    <url>/2025/09/15/Elasticsearch/</url>
    <content><![CDATA[<h1>Elasticsearchæ¦‚è¿°</h1>
<h2 id="Elasticsearchçš„ç‰¹æ€§">Elasticsearchçš„ç‰¹æ€§</h2>
<p><strong>å®æ—¶</strong><br>
ç†è®ºä¸Šæ•°æ®ä»å†™å…¥Elasticsearchåˆ°æ•°æ®å¯ä»¥è¢«æœç´¢åªéœ€è¦1ç§’å·¦å³çš„æ—¶é—´ï¼Œå®ç°å‡†å®æ—¶çš„æ•°æ®ç´¢å¼•å’ŒæŸ¥è¯¢ã€‚</p>
<p><strong>åˆ†å¸ƒå¼ã€å¯æ‰©å±•</strong><br>
å¤©ç”Ÿçš„åˆ†å¸ƒå¼çš„è®¾è®¡ï¼Œæ•°æ®åˆ†ç‰‡å¯¹äºåº”ç”¨å±‚é€æ˜ï¼Œæ‰©å±•æ€§è‰¯å¥½ï¼Œå¯ä»¥è½»æ˜“çš„è¿›è¡ŒèŠ‚ç‚¹æ‰©å®¹ï¼Œæ”¯æŒä¸Šç™¾ç”šè‡³ä¸Šåƒçš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œæ”¯æŒPBçº§åˆ«çš„æ•°æ®å­˜å‚¨å’Œæœç´¢ã€‚</p>
<p><strong>ç¨³å®šå¯é </strong><br>
Elasticsearchçš„åˆ†å¸ƒå¼ã€æ•°æ®å†—ä½™ç‰¹æ€§æä¾›æ›´åŠ å¯é çš„è¿è¡Œæœºåˆ¶ï¼Œä¸”ç»è¿‡å¤§å‹äº’è”ç½‘å…¬å¸ä¼—å¤šé¡¹ç›®ä½¿ç”¨ï¼Œå¯é æ€§å¾—åˆ°éªŒè¯ã€‚</p>
<p><strong>é«˜å¯ç”¨</strong><br>
æ•°æ®å¤šå‰¯æœ¬ã€å¤šèŠ‚ç‚¹å­˜å‚¨ï¼Œå•èŠ‚ç‚¹çš„æ•…éšœä¸å½±å“<strong>é›†ç¾¤</strong>çš„ä½¿ç”¨ã€‚</p>
<p><strong>Rest API</strong><br>
Elasticsearchæä¾›æ ‡å‡†çš„Rest APIï¼Œè¿™ä½¿å¾—æ‰€æœ‰æ”¯æŒRest APIçš„è¯­è¨€éƒ½èƒ½å¤Ÿè½»æ˜“çš„ä½¿ç”¨Elasticsearchï¼Œå…·å¤‡å¤šè¯­è¨€é€šç”¨çš„æ”¯æŒç‰¹æ€§ï¼Œæ˜“äºä½¿ç”¨ã€‚Elasticsearch Version 8ä»¥åï¼Œå»é™¤äº†ä»¥å‰Transport APIã€High-Level APIã€Low-Level APIï¼Œç»Ÿä¸€æ ‡å‡†çš„Rest APIï¼Œè¿™å°†ä½¿å¾—Elasticsearchæ›´åŠ å®¹æ˜“ä½¿ç”¨ï¼ŒåŸæ¥è¢«è¯Ÿç—…çš„APIæ··ä¹±é—®é¢˜ç»ˆäºå¾—åˆ°å®Œç¾è§£å†³ã€‚</p>
<p><strong>é«˜æ€§èƒ½</strong><br>
Elasticsearchåº•å±‚æ„å»ºåŸºäºLuceneï¼Œå…·å¤‡å¼ºå¤§çš„æœç´¢èƒ½åŠ›ï¼Œå³ä¾¿æ˜¯PBçº§åˆ«çš„æ•°æ®ä¾ç„¶èƒ½å¤Ÿå®ç°ç§’çº§çš„æœç´¢ã€‚</p>
<p><strong>å¤šå®¢æˆ·ç«¯æ”¯æŒ</strong><br>
æ”¯æŒJavaã€Pythonã€Goã€PHPã€Rubyç­‰å¤šè¯­è¨€å®¢æˆ·ç«¯ï¼Œè¿˜æ”¯æŒJDBCã€ODBCç­‰å®¢æˆ·ç«¯ã€‚</p>
<p><strong>å®‰å…¨æ”¯æŒ</strong><br>
æä¾›å•ç‚¹ç™»å½•SSOã€åŠ å¯†é€šä¿¡ã€é›†ç¾¤è§’è‰²ã€å±æ€§çš„è®¿é—®æ§åˆ¶ï¼Œæ”¯æŒå®¡è®¡ç­‰åŠŸèƒ½ï¼Œåœ¨å®‰å…¨å±‚é¢ä¸Šè¿˜æ”¯æŒé›†æˆç¬¬ä¸‰æ–¹çš„å®‰å…¨ç»„ä»¶ï¼Œåœ¨Version 8ä»¥åï¼Œé»˜è®¤å¼€å¯äº†HTTPSï¼Œå¤§å¤§ç®€åŒ–äº†å®‰å…¨ä¸Šçš„é…ç½®ã€‚</p>
<h2 id="å€’æ’ç´¢å¼•">å€’æ’ç´¢å¼•</h2>
<p><img src="http://120.26.79.238:9000/blog/img/a827adfd570edf4a44881068818238c4.png" alt=""></p>
<p><strong>å€’æ’ç´¢å¼•æ­¥éª¤</strong>:</p>
<ul>
<li>æ•°æ®æ ¹æ®è¯æ¡è¿›è¡Œåˆ†è¯ï¼ŒåŒæ—¶è®°å½•æ–‡æ¡£ç´¢å¼•ä½ç½®</li>
<li>å°†è¯æ¡ç›¸åŒçš„æ•°æ®åŒ–è¿›è¡Œåˆå¹¶</li>
<li>å¯¹è¯æ¡è¿›è¡Œæ’åº</li>
</ul>
<p><strong>æœç´¢çš„è¿‡ç¨‹</strong>:</p>
<ul>
<li>å…ˆå°†æœç´¢è¯è¯­è¿›è¡Œåˆ†è¯ï¼Œåˆ†è¯åå†å€’æ’ç´¢å¼•åˆ—è¡¨æŸ¥è¯¢æ–‡æ¡£ä½ç½®(docId)ã€‚æ ¹æ®docIdæŸ¥è¯¢æ–‡æ¡£æ•°æ®ã€‚</li>
</ul>
<h3 id="åˆ°æ’ç´¢å¼•ç›¸å¯¹æ­£æ’ç´¢å¼•çš„åŒºåˆ«">åˆ°æ’ç´¢å¼•ç›¸å¯¹æ­£æ’ç´¢å¼•çš„åŒºåˆ«:</h3>
<ol>
<li>æ­£æ’ç´¢å¼•:  é€šè¿‡æ­£æ’ç´¢å¼•è¡¨çš„id(ç´¢å¼•)æ‰¾åˆ°å¯¹åº”çš„å­—æ®µ(æ–‡ç« )  	 		  <code>key --- to ---&gt;word</code></li>
<li>å€’æ’ç´¢å¼•: é€šè¿‡å€’æ’ç´¢å¼•è¡¨çš„ å­—æ®µ(å•è¯) æ‰¾åˆ°å¯¹åº”çš„æ–‡ç« çš„id   	  <code> word--- to ---&gt;key</code></li>
</ol>
<h1>elasticsearchæ ¸å¿ƒæ¦‚å¿µ</h1>
<h2 id="eså¯¹ç…§æ•°æ®åº“">eså¯¹ç…§æ•°æ®åº“</h2>
<p><img src="http://120.26.79.238:9000/blog/img/0a25b0b01fa60636252e231e7b9e3e81.png" alt=""></p>
<h2 id="ç´¢å¼•">ç´¢å¼•</h2>
<ul>
<li>ä¸â€™â€˜åº“â€™'ç±»ä¼¼</li>
<li>ä¸€ä¸ªç´¢å¼•å°±æ˜¯æ‹¥æœ‰å‡ åˆ†ç›¸è¯†ç‰¹å¾çš„<strong>æ–‡æ¡£é›†åˆ</strong></li>
<li>æˆ‘ä»¬å¯¹æ–‡æ¡£è¿›è¡Œå¢åˆ æ”¹æŸ¥éƒ½è¦ç”¨åˆ°è¿™ä¸ªç´¢å¼•</li>
<li>åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­,å¯ä»¥æœ‰ä»»æ„å¤šä¸ªç´¢å¼•</li>
</ul>
<h2 id="ç±»å‹-Type">ç±»å‹(Type)</h2>
<ul>
<li>ä¸â€™â€˜è¡¨â€™'ç±»ä¼¼</li>
<li>åœ¨ç´¢å¼•ä¸­å­˜æ”¾çš„æ˜¯æ–‡æ¡£,å¯¹äºä¸€ä¸ªç´¢å¼•æ¥è¯´,å¯ä»¥æœ‰å¤šä¸ªä¸åŒçš„æ–‡æ¡£,</li>
<li>å¯¹äºæ–‡æ¡£æ¥è¯´,å¦‚æœæŸå†™æ–‡æ¡£å…·æœ‰ç›¸åŒçš„ç»“æ„, åˆ™å¯ä»¥ç»™ä»–ä»¬å®šä¹‰ç›¸åŒçš„ç±»å‹<br>
æœ¬ï¼Œç±»å‹å‘ç”Ÿäº†ä¸åŒçš„å˜åŒ–</li>
</ul>
<table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>5.x</td>
<td>æ”¯æŒå¤šç§type</td>
</tr>
<tr>
<td>6.x</td>
<td>åªèƒ½æœ‰ä¸€ç§type</td>
</tr>
<tr>
<td>7.x</td>
<td>é»˜è®¤ä¸å†æ”¯æŒè‡ªå®šä¹‰ç´¢å¼•ç±»å‹ï¼ˆé»˜è®¤ç±»å‹ä¸ºï¼š_docï¼‰</td>
</tr>
<tr>
<td>8.x</td>
<td>é»˜è®¤ç±»å‹ä¸ºï¼š_doc</td>
</tr>
</tbody>
</table>
<h2 id="æ–‡æ¡£-Document">æ–‡æ¡£(Document)</h2>
<ul>
<li>ä¸ â€˜â€˜è¡Œæ•°æ®â€™â€™ ç±»ä¼¼</li>
<li>ä¹Ÿå°±æ˜¯ä¸€æ¡æ•°æ®</li>
<li>ä»¥JSONæ ¼å¼å­˜å‚¨</li>
</ul>
<h2 id="å­—æ®µ-Field">å­—æ®µ(Field)</h2>
<ul>
<li>ç›¸å½“äºæ˜¯æ•°æ®è¡¨çš„å­—æ®µ</li>
<li>å¯¹æ–‡æ¡£æ•°æ®æ ¹æ®ä¸åŒå±æ€§è¿›è¡Œçš„åˆ†ç±»æ ‡è¯†ã€‚</li>
</ul>
<h2 id="æ˜ å°„-Mapping">æ˜ å°„(Mapping)</h2>
<ul>
<li>ä¸&quot;å­—æ®µç±»å‹&quot; \  â€œé»˜è®¤å€¼â€ \æ˜¯å¦è¢«ç´¢å¼•ç›¸å…³</li>
<li>å¤„ç†æ•°æ®çš„æ–¹å¼å’Œè§„åˆ™æ–¹é¢åšä¸€äº›é™åˆ¶</li>
</ul>
<h1>Elasticsearch åŸºç¡€åŠŸèƒ½</h1>
<h2 id="åˆ†è¯å™¨">åˆ†è¯å™¨</h2>
<ul>
<li>
<p>å®˜æ–¹æä¾›çš„åˆ†è¯å™¨æœ‰è¿™ä¹ˆå‡ ç§: Standardã€Letterã€Lowercaseã€Whitespaceã€UAX URL Emailã€Classicã€Thaiç­‰</p>
</li>
<li>
<p>ä¸­æ–‡åˆ†è¯å™¨å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ¯”å¦‚IKåˆ†è¯å™¨</p>
</li>
<li>
<p><strong>åŠŸèƒ½</strong>:é€šè¿‡åˆ†è¯å™¨å¯ä»¥æŸ¥çœ‹æ¯ä¸ªä¸åŒçš„åˆ†è¯å™¨çš„åˆ†è¯ç²’åº¦,æ¥å†³å®šä½¿ç”¨çš„åˆ†è¯å™¨</p>
</li>
</ul>
<h3 id="åˆ†è¯å™¨çš„ä½¿ç”¨">åˆ†è¯å™¨çš„ä½¿ç”¨</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span><span class="punctuation">,</span>      # åˆ†è¯å™¨ç±»å‹</span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æˆ‘æ˜¯ä¸­å›½äºº&quot;</span>        </span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">ç»“æœ<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æˆ‘&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_CHAR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ˜¯&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_CHAR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸­å›½äºº&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST _analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æˆ‘æ˜¯ä¸­å›½äºº&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">ç»“æœ<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æˆ‘&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_CHAR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ˜¯&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_CHAR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸­å›½äºº&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸­å›½&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å›½äºº&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="ç´¢å¼•æ“ä½œ">ç´¢å¼•æ“ä½œ</h2>
<ul>
<li>ç±»å‹: å¯ä»¥çœ‹åšä¸€ä¸ªæ•°æ®åº“,ä½†æ˜¯ å®ƒé»˜è®¤ä½¿ç”¨çš„ç±»å‹ä¸º_doc,ä¹Ÿå¯ä»¥çœ‹ä½œè¡¨</li>
</ul>
<h3 id="åˆ›å»ºç´¢å¼•">åˆ›å»ºç´¢å¼•</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">  PUT /my_index</span><br><span class="line"></span><br><span class="line">ç»“æœ<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shards_acknowledged&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•">æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•</h3>
<p><code>GET /_cat/indices?v</code></p>
<h3 id="æŸ¥çœ‹å•ä¸ªç´¢å¼•">æŸ¥çœ‹å•ä¸ªç´¢å¼•</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /my_index</span><br><span class="line">ç»“æœ<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;my_index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;aliases&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;routing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;allocation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;_tier_preference&quot;</span><span class="punctuation">:</span> <span class="string">&quot;data_content&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;provided_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;creation_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1693294063006&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kYMuXUZQRumMGqHoV0fDJw&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;created&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8050099&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="åˆ é™¤ç´¢å¼•">åˆ é™¤ç´¢å¼•</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">DELETE /my_index</span><br><span class="line">ç»“æœ<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ–‡æ¡£æ“ä½œ">æ–‡æ¡£æ“ä½œ</h2>
<ul>
<li>ç±»ä¼¼è¡Œæ•°æ®</li>
</ul>
<h3 id="åˆ›å»ºæ–‡æ¡£">åˆ›å»ºæ–‡æ¡£</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /my_index/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°ç±³æ‰‹æœº&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°ç±³&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">3999</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">è¿”å›ç»“æœ<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;found&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°ç±³æ‰‹æœº&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°ç±³&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">3999</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹æ–‡æ¡£">æŸ¥çœ‹æ–‡æ¡£</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /my_index/_doc/<span class="number">1</span></span><br><span class="line">ç»“æœ<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;found&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å°ç±³æ‰‹æœº&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;category&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å°ç±³&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;images&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span> <span class="punctuation">:</span> <span class="number">3999</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£">æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line"></span><br><span class="line">ç»“æœ:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 941,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 1,</span><br><span class="line">    &quot;successful&quot;: 1,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: &#123;</span><br><span class="line">      &quot;value&quot;: 1,</span><br><span class="line">      &quot;relation&quot;: &quot;eq&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;max_score&quot;: 1,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;my_index&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;å°ç±³æ‰‹æœº&quot;,</span><br><span class="line">          &quot;category&quot;: &quot;å°ç±³&quot;,</span><br><span class="line">          &quot;images&quot;: &quot;http://www.gulixueyuan.com/xm.jpg&quot;,</span><br><span class="line">          &quot;price&quot;: 3999</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹æ–‡æ¡£">ä¿®æ”¹æ–‡æ¡£</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /my_index/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°ç±³æ‰‹æœº&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°ç±³&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">4500</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="ä¿®æ”¹å±€éƒ¨å±æ€§">ä¿®æ”¹å±€éƒ¨å±æ€§</h4>
<p>è¯­æ³•:</p>
<p>POST /{ç´¢å¼•åç§°}/_update/{docId}<br>
{<br>
â€œdocâ€: {</p>
<p>â€œå±æ€§â€: â€œå€¼â€</p>
<p>}<br>
}</p>
<blockquote>
<p>åªèƒ½ä½¿ç”¨POSTè¯·æ±‚æ–¹å¼</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_update/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">4500</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="åˆ é™¤æ–‡æ¡£">åˆ é™¤æ–‡æ¡£</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">DELETE /my_index/_doc/<span class="number">1</span></span><br><span class="line">ç»“æœ<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span><span class="punctuation">:</span> <span class="string">&quot;deleted&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ˜ å°„mapping">æ˜ å°„mapping</h2>
<ul>
<li>è®¾ç½®æ–‡æ¡£å­—æ®µçš„é™åˆ¶
<ul>
<li>æ¯”å¦‚è®¾ç½®ä¸ºtext,åˆ™é»˜è®¤ä¼šè¿›è¡Œåˆ†è¯å’Œç´¢å¼•</li>
<li>è®¾ç½®ä¸ºkeywordsåˆ™ä¸ä¼šè¿›è¡Œåˆ†è¯</li>
</ul>
</li>
</ul>
<h3 id="æŸ¥çœ‹æ˜ å°„">æŸ¥çœ‹æ˜ å°„</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /my_index/_mapping</span><br><span class="line">ç»“æœ<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;my_index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="åŠ¨æ€æ˜ å°„">åŠ¨æ€æ˜ å°„</h3>
<ul>
<li>å½“åˆ›å»ºç´¢å¼•æ—¶,å¦‚æœæ²¡è®¾ç½®<strong>æ˜ å°„</strong>,åˆ™ä¼šé»˜è®¤è¿›è¡ŒåŠ¨æ€æ˜ å°„</li>
</ul>
<table>
<thead>
<tr>
<th>æ•°æ®</th>
<th>å¯¹åº”çš„ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>null</td>
<td>å­—æ®µä¸æ·»åŠ </td>
</tr>
<tr>
<td>true|flase</td>
<td>boolean</td>
</tr>
<tr>
<td>å­—ç¬¦ä¸²</td>
<td>text</td>
</tr>
<tr>
<td>æ•°å€¼</td>
<td>long</td>
</tr>
<tr>
<td>å°æ•°</td>
<td>float</td>
</tr>
<tr>
<td>æ—¥æœŸ</td>
<td>date</td>
</tr>
</tbody>
</table>
<h3 id="é™æ€æ˜ å°„">é™æ€æ˜ å°„</h3>
<ul>
<li>æ‰‹åŠ¨è®¾ç½®æ˜ å°„å…³ç³»</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">#åˆ é™¤åŸåˆ›å»ºçš„ç´¢å¼•</span><br><span class="line">DELETE /my_index</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºç´¢å¼•ï¼Œå¹¶åŒæ—¶æŒ‡å®šæ˜ å°„å…³ç³»å’Œåˆ†è¯å™¨ç­‰ã€‚</span><br><span class="line">PUT /my_index</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;store&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;store&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;store&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;store&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">ç»“æœ<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shards_acknowledged&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="type-åˆ†ç±»">type åˆ†ç±»</h3>
<ul>
<li>å­—ç¬¦ä¸²ï¼štext(æ”¯æŒåˆ†è¯)å’Œ keyword(ä¸æ”¯æŒåˆ†è¯)ã€‚</li>
<li>textï¼šè¯¥ç±»å‹è¢«ç”¨æ¥ç´¢å¼•é•¿æ–‡æœ¬ï¼Œåœ¨åˆ›å»ºç´¢å¼•å‰ä¼šå°†è¿™äº›æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼Œè½¬åŒ–ä¸ºè¯çš„ç»„åˆï¼Œå»ºç«‹ç´¢å¼•ï¼›å…è®¸esæ¥æ£€ç´¢è¿™äº›è¯ï¼Œtextç±»å‹ä¸èƒ½ç”¨æ¥æ’åºå’Œèšåˆã€‚</li>
<li>keywordï¼šè¯¥ç±»å‹ä¸èƒ½åˆ†è¯ï¼Œå¯ä»¥è¢«ç”¨æ¥æ£€ç´¢è¿‡æ»¤ã€æ’åºå’Œèšåˆï¼Œkeywordç±»å‹ä¸å¯ç”¨textè¿›è¡Œåˆ†è¯æ¨¡ç³Šæ£€ç´¢ã€‚</li>
<li>æ•°å€¼å‹ï¼šlongã€integerã€shortã€byteã€doubleã€float</li>
<li>æ—¥æœŸå‹ï¼šdate</li>
<li>å¸ƒå°”å‹ï¼šboolean</li>
<li>ç‰¹æ®Šæ•°æ®ç±»å‹ï¼šnested</li>
</ul>
<h3 id="nested-ä»‹ç»">nested ä»‹ç»</h3>
<ul>
<li>
<p>åœ¨esä¸­, å¦‚æœä¸€ä¸ªæ•°ç»„å­˜å‚¨å¤šä¸ªå¯¹è±¡, å½“è¿›è¡Œæ–‡æ¡£æ¡ä»¶æŸ¥è¯¢æ—¶, å¦‚æœæ ¹æ®æ•°ç»„å†…éƒ¨çš„å¯¹è±¡çš„å­—æ®µè¿›è¡Œæ¡ä»¶æŸ¥è¯¢, é»˜è®¤ä¼šå¯¹æ•°ç»„çš„å¯¹è±¡è¿›è¡Œå‹ç¼©å­˜å‚¨.</p>
</li>
<li>
<p>å³,ç›¸åŒå­—æ®µå­˜å‚¨åœ¨åŒä¸€ä¸ªå±æ€§ä¸­, è¿™æ ·åœ¨æ ¹æ®æŸä¸€ä¸ªå¯¹è±¡è¿›è¡Œæ¡ä»¶æŸ¥è¯¢æ—¶, å®é™…ä¸Šæ˜¯æ ¹æ®å£°éŸ³å¯¹è±¡çš„å­—æ®µè¿›è¡Œæ¡ä»¶æŸ¥è¯¢, è¿™æ ·å°±ä¼šå¯¼è‡´æ•°ç»„å¯¹è±¡çš„æ¡ä»¶æŸ¥è¯¢å¤±æ•ˆ.</p>
</li>
<li>
<p><strong>nested</strong> åˆ™æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„:</p>
<ul>
<li><strong>nested</strong>ï¼šç±»å‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡objectæ•°æ®ç±»å‹(specialised version of the object datatype )ï¼Œå…è®¸å¯¹è±¡æ•°ç»„å½¼æ­¤ç‹¬ç«‹åœ°è¿›è¡Œç´¢å¼•å’ŒæŸ¥è¯¢ã€‚</li>
</ul>
</li>
</ul>
<p>æ‰€ä»¥åœ¨è¿›è¡Œæ•°ç»„å¯¹è±¡çš„æ¡ä»¶æŸ¥è¯¢ä¹‹å‰,åº”è¯¥å…ˆå°†è¯¥æ•°ç»„å¯¹è±¡çš„typeè®¾ç½®ä¸ºnested.</p>
<h1>DSLé«˜çº§æŸ¥è¯¢</h1>
<ul>
<li>Query DSLæ¦‚è¿°: Domain Specific Language(é¢†åŸŸä¸“ç”¨è¯­è¨€)ï¼ŒElasticsearchæä¾›äº†åŸºäºJSONçš„DSLæ¥å®šä¹‰æŸ¥è¯¢ã€‚</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/81a1628e0ca2b2f79598e7d1146c1e44.png" alt=""></p>
<h2 id="DSLæŸ¥è¯¢">DSLæŸ¥è¯¢</h2>
<h3 id="æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£-v2">æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</h3>
<p><code>match_all:</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="åŒ¹é…æŸ¥è¯¢-match">åŒ¹é…æŸ¥è¯¢(match)</h3>
<p><code>match:</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åä¸ºæ™ºèƒ½æ‰‹æœº&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="å¤šå­—æ®µåŒ¹é…">å¤šå­—æ®µåŒ¹é…</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åä¸ºæ™ºèƒ½æ‰‹æœº&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;title&quot;</span><span class="punctuation">,</span><span class="string">&quot;category&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="å…³é”®å­—ç²¾ç¡®æŸ¥è¯¢">å…³é”®å­—ç²¾ç¡®æŸ¥è¯¢</h3>
<p><code>term:</code>å…³é”®å­—ä¸ä¼šè¿›è¡Œåˆ†è¯</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åä¸º&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="å¤šå…³é”®å­—ç²¾ç¡®æŸ¥è¯¢">å¤šå…³é”®å­—ç²¾ç¡®æŸ¥è¯¢</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;terms&quot;: &#123;</span><br><span class="line">      &quot;category&quot;: [</span><br><span class="line">        &quot;åä¸º&quot;,</span><br><span class="line">        &quot;vivo&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="èŒƒå›´æŸ¥è¯¢">èŒƒå›´æŸ¥è¯¢</h3>
<p>èŒƒå›´æŸ¥è¯¢ä½¿ç”¨<code>range</code>ã€‚</p>
<ul>
<li><code>gte</code>: å¤§äºç­‰äº</li>
<li><code>lte</code>: å°äºç­‰äº</li>
<li><code>gt</code>: å¤§äº</li>
<li><code>lt</code>: å°äº</li>
</ul>
<h3 id="æŒ‡å®šè¿”å›å­—æ®µ">æŒ‡å®šè¿”å›å­—æ®µ</h3>
<p><code>query</code>åŒçº§å¢åŠ <code>_source</code>è¿›è¡Œè¿‡æ»¤ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ‰‹æœº&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;title&quot;</span><span class="punctuation">,</span><span class="string">&quot;price&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="ç»„åˆæŸ¥è¯¢-å¤šæ¡ä»¶æŸ¥è¯¢">ç»„åˆæŸ¥è¯¢(å¤šæ¡ä»¶æŸ¥è¯¢)</h3>
<p><code>bool</code> å„æ¡ä»¶ä¹‹é—´æœ‰and,oræˆ–notçš„å…³ç³»</p>
<ul>
<li><code>must</code>: å„ä¸ªæ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³ï¼Œæ‰€æœ‰æ¡ä»¶æ˜¯andçš„å…³ç³»</li>
<li><code>should</code>: å„ä¸ªæ¡ä»¶æœ‰ä¸€ä¸ªæ»¡è¶³å³å¯ï¼Œå³å„æ¡ä»¶æ˜¯orçš„å…³ç³»</li>
<li><code>must_not</code>: ä¸æ»¡è¶³æ‰€æœ‰æ¡ä»¶ï¼Œå³å„æ¡ä»¶æ˜¯notçš„å…³ç³»</li>
<li><code>filter</code>: ä¸mustæ•ˆæœç­‰åŒï¼Œä½†æ˜¯å®ƒä¸è®¡ç®—å¾—åˆ†ï¼Œæ•ˆç‡æ›´é«˜ç‚¹ã€‚ å¾—åˆ†:  æŸ¥è¯¢å‡ºçš„æ–‡æ¡£ä¸æŸ¥è¯¢è¯­å¥çš„å…³è”æ€§å¤§å°</li>
</ul>
<h4 id="must">must</h4>
<p>å„ä¸ªæ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³ï¼Œæ‰€æœ‰æ¡ä»¶æ˜¯andçš„å…³ç³»</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åä¸º&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">3000</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">5400</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="should">should</h4>
<p>å„ä¸ªæ¡ä»¶æœ‰ä¸€ä¸ªæ»¡è¶³å³å¯ï¼Œå³å„æ¡ä»¶æ˜¯orçš„å…³ç³»</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åä¸º&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">3000</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">5000</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="å¦‚æœshouldå’ŒmuståŒæ—¶å­˜åœ¨ï¼Œä»–ä»¬ä¹‹é—´æ˜¯andå…³ç³»ï¼š">å¦‚æœshouldå’ŒmuståŒæ—¶å­˜åœ¨ï¼Œä»–ä»¬ä¹‹é—´æ˜¯andå…³ç³»ï¼š</h4>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åä¸º&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">3000</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">5000</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åä¸º&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">3000</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">5000</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="must-not">must_not</h4>
<p>ä¸æ»¡è¶³æ‰€æœ‰æ¡ä»¶ï¼Œå³å„æ¡ä»¶æ˜¯notçš„å…³ç³»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;title&quot;: &quot;åä¸º&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;range&quot;: &#123;</span><br><span class="line">            &quot;price&quot;: &#123;</span><br><span class="line">              &quot;gte&quot;: 3000,</span><br><span class="line">              &quot;lte&quot;: 5000</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="filter">filter</h4>
<p>ä¸mustæ•ˆæœç­‰åŒï¼Œä½†æ˜¯å®ƒä¸è®¡ç®—å¾—åˆ†ï¼Œæ•ˆç‡æ›´é«˜ç‚¹ã€‚</p>
<p>_scoreçš„åˆ†å€¼ä¸º0 åœ¨Elasticsearchä¸­ï¼Œ_score å­—æ®µä»£è¡¨æ¯ä¸ªæ–‡æ¡£çš„ç›¸å…³æ€§åˆ†æ•°ï¼ˆrelevance scoreï¼‰ã€‚è¿™ä¸ªåˆ†æ•°ç”¨äºè¡¡é‡ä¸€ä¸ªæ–‡æ¡£ä¸ç‰¹å®šæŸ¥è¯¢çš„åŒ¹é…ç¨‹åº¦ï¼Œå®ƒæ˜¯åŸºäºæœç´¢æŸ¥è¯¢çš„æ¡ä»¶å’Œæ–‡æ¡£çš„å†…å®¹æ¥è®¡ç®—çš„ã€‚ç›¸å…³æ€§åˆ†æ•°è¶Šé«˜ï¼Œè¡¨ç¤ºæ–‡æ¡£ä¸æŸ¥è¯¢çš„åŒ¹é…åº¦è¶Šé«˜ï¼Œæ’åä¹Ÿè¶Šé å‰ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åä¸º&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="èšåˆæŸ¥è¯¢">èšåˆæŸ¥è¯¢</h3>
<p>èšåˆå…è®¸ä½¿ç”¨è€…å¯¹esæ–‡æ¡£è¿›è¡Œç»Ÿè®¡åˆ†æï¼Œç±»ä¼¼ä¸å…³ç³»å‹æ•°æ®åº“ä¸­çš„group byï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„èšåˆï¼Œä¾‹å¦‚å–æœ€å¤§å€¼ã€å¹³å‡å€¼ç­‰ç­‰ã€‚</p>
<ul>
<li>å¯¹queryæŸ¥è¯¢å‡ºçš„æ–‡æ¡£è¿›è¡Œç»Ÿè®¡åˆ†æ: <code>max</code>   <code>min</code>    <code>avg</code>    <code>sum</code>   <code>stats</code>  <code>terms</code> ç­‰</li>
<li><code>stats</code>: è®¡ç®—å‡º:<code>max</code>  <code>min</code> <code>avg</code> <code>sum</code></li>
<li><code>terms</code>: ç±»ä¼¼group by</li>
</ul>
<h4 id="max">max</h4>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">  POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;max_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;max&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="min">min</h4>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;min_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;min&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="avg">avg</h4>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;avg_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="sum">sum</h4>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;sum_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;sum&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="stats">stats</h4>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;stats_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;stats&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="terms">terms</h3>
<p>æŸ¥è¯¢å‡ºæ¥çš„æ˜¯å¤šä¸ªæ–‡æ¡£çš„é›†åˆ,æ¯ä¸ªæ•°ç»„å†…éƒ¨æœ€å¤šæœ‰<code>size</code>ä¸ªæ–‡æ¡£</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;groupby_category&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;category&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥å¯¹æ¡¶ç»§ç»­è®¡ç®—ï¼šè®¡ç®—æ¯ä¸ªå“ç‰Œå¯¹åº”çš„å¹³å‡å€¼æ˜¯å¤šå°‘ï¼</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;groupby_category&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;category&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;avg_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="top-hit">top_hit</h3>
<p>æŸ¥è¯¢æ¡¶ä¸­é¡¶éƒ¨çš„è¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;top_hit&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;range&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;order&quot;</span><span class="punctuation">:</span><span class="string">&quot;desc&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="æ’åº">æ’åº</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åä¸º&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;_score&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>        # åˆ†æ•°</span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="åˆ†é¡µæŸ¥è¯¢">åˆ†é¡µæŸ¥è¯¢</h3>
<p>åˆ†é¡µçš„ä¸¤ä¸ªå…³é”®å±æ€§:fromã€sizeã€‚</p>
<ul>
<li><code>from</code>: å½“å‰é¡µçš„èµ·å§‹ç´¢å¼•ï¼Œé»˜è®¤ä»0å¼€å§‹ã€‚ from = (pageNum - 1) * size</li>
<li><code>size</code>: æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="é«˜äº®æ˜¾ç¤º">é«˜äº®æ˜¾ç¤º</h3>
<blockquote>
<p>æ— æ£€ç´¢ä¸é«˜äº®</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"># æ£€ç´¢æ•°æ®</span><br><span class="line">GET /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åä¸ºæ‰‹æœº&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;highlight&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pre_tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;font color:#e4393c&gt;&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;post_tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;/font&gt;&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h1>Java Apiæ“ä½œES</h1>
<h2 id="1-åˆ›å»ºé¡¹ç›®es-test">1. åˆ›å»ºé¡¹ç›®es-test</h2>
<h2 id="2-å¯¼å…¥ä¾èµ–">2. å¯¼å…¥ä¾èµ–</h2>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>online.zorange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>es-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span><span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-ç¼–å†™å¯åŠ¨ç±»å’Œé…ç½®æ–‡ä»¶">3. ç¼–å†™å¯åŠ¨ç±»å’Œé…ç½®æ–‡ä»¶</h2>
<p>é…ç½®esçš„åœ°å€</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">uris:</span> <span class="string">test.zorange.online:9200</span></span><br></pre></td></tr></table></figure>
<h2 id="4-ç¼–å†™å®ä½“ç±»-ç”¨äºesæ“ä½œ">4.ç¼–å†™å®ä½“ç±»,ç”¨äºesæ“ä½œ</h2>
<h3 id="ä½¿ç”¨æ³¨è§£">ä½¿ç”¨æ³¨è§£</h3>
<ul>
<li>å®šä¹‰ç´¢å¼•:<code>@Document(indexName = &quot;person&quot;)</code></li>
<li>æ ‡åid:<code>@Id</code></li>
<li>è®¾ç½®mapping: <code>  @Field(type = FieldType.Text,store = true,index = true)</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jdk.jfr.DataAmount;<span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.Document;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.Field;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.FieldType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/10/25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Document(indexName = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Text,store = true,index = true)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> Long age;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Text,store = true,index=true)</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="5-ç¼–å†™Resipositryæ¥å£">5. ç¼–å†™Resipositryæ¥å£</h2>
<ul>
<li>å®ç°<code>CrudRepository&lt;Entity,Retun&gt;</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> online.zorange.entity.Person;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/10/25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PersonRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;Person,Long&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    List&lt;Person&gt; <span class="title function_">findByAddressContains</span><span class="params">(String address)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Person&gt; <span class="title function_">findByPasswordAndNameContains</span><span class="params">(String password,String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="ç®€å•æ“ä½œ-respositry">ç®€å•æ“ä½œ respositry</h2>
<ul>
<li>
<ol>
<li>respositryåˆå§‹æä¾›äº† ä¸‰ä¸ªæ–¹æ³•: <code>findById </code>  <code>findAllByIds</code> <code>findAll</code></li>
</ol>
</li>
<li>
<ol start="2">
<li>æ‰©å±•ç®€å•æŸ¥è¯¢:</li>
</ol>
<ul>
<li>
<ol>
<li>æŸ¥æ‰¾ä»¥findå¼€å¤´</li>
</ol>
</li>
<li>
<ol start="2">
<li>æ¡ä»¶å‰åŠ By ,åæ¥æ¡ä»¶å­—æ®µ</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>ä¸</code> ç”¨<code>And</code>  <code>æˆ–</code> ç”¨ 	<code>or</code>, èŒƒå›´ç”¨<code>Between</code></li>
</ol>
</li>
<li>
<ol start="4">
<li>åŒ¹é…æŸ¥è¯¢æ¥<code>Contains</code></li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="å¤æ‚æŸ¥è¯¢">å¤æ‚æŸ¥è¯¢</h2>
<ul>
<li>
<ol>
<li>æ³¨å…¥ :</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">ElasticsearchClient elasticsearchClient;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ç¼–å†™æŸ¥è¯¢<code>reques</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SearchRequest searchRequest=SearchRequest.of(sr-&gt;sr.index(<span class="string">&quot;my_index&quot;</span>).</span><br><span class="line">                query(q-&gt;q.match(v-&gt;v.field(<span class="string">&quot;title&quot;</span>).query(<span class="string">&quot;oppo&quot;</span>))));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        SearchResponse&lt;Object&gt; search = elasticsearchClient.search(searchRequest, Object.class);</span><br><span class="line">        List&lt;Hit&lt;Object&gt;&gt; hits = search.hits().hits();</span><br><span class="line">        System.out.println(<span class="string">&quot;hits = &quot;</span> + hits);</span><br><span class="line">		</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Gatewayç»„ä»¶</title>
    <url>/2025/09/15/Gateway%E7%BB%84%E4%BB%B6/</url>
    <content><![CDATA[<h1>Gatewayç»„ä»¶</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<ul>
<li>Gatewayæ˜¯åœ¨springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡ï¼ŒåŸºäºSpring5ï¼ŒSpringBoot2å’ŒProject Reactorç­‰æŠ€æœ¯ã€‚Gatewayæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±ï¼Œä»¥åŠæä¾›ä¸€äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šç†”æ–­ã€é™æµã€é‡è¯•ç­‰</li>
<li>SpringCloud Gatewayæ˜¯SpringCloudçš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼ŒåŸºäºSpring5.X+SpringBoot2.Xå’ŒProject Reactorç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„APIè·¯ç”±ç®¡ç†æ–¹å¼ã€‚</li>
<li>ä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼ŒSpringCloud Gatwayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„ï¼Œè€ŒWebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„Reactoræ¨¡å¼é€šè®¯æ¡†æ¶Nettyã€‚</li>
<li>SpringCloud Gatewayçš„ç›®æ ‡æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ä¸”åŸºäºFilteré“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ã€ç›‘æ§/æŒ‡æ ‡ã€å’Œé™æµã€‚</li>
</ul>
<h2 id="æ¶æ„å›¾">æ¶æ„å›¾</h2>
<p><img src="http://120.26.79.238:9000/blog/img/500aeff97ef93d3543ef8c059bf4e0f8.png" alt=""></p>
<h2 id="ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ">ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 id="Route-è·¯ç”±">Route(è·¯ç”±)</h3>
<p>è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±</p>
<h3 id="Predicateï¼ˆæ–­è¨€ï¼‰">Predicateï¼ˆæ–­è¨€ï¼‰</h3>
<p>å‚è€ƒçš„æ˜¯java8çš„java.util.function.Predicateå¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ï¼‰ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±</p>
<h3 id="Filterï¼ˆè¿‡æ»¤ï¼‰">Filterï¼ˆè¿‡æ»¤ï¼‰</h3>
<p>æŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚</p>
<h2 id="å·¥ä½œæµç¨‹">å·¥ä½œæµç¨‹</h2>
<p><img src="http://120.26.79.238:9000/blog/img/b6febb88e53ca66217d7b95833168f37.png" alt=""></p>
<ul>
<li>å®¢æˆ·ç«¯å‘Spring Cloud Gatewayå‘å‡ºè¯·æ±‚ã€‚ç„¶ååœ¨Gateway Handler Mappingä¸­æ‰¾åˆ°ä¸è¯·æ±‚åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ°Gateway Web Handler.</li>
<li>Handlerå†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€ç»™æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚</li>
<li>è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€œpreâ€ï¼‰æˆ–ä¹‹å(â€œpostâ€)æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>Filteråœ¨&quot;pre&quot;ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰ï¼Œåœ¨&quot;post&quot;ç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºç­‰æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨</li>
</ul>
<h2 id="Gatewayå…¥é—¨">Gatewayå…¥é—¨</h2>
<ol>
<li>åˆ›å»ºæ¨¡å—</li>
<li>å¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--ç½‘å…³--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è´Ÿè½½å‡è¡¡ç»„ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ç¼–å†™å¯åŠ¨ç±»</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GatewayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>åœ¨application.ymlé…ç½®æ–‡ä»¶ä¸­ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™</li>
</ol>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8222</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">spzx-cloud-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">spzx-cloud-user</span>  <span class="comment"># è·¯ç”±idï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://spzx-cloud-user</span>  <span class="comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/*/user/**</span> <span class="comment"># è·¯å¾„åŒ¹é…</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">spzx-cloud-order</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://spzx-cloud-order</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/*/order/**</span> <span class="comment"># è·¯å¾„åŒ¹é…</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br></pre></td></tr></table></figure>
<h2 id="Predicateçš„ä½¿ç”¨">Predicateçš„ä½¿ç”¨</h2>
<ul>
<li>æ–­è¨€ï¼šç½‘å…³çš„å…¥å£ï¼Œè®¿é—®è·¯å¾„çš„è§„åˆ™</li>
<li>æ¡†æ¶åº•å±‚æä¾›äº†å¾ˆå¤šè§„åˆ™</li>
<li>å®˜ç½‘ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/4.0.6/reference/html/#gateway-request-predicates-factories">https://docs.spring.io/spring-cloud-gateway/docs/4.0.6/reference/html/#gateway-request-predicates-factories</a></li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/214a26d647add7520610640d7f93baba.png" alt=""></p>
<h3 id="predicate">predicate</h3>
<ul>
<li>
<p>æ—¶é—´</p>
<ul>
<li>After: ä¹‹å</li>
<li>beforeï¼šä¹‹å‰</li>
<li>Betweenï¼šä¹‹é—´</li>
</ul>
</li>
<li>
<p>Cookie</p>
</li>
<li>
<p>Header</p>
</li>
<li>
<p>Host</p>
</li>
<li>
<p>Method</p>
</li>
<li>
<p>Path</p>
</li>
<li>
<p>Query</p>
</li>
<li>
<p>RemoteAddr</p>
</li>
<li>
<p>Weightï¼šæƒé‡</p>
</li>
<li>
<p>XForwordedï¼šç½‘æ®µ</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">xforwarded_remoteaddr_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">   	     <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">XForwardedRemoteAddr=192.168.1.1/24</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>Spring Cloud Gatewayå°†è·¯ç”±åŒ¹é…ä½œä¸ºSpring WebFlux HandlerMapperåŸºç¡€æ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚<br>
Spring Cloud GatewayåŒ…æ‹¬è®¸å¤šå†…ç½®çš„Route Predicateå·¥å‚ã€‚æ‰€æœ‰è¿™äº›Predicateéƒ½ä¸HTTPè¯·æ±‚çš„ä¸åŒå±æ€§åŒ¹é…ã€‚å¤šä¸ªRoute Predicateå·¥å‚å¯ä»¥è¿›è¡Œç»„åˆ<br>
Spring Cloud Gatewayåˆ›å»ºRouteå¯¹è±¡æ—¶ï¼Œä½¿ç”¨RoutePredicateFactoryåˆ›å»ºPredicateå¯¹è±¡ï¼ŒPredicateå¯¹è±¡å¯ä»¥èµ‹å€¼ç»™ Routeã€‚Spring Cloud GatewayåŒ…å«è®¸å¤šå†…ç½®çš„Route Predicate Factoriesã€‚æ‰€æœ‰è¿™äº›è°“è¯éƒ½åŒ¹é…HTTPè¯·æ±‚çš„ä¸åŒå±æ€§ã€‚å¤šç§è°“è¯å·¥å‚å¯ä»¥ç»„åˆï¼Œå¹¶é€šè¿‡é€»è¾‘and ã€‚</p>
<h2 id="è¿‡æ»¤å™¨">è¿‡æ»¤å™¨</h2>
<p>GatewayFilter: å±€éƒ¨è¿‡æ»¤å™¨</p>
<p>â€‹    è·¯ç”±è¿‡æ»¤å™¨ï¼š</p>
<p>â€‹    é»˜è®¤è¿‡æ»¤å™¨:</p>
<p>GlobalFilter: å…¨å±€è¿‡æ»¤å™¨</p>
<h3 id="å†…ç½®è¿‡æ»¤å™¨">å†…ç½®è¿‡æ»¤å™¨</h3>
<p>spring gatewayæä¾›äº†31ç§ä¸åŒçš„è¿‡æ»¤å™¨ã€‚</p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#gatewayfilter-factories">https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#gatewayfilter-factories</a></p>
<p>ä¾‹å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th><strong>åç§°</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>AddRequestHeader</td>
<td>ç»™å½“å‰è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´</td>
</tr>
<tr>
<td>RemoveRequestHeader</td>
<td>ç§»é™¤è¯·æ±‚ä¸­çš„ä¸€ä¸ªè¯·æ±‚å¤´</td>
</tr>
<tr>
<td>AddResponseHeader</td>
<td>ç»™å“åº”ç»“æœä¸­æ·»åŠ ä¸€ä¸ªå“åº”å¤´</td>
</tr>
<tr>
<td>RemoveResponseHeader</td>
<td>ä»å“åº”ç»“æœä¸­ç§»é™¤æœ‰ä¸€ä¸ªå“åº”å¤´</td>
</tr>
<tr>
<td>RequestRateLimiter</td>
<td>é™åˆ¶è¯·æ±‚çš„æµé‡</td>
</tr>
</tbody>
</table>
<p>åœ¨Gatewayä¸­æä¾›äº†ä¸‰ç§çº§åˆ«çš„ç±»å‹çš„è¿‡æ»¤å™¨ï¼š</p>
<p>1ã€è·¯ç”±è¿‡æ»¤å™¨ï¼šåªé’ˆå¯¹å½“å‰è·¯ç”±æœ‰æ•ˆ</p>
<p>2ã€é»˜è®¤è¿‡æ»¤å™¨ï¼šé’ˆå¯¹æ‰€æœ‰çš„è·¯ç”±éƒ½æœ‰æ•ˆ</p>
<p>3ã€å…¨å±€è¿‡æ»¤å™¨ï¼šé’ˆå¯¹æ‰€æœ‰çš„è·¯ç”±éƒ½æœ‰æ•ˆï¼Œéœ€è¦è¿›è¡Œè‡ªå®šä¹‰</p>
<h3 id="è·¯ç”±è¿‡æ»¤å™¨">è·¯ç”±è¿‡æ»¤å™¨</h3>
<ul>
<li>
<p>ä½ç½®ï¼Œå†™åœ¨è·¯ç”±ä¸‹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">spzx-cloud-user</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://spzx-cloud-user</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/user/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,</span> <span class="string">atguigu</span>		<span class="comment"># é…ç½®è·¯ç”±åŸºæœ¬çš„è¿‡æ»¤å™¨ï¼Œç»™è®¿é—®userå¾®æœåŠ¡çš„æ‰€æœ‰æ¥å£æ·»åŠ Truthè¯·æ±‚å¤´</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="é»˜è®¤è¿‡æ»¤å™¨">é»˜è®¤è¿‡æ»¤å™¨</h3>
<ul>
<li>
<p>å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆ</p>
</li>
<li>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">spzx-cloud-user</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://spzx-cloud-user</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/user/**</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">After=2017-01-20T17:42:47.789-07:00[America/Denver]</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,</span> <span class="string">atguigu</span> <span class="string">is</span> <span class="string">good</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å…¨å±€è¿‡æ»¤å™¨">å…¨å±€è¿‡æ»¤å™¨</h3>
<ul>
<li>è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼šéœ€è¦è‡ªå·±å®ç°</li>
</ul>
<h4 id="æ­¥éª¤">æ­¥éª¤</h4>
<p>1ã€å®šä¹‰ä¸€ä¸ªç±»å®ç°GlobalFilteræ¥å£</p>
<p>2ã€é‡å†™filteræ–¹æ³•</p>
<p>3ã€å°†è¯¥ç±»çº³å…¥åˆ°springå®¹å™¨ä¸­</p>
<p>4ã€å®ç°Orderedæ¥å£å®šä¹‰è¯¥è¿‡æ»¤å™¨çš„é¡ºåº</p>
<p>â€‹		å½“æœ‰å¤šä¸ªå…¨å±€è¿‡æ»¤å™¨æ—¶ï¼ŒOrderdè¿”å›çš„å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</p>
<h4 id="å®ç°ä»£ç ">å®ç°ä»£ç </h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.MultiValueMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.apache.http.HttpStatus.SC_BAD_REQUEST;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/9/13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomGlobalFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        MultiValueMap&lt;String, String&gt; queryParams = request.getQueryParams();</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> queryParams.getFirst(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(username!=<span class="literal">null</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span>    chain.filter(exchange);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            response.setStatusCode(HttpStatus.BAD_REQUEST);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;  <span class="comment">//ä¼˜å…ˆçº§ è¶Šå°è¶Šé«˜</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¿‡æ»¤å™¨æ‰§è¡Œçš„é¡ºåº">è¿‡æ»¤å™¨æ‰§è¡Œçš„é¡ºåº</h3>
<ul>
<li>è¯·æ±‚è¿›å…¥ç½‘å…³ä¼šç¢°åˆ°ä¸‰ç±»è¿‡æ»¤å™¨ï¼šå½“å‰è·¯ç”±çš„è¿‡æ»¤å™¨ã€DefaultFilterã€GlobalFilter</li>
<li>æ‰§è¡Œè§„åˆ™</li>
</ul>
<p>â€‹		1ã€æŒ‰ç…§orderçš„å€¼è¿›è¡Œæ’åºï¼Œorderçš„å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰ã€‚</p>
<p>â€‹		2ã€è·¯ç”±è¿‡æ»¤å™¨å’Œé»˜è®¤è¿‡æ»¤å™¨ä¼šæŒ‰ç…§orderçš„å€¼è¿›è¡Œæ’åºï¼Œè¿™ä¸ªå€¼ç”±springè¿›è¡ŒæŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å£°		æ˜é¡ºåºä»1é€’å¢</p>
<p>â€‹		3ã€å½“è¿‡æ»¤å™¨çš„orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§ globalFilter &gt; defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨çš„é¡ºåºæ‰§è¡Œ</p>
<h3 id="RequestRateLimiter">RequestRateLimiter</h3>
<ul>
<li>é»˜è®¤çš„é™æµå™¨</li>
<li>åŸºäºrediså®ç°</li>
</ul>
<h4 id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤</h4>
<ol>
<li>
<p>å‡†å¤‡å¯ç”¨çš„redis</p>
</li>
<li>
<p>mavenä¸­æ·»åŠ ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis-reactive<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç¡®å®šæŒ‰ç…§ä»€ä¹ˆç»´åº¦é™æµï¼Œä¾‹å¦‚æŒ‰ç…§è¯·æ±‚ä¸­çš„usernameå‚æ•°é™æµï¼Œè¿™æ˜¯é€šè¿‡ç¼–å†™KeyResolveræ¥å£çš„å®ç°æ¥å®Œæˆçš„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomizeConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    KeyResolver <span class="title function_">userKeyResolver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> exchange -&gt; Mono.just(exchange.getRequest().getRemoteAddress().getAddress().getHostAddress());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½®application.ymlæ–‡ä»¶ï¼Œæ·»åŠ è¿‡æ»¤å™¨</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">spzx-cloud-order</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://spzx-cloud-order</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/*/order/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">AddResponseHeader=X-Response-Red,</span> <span class="string">Blue</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RequestRateLimiter</span></span><br><span class="line">              <span class="attr">args:</span></span><br><span class="line">                <span class="attr">key-resolver:</span> <span class="string">&quot;#&#123;@userKeyResolver&#125;&quot;</span></span><br><span class="line">                <span class="comment"># ä»¤ç‰Œå…¥æ¡¶çš„é€Ÿåº¦ä¸ºæ¯ç§’1ä¸ªï¼Œç›¸å½“äºQPS</span></span><br><span class="line">                <span class="attr">redis-rate-limiter.replenishRate:</span> <span class="number">1</span></span><br><span class="line">              <span class="comment"># æ¡¶å†…èƒ½è£…5ä¸ªä»¤ç‰Œï¼Œç›¸å½“äºå³°å€¼ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼šç¬¬ä¸€ç§’ä»æ¡¶å†…èƒ½å»5ä¸ªï¼Œä½†æ˜¯ç¬¬äºŒç§’åªèƒ½å–åˆ°1ä¸ªäº†ï¼Œå› ä¸ºå…¥æ¡¶é€Ÿåº¦æ˜¯æ¯ç§’1ä¸ª</span></span><br><span class="line">                <span class="attr">redis-rate-limiter.burstCapacity:</span> <span class="number">5</span></span><br><span class="line">              <span class="comment"># æ¯ä¸ªè¯·æ±‚éœ€è¦çš„ä»¤ç‰Œæ•°</span></span><br><span class="line">                <span class="attr">redis-rate-limiter.requestedTokens:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># http://localhost:80/api/order/findOrderByOrderId/101</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">spzx-cloud-gateway</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>æœ€åä½¿ç”¨Jemeteræµ‹è¯•å³å¯ã€‚</li>
</ul>
<h2 id="è·¨åŸŸå¤„ç†">è·¨åŸŸå¤„ç†</h2>
<h3 id="Global-CORS-Configuration-å…¨å±€è·¨åŸŸ">Global CORS Configuration å…¨å±€è·¨åŸŸ</h3>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">globalcors:</span></span><br><span class="line">        <span class="attr">cors-configurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span> <span class="string">&quot;https://docs.spring.io&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">GET</span></span><br></pre></td></tr></table></figure>
<h3 id="Route-CORS-Configuration-è·¯ç”±è·¨åŸŸ">Route CORS Configuration è·¯ç”±è·¨åŸŸ</h3>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">cors_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/service/**</span></span><br><span class="line">        <span class="attr">metadata:</span></span><br><span class="line">          <span class="attr">cors:</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">GET</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">POST</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">30</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>GitHub Pages + åç«¯ API çš„å®Œæ•´å®ç°æŒ‡å—</title>
    <url>/2026/01/27/GitHub%20Pages%20+%20%E5%90%8E%E7%AB%AF%20API%20%E7%9A%84%E5%AE%8C%E6%95%B4%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h1>ä½¿ç”¨æ–¹æ¡ˆäºŒï¼šGitHub Pages + åç«¯ API çš„å®Œæ•´å®ç°æŒ‡å—</h1>
<h2 id="ç¬¬ä¸€æ­¥ï¼šåˆ›å»º-GitHub-Personal-Access-Token">ç¬¬ä¸€æ­¥ï¼šåˆ›å»º GitHub Personal Access Token</h2>
<ol>
<li>è®¿é—® <a href="https://github.com/settings/tokens">https://github.com/settings/tokens</a></li>
<li>ç‚¹å‡» â€œGenerate new tokenâ€</li>
<li>é€‰æ‹©æƒé™ï¼š
<ul>
<li><code>repo</code> (å®Œå…¨æ§åˆ¶ä»“åº“)</li>
<li><code>workflow</code> (å¦‚æœéœ€è¦ä½¿ç”¨ Actions)</li>
</ul>
</li>
<li>ç”Ÿæˆå¹¶å¤åˆ¶ tokenï¼ˆé‡è¦ï¼šåªæ˜¾ç¤ºä¸€æ¬¡ï¼‰</li>
</ol>
<h2 id="ç¬¬äºŒæ­¥ï¼šå‡†å¤‡é¡¹ç›®ç»“æ„">ç¬¬äºŒæ­¥ï¼šå‡†å¤‡é¡¹ç›®ç»“æ„</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">markdown-editor/</span><br><span class="line">â”œâ”€â”€ backend/</span><br><span class="line">â”‚   â”œâ”€â”€ server.js</span><br><span class="line">â”‚   â”œâ”€â”€ package.json</span><br><span class="line">â”‚   â””â”€â”€ .env</span><br><span class="line">â”œâ”€â”€ frontend/</span><br><span class="line">â”‚   â”œâ”€â”€ index.html</span><br><span class="line">â”‚   â”œâ”€â”€ style.css</span><br><span class="line">â”‚   â””â”€â”€ app.js</span><br><span class="line">â””â”€â”€ README.md</span><br></pre></td></tr></table></figure>
<h2 id="ç¬¬ä¸‰æ­¥ï¼šåç«¯è®¾ç½®">ç¬¬ä¸‰æ­¥ï¼šåç«¯è®¾ç½®</h2>
<h3 id="åˆ›å»ºåç«¯ç›®å½•å’Œæ–‡ä»¶">åˆ›å»ºåç«¯ç›®å½•å’Œæ–‡ä»¶</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p markdown-editor/backend</span><br><span class="line"><span class="built_in">cd</span> markdown-editor/backend</span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…åç«¯ä¾èµ–">å®‰è£…åç«¯ä¾èµ–</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install express cors @octokit/rest dotenv</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»º-server-js">åˆ›å»º server.js</h3>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Octokit</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@octokit/rest&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).<span class="title function_">config</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3001</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸­é—´ä»¶</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>(&#123; <span class="attr">limit</span>: <span class="string">&#x27;10mb&#x27;</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;../frontend&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ– Octokit</span></span><br><span class="line"><span class="keyword">const</span> octokit = <span class="keyword">new</span> <span class="title class_">Octokit</span>(&#123;</span><br><span class="line">  <span class="attr">auth</span>: process.<span class="property">env</span>.<span class="property">GITHUB_TOKEN</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¥åº·æ£€æŸ¥ç«¯ç‚¹</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/health&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">json</span>(&#123; <span class="attr">status</span>: <span class="string">&#x27;OK&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;Markdown Editor API is running&#x27;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿å­˜ Markdown æ–‡ä»¶</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/save-markdown&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; content, filename, message, folder = <span class="string">&#x27;&#x27;</span> &#125; = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éªŒè¯è¾“å…¥</span></span><br><span class="line">    <span class="keyword">if</span> (!content || !filename) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: <span class="string">&#x27;å†…å®¹å’Œæ–‡ä»¶åæ˜¯å¿…éœ€çš„&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="keyword">const</span> filePath = folder ? <span class="string">`<span class="subst">$&#123;folder&#125;</span>/<span class="subst">$&#123;filename&#125;</span>`</span> : filename;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨ï¼ˆè·å– SHAï¼‰</span></span><br><span class="line">    <span class="keyword">let</span> sha = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> existingFile = <span class="keyword">await</span> octokit.<span class="property">repos</span>.<span class="title function_">getContent</span>(&#123;</span><br><span class="line">        <span class="attr">owner</span>: process.<span class="property">env</span>.<span class="property">GITHUB_OWNER</span>,</span><br><span class="line">        <span class="attr">repo</span>: process.<span class="property">env</span>.<span class="property">GITHUB_REPO</span>,</span><br><span class="line">        <span class="attr">branch</span>: process.<span class="property">env</span>.<span class="property">GITHUB_BRANCH</span>,</span><br><span class="line">        <span class="attr">path</span>: filePath</span><br><span class="line">      &#125;);</span><br><span class="line">      sha = existingFile.<span class="property">data</span>.<span class="property">sha</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="comment">// æ–‡ä»¶ä¸å­˜åœ¨æ˜¯æ­£å¸¸çš„ï¼Œç»§ç»­åˆ›å»ºæ–°æ–‡ä»¶</span></span><br><span class="line">      <span class="keyword">if</span> (error.<span class="property">status</span> !== <span class="number">404</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> error;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæˆ–æ›´æ–°æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> octokit.<span class="property">repos</span>.<span class="title function_">createOrUpdateFileContents</span>(&#123;</span><br><span class="line">      <span class="attr">owner</span>: process.<span class="property">env</span>.<span class="property">GITHUB_OWNER</span>,</span><br><span class="line">      <span class="attr">repo</span>: process.<span class="property">env</span>.<span class="property">GITHUB_REPO</span>,</span><br><span class="line">      <span class="attr">branch</span>: process.<span class="property">env</span>.<span class="property">GITHUB_BRANCH</span>,</span><br><span class="line">      <span class="attr">path</span>: filePath,</span><br><span class="line">      <span class="attr">message</span>: message || <span class="string">`Update <span class="subst">$&#123;filename&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">content</span>: <span class="title class_">Buffer</span>.<span class="title function_">from</span>(content).<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>),</span><br><span class="line">      <span class="attr">sha</span>: sha, <span class="comment">// å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œéœ€è¦æä¾› SHA</span></span><br><span class="line">      <span class="attr">committer</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: process.<span class="property">env</span>.<span class="property">COMMITTER_NAME</span> || <span class="string">&#x27;Markdown Editor&#x27;</span>,</span><br><span class="line">        <span class="attr">email</span>: process.<span class="property">env</span>.<span class="property">COMMITTER_EMAIL</span> || <span class="string">&#x27;editor@example.com&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ&#x27;</span>,</span><br><span class="line">      <span class="attr">url</span>: response.<span class="property">data</span>.<span class="property">content</span>.<span class="property">html_url</span>,</span><br><span class="line">      <span class="attr">download_url</span>: response.<span class="property">data</span>.<span class="property">content</span>.<span class="property">download_url</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error saving markdown:&#x27;</span>, error);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: error.<span class="property">message</span> || <span class="string">&#x27;ä¿å­˜æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/files&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; folder = <span class="string">&#x27;&#x27;</span> &#125; = req.<span class="property">query</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> octokit.<span class="property">repos</span>.<span class="title function_">getContent</span>(&#123;</span><br><span class="line">      <span class="attr">owner</span>: process.<span class="property">env</span>.<span class="property">GITHUB_OWNER</span>,</span><br><span class="line">      <span class="attr">repo</span>: process.<span class="property">env</span>.<span class="property">GITHUB_REPO</span>,</span><br><span class="line">      <span class="attr">branch</span>: process.<span class="property">env</span>.<span class="property">GITHUB_BRANCH</span>,</span><br><span class="line">      <span class="attr">path</span>: folder</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> files = response.<span class="property">data</span></span><br><span class="line">      .<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">name</span>.<span class="title function_">endsWith</span>(<span class="string">&#x27;.md&#x27;</span>))</span><br><span class="line">      .<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">path</span>: item.<span class="property">path</span>,</span><br><span class="line">        <span class="attr">url</span>: item.<span class="property">html_url</span>,</span><br><span class="line">        <span class="attr">download_url</span>: item.<span class="property">download_url</span></span><br><span class="line">      &#125;));</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">json</span>(&#123; <span class="attr">success</span>: <span class="literal">true</span>, files &#125;);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error fetching files:&#x27;</span>, error);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: error.<span class="property">message</span> || <span class="string">&#x27;è·å–æ–‡ä»¶åˆ—è¡¨æ—¶å‘ç”Ÿé”™è¯¯&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">error, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Unhandled error:&#x27;</span>, error);</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">error</span>: <span class="string">&#x27;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸš€ Server running on http://localhost:<span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ“ Markdown Editor API ready`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»º-env-æ–‡ä»¶">åˆ›å»º .env æ–‡ä»¶</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># GitHub é…ç½®</span><br><span class="line">GITHUB_TOKEN=ä½ çš„ä¸ªäººè®¿é—®ä»¤ç‰Œ</span><br><span class="line">GITHUB_OWNER=ä½ çš„GitHubç”¨æˆ·å</span><br><span class="line">GITHUB_REPO=ä½ çš„ä»“åº“å</span><br><span class="line">GITHUB_BRANCH=ä½ çš„åˆ†æ”¯å</span><br><span class="line"></span><br><span class="line"># æäº¤è€…ä¿¡æ¯</span><br><span class="line">COMMITTER_NAME=Markdown Editor</span><br><span class="line">COMMITTER_EMAIL=editor@example.com</span><br><span class="line"></span><br><span class="line"># æœåŠ¡å™¨é…ç½®</span><br><span class="line">PORT=3001</span><br><span class="line">NODE_ENV=development</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»º-package-json-è„šæœ¬">åˆ›å»º package.json è„šæœ¬</h3>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node server.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nodemon server.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;setup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm install express cors @octokit/rest dotenv&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="ç¬¬å››æ­¥ï¼šå‰ç«¯å®ç°">ç¬¬å››æ­¥ï¼šå‰ç«¯å®ç°</h2>
<h3 id="åˆ›å»ºå‰ç«¯ç›®å½•å’Œæ–‡ä»¶">åˆ›å»ºå‰ç«¯ç›®å½•å’Œæ–‡ä»¶</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ../frontend</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»º-index-html">åˆ›å»º index.html</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Markdown ç¼–è¾‘å™¨<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-markdown&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Markdown ç¼–è¾‘å™¨<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>åœ¨çº¿ç¼–è¾‘å¹¶ä¿å­˜åˆ° GitHub ä»“åº“<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;editor-container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;editor-section&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;section-header&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-edit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> ç¼–è¾‘åŒº<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;insertText(&#x27;**ç²—ä½“**&#x27;)&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>B<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;insertText(&#x27;*æ–œä½“*&#x27;)&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>I<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;insertText(&#x27;# æ ‡é¢˜&#x27;)&quot;</span>&gt;</span>H1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;insertText(&#x27;```\nä»£ç å—\n```&#x27;)&quot;</span>&gt;</span>ä»£ç <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;markdown-input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;å¼€å§‹ç¼–å†™ä½ çš„ Markdown å†…å®¹...&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;preview-section&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;section-header&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-eye&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> é¢„è§ˆåŒº<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;markdown-preview&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;controls&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;filename&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-file&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> æ–‡ä»¶åï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;filename&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;example.md&quot;</span> <span class="attr">value</span>=<span class="string">&quot;document.md&quot;</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;folder&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-folder&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> æ–‡ä»¶å¤¹ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;folder&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;docs&quot;</span> <span class="attr">value</span>=<span class="string">&quot;markdown-docs&quot;</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-comment&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> æäº¤ä¿¡æ¯ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;æ·»åŠ æ–°æ–‡æ¡£&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;saveToGitHub()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn-primary&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-cloud-upload-alt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> ä¿å­˜åˆ° GitHub</span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;loadFileList()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn-secondary&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-sync&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> åˆ·æ–°æ–‡ä»¶åˆ—è¡¨</span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;file-list&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-files&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> ä»“åº“ä¸­çš„ Markdown æ–‡ä»¶<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;file-list-container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;status-message&quot;</span> <span class="attr">class</span>=<span class="string">&quot;status-hidden&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/marked/marked.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»º-style-css">åˆ›å»º style.css</h3>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="string">&#x27;Segoe UI&#x27;</span>, Roboto, sans-serif;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">135deg</span>, <span class="number">#667eea</span> <span class="number">0%</span>, <span class="number">#764ba2</span> <span class="number">100%</span>);</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">1400px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">10px</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.2</span>);</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">header</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">135deg</span>, <span class="number">#2c3e50</span> <span class="number">0%</span>, <span class="number">#34495e</span> <span class="number">100%</span>);</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">header</span> <span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">2.5em</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">header</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.9</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.editor-container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.editor-section</span>, <span class="selector-class">.preview-section</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#f8f9fa</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.section-header</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#e9ecef</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#dee2e6</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.section-header</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#495057</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.2em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toolbar</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toolbar</span> <span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toolbar</span> <span class="selector-tag">button</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#007bff</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#markdown-input</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">resize</span>: none;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;Monaco&#x27;</span>, <span class="string">&#x27;Menlo&#x27;</span>, <span class="string">&#x27;Ubuntu Mono&#x27;</span>, monospace;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.6</span>;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#markdown-preview</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#markdown-preview</span> <span class="selector-tag">h1</span>, <span class="selector-id">#markdown-preview</span> <span class="selector-tag">h2</span>, <span class="selector-id">#markdown-preview</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#2c3e50</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#markdown-preview</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#markdown-preview</span> <span class="selector-tag">code</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#f4f4f4</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2px</span> <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">font-family</span>: monospace;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#markdown-preview</span> pre &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#f8f9fa</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">overflow-x</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.controls</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#f8f9fa</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#dee2e6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.control-group</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: auto <span class="number">1</span>fr auto <span class="number">1</span>fr auto <span class="number">1</span>fr;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.control-group</span> <span class="selector-tag">label</span> &#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#495057</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.control-group</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ced4da</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.button-group</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">12px</span> <span class="number">24px</span>;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.3s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-primary</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">135deg</span>, <span class="number">#007bff</span> <span class="number">0%</span>, <span class="number">#0056b3</span> <span class="number">100%</span>);</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-primary</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">2px</span>);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">15px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">123</span>, <span class="number">255</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-secondary</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#6c757d</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-secondary</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#545b62</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">2px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-list</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#dee2e6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-list</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#495057</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#file-list-container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fill, <span class="built_in">minmax</span>(<span class="number">250px</span>, <span class="number">1</span>fr));</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-item</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#f8f9fa</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#dee2e6</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-item</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">2px</span>);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-item</span> <span class="selector-tag">h4</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#007bff</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-item</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#6c757d</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.9em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-actions</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-actions</span> <span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.status-hidden</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.status-show</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1000</span>;</span><br><span class="line">    <span class="attribute">animation</span>: slideIn <span class="number">0.3s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.status-success</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#28a745</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.status-error</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#dc3545</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> slideIn &#123;</span><br><span class="line">    <span class="selector-tag">from</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">100%</span>);</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">to</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) &#123;</span><br><span class="line">    <span class="selector-class">.editor-container</span> &#123;</span><br><span class="line">        <span class="attribute">grid-template-columns</span>: <span class="number">1</span>fr;</span><br><span class="line">        <span class="attribute">height</span>: auto;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="selector-class">.control-group</span> &#123;</span><br><span class="line">        <span class="attribute">grid-template-columns</span>: <span class="number">1</span>fr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»º-app-js">åˆ›å»º app.js</h3>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ– Marked.js</span></span><br><span class="line">marked.<span class="title function_">setOptions</span>(&#123;</span><br><span class="line">    <span class="attr">highlight</span>: <span class="keyword">function</span>(<span class="params">code, lang</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (lang &amp;&amp; hljs) &#123;</span><br><span class="line">            <span class="keyword">return</span> hljs.<span class="title function_">highlight</span>(lang, code).<span class="property">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">breaks</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">gfm</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å…ƒç´ </span></span><br><span class="line"><span class="keyword">const</span> markdownInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;markdown-input&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> markdownPreview = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;markdown-preview&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> filenameInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;filename&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> folderInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;folder&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> messageInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;message&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fileListContainer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;file-list-container&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> statusMessage = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;status-message&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹å†…å®¹</span></span><br><span class="line"><span class="keyword">const</span> defaultContent = <span class="string">`# æ¬¢è¿ä½¿ç”¨ Markdown ç¼–è¾‘å™¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¿™æ˜¯ä¸€ä¸ªåœ¨çº¿ Markdown ç¼–è¾‘å™¨ï¼Œå¯ä»¥å°†å†…å®¹ä¿å­˜åˆ° GitHub ä»“åº“ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## åŠŸèƒ½ç‰¹ç‚¹</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- ğŸ“ å®æ—¶é¢„è§ˆ</span></span><br><span class="line"><span class="string">- ğŸ’¾ ä¿å­˜åˆ° GitHub</span></span><br><span class="line"><span class="string">- ğŸ“ æ–‡ä»¶ç®¡ç†</span></span><br><span class="line"><span class="string">- ğŸ¨ è¯­æ³•é«˜äº®</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## ä»£ç ç¤ºä¾‹</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\`\`\`javascript</span></span><br><span class="line"><span class="string">function helloWorld() &#123;</span></span><br><span class="line"><span class="string">    console.log(&#x27;Hello, World!&#x27;);</span></span><br><span class="line"><span class="string">    return &#x27;This is Markdown!&#x27;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">\`\`\`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## åˆ—è¡¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- é¡¹ç›® 1</span></span><br><span class="line"><span class="string">- é¡¹ç›® 2</span></span><br><span class="line"><span class="string">- é¡¹ç›® 3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## é“¾æ¥</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[GitHub](https://github.com) | [Markdown æŒ‡å—](https://www.markdownguide.org/)</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®é»˜è®¤å†…å®¹</span></span><br><span class="line">markdownInput.<span class="property">value</span> = defaultContent;</span><br><span class="line"><span class="title function_">updatePreview</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®æ—¶é¢„è§ˆ</span></span><br><span class="line">markdownInput.<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, updatePreview);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updatePreview</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> content = markdownInput.<span class="property">value</span>;</span><br><span class="line">    markdownPreview.<span class="property">innerHTML</span> = marked.<span class="title function_">parse</span>(content);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥æ–‡æœ¬å·¥å…·å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">insertText</span>(<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> start = markdownInput.<span class="property">selectionStart</span>;</span><br><span class="line">    <span class="keyword">const</span> end = markdownInput.<span class="property">selectionEnd</span>;</span><br><span class="line">    <span class="keyword">const</span> selectedText = markdownInput.<span class="property">value</span>.<span class="title function_">substring</span>(start, end);</span><br><span class="line">    </span><br><span class="line">    markdownInput.<span class="property">value</span> = markdownInput.<span class="property">value</span>.<span class="title function_">substring</span>(<span class="number">0</span>, start) + </span><br><span class="line">                         text + </span><br><span class="line">                         markdownInput.<span class="property">value</span>.<span class="title function_">substring</span>(end);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡æ–°èšç„¦å¹¶è®¾ç½®å…‰æ ‡ä½ç½®</span></span><br><span class="line">    markdownInput.<span class="title function_">focus</span>();</span><br><span class="line">    markdownInput.<span class="property">selectionStart</span> = start + text.<span class="property">length</span>;</span><br><span class="line">    markdownInput.<span class="property">selectionEnd</span> = start + text.<span class="property">length</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">updatePreview</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showStatus</span>(<span class="params">message, isSuccess = <span class="literal">true</span></span>) &#123;</span><br><span class="line">    statusMessage.<span class="property">textContent</span> = message;</span><br><span class="line">    statusMessage.<span class="property">className</span> = isSuccess ? <span class="string">&#x27;status-show status-success&#x27;</span> : <span class="string">&#x27;status-show status-error&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        statusMessage.<span class="property">className</span> = <span class="string">&#x27;status-hidden&#x27;</span>;</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿å­˜åˆ° GitHub</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">saveToGitHub</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> content = markdownInput.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">const</span> filename = filenameInput.<span class="property">value</span> || <span class="string">&#x27;untitled.md&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> folder = folderInput.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">const</span> message = messageInput.<span class="property">value</span> || <span class="string">`Update <span class="subst">$&#123;filename&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!content.<span class="title function_">trim</span>()) &#123;</span><br><span class="line">        <span class="title function_">showStatus</span>(<span class="string">&#x27;é”™è¯¯ï¼šå†…å®¹ä¸èƒ½ä¸ºç©º&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!filename.<span class="title function_">endsWith</span>(<span class="string">&#x27;.md&#x27;</span>)) &#123;</span><br><span class="line">        <span class="title function_">showStatus</span>(<span class="string">&#x27;é”™è¯¯ï¼šæ–‡ä»¶åå¿…é¡»ä»¥ .md ç»“å°¾&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="title function_">showStatus</span>(<span class="string">&#x27;æ­£åœ¨ä¿å­˜...&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/save-markdown&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                content,</span><br><span class="line">                filename,</span><br><span class="line">                message,</span><br><span class="line">                folder</span><br><span class="line">            &#125;),</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result.<span class="property">success</span>) &#123;</span><br><span class="line">            <span class="title function_">showStatus</span>(<span class="string">&#x27;âœ… æ–‡ä»¶ä¿å­˜æˆåŠŸï¼&#x27;</span>);</span><br><span class="line">            <span class="title function_">loadFileList</span>(); <span class="comment">// åˆ·æ–°æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">showStatus</span>(<span class="string">&#x27;âŒ ä¿å­˜å¤±è´¥: &#x27;</span> + result.<span class="property">error</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">        <span class="title function_">showStatus</span>(<span class="string">&#x27;âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ è½½æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadFileList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> folder = folderInput.<span class="property">value</span>;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/api/files?folder=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(folder)&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result.<span class="property">success</span>) &#123;</span><br><span class="line">            <span class="title function_">displayFiles</span>(result.<span class="property">files</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading files:&#x27;</span>, result.<span class="property">error</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading files:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">displayFiles</span>(<span class="params">files</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (files.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        fileListContainer.<span class="property">innerHTML</span> = <span class="string">&#x27;&lt;p&gt;æš‚æ— æ–‡ä»¶&lt;/p&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fileListContainer.<span class="property">innerHTML</span> = files.<span class="title function_">map</span>(<span class="function"><span class="params">file</span> =&gt;</span> <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;file-item&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;h4&gt;<span class="subst">$&#123;file.name&#125;</span>&lt;/h4&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;è·¯å¾„: <span class="subst">$&#123;file.path&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;file-actions&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;button onclick=&quot;window.open(&#x27;<span class="subst">$&#123;file.url&#125;</span>&#x27;, &#x27;_blank&#x27;)&quot;&gt;æŸ¥çœ‹&lt;/button&gt;</span></span><br><span class="line"><span class="string">                &lt;button onclick=&quot;window.open(&#x27;<span class="subst">$&#123;file.download_url&#125;</span>&#x27;, &#x27;_blank&#x27;)&quot;&gt;ä¸‹è½½&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢åŠ è½½æ—¶è·å–æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">loadFileList</span>();</span><br><span class="line">    <span class="comment">// è®¾ç½®å®šæ—¶åˆ·æ–°æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">    <span class="built_in">setInterval</span>(loadFileList, <span class="number">30000</span>); <span class="comment">// æ¯30ç§’åˆ·æ–°ä¸€æ¬¡</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="ç¬¬äº”æ­¥ï¼šè¿è¡Œé¡¹ç›®">ç¬¬äº”æ­¥ï¼šè¿è¡Œé¡¹ç›®</h2>
<h3 id="å¯åŠ¨åç«¯æœåŠ¡">å¯åŠ¨åç«¯æœåŠ¡</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> backend</span><br><span class="line">npm install</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>
<h3 id="è®¿é—®å‰ç«¯é¡µé¢">è®¿é—®å‰ç«¯é¡µé¢</h3>
<p>æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š<code>http://localhost:3001</code></p>
<h2 id="ç¬¬å…­æ­¥ï¼šç¯å¢ƒå˜é‡é…ç½®">ç¬¬å…­æ­¥ï¼šç¯å¢ƒå˜é‡é…ç½®</h2>
<ol>
<li>åœ¨ <code>backend/.env</code> æ–‡ä»¶ä¸­å¡«å†™ä½ çš„é…ç½®ï¼š
<ul>
<li><code>GITHUB_TOKEN</code>: ä½ çš„ GitHub Personal Access Token</li>
<li><code>GITHUB_OWNER</code>: ä½ çš„ GitHub ç”¨æˆ·å</li>
<li><code>GITHUB_REPO</code>: ä½ çš„ä»“åº“åç§°</li>
<li><code>GITHUB_BRANCH</code>: ç›®æ ‡åˆ†æ”¯åç§°ï¼ˆé»˜è®¤ä¸º mainï¼‰</li>
</ul>
</li>
</ol>
<h2 id="å®‰å…¨æ³¨æ„äº‹é¡¹">å®‰å…¨æ³¨æ„äº‹é¡¹</h2>
<ol>
<li><strong>ä¸è¦å°† .env æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶</strong></li>
<li><strong>ä½¿ç”¨ .gitignore å¿½ç•¥æ•æ„Ÿæ–‡ä»¶</strong></li>
<li><strong>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡è€Œä¸æ˜¯æ–‡ä»¶</strong></li>
<li><strong>é™åˆ¶ GitHub Token çš„æƒé™èŒƒå›´</strong></li>
</ol>
<h2 id="æ•…éšœæ’é™¤">æ•…éšœæ’é™¤</h2>
<ol>
<li><strong>CORS é”™è¯¯</strong>: ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ</li>
<li><strong>401 é”™è¯¯</strong>: æ£€æŸ¥ GitHub Token æ˜¯å¦æ­£ç¡®</li>
<li><strong>404 é”™è¯¯</strong>: ç¡®è®¤ä»“åº“ã€åˆ†æ”¯å’Œè·¯å¾„å­˜åœ¨</li>
</ol>
<p>è¿™ä¸ªæ–¹æ¡ˆæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ã€å¯æ‰©å±•çš„ Markdown ç¼–è¾‘å™¨ï¼Œå¯ä»¥ç›´æ¥å°†å†…å®¹ä¿å­˜åˆ°ä½ çš„ GitHub ä»“åº“ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>Hexoåšå®¢å¤‡ä»½</title>
    <url>/2023/10/13/Hexo%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD/</url>
    <content><![CDATA[<h2 id="å‡†å¤‡">å‡†å¤‡</h2>
<div class="note danger no-icon modern"><p>å…ˆå¤‡ä»½ï¼ï¼ï¼</p>
</div>
<p>å°† github å‘å¸ƒ pages çš„é¡µé¢ä¸»åˆ†æ”¯æ”¹åä¸º Hexoï¼Œå†åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ mainã€‚</p>
<p>ç„¶ååœ¨å°† Hexo åšå®¢å‘å¸ƒåœ¨ main åˆ†æ”¯ä¸‹ï¼Œæ”¹_config.yml ä¸‹çš„é…ç½®ï¼Œç„¶åå°†å‘å¸ƒ pages çš„åˆ†æ”¯æ”¹ä¸º mainã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012008722.png" alt="image-20260121012008722"></p>
<h2 id="å¼€å§‹">å¼€å§‹</h2>
<ol>
<li>ä½¿ç”¨ vscode å°† <a href="http://youname.github.io">youname.github.io</a> å…‹éš†ä¸‹æ¥,ç„¶åå°†é‡Œé¢çš„æ–‡ä»¶å…¨åˆ é™¤ï¼Œæäº¤ã€‚</li>
<li>å°†å…ˆå¤‡ä»½çš„ hexo æ–‡ä»¶å¤¹ä¸­çš„<code>_config.yml</code>ã€<code>themes/</code>ã€<code>source</code>ã€<code>scaffolds</code>ã€<code>package.json</code>ã€<code>.gitignore</code>å¤åˆ¶è¿›å»ã€‚</li>
<li>å°† theme ä¸­ä½ çš„ä¸»é¢˜çš„.git/åˆ é™¤,ä¸ç„¶ä¸èƒ½ä¸Šä¼ ã€‚</li>
<li>æ‰§è¡Œï¼š<code>npm install</code>å’Œ<code>npm install hexo-deployer-git</code></li>
<li>æäº¤ã€‚</li>
</ol>
<h2 id="æœ€å">æœ€å</h2>
<p>æ¯æ¬¡æ”¹å˜ hexo æºæ–‡ä»¶çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä¸Šä¼ åˆ° hexo åˆ†æ”¯ä¸‹ã€‚ç”Ÿæˆçš„é™æ€æ–‡ä»¶ä¸ä¼šã€‚gitignoer é‡Œé¢å†™äº†ã€‚</p>
<p>éƒ¨ç½²çš„é™æ€æ–‡ä»¶å°±ä¼šåœ¨ main åˆ†æ”¯ä¸‹ã€‚</p>
]]></content>
      <categories>
        <category>Records</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>JDBCUtil</title>
    <url>/2025/09/15/JDBCUtil/</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> zorange.utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥Druidæ•°æ®æºå·¥å‚ç±»</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDBCå·¥å…·ç±»ï¼Œç”¨äºç®€åŒ–æ•°æ®åº“è¿æ¥å’Œå…³é—­èµ„æºçš„æ“ä½œã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtil</span> &#123;</span><br><span class="line">    <span class="comment">// é™æ€æ•°æ®æºæˆå‘˜å˜é‡ï¼Œç”¨äºæ•´ä¸ªåº”ç”¨å…±äº«ä¸€ä¸ªæ•°æ®æºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">static</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€åˆå§‹åŒ–å—ï¼Œç”¨äºåœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–æ•°æ®æº</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡å½“å‰ç±»çš„ç±»åŠ è½½å™¨è·å–jdbc.propertiesèµ„æºé…ç½®æ–‡ä»¶çš„è¾“å…¥æµ</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> JDBCUtil.class.getClassLoader().getResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºPropertieså¯¹è±¡ï¼Œç”¨äºè£…è½½é…ç½®æ–‡ä»¶ä¸­çš„é”®å€¼å¯¹</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åŠ è½½è¾“å…¥æµä¸­çš„é…ç½®ä¿¡æ¯åˆ°Propertieså¯¹è±¡ä¸­</span></span><br><span class="line">            properties.load(is);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœåŠ è½½é…ç½®æ–‡ä»¶å¤±è´¥ï¼ŒæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨DruidDataSourceFactoryåˆ›å»ºæ•°æ®æºå®ä¾‹</span></span><br><span class="line">            dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœåˆ›å»ºæ•°æ®æºå¤±è´¥ï¼ŒæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ•°æ®åº“è¿æ¥çš„æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ•°æ®åº“è¿æ¥å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException å¦‚æœè·å–è¿æ¥å¤±è´¥ï¼Œåˆ™æŠ›å‡ºSQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">// ä»æ•°æ®æºä¸­è·å–æ•°æ®åº“è¿æ¥</span></span><br><span class="line">        <span class="keyword">return</span>  dataSource.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³é—­æ•°æ®åº“è¿æ¥ã€Statementå’ŒResultSetçš„æ–¹æ³•ï¼Œç¡®ä¿èµ„æºè¢«æ­£ç¡®é‡Šæ”¾ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conn æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sta Statementå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> res ResultSetå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException å¦‚æœå…³é—­èµ„æºæ—¶å‘ç”Ÿé”™è¯¯ï¼Œåˆ™æŠ›å‡ºSQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(Connection conn, Statement sta, ResultSet res)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">// æŒ‰ç…§å…ˆåˆ›å»ºçš„åå…³é—­çš„é¡ºåºå…³é—­èµ„æº</span></span><br><span class="line">        <span class="keyword">if</span>(res != <span class="literal">null</span>)&#123; <span class="comment">// å…³é—­ResultSet</span></span><br><span class="line">            res.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sta != <span class="literal">null</span>)&#123; <span class="comment">// å…³é—­Statement</span></span><br><span class="line">            sta.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123; <span class="comment">// å…³é—­Connection</span></span><br><span class="line">            conn.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>JSONUtil</title>
    <url>/2025/09/15/JSONUtil/</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">package</span> com.atguigu.jxc.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/11/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JSONUtil</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">StringToObject</span><span class="params">(String str, Class&lt;T&gt; objectClass)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> objectMapper.readValue(str, objectClass);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">ObjectToString</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> objectMapper.writeValueAsString(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">StrToArrayObject</span><span class="params">(String str, Class&lt;T&gt; arrayObjectClass)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ TypeReference æ¥æŒ‡å®šè½¬æ¢ä¸º List æˆ–æ•°ç»„çš„ç±»å‹</span></span><br><span class="line">            <span class="keyword">return</span> objectMapper.readValue(str, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;T&gt;() &#123;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>JUC</title>
    <url>/2025/09/15/JUC/</url>
    <content><![CDATA[<h1>JUC</h1>
<p>æ€ç»´å¯¼å›¾ï¼š<a href="https://server.blog.zorange.online/files/de1cdc38f6c34ecb8304253a283acaa3.png">https://server.blog.zorange.online/files/de1cdc38f6c34ecb8304253a283acaa3.png</a></p>
<h2 id="JUCæ˜¯ä»€ä¹ˆï¼Ÿ">JUCæ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>åœ¨ Java 5.0 æä¾›äº† <code>java.util.concurrent</code>(ç®€ç§°JUC)åŒ…ï¼Œåœ¨æ­¤åŒ…ä¸­å¢åŠ äº†åœ¨å¹¶å‘ç¼–ç¨‹ä¸­å¾ˆå¸¸ç”¨çš„å·¥å…·ç±»ã€‚æ­¤åŒ…åŒ…æ‹¬äº†å‡ ä¸ªå°çš„ã€å·²æ ‡å‡†åŒ–çš„å¯æ‰©å±•æ¡†æ¶ï¼Œå¹¶æä¾›ä¸€äº›åŠŸèƒ½å®ç”¨çš„ç±»ï¼Œæ²¡æœ‰è¿™äº›ç±»ï¼Œä¸€äº›åŠŸèƒ½ä¼šå¾ˆéš¾å®ç°æˆ–å®ç°èµ·æ¥å†—é•¿ä¹å‘³ã€‚</p>
<h2 id="è¿›ç¨‹å’Œçº¿ç¨‹">è¿›ç¨‹å’Œçº¿ç¨‹</h2>
<p>è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€å®š<strong>ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åº</strong>å…³äºæŸä¸ªæ•°æ®é›†åˆçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ã€‚å®ƒæ˜¯æ“ä½œç³»ç»ŸåŠ¨æ€æ‰§è¡Œçš„åŸºæœ¬å•å…ƒï¼Œåœ¨ä¼ ç»Ÿçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ—¢æ˜¯åŸºæœ¬çš„åˆ†é…å•å…ƒï¼Œä¹Ÿæ˜¯åŸºæœ¬çš„æ‰§è¡Œå•å…ƒã€‚</p>
<p>çº¿ç¨‹ï¼šé€šå¸¸åœ¨<strong>ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…å«è‹¥å¹²ä¸ªçº¿ç¨‹</strong>ï¼Œå½“ç„¶ä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ç„¶æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰ã€‚çº¿ç¨‹å¯ä»¥åˆ©ç”¨è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºï¼Œåœ¨å¼•å…¥çº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œé€šå¸¸éƒ½æ˜¯æŠŠè¿›ç¨‹ä½œä¸ºåˆ†é…èµ„æºçš„åŸºæœ¬å•ä½ï¼Œè€ŒæŠŠçº¿ç¨‹ä½œä¸ºç‹¬ç«‹è¿è¡Œå’Œç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œç”±äºçº¿ç¨‹æ¯”è¿›ç¨‹æ›´å°ï¼ŒåŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œæ•…å¯¹å®ƒçš„è°ƒåº¦æ‰€ä»˜å‡ºçš„å¼€é”€å°±ä¼šå°å¾—å¤šï¼Œèƒ½æ›´é«˜æ•ˆçš„æé«˜ç³»ç»Ÿå¤šä¸ªç¨‹åºé—´å¹¶å‘æ‰§è¡Œçš„ç¨‹åº¦ã€‚</p>
<h2 id="å¹¶è¡Œå’Œå¹¶å‘">å¹¶è¡Œå’Œå¹¶å‘</h2>
<h2 id="waitå’Œsleepçš„åŒºåˆ«">waitå’Œsleepçš„åŒºåˆ«</h2>
<table>
<thead>
<tr>
<th>åŒºåˆ«</th>
<th>wait</th>
<th>sleep</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç±»</td>
<td>Object</td>
<td>Thread</td>
</tr>
<tr>
<td>é”</td>
<td>é‡Šæ”¾é”</td>
<td>ä¸é‡Šæ”¾é”</td>
</tr>
<tr>
<td>cpuèµ„æº</td>
<td>é‡Šæ”¾</td>
<td>é‡Šæ”¾</td>
</tr>
</tbody>
</table>
<h2 id="åˆ›å»ºå¤šçº¿ç¨‹çš„å››ç§æ–¹æ³•">åˆ›å»ºå¤šçº¿ç¨‹çš„å››ç§æ–¹æ³•</h2>
<ol>
<li>ç»§æ‰¿Threadç±»ï¼Œå®ç°runæ–¹æ³•</li>
<li>å®ç°Runableæ¥å£</li>
<li>å®ç°Callableæ¥å£ï¼Œå€ŸåŠ©FutrueTaskå®ç°ä¸€ä¸ªå¸¦è¿”å›å€¼çš„çº¿ç¨‹</li>
<li>çº¿ç¨‹æ± </li>
</ol>
<h2 id="Synchronized">Synchronized</h2>
<ol>
<li>æ™®é€šæ–¹æ³•ï¼šé”å¯¹è±¡æ˜¯å½“å‰å¯¹è±¡</li>
<li>é™æ€æ–¹æ³•ï¼šé”å¯¹è±¡æ˜¯å½“å‰ç±»çš„å­—èŠ‚ç å¯¹è±¡</li>
<li>ä»£ç å—ï¼šé”å¯¹è±¡æ˜¯è‡ªå®šä¹‰çš„</li>
</ol>
<blockquote>
<p>æ™®é€šæ–¹æ³•å’Œé™æ€æ–¹æ³•çš„é”å¯¹è±¡æ˜¯ä¸ä¼šäº’ç›¸ç«äº‰</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/9/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Resource1</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> num=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             Thread.sleep(<span class="number">10</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span>(num&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;ä¹°ç¥¨å¤±è´¥ï¼Œæ²¡ç¥¨äº†&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;ä¹°åˆ°äº†ï¼Œ&quot;</span>+<span class="string">&quot;è¿˜å‰©&quot;</span>+num--+<span class="string">&quot;å¼ &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SyncTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Resource1</span> <span class="variable">resource1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Resource1</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">30</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(resource1::get,i+<span class="string">&quot;&quot;</span>).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¤šçº¿ç¨‹ç¼–ç¨‹æ¨¡æ¿">å¤šçº¿ç¨‹ç¼–ç¨‹æ¨¡æ¿</h3>
<ol>
<li>åˆ›å»ºèµ„æºç±»</li>
<li>èµ„æºç±»åˆ›å»ºåŒæ­¥æ–¹æ³•ã€åŒæ­¥ä»£ç å—</li>
<li>å¤šçº¿ç¨‹è°ƒç”¨</li>
</ol>
<h2 id="Locké”">Locké”</h2>
<p>ç›¸æ¯”åŒæ­¥é”ï¼ŒJUCåŒ…ä¸­çš„Locké”çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œå®ƒæä¾›äº†å„ç§å„æ ·çš„é”ï¼ˆå…¬å¹³é”ï¼Œéå…¬å¹³é”ï¼Œå…±äº«é”ï¼Œç‹¬å é”â€¦â€¦ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨èµ·æ¥å¾ˆçµæ´»ã€‚</p>
<ul>
<li>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªå®ç°ï¼šReentrantLockã€ReentrantReadWriteLock.ReadLockã€ReentrantReadWriteLock.WriteLock</li>
</ul>
<h3 id="ReentrantLockå¯é‡å…¥é”">ReentrantLockå¯é‡å…¥é”</h3>
<ul>
<li>
<p>å¯é‡å…¥é”ï¼š</p>
<p>åœ¨ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†ä¸€ä¸ªèµ„æºç±»çš„ä¸€ä¸ªåŒæ­¥æ–¹æ³•åï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢åˆè°ƒç”¨äº†è¿™ä¸ªèµ„æºç±»çš„å¦å¤–ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œä¸”ä¸¤ä¸ªæ–¹æ³•çš„é”æ˜¯åŒä¸€ä¸ªã€‚</p>
<p>Aâ€”&gt;S1----&gt;S2</p>
<p>è‹¥è¿™ä¸ªé”ä¸å¯é‡å…¥ï¼Œæ­¤æ—¶ä¼šå‘ç”Ÿæ­»é”.å¯é‡å…¥çš„è¯å°±ä¸ä¼šæ­»é”ï¼Œè¿™ä¸ªé”ä»»ç„¶å¯ä»¥æ­£å¸¸è·å–</p>
</li>
<li>
<p>Synchronizedä¹Ÿæ˜¯å¯é‡å…¥é”</p>
</li>
<li>
<p>å¯é‡å…¥é”å¯ä»¥è§£å†³æ­»é”é—®é¢˜</p>
</li>
</ul>
<h3 id="å…¬å¹³é”">å…¬å¹³é”</h3>
<ul>
<li>
<p>å…¬å¹³é”ï¼šåœ¨é”ä¸Šç­‰å¾…çš„æ—¶é—´æœ€é•¿çš„çº¿ç¨‹å°†æ´»å¾—é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(<span class="literal">true</span>); </span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="é™æ—¶ç­‰å¾…">é™æ—¶ç­‰å¾…</h3>
<p>é€šè¿‡æˆ‘ä»¬çš„tryLockæ–¹æ³•æ¥å®ç°ï¼Œå¯ä»¥é€‰æ‹©ä¼ å…¥æ—¶é—´å‚æ•°ï¼Œè¡¨ç¤ºç­‰å¾…æŒ‡å®šçš„æ—¶é—´ï¼Œæ— å‚åˆ™è¡¨ç¤ºç«‹å³è¿”å›é”ç”³è¯·çš„ç»“æœï¼štrueè¡¨ç¤ºè·å–é”æˆåŠŸï¼Œfalseè¡¨ç¤ºè·å–é”å¤±è´¥ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™ç§æ–¹æ³•ç”¨æ¥è§£å†³æ­»é”é—®é¢˜ã€‚</p>
<blockquote>
<p>å“åº”ä¸­æ–­</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">lock.tryLock()</span><br><span class="line">lock.tryLock(Long timeout,Timeunit unit)   <span class="comment">//ç»è¿‡å¤šæ¬¡æ—¶é—´æ”¾å¼ƒ</span></span><br></pre></td></tr></table></figure>
<h3 id="ReentrantLockå’ŒsynchronizedåŒºåˆ«">ReentrantLockå’ŒsynchronizedåŒºåˆ«</h3>
<table>
<thead>
<tr>
<th>åŒºåˆ«</th>
<th>ReentrantLock</th>
<th>synchronized</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯é‡å…¥</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>ç‹¬å é”</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>éšå¼é‡Šæ”¾|æ˜¾ç¤º</td>
<td>æ˜¾ç¤º</td>
<td>éšå¼</td>
</tr>
<tr>
<td>å“åº”ä¸­æ–­</td>
<td>å¯ä»¥å“åº”ä¸­æ–­</td>
<td>ä¸å¯ä»¥å“åº”ä¸­æ–­</td>
</tr>
</tbody>
</table>
<p>å“åº”ä¸­æ–­ï¼šæ‹¿ä¸åˆ°é”å°±ä¸­æ–­çº¿ç¨‹ã€‚</p>
<h3 id="ReentrantReadWriteLockè¯»å†™é”">ReentrantReadWriteLockè¯»å†™é”</h3>
<p>åœ¨å¹¶å‘åœºæ™¯ä¸­ç”¨äºè§£å†³çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬å‡ ä¹ä¼šé«˜é¢‘ç‡çš„ä½¿ç”¨åˆ°ç‹¬å å¼é”ï¼Œé€šå¸¸ä½¿ç”¨javaæä¾›çš„å…³é”®å­—synchronizedæˆ–è€…concurrentsåŒ…ä¸­å®ç°äº†Lockæ¥å£çš„ReentrantLockã€‚å®ƒä»¬éƒ½æ˜¯ç‹¬å å¼è·å–é”ï¼Œä¹Ÿå°±æ˜¯åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–é”ã€‚è€Œåœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¤§éƒ¨åˆ†åªæ˜¯è¯»æ•°æ®ï¼Œå†™æ•°æ®å¾ˆå°‘ï¼Œå¦‚æœä»…ä»…æ˜¯è¯»æ•°æ®çš„è¯å¹¶ä¸ä¼šå½±å“æ•°æ®æ­£ç¡®æ€§ï¼ˆå‡ºç°è„è¯»ï¼‰ï¼Œè€Œå¦‚æœåœ¨è¿™ç§ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä¾ç„¶ä½¿ç”¨ç‹¬å é”çš„è¯ï¼Œå¾ˆæ˜¾ç„¶è¿™å°†æ˜¯å‡ºç°æ€§èƒ½ç“¶é¢ˆçš„åœ°æ–¹ã€‚é’ˆå¯¹è¿™ç§è¯»å¤šå†™å°‘çš„æƒ…å†µï¼Œjavaè¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªå®ç°Lockæ¥å£çš„<strong>ReentrantReadWriteLock</strong>(è¯»å†™é”)ã€‚<strong>è¯»å†™é”å…è®¸åŒä¸€æ—¶åˆ»è¢«å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯åœ¨å†™çº¿ç¨‹è®¿é—®æ—¶ï¼Œæ‰€æœ‰çš„è¯»çº¿ç¨‹å’Œå…¶ä»–çš„å†™çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡</strong>ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å†™å†™ä¸å¯å¹¶å‘</li>
<li>è¯»å†™ä¸å¯å¹¶å‘</li>
<li>è¯»è¯»å¯ä»¥å¹¶å‘</li>
</ul>
<p>è¯»å†™é”ï¼šè¯»å†™é”ä¸­çš„è¯»é”å’Œå†™é”å®é™…æ˜¯ä¸€æŠŠé”çš„ä¸¤ä¸ªä¸åŒè§’è‰²ã€‚</p>
<p>è¯»é”ï¼šè¯»å…±äº«</p>
<p>å†™é”:  ç‹¬å é”</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/9/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Resource2</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String,String&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    ReentrantReadWriteLock reentrantReadWriteLock= <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line">    ReentrantReadWriteLock.<span class="type">ReadLock</span> <span class="variable">readLock</span> <span class="operator">=</span> reentrantReadWriteLock.readLock();</span><br><span class="line">    ReentrantReadWriteLock.WriteLock writeLock=reentrantReadWriteLock.writeLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key,String value)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">20</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        writeLock.lock();</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å¼€å§‹å†™å…¥ï¼Œkey:&quot;</span>+key+<span class="string">&quot;,value:&quot;</span>+value);</span><br><span class="line">        map.put(key,value);</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å†™å…¥æˆåŠŸ,key:&quot;</span>+key+<span class="string">&quot;,value:&quot;</span>+value);</span><br><span class="line">        writeLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">get</span><span class="params">(String key)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">20</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        readLock.lock();</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å¼€å§‹è¯»å–,key:&quot;</span>+key);</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;è¯»å–æˆåŠŸï¼Œkey:&quot;</span>+key+<span class="string">&quot;,value:&quot;</span>+value);</span><br><span class="line">        readLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadWriteLock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Resource2</span> <span class="variable">resource2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Resource2</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">10</span> ; i++) &#123;</span><br><span class="line">            String a=i+<span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                resource2.put(a,a);</span><br><span class="line">            &#125;,<span class="string">&quot;çº¿ç¨‹&quot;</span>+i).start();</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                resource2.get(a);</span><br><span class="line">            &#125;,<span class="string">&quot;çº¿ç¨‹&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="é”é™çº§">é”é™çº§</h3>
<p>ä»€ä¹ˆæ˜¯é”é™çº§ï¼Œé”é™çº§å°±æ˜¯ä»å†™é”é™çº§æˆä¸ºè¯»é”ã€‚åœ¨å½“å‰çº¿ç¨‹æ‹¥æœ‰å†™é”çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡è·å–åˆ°è¯»é”ï¼Œéšåé‡Šæ”¾å†™é”çš„è¿‡ç¨‹å°±æ˜¯é”é™çº§ã€‚è¿™é‡Œå¯ä»¥ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    rwlock.writeLock().lock();</span><br><span class="line">    System.out.println(<span class="string">&quot;è·å–åˆ°å†™é”ã€‚ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">    rwlock.readLock().lock();</span><br><span class="line">    System.out.println(<span class="string">&quot;è·å–åˆ°è¯»é”----------&quot;</span>);</span><br><span class="line">    rwlock.writeLock().unlock();</span><br><span class="line">    System.out.println(<span class="string">&quot;é‡Šæ”¾å†™é”==============&quot;</span>);</span><br><span class="line">    rwlock.readLock().unlock();</span><br><span class="line">    System.out.println(<span class="string">&quot;é‡Šæ”¾è¯»é”++++++++++++++++&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åªèƒ½ç”±å†™é”é™çº§åˆ°è¯»é”ï¼Œä¸èƒ½ç”±è¯»é”å‡çº§åˆ°å†™é”</p>
<h3 id="è¯»å†™é”æ€»ç»“">è¯»å†™é”æ€»ç»“</h3>
<ol>
<li>
<p>æ”¯æŒå…¬å¹³/éå…¬å¹³ç­–ç•¥</p>
</li>
<li>
<p>æ”¯æŒå¯é‡å…¥</p>
<ul>
<li>åŒä¸€è¯»çº¿ç¨‹åœ¨è·å–äº†è¯»é”åè¿˜å¯ä»¥è·å–è¯»é”</li>
<li>åŒä¸€å†™çº¿ç¨‹åœ¨è·å–äº†å†™é”ä¹‹åæ—¢å¯ä»¥å†æ¬¡è·å–å†™é”åˆå¯ä»¥è·å–è¯»é”</li>
</ul>
</li>
<li>
<p>æ”¯æŒé”é™çº§ï¼Œä¸æ”¯æŒé”å‡çº§</p>
</li>
<li>
<p>è¯»å†™é”å¦‚æœä½¿ç”¨ä¸å½“ï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿâ€œå†™é¥¥é¥¿â€é—®é¢˜ï¼š</p>
<p>åœ¨è¯»çº¿ç¨‹éå¸¸å¤šï¼Œå†™çº¿ç¨‹å¾ˆå°‘çš„æƒ…å†µä¸‹ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´å†™çº¿ç¨‹â€œé¥¥é¥¿â€ï¼Œè™½ç„¶ä½¿ç”¨â€œå…¬å¹³â€ç­–ç•¥å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯â€œå…¬å¹³â€ç­–ç•¥æ˜¯ä»¥ç‰ºç‰²ç³»ç»Ÿååé‡ä¸ºä»£ä»·çš„ã€‚</p>
</li>
<li>
<p>Conditionæ¡ä»¶æ”¯æŒ</p>
<p>å†™é”å¯ä»¥é€šè¿‡<code>newCondition()</code>æ–¹æ³•è·å–Conditionå¯¹è±¡ã€‚ä½†æ˜¯è¯»é”æ˜¯æ²¡æ³•è·å–Conditionå¯¹è±¡ï¼Œè¯»é”è°ƒç”¨<code>newCondition() </code>æ–¹æ³•ä¼šç›´æ¥æŠ›å‡º<code>UnsupportedOperationException</code>ã€‚</p>
</li>
</ol>
<h2 id="çº¿ç¨‹é€šä¿¡">çº¿ç¨‹é€šä¿¡</h2>
<h3 id="çº¿ç¨‹é€šä¿¡æ¨¡æ¿">çº¿ç¨‹é€šä¿¡æ¨¡æ¿</h3>
<ol>
<li>å®šä¹‰èµ„æºç±»ã€æ–¹æ³•</li>
<li>èµ„æºç±»æ–¹æ³•ï¼š
<ul>
<li>åˆ¤æ–­ï¼ˆç¬¦åˆæ¡ä»¶å°±è¿è¡Œï¼Œä¸ç¬¦åˆå°±ç­‰å¾…ï¼‰</li>
<li>æ‰§è¡Œ</li>
<li>å”¤é†’</li>
</ul>
</li>
<li>é€šè¿‡å¤šçº¿ç¨‹æ“ä½œå…±äº«èµ„æº</li>
</ol>
<h3 id="synchronizedå’ŒLocké”çš„é€šä¿¡åŒºåˆ«-ï¼ˆawaitã€Conditionï¼‰">synchronizedå’ŒLocké”çš„é€šä¿¡åŒºåˆ« ï¼ˆawaitã€Conditionï¼‰</h3>
<ul>
<li>synchronized     wait -----waitï¼ˆtimeï¼‰-----notify-----notifyAll</li>
<li>lock        lock.newCondition.await------lock.condition.signal-----lock.condition.signalAll</li>
</ul>
<h3 id="çº¿ç¨‹é€šä¿¡æ¶‰åŠå¤šä¸ªçº¿ç¨‹æ—¶">çº¿ç¨‹é€šä¿¡æ¶‰åŠå¤šä¸ªçº¿ç¨‹æ—¶</h3>
<h4 id="è™šå‡å”¤é†’">è™šå‡å”¤é†’</h4>
<p><strong>é—®é¢˜</strong>ï¼šä¸€ä¸ªçº¿ç¨‹åœ¨åˆ¤æ–­ä¹‹åwaitï¼Œä¹‹åè¢«å”¤é†’æ—¶ï¼Œä¼šç›´æ¥ä»waitå”¤é†’ï¼Œæ­¤æ—¶å¦‚æœç”¨çš„ifï¼Œå°±ä¸ä¼šå†è¿›è¡Œåˆ¤æ–­ã€‚å°±ç®—ä¸ç¬¦åˆæ¡ä»¶ä¹Ÿä¼šè¿è¡Œã€‚</p>
<p><strong>è§£å†³</strong>ï¼šå°†ifæ¢ä¸ºwhile</p>
<p><strong>åŸå› </strong>ï¼šçº¿ç¨‹è¢«å”¤é†’æ—¶ä¸æ˜¯ä»å¤´å¼€å§‹ï¼Œè€Œæ˜¯ä»waitå¼€å§‹</p>
<h3 id="å®šåˆ¶åŒ–çº¿ç¨‹é—´é€šä¿¡">å®šåˆ¶åŒ–çº¿ç¨‹é—´é€šä¿¡</h3>
<blockquote>
<p>é€šè¿‡å¤šé’¥åŒ™å®ç°<strong>æŒ‡å®šçº¿ç¨‹</strong>å”¤é†’</p>
</blockquote>
<p><strong>æ¡ˆä¾‹</strong>ï¼šå¤šçº¿ç¨‹é—´æœ‰åºè¿è¡Œ</p>
<p>â€‹			aæ‰“å°10æ¬¡ï¼Œbå†æ‰“å°10æ¬¡ï¼Œcå†æ‰“å°10æ¬¡</p>
<p><strong>åŸç†</strong>ï¼šé€šè¿‡locké”çš„å¤šconditionæ¥å®ç°æŒ‡å®šå”¤é†’çº¿ç¨‹ï¼Œåªæœ‰è¢«åŒä¸€ä¸ªcondition .awaitçš„æ‰èƒ½è¢«è¿™ä¸ªcanditionçš„signalå”¤é†’ã€‚</p>
<p><strong>ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.thread.communication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/9/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Resource</span>&#123;</span><br><span class="line">    <span class="type">int</span> flag=<span class="number">1</span>;</span><br><span class="line">    Lock lock=<span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    Condition conditionA=lock.newCondition();</span><br><span class="line">    Condition conditionB=lock.newCondition();</span><br><span class="line">    Condition conditionC=lock.newCondition();</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">AA</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">while</span> (flag!=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conditionA.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.print(Thread.currentThread().getName()+<span class="string">&quot;AA &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        flag++;</span><br><span class="line">        conditionB.signal();</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">BB</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">while</span> (flag!=<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conditionB.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.print(Thread.currentThread().getName()+<span class="string">&quot;BB &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        flag++;</span><br><span class="line">        conditionC.signal();</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">CC</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">while</span> (flag!=<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conditionC.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.print(Thread.currentThread().getName()+<span class="string">&quot;CC &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        flag=<span class="number">1</span>;</span><br><span class="line">        conditionA.signal();</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AaBbCc</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Resource</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">                resource.BB();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;2&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">                resource.AA();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">                resource.CC();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;3&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="å¹¶å‘å®¹å™¨ç±»">å¹¶å‘å®¹å™¨ç±»</h2>
<p>é¢è¯•é¢˜ï¼š</p>
<p>â€‹	è¯·ä¸¾ä¾‹è¯´æ˜é›†åˆç±»æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<p>â€‹                                   åŸå› ï¼š                             è§£å†³æ–¹æ¡ˆ</p>
<p>ArrayList:                  æ²¡æœ‰é”                            ç»™ä»£ç å—è§£é”ã€</p>
<p>â€‹                                                                         vectorã€åº•å±‚æ‰©å®¹åŸºäºæ•°ç»„ã€é€Ÿåº¦æ…¢ã€ç¨å¾®æµªè´¹å†…å­˜ã€</p>
<p>â€‹                                                                          Collections.synchronizedList(list);  æœ‰é”ã€åº•å±‚æ‰©å®¹åŸºäºListã€é€Ÿåº¦ç›¸è¾ƒäº   vectorå¿«ä¸€äº›ã€</p>
<p>â€‹                                                                          CopyOnWriteArrayList: é€‚ç”¨äºé«˜å¹¶å‘è¯»å†™æ“ä½œï¼Œè§£å†³äº†è¯»å†™å†²çªé—®é¢˜ã€‚</p>
<p>HashSet                    æ²¡æœ‰é”                            ç»™ä»£ç å—è§£é”ï¼š</p>
<p>â€‹                                                                          Collections.synchronizedSet(set)</p>
<p>â€‹                                                                         CopyOnWriteArraySet:  é€‚ç”¨äºé«˜å¹¶å‘è¯»å†™æ“ä½œï¼Œè§£å†³äº†è¯»å†™å†²çªé—®é¢˜ã€‚</p>
<p>HashMap:                 æ²¡æœ‰é”                           ç»™ä»£ç å—è§£é”ï¼š</p>
<p>â€‹                                                                        Collections.synchronizedMap(map)</p>
<p>â€‹                                                                        HashTable:åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ€§èƒ½è¾ƒå·®ï¼Œå› å…¨è¡¨é”å®šå¯¼è‡´å¤§é‡é”ç«äº‰ã€‚</p>
<p>â€‹                                                                       ConcurrentHashMap: åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ€§èƒ½ä¼˜è¶Šï¼Œå…è®¸æ›´é«˜çš„å¹¶å‘è®¿é—®,åº•å±‚åŸºäºCASä¹è§‚é”å®ç°çš„ã€‚</p>
<p>â€‹	<strong>CopyOnWriteå®¹å™¨</strong>ï¼ˆç®€ç§°COWå®¹å™¨ï¼‰å³<strong>å†™æ—¶å¤åˆ¶</strong>çš„å®¹å™¨ã€‚é€šä¿—çš„ç†è§£æ˜¯å½“æˆ‘ä»¬å¾€ä¸€ä¸ªå®¹å™¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¾€å½“å‰å®¹å™¨æ·»åŠ ï¼Œè€Œæ˜¯å…ˆå°†å½“å‰å®¹å™¨è¿›è¡ŒCopyï¼Œå¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œç„¶åæ–°çš„å®¹å™¨é‡Œæ·»åŠ å…ƒç´ ï¼Œæ·»åŠ å®Œå…ƒç´ ä¹‹åï¼Œå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°çš„å®¹å™¨ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å¯¹CopyOnWriteå®¹å™¨è¿›è¡Œå¹¶å‘çš„è¯»ï¼Œè€Œä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºå½“å‰å®¹å™¨ä¸ä¼šæ·»åŠ ä»»ä½•å…ƒç´ ã€‚æ‰€ä»¥<strong>CopyOnWriteå®¹å™¨ä¹Ÿæ˜¯ä¸€ç§è¯»å†™åˆ†ç¦»çš„æ€æƒ³ï¼Œè¯»å’Œå†™ä¸åŒçš„å®¹å™¨</strong>ã€‚</p>
<p><strong>CopyOnWriteå¹¶å‘å®¹å™¨ç”¨äºè¯»å¤šå†™å°‘çš„å¹¶å‘åœºæ™¯</strong>ã€‚æ¯”å¦‚ï¼šç™½åå•ï¼Œé»‘åå•ã€‚å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæœç´¢ç½‘ç«™ï¼Œç”¨æˆ·åœ¨è¿™ä¸ªç½‘ç«™çš„æœç´¢æ¡†ä¸­ï¼Œè¾“å…¥å…³é”®å­—æœç´¢å†…å®¹ï¼Œä½†æ˜¯æŸäº›å…³é”®å­—ä¸å…è®¸è¢«æœç´¢ã€‚è¿™äº›ä¸èƒ½è¢«æœç´¢çš„å…³é”®å­—ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªé»‘åå•å½“ä¸­ï¼Œé»‘åå•ä¸€å®šå‘¨æœŸæ‰ä¼šæ›´æ–°ä¸€æ¬¡ã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>**å†…å­˜å ç”¨é—®é¢˜ã€‚**å†™çš„æ—¶å€™ä¼šåˆ›å»ºæ–°å¯¹è±¡æ·»åŠ åˆ°æ–°å®¹å™¨é‡Œï¼Œè€Œæ—§å®¹å™¨çš„å¯¹è±¡è¿˜åœ¨ä½¿ç”¨ï¼Œæ‰€ä»¥æœ‰ä¸¤ä»½å¯¹è±¡å†…å­˜ã€‚é€šè¿‡å‹ç¼©å®¹å™¨ä¸­çš„å…ƒç´ çš„æ–¹æ³•æ¥å‡å°‘å¤§å¯¹è±¡çš„å†…å­˜æ¶ˆè€—ï¼Œæ¯”å¦‚ï¼Œå¦‚æœå…ƒç´ å…¨æ˜¯10è¿›åˆ¶çš„æ•°å­—ï¼Œå¯ä»¥è€ƒè™‘æŠŠå®ƒå‹ç¼©æˆ36è¿›åˆ¶æˆ–64è¿›åˆ¶ã€‚æˆ–è€…ä¸ä½¿ç”¨CopyOnWriteå®¹å™¨ï¼Œè€Œä½¿ç”¨å…¶ä»–çš„å¹¶å‘å®¹å™¨ï¼Œå¦‚ConcurrentHashMapã€‚</li>
<li>**æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚**CopyOnWriteå®¹å™¨åªèƒ½ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„å®æ—¶ä¸€è‡´æ€§ã€‚æ‰€ä»¥å¦‚æœä½ å¸Œæœ›å†™å…¥çš„çš„æ•°æ®ï¼Œé©¬ä¸Šèƒ½è¯»åˆ°ï¼Œè¯·ä¸è¦ä½¿ç”¨CopyOnWriteå®¹å™¨ã€‚</li>
</ol>
<h2 id="JUCä¸‹çš„å¼ºå¤§è¾…åŠ©å·¥å…·ç±»">JUCä¸‹çš„å¼ºå¤§è¾…åŠ©å·¥å…·ç±»</h2>
<ol>
<li>CountDownLatch(å€’è®¡æ•°å™¨)</li>
<li>CycliBarrier(å¾ªç¯æ …æ )</li>
<li>Samaphoreï¼ˆä¿¡å·é‡ï¼‰</li>
</ol>
<h3 id="CountDownLatch">CountDownLatch</h3>
<p><strong>ä½¿ç”¨</strong>ï¼šè®¾ç½®ä¸€ä¸ªè®¡æ•°å™¨ã€‚æ¯å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¯¥è®¡æ•°å™¨çš„countDownæ—¶ï¼Œè®¡æ•°å™¨å‡ä¸€</p>
<p>åœ¨ä¸»çº¿ç¨‹æˆ–å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œä½¿ç”¨è®¡æ•°å™¨çš„awaitæ–¹æ³•ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œåªæœ‰å½“è®¡æ•°å™¨å‡ä¸º0ä¹‹åï¼Œè¯¥çº¿ç¨‹æ‰ä¼šç»§ç»­è¿è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="type">int</span> count) <span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ªå€’è®¡æ•°å™¨ï¼ŒcountæŒ‡å®šåˆå§‹è®¡æ•°</span></span><br><span class="line">countDown() <span class="comment">// æ¯è°ƒç”¨ä¸€æ¬¡ï¼Œè®¡æ•°å‡ä¸€</span></span><br><span class="line">await() <span class="comment">//ç­‰å¾…ï¼Œå½“è®¡æ•°å‡åˆ°0æ—¶ï¼Œé˜»å¡çº¿ç¨‹ï¼ˆå¯ä»¥æ˜¯ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªï¼‰å¹¶è¡Œæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>
<p><strong>ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.thread.communication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/9/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountDownTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String[] country = &#123;<span class="string">&quot;ä¿„ç½—æ–¯&quot;</span>, <span class="string">&quot;ç¾å›½&quot;</span>, <span class="string">&quot;å¾·å›½&quot;</span>, <span class="string">&quot;æ„å¤§åˆ©&quot;</span>, <span class="string">&quot;ä¸­å›½&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : country) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">3000</span>));</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;åŒæ„!&quot;</span>);</span><br><span class="line">                    count.countDown();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, s).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ ¸å¼¹å‘å°„!!!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="CyclicBarrier">CyclicBarrier</h3>
<p><strong>ä»‹ç»</strong>ï¼šåœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œè‹¥æŸäº›ä»»åŠ¡éœ€è¦å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œã€‚ä¸”å­˜åœ¨å¤šä¸ªä»»åŠ¡æ—¶ï¼Œä½¿ç”¨CyclicBarrierã€‚</p>
<p>ä¸”åœ¨æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡æ—¶çš„æœ€åä¸€ä¸ªå®Œæˆçº¿ç¨‹å¯ä»¥æ·»åŠ é¢å¤–åŠŸèƒ½ã€‚</p>
<p><strong>å¸¸ç”¨æ–¹æ³•</strong>ï¼š</p>
<ol>
<li>CyclicBarrier(int parties, Runnable barrierAction) åˆ›å»ºä¸€ä¸ªCyclicBarrierå®ä¾‹ï¼ŒpartiesæŒ‡å®šå‚ä¸ç›¸äº’ç­‰å¾…çš„çº¿ç¨‹æ•°ï¼Œ<strong>barrierActionä¸€ä¸ªå¯é€‰çš„Runnableå‘½ä»¤ï¼Œè¯¥å‘½ä»¤åªåœ¨æ¯ä¸ªå±éšœç‚¹è¿è¡Œä¸€æ¬¡ï¼Œå¯ä»¥åœ¨æ‰§è¡Œåç»­ä¸šåŠ¡ä¹‹å‰å…±äº«çŠ¶æ€ã€‚è¯¥æ“ä½œç”±æœ€åä¸€ä¸ªè¿›å…¥å±éšœç‚¹çš„çº¿ç¨‹æ‰§è¡Œã€‚</strong></li>
<li>CyclicBarrier(int parties) åˆ›å»ºä¸€ä¸ªCyclicBarrierå®ä¾‹ï¼ŒpartiesæŒ‡å®šå‚ä¸ç›¸äº’ç­‰å¾…çš„çº¿ç¨‹æ•°ã€‚</li>
<li>await() è¯¥æ–¹æ³•è¢«è°ƒç”¨æ—¶è¡¨ç¤ºå½“å‰çº¿ç¨‹å·²ç»åˆ°è¾¾å±éšœç‚¹ï¼Œå½“å‰çº¿ç¨‹é˜»å¡è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œ<strong>ç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœç‚¹</strong>ï¼Œå½“å‰çº¿ç¨‹æ‰ä¼šè¢«å”¤é†’ã€‚</li>
</ol>
<p><strong>ç›¸å¯¹äºCountDownçš„åŒºåˆ«</strong>ï¼š</p>
<p>CountDownåªèƒ½å­˜åœ¨ä¸€ä¸ªä¸»ä»»åŠ¡ï¼Œè€ŒCyclicBarrieråœ¨å®Œæˆä¸€ä¸ªä»»åŠ¡ä¹‹åï¼Œè®¡æ•°å™¨å¯ä»¥é‡ç½®ã€‚</p>
<p><strong>ä»£ç ä½¿ç”¨</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.thread.communication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BrokenBarrierException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/9/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Resource2</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CyclicBarrierTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">cyclicBarrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">4</span>,()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æœ€èœç©å®¶å‡ºç°äº†ï¼Œä»–å°±æ˜¯ï¼š&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">4</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= <span class="number">4</span>; j++) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;æ­£åœ¨é—¯ç¬¬&quot;</span>+j+<span class="string">&quot;å…³&quot;</span>);</span><br><span class="line">                        Thread.sleep(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">3000</span>));</span><br><span class="line">                        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;é—¯è¿‡äº†&quot;</span>+j+<span class="string">&quot;å…³&quot;</span>);</span><br><span class="line">                        cyclicBarrier.await();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="string">&quot;ç©å®¶&quot;</span>+ i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Semaphore">Semaphore</h3>
<p>Semaphoreç¿»è¯‘æˆå­—é¢æ„æ€ä¸º ä¿¡å·é‡ï¼ŒSemaphoreå¯ä»¥æ§åˆ¶åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°ã€‚éå¸¸é€‚åˆéœ€æ±‚é‡å¤§ï¼Œè€Œèµ„æºåˆå¾ˆç´§å¼ çš„æƒ…å†µã€‚æ¯”å¦‚ç»™å®šä¸€ä¸ªèµ„æºæ•°ç›®æœ‰é™çš„èµ„æºæ± ï¼Œå‡è®¾èµ„æºæ•°ç›®ä¸ºNï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å‡å¯è·å–ä¸€ä¸ªèµ„æºï¼Œä½†æ˜¯å½“èµ„æºåˆ†é…å®Œæ¯•æ—¶ï¼Œåæ¥çº¿ç¨‹éœ€è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å‰é¢å·²æŒæœ‰èµ„æºçš„çº¿ç¨‹é‡Šæ”¾èµ„æºä¹‹åæ‰èƒ½ç»§ç»­ã€‚</p>
<p><strong>ä»‹ç»</strong>ï¼šä¸»è¦ç”¨äºé™æµï¼Œé™åˆ¶å¤šå°‘ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡ŒæŸä¸ªä»»åŠ¡ã€‚</p>
<p>ä¿¡å·é‡ä¸»è¦ç”¨äºä¸¤ä¸ªç›®çš„ï¼š</p>
<ol>
<li>å¤šä¸ªå…±äº«èµ„æºçš„äº’æ–¥ä½¿ç”¨ã€‚</li>
<li>ç”¨äºå¹¶å‘çº¿ç¨‹æ•°çš„æ§åˆ¶ã€‚ä¿æŠ¤ä¸€ä¸ªå…³é”®éƒ¨åˆ†ä¸è¦ä¸€æ¬¡è¾“å…¥è¶…è¿‡Nä¸ªçº¿ç¨‹ã€‚</li>
</ol>
<p>sentinelé™æµ</p>
<p><strong>ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.thread.communication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/9/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SemaphoreTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span>);</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;æ­£åœ¨pk...&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">4000</span>));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;ç©ç´¯äº†,é€€å‡ºäº†&quot;</span>);</span><br><span class="line">                semaphore.release();</span><br><span class="line">            &#125;,<span class="string">&quot;ç©å®¶&quot;</span>+i).start();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Callable">Callable</h2>
<h3 id="é¢è¯•é¢˜ï¼šcallableæ¥å£ä¸runnableæ¥å£çš„åŒºåˆ«ï¼Ÿ">é¢è¯•é¢˜ï¼šcallableæ¥å£ä¸runnableæ¥å£çš„åŒºåˆ«ï¼Ÿ</h3>
<p>ç›¸åŒç‚¹ï¼šéƒ½æ˜¯æ¥å£ï¼Œéƒ½å¯ä»¥ç¼–å†™å¤šçº¿ç¨‹ç¨‹åºï¼Œéƒ½é‡‡ç”¨Thread.start()å¯åŠ¨çº¿ç¨‹</p>
<p>ä¸åŒç‚¹ï¼š</p>
<ol>
<li>å…·ä½“æ–¹æ³•ä¸åŒï¼šä¸€ä¸ªæ˜¯runï¼Œä¸€ä¸ªæ˜¯call</li>
<li>Runnableæ²¡æœ‰è¿”å›å€¼ï¼›Callableå¯ä»¥è¿”å›æ‰§è¡Œç»“æœï¼Œæ˜¯ä¸ªæ³›å‹</li>
<li>Callableæ¥å£çš„call()æ–¹æ³•å…è®¸æŠ›å‡ºå¼‚å¸¸ï¼›Runnableçš„run()æ–¹æ³•å¼‚å¸¸åªèƒ½åœ¨å†…éƒ¨æ¶ˆåŒ–ï¼Œä¸èƒ½å¾€ä¸Šç»§ç»­æŠ›</li>
<li>å®ƒæä¾›äº†æ£€æŸ¥è®¡ç®—æ˜¯å¦å®Œæˆçš„æ–¹æ³•ï¼Œä»¥ç­‰å¾…è®¡ç®—çš„å®Œæˆï¼Œå¹¶æ£€ç´¢è®¡ç®—çš„ç»“æœã€‚</li>
</ol>
<h2 id="é˜»å¡é˜Ÿåˆ—">é˜»å¡é˜Ÿåˆ—</h2>
<p>ä»‹ç»ï¼šåœ¨å¤šçº¿ç¨‹é¢†åŸŸï¼šæ‰€è°“é˜»å¡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šæŒ‚èµ·çº¿ç¨‹ï¼ˆå³é˜»å¡ï¼‰ï¼Œä¸€æ—¦æ¡ä»¶æ»¡è¶³ï¼Œè¢«æŒ‚èµ·çš„çº¿ç¨‹åˆä¼šè‡ªåŠ¨è¢«å”¤èµ·</p>
<p>BlockingQueueå³é˜»å¡é˜Ÿåˆ—ï¼Œæ˜¯java.util.concurrentä¸‹çš„ä¸€ä¸ªæ¥å£ï¼Œå› æ­¤ä¸éš¾ç†è§£ï¼ŒBlockingQueueæ˜¯ä¸ºäº†è§£å†³å¤šçº¿ç¨‹ä¸­æ•°æ®é«˜æ•ˆå®‰å…¨ä¼ è¾“è€Œæå‡ºçš„ã€‚ä»é˜»å¡è¿™ä¸ªè¯å¯ä»¥çœ‹å‡ºï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯¹é˜»å¡é˜Ÿåˆ—çš„è®¿é—®å¯èƒ½ä¼šé€ æˆé˜»å¡ã€‚è¢«é˜»å¡çš„æƒ…å†µä¸»è¦æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p>
<ol>
<li>å½“é˜Ÿåˆ—æ»¡äº†çš„æ—¶å€™è¿›è¡Œå…¥é˜Ÿåˆ—æ“ä½œ</li>
<li>å½“é˜Ÿåˆ—ç©ºäº†çš„æ—¶å€™è¿›è¡Œå‡ºé˜Ÿåˆ—æ“ä½œ</li>
</ol>
<h3 id="BlockingQueue">BlockingQueue</h3>
<p>java.util.concurrent åŒ…é‡Œçš„ BlockingQueueæ˜¯ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿Queueæ¥å£ï¼ŒQueueæ¥å£ç»§æ‰¿ Collectionã€‚</p>
<p>BlockingQueueæ¥å£ä¸»è¦æœ‰ä»¥ä¸‹7ä¸ªå®ç°ç±»ï¼š</p>
<ol>
<li><strong>ArrayBlockingQueue</strong>ï¼šç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><strong>LinkedBlockingQueue</strong>ï¼šç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œï¼ˆä½†å¤§å°é»˜è®¤å€¼ä¸ºinteger.MAX_VALUEï¼‰é˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>PriorityBlockingQueueï¼šæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>DelayQueueï¼šä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„å»¶è¿Ÿæ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><strong>SynchronousQueue</strong>ï¼šä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¹Ÿå³å•ä¸ªå…ƒç´ çš„é˜Ÿåˆ—ã€‚</li>
<li>LinkedTransferQueueï¼šç”±é“¾è¡¨ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>LinkedBlockingDequeï¼šç”±é“¾è¡¨ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚</li>
</ol>
<p><strong>Blockingqueueçš„æ–¹æ³•</strong>ï¼š</p>
<p>å®ƒçš„æ–¹æ³•å¯ä»¥åˆ†æˆä»¥ä¸‹4ç±»ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>æŠ›å‡ºå¼‚å¸¸</th>
<th>ç‰¹æ®Šå€¼</th>
<th>é˜»å¡</th>
<th>è¶…æ—¶</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ’å…¥</strong></td>
<td>add(e)</td>
<td>offer(e)</td>
<td>put(e)</td>
<td>offer(e, time, unit)</td>
</tr>
<tr>
<td><strong>ç§»é™¤</strong></td>
<td>remove()</td>
<td>poll()</td>
<td>take()</td>
<td>poll(time, unit)</td>
</tr>
<tr>
<td><strong>æ£€æŸ¥</strong></td>
<td>element()</td>
<td>peek()</td>
<td>ä¸å¯ç”¨</td>
<td>ä¸å¯ç”¨</td>
</tr>
</tbody>
</table>
<p><strong>æŠ›å‡ºå¼‚å¸¸</strong></p>
<p>addæ­£å¸¸æ‰§è¡Œè¿”å›trueï¼Œelementï¼ˆä¸åˆ é™¤ï¼‰å’Œremoveè¿”å›é˜»å¡é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ <br>
å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå†å¾€é˜Ÿåˆ—é‡Œaddæ’å…¥å…ƒç´ ä¼šæŠ›IllegalStateException:Queue full<br>
å½“é˜»å¡é˜Ÿåˆ—ç©ºæ—¶ï¼Œå†å¾€é˜Ÿåˆ—é‡Œremoveç§»é™¤å…ƒç´ ä¼šæŠ›NoSuchElementException<br>
å½“é˜»å¡é˜Ÿåˆ—ç©ºæ—¶ï¼Œå†è°ƒç”¨elementæ£€æŸ¥å…ƒç´ ä¼šæŠ›å‡ºNoSuchElementException</p>
<p><strong>ç‰¹å®šå€¼</strong><br>
æ’å…¥æ–¹æ³•ï¼ŒæˆåŠŸtureå¤±è´¥false<br>
ç§»é™¤æ–¹æ³•ï¼ŒæˆåŠŸè¿”å›å‡ºé˜Ÿåˆ—çš„å…ƒç´ ï¼Œé˜Ÿåˆ—é‡Œæ²¡æœ‰å°±è¿”å›null<br>
æ£€æŸ¥æ–¹æ³•ï¼ŒæˆåŠŸè¿”å›é˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼Œæ²¡æœ‰è¿”å›null</p>
<p><strong>ä¸€ç›´é˜»å¡</strong></p>
<p>å¦‚æœè¯•å›¾çš„æ“ä½œæ— æ³•ç«‹å³æ‰§è¡Œï¼Œè¯¥æ–¹æ³•è°ƒç”¨å°†ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°èƒ½å¤Ÿæ‰§è¡Œã€‚<br>
å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå†å¾€é˜Ÿåˆ—é‡Œputå…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ç›´åˆ°putæ•°æ®orå“åº”ä¸­æ–­é€€å‡º<br>
å½“é˜»å¡é˜Ÿåˆ—ç©ºæ—¶ï¼Œå†ä»é˜Ÿåˆ—é‡Œtakeå…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡æ¶ˆè´¹è€…çº¿ç¨‹ç›´åˆ°é˜Ÿåˆ—å¯ç”¨</p>
<p><strong>è¶…æ—¶é€€å‡º</strong></p>
<p>å¦‚æœè¯•å›¾çš„æ“ä½œæ— æ³•ç«‹å³æ‰§è¡Œï¼Œè¯¥æ–¹æ³•è°ƒç”¨å°†ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°èƒ½å¤Ÿæ‰§è¡Œï¼Œä½†ç­‰å¾…æ—¶é—´ä¸ä¼šè¶…è¿‡ç»™å®šå€¼ã€‚<br>
è¿”å›ä¸€ä¸ªç‰¹å®šå€¼ä»¥å‘ŠçŸ¥è¯¥æ“ä½œæ˜¯å¦æˆåŠŸ(å…¸å‹çš„æ˜¯ true / false)ã€‚</p>
<h2 id="çº¿ç¨‹æ± ">çº¿ç¨‹æ± </h2>
<p><strong>ä¼˜åŠ¿</strong>ï¼šçº¿ç¨‹å¤ç”¨ï¼›æ§åˆ¶æœ€å¤§å¹¶å‘æ•°ï¼›ç®¡ç†çº¿ç¨‹ã€‚</p>
<ol>
<li>é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„é”€è€—ã€‚â€‹â€‹</li>
<li>æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰å¾…çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li>
<li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šé”€è€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</li>
</ol>
<h3 id="çº¿ç¨‹æ± ä½¿ç”¨çš„ä¸¤ç§æ–¹å¼ï¼š">çº¿ç¨‹æ± ä½¿ç”¨çš„ä¸¤ç§æ–¹å¼ï¼š</h3>
<p>1.ä½¿ç”¨ç°æˆçš„å·¥å…·ç±»å¾—åˆ°çº¿ç¨‹æ± </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> * Executors:</span><br><span class="line">*   <span class="number">1.</span>ä¸€æ± ä¸€çº¿ç¨‹ï¼š Executors.newSingleThreadExecutor()</span><br><span class="line"> *   <span class="number">2.</span>ä¸€æ± nçº¿ç¨‹ï¼š  Executors.newFixedThreadPool(<span class="number">5</span>):OOMå¼‚å¸¸</span><br><span class="line">*   <span class="number">3.</span>ä¸€æ± å¤šçº¿ç¨‹:  Executors.newCachedThreadPool();OOMå¼‚å¸¸</span><br></pre></td></tr></table></figure>
<p>â€‹    2.ç”¨æˆ·è‡ªå®šä¹‰çº¿ç¨‹æ± <br>
<img src="http://120.26.79.238:9000/blog/img/4c1f58c69a3d2d9e55d09a18ce7a16a1.png" alt=""></p>
<p>çº¿ç¨‹æ± å·¥å…·ç±»çš„ä¸‰ä¸ªæ–¹æ³•çš„æœ¬è´¨éƒ½æ˜¯ThreadPoolExecutorçš„å®ä¾‹åŒ–å¯¹è±¡</p>
<h3 id="çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°">çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°</h3>
<p><img src="http://120.26.79.238:9000/blog/img/03ee9499fb5f1b533fe6d193c1b406d6.png" alt=""></p>
<ol>
<li>corePoolSizeï¼šçº¿ç¨‹æ± ä¸­çš„å¸¸é©»æ ¸å¿ƒçº¿ç¨‹æ•°</li>
<li>maximumPoolSizeï¼šçº¿ç¨‹æ± ä¸­èƒ½å¤Ÿå®¹çº³åŒæ—¶ æ‰§è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ­¤å€¼å¿…é¡»å¤§äºç­‰äº1</li>
<li>keepAliveTimeï¼šå¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ å½“å‰æ± ä¸­çº¿ç¨‹æ•°é‡è¶…è¿‡corePoolSizeæ—¶ï¼Œå½“ç©ºé—²æ—¶é—´è¾¾åˆ°keepAliveTimeæ—¶ï¼Œå¤šä½™çº¿ç¨‹ä¼šè¢«é”€æ¯ç›´åˆ° åªå‰©ä¸‹corePoolSizeä¸ªçº¿ç¨‹ä¸ºæ­¢</li>
<li>Timeunitï¼škeepAliveTimeçš„å•ä½</li>
<li>workQueueï¼šä»»åŠ¡é˜Ÿåˆ—ï¼Œè¢«æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡</li>
<li>threadFactoryï¼šè¡¨ç¤ºç”Ÿæˆçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ï¼Œ ç”¨äºåˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤çš„å³å¯</li>
<li>handlerï¼šæ‹’ç»ç­–ç•¥ï¼Œè¡¨ç¤ºå½“é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹å¤§äº ç­‰äºçº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰æ—¶ï¼Œå¦‚ä½•æ¥æ‹’ç» è¯·æ±‚æ‰§è¡Œçš„runnableçš„ç­–ç•¥</li>
</ol>
<h3 id="çº¿ç¨‹æ± çš„å·¥ä½œåŸç†">çº¿ç¨‹æ± çš„å·¥ä½œåŸç†</h3>
<p><img src="http://120.26.79.238:9000/blog/img/03614a601789d1577e3515876f24e080.png" alt=""></p>
<ol>
<li>åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸ºé›¶ã€‚</li>
<li>å½“è°ƒç”¨execute()æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¯·æ±‚ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå‡ºå¦‚ä¸‹åˆ¤æ–­ï¼š
<ol>
<li>å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äºcorePoolSizeï¼Œé‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li>
<li>å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äºcorePoolSizeï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼›</li>
<li>å¦‚æœè¿™ä¸ªæ—¶å€™é˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¿˜å°äºmaximumPoolSizeï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li>
<li>å¦‚æœé˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äºmaximumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šå¯åŠ¨é¥±å’Œæ‹’ç»ç­–ç•¥æ¥æ‰§è¡Œã€‚</li>
</ol>
</li>
<li>å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚</li>
<li>å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åšè¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼ˆkeepAliveTimeï¼‰æ—¶ï¼Œçº¿ç¨‹ä¼šåˆ¤æ–­ï¼š<br>
å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºcorePoolSizeï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰ã€‚<br>
æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ°corePoolSizeçš„å¤§å°ã€‚</li>
</ol>
<blockquote>
<p>çº¿ç¨‹æ± çš„æœ€å¤§è´Ÿè½½ï¼šmaximumpoolsize+blockingqueuesize</p>
</blockquote>
<p><img src="http://120.26.79.238:9000/blog/img/0661de0e6e05f34962ba290b0253d90f.png" alt=""></p>
<h3 id="æ‹’ç»ç­–ç•¥">æ‹’ç»ç­–ç•¥</h3>
<p>ä¸€èˆ¬æˆ‘ä»¬åˆ›å»ºçº¿ç¨‹æ± æ—¶ï¼Œä¸ºé˜²æ­¢èµ„æºè¢«è€—å°½ï¼Œä»»åŠ¡é˜Ÿåˆ—éƒ½ä¼šé€‰æ‹©åˆ›å»ºæœ‰ç•Œä»»åŠ¡é˜Ÿåˆ—ï¼Œä½†ç§æ¨¡å¼ä¸‹å¦‚æœå‡º<strong>ç°ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ä¸”çº¿ç¨‹æ± åˆ›å»ºçš„çº¿ç¨‹æ•°è¾¾åˆ°ä½ è®¾ç½®çš„æœ€å¤§çº¿ç¨‹æ•°æ—¶</strong>ï¼Œè¿™æ—¶å°±éœ€è¦ä½ æŒ‡å®šThreadPoolExecutorçš„RejectedExecutionHandlerå‚æ•°å³åˆç†çš„æ‹’ç»ç­–ç•¥ï¼Œæ¥å¤„ç†çº¿ç¨‹æ± &quot;è¶…è½½&quot;çš„æƒ…å†µã€‚</p>
<p>ThreadPoolExecutorè‡ªå¸¦çš„æ‹’ç»ç­–ç•¥å¦‚ä¸‹ï¼š</p>
<ol>
<li>AbortPolicy(é»˜è®¤)ï¼š<strong>ç›´æ¥æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸</strong>é˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</li>
<li>CallerRunsPolicyï¼šâ€œè°ƒç”¨è€…è¿è¡Œâ€ä¸€ç§è°ƒèŠ‚æœºåˆ¶ï¼Œè¯¥ç­–ç•¥æ—¢ä¸ä¼šæŠ›å¼ƒä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯å°†<strong>æŸäº›ä»»åŠ¡å›é€€åˆ°è°ƒç”¨è€…</strong>ï¼Œä»è€Œé™ä½æ–°ä»»åŠ¡çš„æµé‡ã€‚</li>
<li>DiscardOldestPolicyï¼š<strong>æŠ›å¼ƒé˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡</strong>ï¼Œç„¶åæŠŠå½“å‰ä»»åŠ¡åŠ äººé˜Ÿåˆ—ä¸­ å°è¯•å†æ¬¡æäº¤å½“å‰ä»»åŠ¡ã€‚</li>
<li>DiscardPolicyï¼š<strong>è¯¥ç­–ç•¥é»˜é»˜åœ°ä¸¢å¼ƒæ— æ³•å¤„ç†çš„ä»»åŠ¡</strong>ï¼Œä¸äºˆä»»ä½•å¤„ç†ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ã€‚ å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±ï¼Œè¿™æ˜¯æœ€å¥½çš„ä¸€ç§ç­–ç•¥ã€‚</li>
</ol>
<p><strong>ä»¥ä¸Šå†…ç½®çš„ç­–ç•¥å‡å®ç°äº†RejectedExecutionHandleræ¥å£ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰©å±•RejectedExecutionHandleræ¥å£ï¼Œå®šä¹‰è‡ªå·±çš„æ‹’ç»ç­–ç•¥.</strong></p>
<h3 id="è‡ªå®šä¹‰çº¿ç¨‹æ± ">è‡ªå®šä¹‰çº¿ç¨‹æ± </h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadPoolDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå•ä¸€çº¿ç¨‹çš„è¿æ¥æ± </span></span><br><span class="line">        <span class="comment">// ExecutorService threadPool = Executors.newSingleThreadExecutor();</span></span><br><span class="line">        <span class="comment">// åˆ›å»ºå›ºå®šæ•°çº¿ç¨‹çš„è¿æ¥æ± </span></span><br><span class="line">        <span class="comment">// ExecutorService threadPool = Executors.newFixedThreadPool(3);</span></span><br><span class="line">        <span class="comment">// å¯æ‰©å®¹è¿æ¥æ± </span></span><br><span class="line">        <span class="comment">// ExecutorService threadPool = Executors.newCachedThreadPool();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰è¿æ¥æ± </span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">2</span>, <span class="number">5</span>,</span><br><span class="line">                <span class="number">2</span>, TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>),</span><br><span class="line">                Executors.defaultThreadFactory(),</span><br><span class="line">                <span class="comment">//new ThreadPoolExecutor.AbortPolicy()</span></span><br><span class="line">                <span class="comment">//new ThreadPoolExecutor.CallerRunsPolicy()</span></span><br><span class="line">                <span class="comment">//new ThreadPoolExecutor.DiscardOldestPolicy()</span></span><br><span class="line">                <span class="comment">//new ThreadPoolExecutor.DiscardPolicy()</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">RejectedExecutionHandler</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor executor)</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;æ‰§è¡Œäº†ä¸šåŠ¡é€»è¾‘&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¼˜åŒ–</strong>ï¼š</p>
<ol>
<li>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå°†è‡ªå®šä¹‰çº¿ç¨‹æ± æ”¾å…¥springå®¹å™¨ä¸­ï¼Œå•ä¾‹</li>
<li>å®é™…ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæ ¸å¿ƒçº¿ç¨‹æ•°=æœ€å¤§çº¿ç¨‹æ•°ï¼Œé˜²æ­¢ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œåå¤åˆ›å»ºã€é”€æ¯çº¿ç¨‹ã€é€ æˆèµ„æºæ¶ˆè€—ã€‚ä¸€èˆ¬æŠŠæœ€å¤§çº¿ç¨‹æ•°å’Œæ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®ä¸ºä¸€æ ·</li>
<li>çº¿ç¨‹æ•°çš„è®¾ç½®
<ul>
<li>IOå¯†é›†å‹ã€webåº”ç”¨ã€‘ï¼šcpuæ ¸æ•°*2ï¼Œç¨‹åºä¸­å¤§é‡è¿›è¡ŒIOæ“ä½œï¼Œå¯¹cpuè¦æ±‚å¹¶ä¸é«˜å› æ­¤æ‰§è¡Œæµä¸ªæ•°æ²¡æœ‰å¤ªå¤§è¦æ±‚</li>
<li>è®¡ç®—å¯†é›†å‹ï¼šcpuæ ¸æ•°+1: åƒè®¡ç®—åœ†å‘¨ç‡ã€å¯¹é«˜æ¸…è§†é¢‘è§£ç ç­‰å…¨é cpuè®¡ç®—ã€‚ +1æ˜¯ä¸ºäº†é¢„é˜²æœ‰ä¸ªçº¿ç¨‹è¢«é˜»å¡ï¼Œcpuå¯ä»¥è°ƒç”¨å…¶ä»–çº¿ç¨‹</li>
</ul>
</li>
<li>åŠ¨æ€è·å–cpuæ ¸å¿ƒæ•°</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">coreSize</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors();</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>åœ¨åˆ›å»ºçº¿ç¨‹æ± æ—¶ï¼Œé»˜è®¤å¼€å¯ä¸€ä¸ªæˆ–å…¨éƒ¨æ ¸å¿ƒçº¿ç¨‹</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">executorService.prestartCoreThread();<span class="comment">//å¼€å¯ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹</span></span><br><span class="line">executorService.prestartAllCoreThreads();<span class="comment">//å¼€å¯æ‰€æœ‰çš„æ ¸å¿ƒçº¿ç¨‹</span></span><br></pre></td></tr></table></figure>
<h2 id="å¤šçº¿ç¨‹é«˜å¹¶å‘åº•å±‚åŸç†">å¤šçº¿ç¨‹é«˜å¹¶å‘åº•å±‚åŸç†</h2>
<p>è®¡ç®—æœºè¿è¡Œæ¶æ„å›¾<br>
<img src="http://120.26.79.238:9000/blog/img/185269c1ad455db1f0a69020f7244535.png" alt=""></p>
<h3 id="javaå†…å­˜æ¨¡å‹">javaå†…å­˜æ¨¡å‹</h3>
<p><img src="http://120.26.79.238:9000/blog/img/a2efb89bb1ed915e25cbdc9b6926eaf6.png" alt=""></p>
<p>JMMè§„å®šäº†å†…å­˜ä¸»è¦åˆ’åˆ†ä¸º<strong>ä¸»å†…å­˜</strong>å’Œ<strong>å·¥ä½œå†…å­˜</strong>ä¸¤ç§ã€‚</p>
<blockquote>
<p><strong>ä¸»å†…å­˜</strong>ï¼šä¿å­˜äº†æ‰€æœ‰çš„å˜é‡ã€‚<br>
<strong>å…±äº«å˜é‡</strong>ï¼šå¦‚æœä¸€ä¸ªå˜é‡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡ä¼šåœ¨æ¯ä¸ªçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿æœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™ç§å˜é‡å°±æ˜¯å…±äº«å˜é‡ã€‚<br>
<strong>å·¥ä½œå†…å­˜</strong>ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹ç‹¬äº«ï¼Œä¿å­˜äº†çº¿ç¨‹ç”¨åˆ°çš„å˜é‡å‰¯æœ¬ï¼ˆä¸»å†…å­˜å…±äº«å˜é‡çš„ä¸€ä»½æ‹·è´ï¼‰ã€‚å·¥ä½œå†…å­˜è´Ÿè´£ä¸çº¿ç¨‹äº¤äº’ï¼Œä¹Ÿè´Ÿè´£ä¸ä¸»å†…å­˜äº¤äº’ã€‚</p>
</blockquote>
<p>æ­¤å¤„çš„ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜è·ŸJVMå†…å­˜åˆ’åˆ†ï¼ˆå †ã€æ ˆã€æ–¹æ³•åŒºï¼‰æ˜¯åœ¨ä¸åŒçš„ç»´åº¦ä¸Šè¿›è¡Œçš„ï¼Œå¦‚æœéè¦å¯¹åº”èµ·æ¥ï¼Œä¸»å†…å­˜å¯¹åº”çš„æ˜¯Javaå †ä¸­çš„å¯¹è±¡å®ä¾‹éƒ¨åˆ†ï¼Œå·¥ä½œå†…å­˜å¯¹åº”çš„æ˜¯æ ˆä¸­çš„éƒ¨åˆ†åŒºåŸŸï¼Œä»æ›´åº•å±‚çš„æ¥è¯´ï¼Œ<strong>ä¸»å†…å­˜å¯¹åº”çš„æ˜¯ç¡¬ä»¶çš„ç‰©ç†å†…å­˜ï¼Œå·¥ä½œå†…å­˜å¯¹åº”çš„æ˜¯å¯„å­˜å™¨å’Œé«˜é€Ÿç¼“å­˜</strong>ã€‚</p>
<p>JMMå¯¹å…±äº«å†…å­˜çš„æ“ä½œåšå‡ºäº†å¦‚ä¸‹ä¸¤æ¡è§„å®šï¼š</p>
<blockquote>
<ul>
<li>çº¿ç¨‹å¯¹å…±äº«å†…å­˜çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œä¸èƒ½ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å†™ï¼›</li>
<li>ä¸åŒçº¿ç¨‹æ— æ³•ç›´æ¥è®¿é—®å…¶ä»–çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå› æ­¤å…±äº«å˜é‡çš„å€¼ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜å®Œæˆã€‚</li>
</ul>
</blockquote>
<h4 id="å¹¶å‘ç¼–ç¨‹çš„ä¸‰å¤§ç‰¹æ€§ï¼š">å¹¶å‘ç¼–ç¨‹çš„ä¸‰å¤§ç‰¹æ€§ï¼š</h4>
<ul>
<li>
<p><strong>åŸå­æ€§ï¼š<strong>å³ä¸å¯åˆ†å‰²æ€§ã€‚æ¯”å¦‚ a=0ï¼›ï¼ˆaélongå’Œdoubleç±»å‹ï¼‰ è¿™ä¸ªæ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´è¿™ä¸ªæ“ä½œæ˜¯åŸå­æ“ä½œã€‚å†æ¯”å¦‚ï¼ša++ï¼› è¿™ä¸ªæ“ä½œå®é™…æ˜¯a = a + 1ï¼›æ˜¯å¯åˆ†å‰²çš„ï¼Œæ‰€ä»¥ä»–ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚éåŸå­æ“ä½œéƒ½ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œéœ€è¦</strong>ä½¿ç”¨åŒæ­¥æŠ€æœ¯ï¼ˆsychronizedï¼‰æˆ–è€…é”ï¼ˆLockï¼‰æ¥è®©å®ƒå˜æˆä¸€ä¸ªåŸå­æ“ä½œ</strong>ã€‚ä¸€ä¸ªæ“ä½œæ˜¯åŸå­æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°å®ƒå…·æœ‰åŸå­æ€§ã€‚javaçš„concurrentåŒ…ä¸‹æä¾›äº†ä¸€äº›åŸå­ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é˜…è¯»APIæ¥äº†è§£è¿™äº›åŸå­ç±»çš„ç”¨æ³•ã€‚æ¯”å¦‚ï¼š<strong>AtomicIntegerã€AtomicLongã€AtomicReference</strong>ç­‰ã€‚</p>
</li>
<li>
<p>**å¯è§æ€§ï¼š**æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œæ‰€ä»¥å½“æŸä¸ªçº¿ç¨‹ä¿®æ”¹å®ŒæŸä¸ªå˜é‡ä¹‹åï¼Œåœ¨å…¶ä»–çš„çº¿ç¨‹ä¸­ï¼Œæœªå¿…èƒ½è§‚å¯Ÿåˆ°è¯¥å˜é‡å·²ç»è¢«ä¿®æ”¹ã€‚**åœ¨ Java ä¸­ volatileã€synchronized å’Œ final å®ç°å¯è§æ€§ã€‚**volatileåªèƒ½è®©è¢«ä»–ä¿®é¥°å†…å®¹å…·æœ‰å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯å®ƒå…·æœ‰åŸå­æ€§ã€‚</p>
</li>
<li>
<p>**æœ‰åºæ€§ï¼š**javaçš„æœ‰åºæ€§è·Ÿçº¿ç¨‹ç›¸å…³ã€‚ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨æ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼Œå¦‚æœæ˜¯å¤šä¸ªçº¿ç¨‹æ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚å› ä¸ºJMMçš„å·¥ä½œå†…å­˜å’Œä¸»å†…å­˜ä¹‹é—´å­˜åœ¨å»¶è¿Ÿï¼Œè€Œä¸”javaä¼šå¯¹ä¸€äº›æŒ‡ä»¤è¿›è¡Œé‡æ–°æ’åºã€‚volatileå’Œsynchronizedå¯ä»¥ä¿è¯ç¨‹åºçš„æœ‰åºæ€§ï¼Œå¾ˆå¤šç¨‹åºå‘˜åªç†è§£è¿™ä¸¤ä¸ªå…³é”®å­—çš„æ‰§è¡Œäº’æ–¥ï¼Œè€Œæ²¡æœ‰å¾ˆå¥½çš„ç†è§£åˆ°volatileå’Œsynchronizedä¹Ÿèƒ½ä¿è¯æŒ‡ä»¤ä¸è¿›è¡Œé‡æ’åºã€‚</p>
</li>
</ul>
<h3 id="volatileå…³é”®å­—">volatileå…³é”®å­—</h3>
<blockquote>
<p>volatileå¯ä»¥è§£å†³å¯è§æ€§å’Œæœ‰åºæ€§ã€ä¸èƒ½è§£å†³åŸå­æ€§</p>
</blockquote>
<p>Javaè¯­è¨€æä¾›äº†ä¸€ç§ç¨å¼±çš„åŒæ­¥æœºåˆ¶ï¼Œå³volatileå˜é‡ï¼Œç”¨æ¥ç¡®ä¿å°†å˜é‡çš„æ›´æ–°æ“ä½œé€šçŸ¥åˆ°å…¶ä»–çº¿ç¨‹(volatileä¿®é¥°çš„å˜é‡ä»ä¸»å†…å­˜è·å–)ã€‚</p>
<p>å½“æŠŠå˜é‡å£°æ˜ä¸ºvolatileç±»å‹åï¼Œç¼–è¯‘å™¨ä¸è¿è¡Œæ—¶éƒ½ä¼šæ³¨æ„åˆ°è¿™ä¸ªå˜é‡æ˜¯å…±äº«çš„ï¼Œå› æ­¤<strong>ä¸ä¼šå°†è¯¥å˜é‡ä¸Šçš„æ“ä½œä¸å…¶ä»–å†…å­˜æ“ä½œä¸€èµ·é‡æ’åº</strong>ã€‚</p>
<p><strong>åœ¨è®¿é—®volatileå˜é‡æ—¶ä¸ä¼šæ‰§è¡ŒåŠ é”æ“ä½œï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šä½¿æ‰§è¡Œçº¿ç¨‹é˜»å¡ï¼Œå› æ­¤volatileå˜é‡æ˜¯ä¸€ç§æ¯”sychronizedå…³é”®å­—æ›´è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚</strong></p>
<p>å½“ä¸€ä¸ªå˜é‡å®šä¹‰ä¸º volatile ä¹‹åï¼Œå°†å…·å¤‡ä¸¤ç§ç‰¹æ€§ï¼š</p>
<ul>
<li>
<p>ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çš„çº¿ç¨‹çš„å¯è§æ€§ã€‚</p>
</li>
<li>
<p>ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚æœ‰volatileä¿®é¥°çš„å˜é‡ï¼Œèµ‹å€¼åå¤šæ‰§è¡Œäº†ä¸€ä¸ªâ€œload addl $0x0, (%esp)â€æ“ä½œï¼Œè¿™ä¸ªæ“ä½œç›¸å½“äºä¸€ä¸ª<strong>å†…å­˜å±éšœ</strong>ï¼ˆæŒ‡ä»¤é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼‰ï¼Œåªæœ‰ä¸€ä¸ªCPUè®¿é—®å†…å­˜æ—¶ï¼Œå¹¶ä¸éœ€è¦å†…å­˜å±éšœã€‚</p>
</li>
<li>
<p>ä¸ä¿è¯å˜é‡çš„åŸå­æ€§</p>
</li>
</ul>
<p>volatile æ€§èƒ½ï¼švolatile çš„è¯»æ€§èƒ½æ¶ˆè€—ä¸æ™®é€šå˜é‡å‡ ä¹ç›¸åŒï¼Œä½†æ˜¯å†™æ“ä½œç¨æ…¢ï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨æœ¬åœ°ä»£ç ä¸­æ’å…¥è®¸å¤šå†…å­˜å±éšœæŒ‡ä»¤æ¥ä¿è¯å¤„ç†å™¨ä¸å‘ç”Ÿä¹±åºæ‰§è¡Œã€‚</p>
<h2 id="CAS-campare-and-set-swap">CAS  (campare and set(swap))</h2>
<p>CASï¼šCompare and Swapã€‚æ¯”è¾ƒå¹¶äº¤æ¢çš„æ„æ€ã€‚CASæ“ä½œæœ‰3ä¸ªåŸºæœ¬å‚æ•°ï¼šå†…å­˜åœ°å€Aï¼Œæ—§å€¼Bï¼Œæ–°å€¼Cã€‚å®ƒçš„ä½œç”¨æ˜¯å°†æŒ‡å®šå†…å­˜åœ°å€Açš„å†…å®¹ä¸æ‰€ç»™çš„æ—§å€¼Bç›¸æ¯”ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†å…¶å†…å®¹æ›¿æ¢ä¸ºæŒ‡ä»¤ä¸­æä¾›çš„æ–°å€¼Cï¼›å¦‚æœä¸ç­‰ï¼Œåˆ™æ›´æ–°å¤±è´¥ã€‚ç±»ä¼¼äºä¿®æ”¹ç™»é™†å¯†ç çš„è¿‡ç¨‹ã€‚å½“ç”¨æˆ·è¾“å…¥çš„åŸå¯†ç å’Œæ•°æ®åº“ä¸­å­˜å‚¨çš„åŸå¯†ç ç›¸åŒï¼Œæ‰å¯ä»¥å°†åŸå¯†ç æ›´æ–°ä¸ºæ–°å¯†ç ï¼Œå¦åˆ™å°±ä¸èƒ½æ›´æ–°ã€‚</p>
<p>**CASæ˜¯è§£å†³å¤šçº¿ç¨‹å¹¶å‘å®‰å…¨é—®é¢˜çš„ä¸€ç§ä¹è§‚é”ç®—æ³•ã€‚**å› ä¸ºå®ƒåœ¨å¯¹å…±äº«å˜é‡æ›´æ–°ä¹‹å‰ï¼Œä¼šå…ˆæ¯”è¾ƒå½“å‰å€¼æ˜¯å¦ä¸æ›´æ–°å‰çš„å€¼ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™æ›´æ–°ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™å¾ªç¯æ‰§è¡Œï¼ˆç§°ä¸ºè‡ªæ—‹é”ï¼‰ï¼Œç›´åˆ°å½“å‰å€¼ä¸æ›´æ–°å‰çš„å€¼ä¸€è‡´ä¸ºæ­¢ï¼Œæ‰æ‰§è¡Œæ›´æ–°ã€‚</p>
<p>Unsafeç±»æ˜¯CASçš„æ ¸å¿ƒç±»ï¼Œæä¾›<strong>ç¡¬ä»¶çº§åˆ«çš„åŸå­æ“ä½œ</strong>ï¼ˆç›®å‰æ‰€æœ‰CPUåŸºæœ¬éƒ½æ”¯æŒç¡¬ä»¶çº§åˆ«çš„CASæ“ä½œï¼‰ã€‚</p>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<p><strong>å¼€é”€å¤§</strong>ï¼šåœ¨å¹¶å‘é‡æ¯”è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œå¦‚æœåå¤å°è¯•æ›´æ–°æŸä¸ªå˜é‡ï¼Œå´åˆä¸€ç›´æ›´æ–°ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥è¾ƒå¤§çš„å‹åŠ›</p>
<p><strong>ABAé—®é¢˜</strong>ï¼šå½“å˜é‡ä»Aä¿®æ”¹ä¸ºBå†ä¿®æ”¹å›Aæ—¶ï¼Œå˜é‡å€¼ç­‰äºæœŸæœ›å€¼Aï¼Œä½†æ˜¯æ— æ³•åˆ¤æ–­æ˜¯å¦ä¿®æ”¹ï¼ŒCASæ“ä½œåœ¨ABAä¿®æ”¹åä¾ç„¶æˆåŠŸã€‚ç‰ˆæœ¬å·</p>
<p><strong>ä¸èƒ½ä¿è¯ä»£ç å—çš„åŸå­æ€§</strong>ï¼šCASæœºåˆ¶æ‰€ä¿è¯çš„åªæ˜¯ä¸€ä¸ªå˜é‡çš„åŸå­æ€§æ“ä½œï¼Œè€Œä¸èƒ½ä¿è¯æ•´ä¸ªä»£ç å—çš„åŸå­æ€§ã€‚</p>
<h2 id="AQS">AQS</h2>
<p>AbstractQueuedSynchronizeræŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ç®€ç§°AQSï¼Œå®ƒæ˜¯å®ç°åŒæ­¥å™¨çš„åŸºç¡€ç»„ä»¶ï¼ˆæ¡†æ¶ï¼‰ï¼Œjucä¸‹é¢Lockï¼ˆReentrantLockã€ReentrantReadWriteLockç­‰ï¼‰çš„å®ç°ä»¥åŠä¸€äº›å¹¶å‘å·¥å…·ç±»ï¼ˆSemaphoreã€CountDownLatchã€CyclicBarrierç­‰ï¼‰å°±æ˜¯é€šè¿‡AQSæ¥å®ç°çš„ã€‚å…·ä½“ç”¨æ³•æ˜¯é€šè¿‡ç»§æ‰¿AQSå®ç°å…¶æ¨¡æ¿æ–¹æ³•ï¼Œç„¶åå°†å­ç±»ä½œä¸ºåŒæ­¥ç»„ä»¶çš„å†…éƒ¨ç±»ã€‚But StampLockä¸æ˜¯åŸºäºAQSå®ç°çš„ã€‚</p>
<blockquote>
<p>JUC å·¥å…·ç±» æ¡†æ¶åº•å±‚åŠ é”å’Œè§£é”éƒ½æ˜¯æ ¹æ®AQSå®ç°çš„ï¼Œæ˜¯æ‰€æœ‰JUCåŒ…ä¸‹å·¥å…·ç±»çš„è§£é”å’Œè§£é”å®ç°çš„åŸºçŸ³ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åŸºäºAQSè‡ªå®šä¹‰ä¸€äº›åŠ é”å’Œè§£é”çš„å·¥å…·ç±»ã€‚</p>
</blockquote>
<h3 id="æ¡†æ¶ç»“æ„">æ¡†æ¶ç»“æ„</h3>
<p>AQSæ¡†æ¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<p>AQSå†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ªFIFOåŒå‘é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—å°±æ˜¯<code>CLHåŒæ­¥é˜Ÿåˆ—</code>ã€‚<br>
<img src="http://120.26.79.238:9000/blog/img/6e0cb17740d4ca629866070f18b00666.png" alt=""></p>
<p>AQSç»´æŠ¤äº†ä¸€ä¸ªvolatileè¯­ä¹‰(æ”¯æŒå¤šçº¿ç¨‹ä¸‹çš„å¯è§æ€§)çš„å…±äº«èµ„æºå˜é‡<strong>state</strong>å’Œä¸€ä¸ªFIFOï¼ˆfirst-in-first-outï¼‰<strong>çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—</strong>(å¤šçº¿ç¨‹ç«äº‰stateèµ„æºè¢«é˜»å¡æ—¶ï¼Œä¼šè¿›å…¥æ­¤é˜Ÿåˆ—)ã€‚</p>
<p><code>state å±æ€§è¡¨ç¤ºèµ„æºçš„çŠ¶æ€</code></p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>å¯¹äºReentrantLockæ¥è¯´ï¼Œstate=1ï¼Œè¡¨ç¤ºèµ„æºè¢«å ç”¨ï¼›state=0ï¼Œè¡¨ç¤ºèµ„æºæ²¡æœ‰è¢«å ç”¨ã€‚</li>
<li>å¯¹äºCountDownLatchæ¥è¯´ï¼Œstate=0ï¼Œè¡¨ç¤ºè®¡æ•°å™¨å½’é›¶ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®èµ„æºï¼›statusä¸ºNè¡¨ç¤ºè®¡æ•°å™¨æœªå½’é›¶ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½éœ€è¦é˜»å¡ã€‚</li>
</ul>
<h3 id="åŸºäºAQSå®ç°é”çš„æ€è·¯">åŸºäºAQSå®ç°é”çš„æ€è·¯</h3>
<p>AQSå°†å¤§éƒ¨åˆ†çš„åŒæ­¥é€»è¾‘å‡å·²ç»å®ç°å¥½ï¼Œç»§æ‰¿çš„è‡ªå®šä¹‰åŒæ­¥å™¨åªéœ€è¦å®ç°stateçš„è·å–(acquire)å’Œé‡Šæ”¾(release)çš„é€»è¾‘ä»£ç å°±å¯ä»¥ï¼Œä¸»è¦åŒ…æ‹¬ä¸‹é¢æ–¹æ³•ï¼š</p>
<ul>
<li>acquire(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</li>
<li>release(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</li>
<li></li>
<li>acquireShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚</li>
<li>releaseShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</li>
<li></li>
<li>isHeldExclusively()ï¼šè¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦å»å®ç°å®ƒã€‚</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<p>â€‹		é€šè¿‡AQSå¯ä»¥å®ç°ç‹¬å é”ï¼ˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–åˆ°é”ï¼Œå¦‚ï¼šReentrantLockï¼‰ï¼Œä¹Ÿå¯ä»¥å®ç°å…±äº«é”ï¼ˆå¤šä¸ªçº¿ç¨‹éƒ½å¯ä»¥è·å–åˆ°é”Semaphore/CountDownLatchç­‰ï¼‰</p>
<h3 id="ReentrantLockåº•å±‚åŸç†">ReentrantLockåº•å±‚åŸç†</h3>
<p><img src="http://120.26.79.238:9000/blog/img/290dd92ba7e3e91ef40851699b9ffc6a.png" alt=""></p>
<p>åœ¨ReentrantLockç±»ä¸­åŒ…å«äº†3ä¸ªAQSçš„å®ç°ç±»ï¼š</p>
<ol>
<li>æŠ½è±¡ç±»Sync</li>
<li>éå…¬å¹³é”å®ç°ç±»NonfaireSync</li>
<li>å…¬å¹³é”å®ç°ç±»FairSync</li>
</ol>
<h4 id="å…¬å¹³å’Œéå…¬å¹³">å…¬å¹³å’Œéå…¬å¹³</h4>
<p>å…¬å¹³é”æŒ‡çš„æ˜¯æŒ‰ç…§çº¿ç¨‹è¯·æ±‚çš„é¡ºåºï¼Œæ¥åˆ†é…é”ï¼›è€Œéå…¬å¹³é”æŒ‡çš„æ˜¯ä¸å®Œå…¨æŒ‰ç…§è¯·æ±‚çš„é¡ºåºï¼Œåœ¨ä¸€å®šæƒ…å†µä¸‹ï¼Œå¯ä»¥å…è®¸æ’é˜Ÿã€‚ä½†éœ€è¦æ³¨æ„è¿™é‡Œçš„éå…¬å¹³å¹¶ä¸æ˜¯æŒ‡å®Œå…¨çš„éšæœºï¼Œä¸æ˜¯è¯´çº¿ç¨‹å¯ä»¥ä»»æ„æ’é˜Ÿï¼Œè€Œæ˜¯ä»…ä»…â€œåœ¨åˆé€‚çš„æ—¶æœºâ€æ’é˜Ÿã€‚</p>
<p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ˜¯åˆé€‚çš„æ—¶æœºå‘¢ï¼Ÿå‡è®¾å½“å‰çº¿ç¨‹åœ¨è¯·æ±‚è·å–é”çš„æ—¶å€™ï¼Œæ°å·§å‰ä¸€ä¸ªæŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾äº†è¿™æŠŠé”ï¼Œé‚£ä¹ˆå½“å‰ç”³è¯·é”çš„çº¿ç¨‹å°±å¯ä»¥ä¸é¡¾å·²ç»ç­‰å¾…çš„çº¿ç¨‹è€Œé€‰æ‹©ç«‹åˆ»æ’é˜Ÿã€‚ä½†æ˜¯å¦‚æœå½“å‰çº¿ç¨‹è¯·æ±‚çš„æ—¶å€™ï¼Œå‰ä¸€ä¸ªçº¿ç¨‹å¹¶æ²¡æœ‰åœ¨é‚£ä¸€æ—¶åˆ»é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹è¿˜æ˜¯ä¸€æ ·ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚</p>
<h3 id="é¢è¯•é¢˜">é¢è¯•é¢˜</h3>
<p>AQSçš„åº•å±‚åŸç†ï¼šAQSä½¿ç”¨ä¸€ä¸ªvolatileæˆå‘˜å˜é‡stateæ¥è¡¨ç¤ºé”æ˜¯å¦å·²è¢«æŒæœ‰ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—å­˜å‚¨è¢«é˜»å¡çš„çº¿ç¨‹ã€‚AQSä½¿ç”¨CASæœºåˆ¶å¯¹stateè¿›è¡ŒåŸå­æ“ä½œä»è€Œå¯¹stateçš„å€¼è¿›è¡Œä¿®æ”¹ã€‚å¦‚æœstateçš„å€¼ä¸º0ï¼Œè¡¨ç¤ºé”æœªè¢«æŒæœ‰ï¼Œåˆ™å°†å½“å‰çº¿ç¨‹è®¾ç½®ä¸ºå·¥ä½œçº¿ç¨‹ï¼ˆå³è·å–åˆ°äº†é”ï¼‰ï¼Œå¹¶å°†stateçš„å€¼è®¾ç½®ä¸º1ï¼Œè¿”å›æˆåŠŸè·å–åˆ°é”ã€‚å¦‚æœæœªèƒ½æˆåŠŸè·å–åˆ°é”ï¼ŒAQSå…ˆè‡ªæ—‹è·å–é”ï¼Œå¦‚æœä¸€ç›´è·å–ä¸åˆ°ï¼Œåˆ™å°†å½“å‰è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°FIFOé˜Ÿåˆ—ä¸­</p>
<h1>JUC æ‰©å±•</h1>
<h2 id="å¹¶å‘ä¸‰å¤§ç‰¹æ€§">å¹¶å‘ä¸‰å¤§ç‰¹æ€§</h2>
<p>åŸå­æ€§ï¼šé”(synchronizedã€Lock)</p>
<p>å¯è§æ€§ï¼švolatile</p>
<p>æœ‰åºæ€§ï¼švolatile</p>
<h2 id="æœ‰åºæ€§-æŒ‡ä»¤é‡æ’">æœ‰åºæ€§&amp;æŒ‡ä»¤é‡æ’</h2>
<p>æœ‰åºæ€§ï¼šå®ƒæŒ‡çš„æ˜¯ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚</p>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æ²¡ä»€ä¹ˆå¯è¯´çš„ï¼Œä½†æ˜¯å¦‚æœåœ¨Javaä¸­ï¼Œå¹¶ä¸”æ˜¯å¹¶å‘æƒ…å†µï¼Œå°±ä¸å¾—ä¸è¯´äº†ã€‚è®¡ç®—æœºåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹<strong>æŒ‡ä»¤é‡æ’</strong>ã€‚å¤„ç†å™¨ã€‚åœ¨è¿›è¡Œé‡æ’åºæ—¶ï¼Œå¿…é¡»è¦è€ƒè™‘æŒ‡ä»¤ä¹‹é—´çš„<strong>æ•°æ®ä¾èµ–æ€§</strong>ã€‚</p>
<h2 id="Happen-Before">Happen-Before</h2>
<p>åœ¨å¸¸è§„çš„å¼€å‘ä¸­ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡ä¸Šè¿°è§„åˆ™æ¥åˆ†æä¸€ä¸ªå¹¶å‘ç¨‹åºæ˜¯å¦å®‰å…¨ï¼Œä¼°è®¡è„‘å£³ä¼šå¾ˆç–¼ã€‚å› ä¸ºæ›´å¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯åˆ†æä¸€ä¸ªå¹¶å‘ç¨‹åºæ˜¯å¦å®‰å…¨ï¼Œå…¶å®éƒ½ä¾èµ–Happen-BeforeåŸåˆ™è¿›è¡Œåˆ†æã€‚Happen-Beforeè¢«ç¿»è¯‘æˆ<strong>å…ˆè¡Œå‘ç”ŸåŸåˆ™</strong>ï¼Œæ„æ€å°±æ˜¯<strong>å½“Aæ“ä½œå…ˆè¡Œå‘ç”ŸäºBæ“ä½œï¼Œåˆ™åœ¨å‘ç”ŸBæ“ä½œçš„æ—¶å€™ï¼Œæ“ä½œAäº§ç”Ÿçš„å½±å“èƒ½è¢«Bè§‚å¯Ÿåˆ°</strong>ï¼Œâ€œå½±å“â€åŒ…æ‹¬ä¿®æ”¹äº†å†…å­˜ä¸­çš„å…±äº«å˜é‡çš„å€¼ã€å‘é€äº†æ¶ˆæ¯ã€è°ƒç”¨äº†æ–¹æ³•ç­‰ã€‚</p>
<p>Happen-Beforeçš„è§„åˆ™æœ‰ä»¥ä¸‹å‡ æ¡ï¼š</p>
<ol>
<li>ç¨‹åºæ¬¡åºè§„åˆ™ï¼ˆProgram Order Ruleï¼‰ï¼šåœ¨<strong>ä¸€ä¸ªçº¿ç¨‹å†…</strong>ä¸€æ®µä»£ç çš„**æ‰§è¡Œç»“æœæ˜¯æœ‰åºçš„ã€‚**å°±ç®—è¿˜ä¼šæŒ‡ä»¤é‡æ’ï¼Œä½†æ˜¯éšä¾¿å®ƒæ€ä¹ˆæ’ï¼Œç»“æœæ˜¯æŒ‰ç…§æˆ‘ä»¬ä»£ç çš„é¡ºåºç”Ÿæˆçš„ä¸ä¼šå˜ï¼</li>
<li>ç®¡ç¨‹é”å®šè§„åˆ™ï¼ˆMonitor Lock Ruleï¼‰ï¼šå°±æ˜¯æ— è®ºæ˜¯åœ¨å•çº¿ç¨‹ç¯å¢ƒè¿˜æ˜¯å¤šçº¿ç¨‹ç¯å¢ƒï¼Œå¯¹äº<strong>åŒä¸€ä¸ªé”</strong>æ¥è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªé”è§£é”ä¹‹åï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è·å–äº†è¿™ä¸ªé”éƒ½èƒ½çœ‹åˆ°å‰ä¸€ä¸ªçº¿ç¨‹çš„æ“ä½œç»“æœï¼(ç®¡ç¨‹æ˜¯ä¸€ç§é€šç”¨çš„åŒæ­¥åŸè¯­ï¼Œsynchronizedå°±æ˜¯ç®¡ç¨‹çš„å®ç°ï¼‰</li>
<li>volatileå˜é‡è§„åˆ™ï¼ˆvolatile Variable Ruleï¼‰ï¼š<strong>å¯¹åŒä¸€ä¸ªvolatileçš„å˜é‡ï¼Œå…ˆè¡Œå‘ç”Ÿçš„å†™æ“ä½œï¼Œè‚¯å®šæ—©äºåç»­å‘ç”Ÿçš„è¯»æ“ä½œ</strong></li>
<li>çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼ˆThread Start Ruleï¼‰ï¼šThreadå¯¹è±¡çš„start()æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œ</li>
<li>çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ï¼ˆThread Termination Ruleï¼‰ï¼šçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºå¯¹æ­¤çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Thread.join()æ–¹æ³•ç»“æŸã€Thread.isAlive()çš„è¿”å›å€¼ç­‰æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œã€‚</li>
<li>çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼ˆThread Interruption Ruleï¼‰ï¼šå¯¹çº¿ç¨‹çš„interruption()è°ƒç”¨ï¼Œå…ˆäºè¢«è°ƒç”¨çš„çº¿ç¨‹æ£€æµ‹ä¸­æ–­äº‹ä»¶(Thread.interrupted())çš„å‘ç”Ÿ</li>
<li>å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼ˆFinalizer Ruleï¼‰ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼ˆæ„é€ å‡½æ•°æ‰§è¡Œç»“æŸï¼‰å…ˆè¡Œå‘ç”Ÿäºå®ƒçš„finalize()æ–¹æ³•çš„å¼€å§‹ã€‚</li>
<li>ä¼ é€’æ€§ï¼ˆTransitivityï¼‰ï¼šå¦‚æœæ“ä½œAå…ˆäºæ“ä½œBã€æ“ä½œBå…ˆäºæ“ä½œC,åˆ™æ“ä½œAå…ˆäºæ“ä½œC</li>
</ol>
<p>ä»¥ä¸Šè¿™äº›è§„åˆ™ä¿éšœäº†happen-beforeçš„é¡ºåºï¼Œå¦‚æœä¸ç¬¦åˆä»¥ä¸Šè§„åˆ™ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å°±ä¸èƒ½<strong>ä¿è¯æ‰§è¡Œé¡ºåºç­‰åŒäºä»£ç é¡ºåº</strong>ã€‚é€šè¿‡è¿™äº›æ¡ä»¶çš„åˆ¤å®šï¼Œä»ç„¶å¾ˆéš¾åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦èƒ½å®‰å…¨æ‰§è¡Œï¼Œçº¿ç¨‹å®‰å…¨å¤šæ•°ä¾èµ–äºå·¥å…·ç±»çš„å®‰å…¨æ€§æ¥ä¿è¯ã€‚æƒ³æé«˜è‡ªå·±å¯¹çº¿ç¨‹æ˜¯å¦å®‰å…¨çš„åˆ¤æ–­èƒ½åŠ›ï¼Œå¿…ç„¶éœ€è¦ç†è§£æ‰€ä½¿ç”¨çš„æ¡†æ¶æˆ–è€…å·¥å…·çš„å®ç°ï¼Œå¹¶ç§¯ç´¯çº¿ç¨‹å®‰å…¨çš„ç»éªŒã€‚</p>
<h2 id="AQSçš„å·¥ä½œæ¨¡å¼">AQSçš„å·¥ä½œæ¨¡å¼</h2>
<h3 id="ç‹¬å æ¨¡å¼">ç‹¬å æ¨¡å¼</h3>
<p><strong>åŸç†ä»‹ç»</strong></p>
<p>å·¥ä½œæµç¨‹ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/33b3dcce4ac90eae34c8d5796a76f443.png" alt=""></p>
<p>çº¿ç¨‹è·å–é”çš„æµç¨‹ï¼š</p>
<p>1ã€çº¿ç¨‹Aè·å–é”ï¼Œå°†stateçš„å€¼ç”±0è®¾ç½®ä¸º1</p>
<p>2ã€åœ¨Aæ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰ï¼Œçº¿ç¨‹Bä¹Ÿæ¥è·å–é”ï¼Œçº¿ç¨‹Bè·å–åˆ°stateçš„å€¼ä¸º1ï¼Œè¡¨ç¤ºé”è¢«å ç”¨ã€‚çº¿ç¨‹Båˆ›å»ºNodeèŠ‚ç‚¹æ”¾å…¥é˜Ÿå°¾ï¼Œå¹¶ä¸”é˜»å¡çº¿ç¨‹B</p>
<p>3ã€åŒç†çº¿ç¨‹Cè·å–åˆ°çš„stateçš„å€¼ä¸º1ï¼Œè¡¨ç¤ºé”è¢«å ç”¨ã€‚çº¿ç¨‹Cåˆ›å»ºNodeèŠ‚ç‚¹æ”¾å…¥é˜Ÿå°¾ï¼Œå¹¶ä¸”é˜»å¡çº¿ç¨‹C</p>
<p>çº¿ç¨‹é‡Šæ”¾é”çš„æµç¨‹ï¼š</p>
<p>1ã€çº¿ç¨‹Aæ‰§è¡Œå®Œæ¯•ä»¥åï¼Œå°†stateçš„å€¼ç”±1è®¾ç½®ä¸º0</p>
<p>2ã€å”¤é†’ä¸‹ä¸€ä¸ªNode BèŠ‚ç‚¹ï¼Œç„¶ååˆ é™¤çº¿ç¨‹AèŠ‚ç‚¹</p>
<h3 id="å…±äº«æ¨¡å¼">å…±äº«æ¨¡å¼</h3>
<p><img src="http://120.26.79.238:9000/blog/img/b196073b1a21955e132515acf42db2ae.png" alt=""></p>
<p>è·å–é”çš„æµç¨‹ï¼š</p>
<p>1ã€çº¿ç¨‹Aåˆ¤æ–­stateçš„å€¼æ˜¯å¦å¤§äº0ï¼Œå¦‚æœå¦åˆ›å»ºNodeèŠ‚ç‚¹ï¼Œå°†å…¶åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—æœ«å°¾ã€‚</p>
<p>2ã€å¦‚æœå¤§äº0ç›¸å½“äºè·å–åˆ°äº†é”ï¼Œä½¿ç”¨CASç®—æ³•å¯¹stateè¿›è¡Œ-1</p>
<p>é‡Šæ”¾é”çš„æµç¨‹</p>
<p>1ã€æ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Œä¸šåŠ¡æ“ä½œå®Œæ¯•ä»¥åå¯¹stateçš„å€¼è¿›è¡Œ+1æ“ä½œ</p>
<p>2ã€å”¤é†’ä¸‹ä¸€ä¸ªNode BèŠ‚ç‚¹ï¼Œç„¶ååˆ é™¤çº¿ç¨‹AèŠ‚ç‚¹</p>
<h2 id="synchronizedåŸç†">synchronizedåŸç†</h2>
<blockquote>
<p>Javaå¯¹è±¡ç»“æ„</p>
</blockquote>
<p>Javaä¸­çš„å¯¹è±¡æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯<strong>å¯¹è±¡å¤´ã€å¯¹è±¡ä½“å’Œå¯¹é½å¡«å……</strong>ï¼›</p>
<p>1ã€å¯¹è±¡ä½“æ˜¯å­˜å‚¨ä¸€ä¸ªå¯¹è±¡å±æ€§å€¼å’Œçˆ¶ç±»çš„å±æ€§å€¼çš„åœ°æ–¹ï¼Œå¹¶ä¸”jvmè™šæ‹Ÿæœºä¸­è¦æ±‚ä¸€ä¸ªå¯¹è±¡å¤§å°å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œé€šè¿‡å¯¹é½å¡«å……è¾¾åˆ°è¿™ä¸ªè¦æ±‚ï¼›</p>
<p>2ã€å¯¹è±¡å¤´æ¥æè¿°ä¸€ä¸ªJavaå¯¹è±¡æ˜¯ä½•ç§å¯¹è±¡ï¼Œä¸”æ˜¯å±äºé‚£ä¸ªç±»çš„å¯¹è±¡</p>
<ul>
<li>å¯¹è±¡å¤´ä¸­çš„Klass Wordå­˜å‚¨çš„æ˜¯Classå¯¹è±¡çš„åœ°å€ï¼Œè¡¨æ˜è¯¥å¯¹è±¡æ˜¯å±äºé‚£ä¸ªç±»</li>
<li>æ ‡è®°å­—æ®µMark Wordåˆ™å­˜å‚¨äº†è¯¥å¯¹è±¡è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆhashcode)ã€GCåˆ†ä»£å¹´é¾„ã€<strong>é”çŠ¶æ€æ ‡å¿—å’Œé”ç±»å‹ç­‰ä¿¡æ¯</strong>ã€‚</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/e2e65a6045c9369633166c2cb8dd1573.png" alt=""></p>
<blockquote>
<p>synchronizedä¸Šé”åŸç†</p>
</blockquote>
<p><strong>synchronizedåŒæ­¥ä»£ç å—çš„æƒ…å†µ</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;  </span><br><span class="line">            System.out.println(<span class="string">&quot;synchronized ä»£ç å—&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡javapæŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br>
<img src="http://120.26.79.238:9000/blog/img/4d5d7deb04055f4416ab1d852eeee939.png" alt=""></p>
<p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼šsynchronized åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯ monitorenter å’Œ monitorexit æŒ‡ä»¤ï¼Œå…¶ä¸­monitorenter æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œ</p>
<p>monitorexit æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚å½“æ‰§è¡Œ monitorenter æŒ‡ä»¤æ—¶ï¼Œçº¿ç¨‹è¯•å›¾è·å–é”ä¹Ÿå°±æ˜¯è·å– monitor(monitorå¯¹è±¡å­˜åœ¨äºæ¯ä¸ªJavaå¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ï¼Œsynchronized é”ä¾¿æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è·å–é”çš„ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆJavaä¸­ä»»æ„å¯¹è±¡å¯ä»¥ä½œä¸ºé”çš„åŸå› ) çš„æŒæœ‰æƒã€‚å½“è®¡æ•°å™¨ä¸º0åˆ™å¯ä»¥æˆåŠŸè·å–ï¼Œè·å–åå°†é”è®¡æ•°å™¨è®¾ä¸º1ä¹Ÿ</p>
<p>å°±æ˜¯åŠ 1ã€‚ç›¸åº”çš„åœ¨æ‰§è¡Œmonitorexit æŒ‡ä»¤åï¼Œå°†é”è®¡æ•°å™¨è®¾ä¸º0ï¼Œè¡¨æ˜é”è¢«é‡Šæ”¾ã€‚å¦‚æœè·å–å¯¹è±¡é”å¤±è´¥ï¼Œé‚£å½“å‰çº¿ç¨‹å°±è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°é”è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢ã€‚</p>
<p>Mark Wordç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/6cf47960cc5c58c51f5ddd4b97f386de.png" alt=""></p>
<p>å¹¶å‘é”æ€»å…±æœ‰4ç§çŠ¶æ€ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€å’Œé‡é‡çº§é”çŠ¶æ€ï¼Œæ¯ç§çŠ¶æ€åœ¨å¹¶å‘ç«äº‰æƒ…å†µä¸‹éœ€è¦æ¶ˆè€—çš„èµ„æºç”±ä½åˆ°é«˜ï¼Œæ€§èƒ½ç”±é«˜åˆ°ä½ã€‚ï¼ˆé”ä¿¡æ¯å 3ä½ï¼‰åœ¨jdk1.6ä¹‹å‰åªæœ‰é‡é‡çº§é”ï¼Œè€ŒJDK1.6ä¹‹åå¯¹synchronizedè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¼•å…¥äº†åå‘é”ä¸è½»é‡çº§é”ï¼Œæé«˜äº†æ€§èƒ½é™ä½äº†èµ„æºæ¶ˆè€—ã€‚</p>
<p>é”çŠ¶æ€ç¡®å®šï¼š</p>
<p>1ã€æ— é”ï¼šæ˜¯å¦åå‘é”çš„å­—æ®µå€¼=0ï¼Œé”æ ‡å¿—ä½çš„å€¼=01</p>
<p>2ã€åå‘é”ï¼šæ˜¯å¦åå‘é”çš„å­—æ®µå€¼=1ï¼Œé”æ ‡å¿—ä½çš„å€¼=01</p>
<p>3ã€è½»é‡çº§é”ï¼šé”æ ‡å¿—ä½çš„å€¼=00</p>
<p>4ã€é‡é‡çº§é”ï¼šé”æ ‡å¿—ä½çš„å€¼=10</p>
<blockquote>
<p>é”å‡çº§</p>
</blockquote>
<p>æ‰€è°“çš„ä¸Šé”ï¼Œå°±æ˜¯æŠŠé”çš„ä¿¡æ¯è®°å½•åœ¨å¯¹è±¡å¤´ä¸­ï¼Œé»˜è®¤æ˜¯æ— é”çš„ï¼Œå½“è¾¾åˆ°ä¸€å®šçš„æ¡ä»¶æ—¶ä¼šè¿›è¡Œé”å‡çº§ï¼Œä¼šæŒ‰ç…§ä¸‹é¢çš„é¡ºåºä¾æ¬¡å‡çº§ã€‚</p>
<p>1ã€æ— é”ï¼šæ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œä½†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚</p>
<p>2ã€åå‘é”ï¼šç ”ç©¶å‘ç°å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†ä¸è®©è¿™ä¸ªçº¿ç¨‹æ¯æ¬¡è·å¾—é”éƒ½éœ€è¦CASæ“ä½œçš„æ€§èƒ½æ¶ˆè€—ï¼Œå°±å¼•å…¥</p>
<p>äº†åå‘é”ã€åå‘é”ä¼šåå‘äºç¬¬ä¸€ä¸ªè·å¾—å®ƒçš„çº¿ç¨‹ã€‘ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®å¯¹è±¡å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´é‡Œå­˜å‚¨é”åå‘çš„è¿™ä¸ªçº¿ç¨‹çš„IDï¼Œä»¥åè¯¥çº¿ç¨‹å†è®¿é—®è¯¥å¯¹è±¡æ—¶åªéœ€åˆ¤æ–­å¯¹è±¡å¤´çš„Mark Wordé‡Œæ˜¯å¦æœ‰è¿™ä¸ªçº¿ç¨‹çš„IDï¼Œå¦‚æœæœ‰å°±ä¸éœ€è¦è¿›è¡ŒCASæ“ä½œï¼Œè¿™å°±æ˜¯åå‘é”ã€‚</p>
<p>3ã€è½»é‡çº§é”ï¼šå½“çº¿ç¨‹ç«äº‰æ›´æ¿€çƒˆæ—¶ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œè½»é‡çº§é”è®¤ä¸ºè™½ç„¶ç«äº‰æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯ç†æƒ³æƒ…å†µä¸‹ç«äº‰çš„ç¨‹åº¦å¾ˆä½ï¼Œé€šè¿‡è‡ªæ—‹æ–¹å¼ç­‰å¾…ä¸€ä¼šå„¿ä¸Šä¸€ä¸ªçº¿ç¨‹å°±ä¼šé‡Šæ”¾é”ã€‚</p>
<p>4ã€é‡é‡çº§é”ï¼šä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡äº†ä¸€å®šæ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è‡ªæ—‹ï¼Œåˆæ¥äº†ç¬¬ä¸‰ä¸ªçº¿ç¨‹è®¿é—®æ—¶ï¼ˆåæ­£å°±æ˜¯ç«äº‰ç»§ç»­åŠ å¤§äº†ï¼‰ï¼Œè½»é‡çº§é”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œé‡é‡çº§é”å°±æ˜¯Synchronized,é‡é‡çº§é”ä¼šä½¿é™¤äº†æ­¤æ—¶æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/634979a855ebe5dabf3c714f4da9e31d.png" alt=""></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>JVM</title>
    <url>/2025/09/15/JVM/</url>
    <content><![CDATA[<h1>JVM</h1>
<p><img src="http://120.26.79.238:9000/blog/img/93e6ed456e2dd92477e61ce35e6cefa7.png" alt=""></p>
<h2 id="é¢è¯•">é¢è¯•</h2>
<p>1.JVMæ˜¯ä»€ä¹ˆ?JVMçš„å†…å­˜	åŒºåŸŸåˆ†ä¸ºå“ªäº›?</p>
<p>2.ä»€ä¹ˆæ˜¯OOM ?ä»€ä¹ˆæ˜¯StackoverflowError?æœ‰å“ªäº›æ–¹æ³•åˆ†æ?</p>
<p>3.JVM çš„å¸¸ç”¨å‚æ•°è°ƒä¼˜ä½ çŸ¥é“å“ªäº›?</p>
<p>4.GCæ˜¯ä»€ä¹ˆ?ä¸ºä»€ä¹ˆéœ€è¦GC?</p>
<p>5.ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨?</p>
<h2 id="ä»€ä¹ˆæ˜¯JVM">ä»€ä¹ˆæ˜¯JVM</h2>
<p><strong>æ˜¯ä¸€ç§è§„èŒƒï¼šè§„å®šäº†å­—èŠ‚ç æ–‡ä»¶çš„æ ¼å¼</strong></p>
<blockquote>
<p>JDK=JRE+å·¥å…·é›†ï¼ˆjava.exe,javac.exe)</p>
<p>JRE=JVM+ç³»ç»Ÿç±»åº“</p>
</blockquote>
<p>==å±è”½äº†å¹³å°å’Œè¯­è¨€ç›¸å…³æ€§==</p>
<p>JVMï¼š<strong>J</strong>ava <strong>V</strong>irtual <strong>M</strong>achineï¼ŒJavaè™šæ‹Ÿæœº</p>
<p>**ä½ç½®ï¼š**JVMæ˜¯è¿è¡Œåœ¨æ“ä½œ ç³»ç»Ÿä¹‹ä¸Šçš„ï¼Œå®ƒä¸ç¡¬ä»¶æ²¡æœ‰ç›´æ¥çš„äº¤äº’ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/97126ec49a5f09c3cb50853909c5877d.png" alt=""></p>
<h2 id="ä¸»æµè™šæ‹Ÿæœº">ä¸»æµè™šæ‹Ÿæœº</h2>
<ul>
<li>JCPç»„ç»‡ï¼ˆJava Community Process å¼€æ”¾çš„å›½é™…ç»„ç»‡ ï¼‰ï¼š<strong>Hotspotè™šæ‹Ÿæœº</strong>ï¼ˆOpen JDKç‰ˆï¼‰ï¼Œsun2006å¹´å¼€æº</li>
<li>Oracleï¼šHotspotè™šæ‹Ÿæœºï¼ˆOracle JDKç‰ˆï¼‰ï¼Œé—­æºï¼Œå…è®¸ä¸ªäººä½¿ç”¨ï¼Œå•†ç”¨æ”¶è´¹</li>
<li>BEAï¼šJRockitè™šæ‹Ÿæœº</li>
<li>IBMï¼šJ9è™šæ‹Ÿæœº</li>
<li>é˜¿é‡Œå·´å·´ï¼šDragonwell JDKï¼ˆé¾™äº•è™šæ‹Ÿæœºï¼‰ï¼Œç”µå•†ç‰©æµé‡‘èç­‰é¢†åŸŸï¼Œé«˜æ€§èƒ½è¦æ±‚ã€‚</li>
</ul>
<h2 id="JVMç»“æ„å›¾">JVMç»“æ„å›¾</h2>
<p>**JVMçš„ä½œç”¨ï¼š**åŠ è½½å¹¶æ‰§è¡ŒJavaå­—èŠ‚ç æ–‡ä»¶(.class) - åŠ è½½å­—èŠ‚ç æ–‡ä»¶ã€åˆ†é…å†…å­˜ï¼ˆè¿è¡Œæ—¶æ•°æ®åŒºï¼‰ã€è¿è¡Œç¨‹åº</p>
<p>**JVMçš„ç‰¹ç‚¹ï¼š**ä¸€æ¬¡ç¼–è¯‘åˆ°å¤„è¿è¡Œã€è‡ªåŠ¨å†…å­˜ç®¡ç†ã€è‡ªåŠ¨åƒåœ¾å›æ”¶</p>
<p><img src="http://120.26.79.238:9000/blog/img/33b3904478561b47dee88f082a7df66d.png" alt=""></p>
<ul>
<li>
<p>ç±»åŠ è½½å™¨å­ç³»ç»Ÿï¼šå°†å­—èŠ‚ç æ–‡ä»¶ï¼ˆ.classï¼‰åŠ è½½åˆ°å†…å­˜ä¸­çš„æ–¹æ³•åŒº</p>
</li>
<li>
<p><strong>è¿è¡Œæ—¶æ•°æ®åŒº</strong>ï¼šï¼ˆRuntime Data Area)</p>
<ul>
<li>æ–¹æ³•åŒºï¼šå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»çš„<strong>å…ƒæ•°æ®ä¿¡æ¯(å…ƒç©ºé—´)</strong>ã€‚ä¹Ÿå°±æ˜¯å­˜å‚¨å­—èŠ‚ç ä¿¡æ¯ã€‚</li>
<li>å †ï¼š<strong>å­˜æ”¾å¯¹è±¡å®ä¾‹</strong>ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</li>
<li>è™šæ‹Ÿæœºæ ˆ(javaæ ˆ)ï¼šè™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯<strong>Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹</strong>ã€‚æ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ª<strong>æ ˆå¸§</strong>ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆï¼šæœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯<strong>è®°å½•</strong>è™šæ‹Ÿæœºå½“å‰ä½¿ç”¨åˆ°çš„<strong>nativeæ–¹æ³•</strong>ã€‚</li>
<li>ç¨‹åºè®¡æ•°å™¨ï¼šå½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„<strong>è¡Œå·æŒ‡ç¤ºå™¨</strong>ã€‚</li>
</ul>
</li>
<li>
<p>æœ¬åœ°æ–¹æ³•æ¥å£ï¼šè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„nativeç±»å‹çš„æ–¹æ³•ï¼Œè´Ÿè´£è°ƒç”¨æ“ä½œç³»ç»Ÿç±»åº“ã€‚ï¼ˆä¾‹å¦‚Threadç±»ä¸­æœ‰å¾ˆå¤šNativeæ–¹æ³•çš„è°ƒç”¨ï¼‰</p>
</li>
<li>
<p>æ‰§è¡Œå¼•æ“ï¼šåŒ…å«è§£é‡Šå™¨ã€å³æ—¶ç¼–è¯‘å™¨å’Œåƒåœ¾æ”¶é›†å™¨ ï¼Œè´Ÿè´£æ‰§è¡ŒåŠ è½½åˆ°JVMä¸­çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
<ol>
<li>åŠŸèƒ½åŒºï¼š ç±»åŠ è½½å™¨å­ç³»ç»Ÿã€åƒåœ¾å›æ”¶å™¨ã€å­—èŠ‚ç æ‰§è¡Œå¼•æ“</li>
<li>çº¿ç¨‹å…±äº«åŒºï¼šå †ã€æ–¹æ³•åŒºã€ç›´æ¥å†…å­˜ã€è¿è¡Œæ—¶å¸¸é‡æ± </li>
<li>çº¿ç¨‹ç§æœ‰åŒºï¼šæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨</li>
</ol>
</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/0f9c6206734143c8458c4b9a898d7fcb.png" alt=""></p>
<p><img src="http://120.26.79.238:9000/blog/img/28aef0cd227d38dc63c33e178e36ac82.png" alt=""></p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>å¤šçº¿ç¨‹å…±äº«æ–¹æ³•åŒºå’Œå †ï¼›</li>
<li>Javaæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨æ˜¯æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„ã€‚</li>
</ul>
<h2 id="æ‰§è¡Œå¼•æ“Execution-Engine">æ‰§è¡Œå¼•æ“Execution Engine</h2>
<p><strong>Execution Engine</strong>æ‰§è¡Œå¼•æ“è´Ÿè´£è§£é‡Šå‘½ä»¤(å°†å­—èŠ‚ç æŒ‡ä»¤è§£é‡Šç¼–è¯‘ä¸ºæœºå™¨ç æŒ‡ä»¤)ï¼Œæäº¤æ“ä½œç³»ç»Ÿæ‰§è¡Œã€‚</p>
<p>JVMæ‰§è¡Œå¼•æ“é€šå¸¸ç”±ä¸¤ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†æ„æˆï¼šè§£é‡Šå™¨å’Œå³æ—¶ç¼–è¯‘å™¨ï¼ˆJust-In-Time Compilerï¼ŒJIT Compilerï¼‰ã€‚</p>
<ol>
<li>è§£é‡Šå™¨ï¼šå½“Javaå­—èŠ‚ç è¢«åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ï¼Œè§£é‡Šå™¨é€æ¡è§£æå’Œæ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ã€‚è§£é‡Šå™¨é€æ¡æ‰§è¡Œå­—èŠ‚ç ï¼Œå°†æ¯æ¡æŒ‡ä»¤è½¬æ¢ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœ¬åœ°æœºå™¨æŒ‡ä»¤ã€‚ç”±äºè§£é‡Šå™¨é€æ¡è§£ææ‰§è¡Œï¼Œå› æ­¤æ‰§è¡Œé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚ä½†è§£é‡Šå™¨å…·æœ‰ä¼˜ç‚¹ï¼Œå³å¯ç«‹å³æ‰§è¡Œå­—èŠ‚ç ï¼Œæ— éœ€ç­‰å¾…ç¼–è¯‘è¿‡ç¨‹ã€‚</li>
<li>å³æ—¶ç¼–è¯‘å™¨ï¼ˆJIT Compilerï¼‰ï¼šä¸ºäº†æé«˜æ‰§è¡Œé€Ÿåº¦ï¼ŒJVMè¿˜ä½¿ç”¨å³æ—¶ç¼–è¯‘å™¨ã€‚å³æ—¶ç¼–è¯‘å™¨å°†å­—èŠ‚ç åŠ¨æ€åœ°ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œä»¥ä¾¿ç›´æ¥åœ¨åº•å±‚ç¡¬ä»¶ä¸Šæ‰§è¡Œã€‚å³æ—¶ç¼–è¯‘å™¨æ ¹æ®è¿è¡Œæ—¶çš„æ€§èƒ½æ•°æ®å’Œä¼˜åŒ–æŠ€æœ¯ï¼Œå¯¹ç»å¸¸æ‰§è¡Œçš„çƒ­ç‚¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚å³æ—¶ç¼–è¯‘å™¨å¯ä»¥å°†ç»è¿‡ä¼˜åŒ–çš„ä»£ç ç¼“å­˜èµ·æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡å†æ¬¡æ‰§è¡Œæ—¶ç›´æ¥ä½¿ç”¨ã€‚</li>
</ol>
<p>JVMæ‰§è¡Œå¼•æ“è¿˜åŒ…æ‹¬å…¶ä»–ä¸€äº›é‡è¦çš„ç»„ä»¶ï¼Œå¦‚å³æ—¶ç¼–è¯‘å™¨åç«¯ã€åƒåœ¾å›æ”¶å™¨ã€çº¿ç¨‹ç®¡ç†å™¨ç­‰ã€‚è¿™äº›ç»„ä»¶å…±åŒåä½œï¼Œä½¿å¾—Javaç¨‹åºèƒ½å¤Ÿåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œï¼Œå¹¶ä¸”å…·å¤‡è‰¯å¥½çš„æ€§èƒ½ã€‚</p>
<h2 id="æœ¬åœ°æ–¹æ³•æ¥å£">æœ¬åœ°æ–¹æ³•æ¥å£</h2>
<p>æœ¬åœ°æ¥å£çš„ä½œç”¨æ˜¯èåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ï¼Œäºæ˜¯å°±åœ¨å†…å­˜ä¸­ä¸“é—¨å¼€è¾Ÿäº†ä¸€å—åŒºåŸŸå¤„ç†æ ‡è®°ä¸ºnativeçš„ä»£ç ï¼Œå®ƒçš„å…·ä½“åšæ³•æ˜¯ Native Method Stackä¸­ç™»è®° nativeæ–¹æ³•ï¼Œåœ¨Execution Engine æ‰§è¡Œæ—¶åŠ è½½native libraiesã€‚</p>
<h2 id="æœ¬åœ°æ–¹æ³•æ ˆNative-Method-Stack">æœ¬åœ°æ–¹æ³•æ ˆNative Method Stack</h2>
<p>æœ¬åœ°æ–¹æ³•æ ˆå­˜å‚¨äº†ä»Javaä»£ç ä¸­è°ƒç”¨æœ¬åœ°æ–¹æ³•æ—¶æ‰€éœ€çš„ä¿¡æ¯ã€‚æ˜¯<strong>çº¿ç¨‹ç§æœ‰</strong>çš„ã€‚</p>
<h2 id="PCå¯„å­˜å™¨-ç¨‹åºè®¡æ•°å™¨">PCå¯„å­˜å™¨(ç¨‹åºè®¡æ•°å™¨)</h2>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯<strong>çº¿ç¨‹ç§æœ‰</strong>çš„ï¼Œå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ–¹æ³•åŒºä¸­çš„æ–¹æ³•å­—èŠ‚ç ï¼ˆç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå³ å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ä»£ç ï¼‰ï¼Œç”±æ‰§è¡Œå¼•æ“è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å°çš„å†…å­˜ç©ºé—´ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®°ã€‚</p>
<h2 id="ç±»åŠ è½½å™¨">ç±»åŠ è½½å™¨</h2>
<ul>
<li>è´Ÿè´£åŠ è½½classæ–‡ä»¶ï¼Œclassæ–‡ä»¶åœ¨æ–‡ä»¶å¼€å¤´æœ‰ç‰¹å®šçš„æ–‡ä»¶æ ‡è¯†(cafe babe)ã€‚</li>
<li>ClassLoaderåªè´Ÿè´£classæ–‡ä»¶çš„åŠ è½½ï¼Œè‡³äºå®ƒæ˜¯å¦å¯ä»¥è¿è¡Œï¼Œåˆ™ç”±Execution Engineå†³å®šã€‚</li>
<li>åŠ è½½çš„ç±»ä¿¡æ¯å­˜æ”¾åˆ°æ–¹æ³•åŒºçš„å†…å­˜ç©ºé—´ã€‚</li>
</ul>
<h3 id="ç±»åŠ è½½çš„è¿‡ç¨‹">ç±»åŠ è½½çš„è¿‡ç¨‹</h3>
<p><strong>ç±»åŠ è½½è¿‡ç¨‹</strong>ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š<strong>åŠ è½½</strong>ã€<strong>é“¾æ¥</strong>ã€<strong>åˆå§‹åŒ–</strong>ï¼Œè€Œå…¶ä¸­é“¾æ¥è¿‡ç¨‹åˆåˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š<strong>éªŒè¯</strong>ã€<strong>å‡†å¤‡</strong>ã€<strong>è§£æ</strong>ï¼ŒåŠ ä¸Š<strong>å¸è½½</strong>ã€<strong>ä½¿ç”¨</strong>ä¸¤ä¸ªæ­¥éª¤ç»Ÿç§°ä¸ºä¸º<strong>ç±»çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/9dcf02e8fa38ba6c1c0a3ddd56d9c820.png" alt=""></p>
<p><strong>é˜¶æ®µä¸€ï¼šåŠ è½½</strong></p>
<p>é€šè¿‡<strong>åŒäº²å§”æ´¾æ¨¡å‹</strong>åŠ è½½ç±»çš„å­—èŠ‚ç æ–‡ä»¶</p>
<ul>
<li>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</li>
<li>å°†è¿™ä¸ªå­—èŠ‚æµä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬ä¸ºæ–¹æ³•åŒºè¿è¡Œæ—¶æ•°æ®ç»“æ„</li>
<li><strong>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£ç è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡</strong>ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£</li>
</ul>
<p>ç»“è®ºï¼šç±»åŠ è½½ä¸ºæ‡’åŠ è½½</p>
<p><strong>é˜¶æ®µäºŒï¼šé“¾æ¥</strong></p>
<ul>
<li>éªŒè¯ï¼šéªŒè¯é˜¶æ®µä¸»è¦æ˜¯ä¸ºäº†ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆè™šæ‹Ÿæœºè¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœº</li>
<li>å‡†å¤‡ï¼š
<ul>
<li>ä¸ºç±»çš„<strong>é™æ€å˜é‡</strong>åˆ†é…å†…å­˜å¹¶ ä¸”è®¾ç½®è¯¥ç±»å˜é‡çš„é»˜è®¤åˆå§‹å€¼ï¼Œå³<strong>èµ‹åˆå€¼</strong></li>
<li><strong>å®ä¾‹å˜é‡</strong>æ˜¯åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å®Œæˆèµ‹å€¼ï¼Œä¸”å®ä¾‹å˜é‡éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­</li>
<li><strong>finalä¿®é¥°çš„å¸¸é‡</strong>åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šåˆ†é…ï¼Œå‡†å¤‡é˜¶æ®µç›´æ¥å®Œæˆèµ‹å€¼ï¼Œå³æ²¡æœ‰èµ‹åˆå€¼è¿™ä¸€æ­¥ã€‚è¢«æ‰€æœ‰çº¿ç¨‹æ‰€æœ‰å¯¹è±¡å…±äº«</li>
</ul>
</li>
<li>è§£æï¼šå°†<strong>ç¬¦å·å¼•ç”¨</strong>æ›¿æ¢ä¸º<strong>ç›´æ¥å¼•ç”¨</strong>
<ul>
<li>ç¬¦å·å¼•ç”¨ï¼šä»¥ä¸€ç»„<strong>ç¬¦å·æ¥æè¿°</strong>æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„<strong>å­—é¢é‡</strong>ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯</li>
<li>ç›´æ¥å¼•ç”¨ï¼šå¯ä»¥<strong>ç›´æ¥</strong>æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆï¼Œè€Œç›´æ¥å¼•ç”¨å¿…é¡»å¼•ç”¨çš„ç›®æ ‡å·²ç»<strong>åœ¨å†…å­˜ä¸­å­˜åœ¨</strong></li>
</ul>
</li>
</ul>
<p><strong>é˜¶æ®µä¸‰ï¼šåˆå§‹åŒ–</strong></p>
<p>â€‹	åˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æ„é€ å™¨ <clinit>çš„è¿‡ç¨‹ã€‚è¿™ä¸€æ­¥ä¸»è¦çš„ç›®çš„æ˜¯ï¼šæ ¹æ®ç¨‹åºå‘˜ç¨‹åºç¼–ç åˆ¶å®šçš„ä¸»è§‚è®¡åˆ’å»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶ä»–èµ„æºã€‚</p>
<p><code>æ‰§è¡Œç±»æ„é€ å™¨&lt;cinit&gt;()æ–¹æ³•,ç»™ç±»é™æ€å˜é‡èµ‹å€¼(æ¯”å¦‚:int i=5)ï¼Œå¹¶æ‰§è¡Œé™æ€ä»£ç å—,å¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰é™æ€ä»£ç å—ï¼Œä¹Ÿæ²¡æœ‰é™æ€å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿæˆ&lt;init&gt;()æ–¹æ³•</code></p>
<h3 id="ç±»åŠ è½½å™¨çš„ä½œç”¨">ç±»åŠ è½½å™¨çš„ä½œç”¨</h3>
<p>è´Ÿè´£åŠ è½½classæ–‡ä»¶ï¼Œclassæ–‡ä»¶åœ¨æ–‡ä»¶å¼€å¤´æœ‰çš„æ–‡ä»¶æ ‡è¯†**ï¼ˆCA FE BA BEï¼‰**ï¼Œå¹¶ä¸”ClassLoaderåªè´Ÿè´£classæ–‡ä»¶çš„åŠ è½½ï¼Œè‡³äºå®ƒæ˜¯å¦å¯ä»¥è¿è¡Œï¼Œåˆ™ç”±Execution Engineå†³å®šã€‚</p>
<h3 id="ç±»åŠ è½½å™¨çš„åˆ†ç±»">ç±»åŠ è½½å™¨çš„åˆ†ç±»</h3>
<p>åˆ†ä¸ºå››ç§ï¼Œå‰ä¸‰ç§ä¸ºè™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨ã€‚</p>
<ul>
<li>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrapClassLoaderï¼‰ï¼šç”±C++å®ç°ã€‚</li>
<li>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtClassLoader/PlatformClassLoaderï¼‰ï¼šç”±Javaå®ç°ï¼Œæ´¾ç”Ÿè‡ªClassLoaderç±»ã€‚</li>
<li>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰ï¼šä¹Ÿå«ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ç”±Javaå®ç°ï¼Œæ´¾ç”Ÿè‡ªClassLoaderç±»ã€‚</li>
<li>è‡ªå®šä¹‰åŠ è½½å™¨ ï¼šç¨‹åºå‘˜å¯ä»¥å®šåˆ¶ç±»çš„åŠ è½½æ–¹å¼ï¼Œæ´¾ç”Ÿè‡ªClassLoaderç±»ã€‚</li>
</ul>
<p><strong>Java 9ä¹‹å‰çš„ClassLoader</strong></p>
<ul>
<li>Bootstrap ClassLoaderåŠ è½½$JAVA_HOMEä¸­jre/lib/rt.jarï¼ŒåŠ è½½JDKä¸­çš„æ ¸å¿ƒç±»åº“</li>
<li>ExtClassLoaderåŠ è½½ç›¸å¯¹æ¬¡è¦ã€ä½†åˆé€šç”¨çš„ç±»ï¼Œä¸»è¦åŒ…æ‹¬$JAVA_HOMEä¸­jre/lib/*.jaræˆ–-Djava.ext.dirsæŒ‡å®šç›®å½•ä¸‹çš„jaråŒ…</li>
<li>AppClassLoaderåŠ è½½-cpæŒ‡å®šçš„ç±»ï¼ŒåŠ è½½ç”¨æˆ·ç±»è·¯å¾„ä¸­æŒ‡å®šçš„jaråŒ…åŠç›®å½•ä¸­class</li>
</ul>
<p><strong>Java 9åŠä¹‹åçš„ClassLoader</strong></p>
<ul>
<li>
<p>Bootstrap ClassLoaderï¼Œä½¿ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŠ è½½lib/moduleså¯åŠ¨æ—¶çš„åŸºç¡€æ¨¡å—ç±»ï¼Œjava.baseã€java.managementã€java.xml</p>
</li>
<li>
<p>ExtClassLoaderæ›´åä¸ºPlatformClassLoaderï¼Œä½¿ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŠ è½½lib/modulesä¸­å¹³å°ç›¸å…³æ¨¡å—ï¼Œå¦‚java.scriptingã€java.compilerã€‚</p>
<blockquote>
<p><strong>å¹³å°ç±»åŠ è½½å™¨</strong>åŠ è½½çš„ç±»ç¤ºä¾‹ï¼š</p>
<ul>
<li><code>java.util.logging.Logger</code></li>
<li><code>javax.xml.parsers.DocumentBuilderFactory</code></li>
<li><code>javax.sql.DataSource</code></li>
</ul>
</blockquote>
</li>
<li>
<p>AppClassLoaderåŠ è½½-cpï¼Œ-mpæŒ‡å®šçš„ç±»ï¼ŒåŠ è½½ç”¨æˆ·ç±»è·¯å¾„ä¸­æŒ‡å®šçš„jaråŒ…åŠç›®å½•ä¸­class</p>
</li>
</ul>
<h2 id="åŒäº²å§”æ´¾æ¨¡å‹">åŒäº²å§”æ´¾æ¨¡å‹</h2>
<p><img src="http://120.26.79.238:9000/blog/img/6366cd80ac2f7c90e911466098ca63d9.png" alt=""></p>
<p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œ<strong>è€Œæ˜¯æŠŠè¯·æ±‚å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨å»å®Œæˆï¼Œä¾æ¬¡å‘ä¸Š</strong>ï¼š</p>
<ul>
<li>1ã€å½“AppClassLoaderåŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨PlatformClassLoaderå»å®Œæˆã€‚</li>
<li>2ã€å½“PlatformClassLoaderåŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œå®ƒé¦–å…ˆä¹Ÿä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨BootStrapClassLoaderå»å®Œæˆã€‚</li>
<li>3ã€å¦‚æœBootStrapClassLoaderåŠ è½½å¤±è´¥ï¼Œä¼šç”¨PlatformClassLoaderæ¥å°è¯•åŠ è½½ï¼›</li>
<li>4ã€è‹¥PlatformClassLoaderä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šä½¿ç”¨AppClassLoaderæ¥åŠ è½½</li>
<li>5ã€å¦‚æœAppClassLoaderä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šæŠ¥å‡ºå¼‚å¸¸ClassNotFoundException</li>
</ul>
<p>å…¶å®è¿™å°±æ˜¯æ‰€è°“çš„<strong>åŒäº²å§”æ´¾æ¨¡å‹</strong>ã€‚ç®€å•æ¥è¯´ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠ**è¯·æ±‚å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨å»å®Œæˆ</p>
<p><strong>ç›®çš„ï¼š</strong></p>
<p>ä¸€ï¼Œæ€§èƒ½ï¼Œé¿å…é‡å¤åŠ è½½ï¼›</p>
<p>äºŒï¼Œå®‰å…¨æ€§ï¼Œé¿å…æ ¸å¿ƒç±»è¢«ä¿®æ”¹ã€‚</p>
<h2 id="æ–¹æ³•åŒºMethod-Area">æ–¹æ³•åŒºMethod Area</h2>
<h3 id="å­˜å‚¨">å­˜å‚¨</h3>
<p>å®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰ï¼š</p>
<h3 id="æ–¹æ³•åŒºæ¼”è¿›">æ–¹æ³•åŒºæ¼”è¿›</h3>
<p><img src="http://120.26.79.238:9000/blog/img/1c8f67cb1d67aa523b2495f39dd51610.png" alt=""></p>
<p><strong>æ–¹æ³•åŒº(æ°¸ä¹…ä»£ï¼ˆJDK7åŠä»¥å‰ï¼‰ã€å…ƒç©ºé—´ï¼ˆJDK8ä»¥åï¼‰)</strong></p>
<ul>
<li><strong>æ–¹æ³•åŒº</strong>æ˜¯ JVM è§„èŒƒä¸­å®šä¹‰çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œç”¨æ¥å­˜å‚¨ç±»å…ƒæ•°æ®ã€æ–¹æ³•å­—èŠ‚ç ã€å³æ—¶ç¼–è¯‘å™¨éœ€è¦çš„ä¿¡æ¯ç­‰</li>
<li><strong>æ°¸ä¹…ä»£</strong>æ˜¯ Hotspot è™šæ‹Ÿæœºå¯¹ JVM è§„èŒƒçš„å®ç°ï¼ˆ1.8 ä¹‹å‰ï¼‰</li>
<li><strong>å…ƒç©ºé—´</strong>æ˜¯ Hotspot è™šæ‹Ÿæœºå¯¹ JVM è§„èŒƒçš„å¦ä¸€ç§å®ç°ï¼ˆ1.8 ä»¥åï¼‰ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜ä½œä¸ºè¿™äº›ä¿¡æ¯çš„å­˜å‚¨ç©ºé—´</li>
</ul>
<p>-XXMateSpaceSize</p>
<p>-XXMAxMateSpaceSize</p>
<p>å…ƒç©ºé—´æº¢å‡ºOOMï¼Œ(OutOfMenmoryError)</p>
<h2 id="è™šæ‹Ÿæœºæ ˆ">è™šæ‹Ÿæœºæ ˆ</h2>
<ul>
<li>æ ˆä¹Ÿå«æ ˆå†…å­˜ï¼Œä¸»ç®¡Javaç¨‹åºçš„è¿è¡Œï¼Œæ˜¯åœ¨çº¿ç¨‹åˆ›å»ºæ—¶åˆ›å»ºï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯è·Ÿéšçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œçº¿ç¨‹ç»“æŸæ ˆå†…å­˜ä¹Ÿå°±é‡Šæ”¾ï¼Œ<strong>æ˜¯çº¿ç¨‹ç§æœ‰çš„</strong>ã€‚</li>
<li>çº¿ç¨‹ä¸Šæ­£åœ¨æ‰§è¡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½å„è‡ªå¯¹åº”ä¸€ä¸ª<strong>æ ˆå¸§ï¼ˆStack Frameï¼‰</strong>ã€‚</li>
</ul>
<h3 id="æ ˆå­˜å‚¨ä»€ä¹ˆ">æ ˆå­˜å‚¨ä»€ä¹ˆ?</h3>
<ol>
<li>å±€éƒ¨å˜é‡è¡¨</li>
<li>æ“ä½œæ•°æ ˆ</li>
<li>åŠ¨æ€é“¾æ¥</li>
<li>æ–¹æ³•å‡ºå£</li>
</ol>
<h4 id="å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal-Variablesï¼‰">å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰</h4>
<p>ä¹Ÿå«æœ¬åœ°å˜é‡è¡¨ã€‚</p>
<p>**ä½œç”¨ï¼š**å­˜å‚¨æ–¹æ³•å‚æ•°å’Œæ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ï¼š8ç§åŸºæœ¬ç±»å‹å˜é‡ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceï¼‰ã€‚</p>
<h4 id="æ“ä½œæ•°æ ˆï¼ˆOperand-Stackï¼‰">æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰</h4>
<p>**ä½œç”¨ï¼š**ä¹Ÿæ˜¯ä¸€ä¸ªæ ˆï¼Œåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤è®°å½•å½“å‰æ“ä½œçš„æ•°æ®ï¼Œå°†å®ƒä»¬å…¥æ ˆæˆ–å‡ºæ ˆã€‚ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœï¼ŒåŒæ—¶ä½œä¸ºè®¡ç®—è¿‡ç¨‹ä¸­å˜é‡çš„ä¸´æ—¶å­˜å‚¨ç©ºé—´ã€‚ä¾›cpuä½¿ç”¨</p>
<h4 id="åŠ¨æ€é“¾æ¥ï¼ˆDynamic-Linkingï¼‰">åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰</h4>
<p>**ä½œç”¨ï¼š**å¯ä»¥çŸ¥é“å½“å‰å¸§æ‰§è¡Œçš„æ˜¯å“ªä¸ªæ–¹æ³•ã€‚**æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ã€‚**ç¨‹åºçœŸæ­£æ‰§è¡Œæ—¶ï¼Œç±»åŠ è½½åˆ°å†…å­˜ä¸­åï¼Œç¬¦å·å¼•ç”¨ä¼šæ¢æˆç›´æ¥å¼•ç”¨ã€‚</p>
<p>å°†ç¬¦å·å¼•ç”¨æŒ‡å‘å…ƒç©ºé—´çš„åœ°å€</p>
<h4 id="æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn-Addressï¼‰">æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰</h4>
<p>**ä½œç”¨ï¼š**å¯ä»¥çŸ¥é“è°ƒç”¨å®Œå½“å‰æ–¹æ³•åï¼Œä¸Šä¸€å±‚æ–¹æ³•æ¥ç€åšä»€ä¹ˆï¼Œ<strong>å³â€œreturnâ€åˆ°ä»€ä¹ˆä½ç½®å»</strong>ã€‚å­˜å‚¨å½“å‰æ–¹æ³•è°ƒç”¨å®Œæ¯•</p>
<h4 id="æ ˆæº¢å‡º">æ ˆæº¢å‡º</h4>
<p><strong>å¸¸è§é—®é¢˜æ ˆæº¢å‡º</strong>ï¼šException in thread â€œmainâ€ java.lang.StackOverflowErroré€šå¸¸å‡ºç°åœ¨é€’å½’è°ƒç”¨æ—¶ã€‚</p>
<p>é—®é¢˜è¾¨æï¼š</p>
<ul>
<li>
<p>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ</p>
<p>ä¸æ¶‰åŠï¼Œå› ä¸ºæ ˆå†…å­˜åœ¨æ–¹æ³•è°ƒç”¨ç»“æŸåéƒ½ä¼šè‡ªåŠ¨å¼¹å‡ºæ ˆã€‚</p>
</li>
<li>
<p>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</p>
<p>å½“æ–¹æ³•å†…å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´æ—¶çº¿ç¨‹å®‰å…¨ï¼Œ<strong>å› ä¸ºä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªæ ˆï¼Œæ¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å°±ä¼šæ–°äº§ç”Ÿä¸€ä¸ªæ ˆæ¡¢ï¼Œéƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„å±€éƒ¨å˜é‡</strong>ï¼Œå½“å˜é‡æ˜¯staticæ—¶åˆ™ä¸å®‰å…¨ï¼Œå› ä¸ºæ˜¯çº¿ç¨‹å…±äº«çš„ã€‚</p>
</li>
</ul>
<h4 id="è®¾ç½®æ ˆçš„å¤§å°">è®¾ç½®æ ˆçš„å¤§å°</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">-Xss1m  </span><br><span class="line">-Xss1024k</span><br><span class="line">-Xss1048576</span><br><span class="line">å®Œæ•´çš„å†™æ³•æ˜¯ï¼š -XX:ThreadStackSize=1m  </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -Xss1m YourClassName</span><br></pre></td></tr></table></figure>
<h2 id="å †heap">å †heap</h2>
<h3 id="å †ã€æ ˆã€æ–¹æ³•åŒºçš„å…³ç³»">å †ã€æ ˆã€æ–¹æ³•åŒºçš„å…³ç³»</h3>
<p><img src="http://120.26.79.238:9000/blog/img/310a562ff5e34e99c47ae040b14251ef.png" alt=""></p>
<p>HotSpotæ˜¯ä½¿ç”¨æŒ‡é’ˆçš„æ–¹å¼æ¥è®¿é—®å¯¹è±¡ï¼š</p>
<ul>
<li>
<p>Javaå †ä¸­ä¼šå­˜æ”¾æŒ‡å‘ç±»å…ƒæ•°æ®çš„åœ°å€</p>
</li>
<li>
<p>Javaæ ˆä¸­çš„referenceå­˜å‚¨çš„æ˜¯æŒ‡å‘å †ä¸­çš„å¯¹è±¡çš„åœ°å€</p>
</li>
</ul>
<h3 id="åˆ†å¸¦ç©ºé—´">åˆ†å¸¦ç©ºé—´</h3>
<h4 id="å †ç©ºé—´åˆ’åˆ†">å †ç©ºé—´åˆ’åˆ†</h4>
<p>å †å†…å­˜<strong>é€»è¾‘</strong>ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p>
<ul>
<li>Young Generation Space  				æ–°ç”Ÿä»£/å¹´è½»ä»£                    Young/New</li>
<li>Tenured generation space  	       å…»è€ä»£/è€å¹´ä»£                   Old/Tenured</li>
<li>Permanent Space/Meta Space     æ°¸ä¹…ä»£/å…ƒç©ºé—´                    Permanent/Meta</li>
</ul>
<p>æ–°ç”Ÿä»£åˆåˆ’åˆ†ä¸ºï¼š</p>
<ul>
<li>
<p>æ–°ç”Ÿä»£åˆåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š ä¼Šç”¸å›­åŒºï¼ˆEden spaceï¼‰å’Œå¹¸å­˜è€…åŒºï¼ˆSurvivor paceï¼‰ ã€‚</p>
</li>
<li>
<p>å¹¸å­˜è€…åŒºæœ‰ä¸¤ä¸ªï¼š 0åŒºï¼ˆSurvivor 0 spaceï¼‰å’Œ1åŒºï¼ˆSurvivor 1 spaceï¼‰ã€‚</p>
</li>
</ul>
<h4 id="JDK1-7åŠä¹‹å‰çš„å †ç©ºé—´">JDK1.7åŠä¹‹å‰çš„å †ç©ºé—´</h4>
<p><img src="http://120.26.79.238:9000/blog/img/1ebb50a0bfd024d4827bb42a30e22927.png" alt=""></p>
<h4 id="JDK1-8åŠä¹‹åçš„å †ç©ºé—´">JDK1.8åŠä¹‹åçš„å †ç©ºé—´</h4>
<p><img src="http://120.26.79.238:9000/blog/img/03952a19733057b71b7658e069bb9721.png" alt=""></p>
<p>**æ³¨æ„ï¼š**æ–¹æ³•åŒºï¼ˆå…·ä½“çš„å®ç°æ˜¯æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´ï¼‰é€»è¾‘ä¸Šæ˜¯å †ç©ºé—´çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯è™šæ‹Ÿæœºçš„å®ç°ä¸­å°†æ–¹æ³•åŒºå’Œå †åˆ†å¼€äº†ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p>å †ç©ºé—´åˆ†ä¸ºï¼šå¹´è½»ä»£ã€è€å¹´ä»£</p>
<p>å¹´è½»ä»£ï¼šä¼Šç”¸å›­åŒº+survivoråŒº</p>
<p>â€‹				suvivoråŒºï¼šs0ï¼ˆfromï¼‰+s1ï¼ˆtoï¼‰</p>
<p>â€‹				ç©ºçš„ä¸ºtoåŒºï¼Œä¸¤ä¸ªsuvivoråŒºæ˜¯ä¸ºäº†è§£å†³å†…å­˜ç¢ç‰‡</p>
<h3 id="åˆ†ä»£ç©ºé—´çš„å·¥ä½œæµç¨‹">åˆ†ä»£ç©ºé—´çš„å·¥ä½œæµç¨‹</h3>
<p>å­˜å‚¨åœ¨JVMä¸­çš„Javaå¯¹è±¡å¯ä»¥è¢«åˆ’åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>ä¸€ç±»æ˜¯ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ï¼Œåˆ›å»ºåœ¨æ–°ç”Ÿä»£ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­è¢«åƒåœ¾å›æ”¶ã€‚</li>
<li>ä¸€ç±»æ˜¯ç”Ÿå‘½å‘¨æœŸéå¸¸é•¿çš„å¯¹è±¡ï¼Œåˆ›å»ºåœ¨æ–°ç”Ÿä»£ï¼Œåœ¨è€å¹´ä»£ä¸­è¢«åƒåœ¾å›æ”¶ï¼Œç”šè‡³ä¸JVMç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚</li>
<li>å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡åˆ›å»ºåœ¨ä¼Šç”¸å›­åŒºï¼Œç»å¤§éƒ¨åˆ†å¯¹è±¡é”€æ¯åœ¨æ–°ç”Ÿä»£ï¼Œå¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</li>
</ul>
<h4 id="æ–°ç”Ÿä»£">æ–°ç”Ÿä»£</h4>
<p>ï¼ˆ1ï¼‰æ–°åˆ›å»ºçš„å¯¹è±¡å…ˆæ”¾åœ¨ä¼Šç”¸å›­åŒºã€‚</p>
<p>ï¼ˆ2ï¼‰å½“ä¼Šç”¸å›­çš„ç©ºé—´ç”¨å®Œæ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºæ–°å¯¹è±¡ï¼Œæ­¤æ—¶ï¼Œè§¦å‘JVMçš„åƒåœ¾å›æ”¶å™¨å¯¹ä¼Šç”¸å›­åŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆMinor GCï¼Œä¹Ÿå«Young GCï¼‰ï¼Œå°†ä¼Šç”¸å›­åŒºä¸­ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ã€‚</p>
<p>ï¼ˆ3ï¼‰ç„¶åå°†ä¼Šç”¸å›­åŒºçš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°ç©ºçš„å¹¸å­˜0åŒºã€‚</p>
<p>ï¼ˆ4ï¼‰æ­¤æ—¶ï¼Œä¼Šç”¸å›­åŒºæ¸…ç©ºã€‚</p>
<p>ï¼ˆ5ï¼‰è¢«ç§»åˆ°å¹¸å­˜è€…0åŒºçš„å¯¹è±¡ä¸Šæœ‰ä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼Œå€¼æ˜¯1ã€‚</p>
<p>ï¼ˆ6ï¼‰ç„¶åå†æ¬¡å°†æ–°å¯¹è±¡æ”¾å…¥ä¼Šç”¸å›­åŒºã€‚</p>
<p>ï¼ˆ7ï¼‰å¦‚æœä¼Šç”¸å›­åŒºçš„ç©ºé—´å†æ¬¡ç”¨å®Œï¼Œåˆ™å†æ¬¡è§¦å‘åƒåœ¾å›æ”¶ï¼Œå¯¹ä¼Šç”¸å›­åŒºå’Œs0åŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œé”€æ¯ä¸å†å¼•ç”¨çš„å¯¹è±¡ã€‚</p>
<p>ï¼ˆ8ï¼‰æ­¤æ—¶s1åŒºä¸ºç©ºï¼Œç„¶åå°†ä¼Šç”¸å›­åŒºå’Œs0åŒºçš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°ç©ºçš„s1åŒºã€‚</p>
<p>ï¼ˆ9ï¼‰æ­¤æ—¶ï¼Œä¼Šç”¸å›­åŒºå’Œs0åŒºæ¸…ç©ºã€‚</p>
<p>ï¼ˆ10ï¼‰ä»ä¼Šç”¸å›­åŒºè¢«ç§»åˆ°s1åŒºçš„å¯¹è±¡ä¸Šæœ‰ä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼Œå€¼æ˜¯1ã€‚ä»s0åŒºè¢«ç§»åˆ°s1åŒºçš„å¯¹è±¡ä¸Šçš„å¹´é¾„è®¡æ•°å™¨+1ï¼Œå€¼æ˜¯2ã€‚</p>
<p>ï¼ˆ11ï¼‰ç„¶åå†æ¬¡å°†æ–°å¯¹è±¡æ”¾å…¥ä¼Šç”¸å›­åŒºã€‚å¦‚æœå†æ¬¡ç»å†åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆä¼Šç”¸å›­åŒºå’Œs1åŒºçš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°s0åŒºã€‚å¯¹è±¡ä¸Šçš„å¹´é¾„è®¡æ•°å™¨+1ã€‚</p>
<p>ï¼ˆ12ï¼‰å½“å¯¹è±¡ä¸Šçš„å¹´é¾„è®¡æ•°å™¨è¾¾åˆ°15æ—¶ï¼ˆ<strong>-XX:MaxTenuringThreshold</strong>ï¼‰ï¼Œåˆ™æ™‹å‡åˆ°è€å¹´ä»£ã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li>
<p>é’ˆå¯¹å¹¸å­˜è€…s0ï¼Œs1ï¼ŒGCä¹‹åæœ‰äº¤æ¢ï¼Œè°ç©ºè°æ˜¯to</p>
</li>
<li>
<p>åƒåœ¾å›æ”¶æ—¶ï¼Œ<strong>ä¼Šç”¸å›­åŒºå’ŒfromåŒºå¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°toåŒº</strong></p>
</li>
</ul>
<h4 id="è€å¹´ä»£">è€å¹´ä»£</h4>
<p>ç»å†<strong>å¤šæ¬¡Minor GC</strong>ä»ç„¶å­˜åœ¨çš„å¯¹è±¡ï¼ˆé»˜è®¤æ˜¯15æ¬¡ï¼‰ä¼šè¢«ç§»å…¥è€å¹´ä»£ï¼Œè€å¹´ä»£çš„å¯¹è±¡æ¯”è¾ƒç¨³å®šï¼Œä¸ä¼šé¢‘ç¹çš„GCã€‚è‹¥è€å¹´ä»£ä¹Ÿæ»¡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°†<strong>äº§ç”ŸMajor GCï¼ˆåŒæ—¶è§¦å‘Full GCï¼‰</strong>ï¼Œè¿›è¡Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€‚è‹¥è€å¹´ä»£æ‰§è¡Œäº†Major GCä¹‹åå‘ç°ä¾ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡çš„ä¿å­˜ï¼Œå°±ä¼š<strong>äº§ç”ŸOOMå¼‚å¸¸OutOfMemoryError</strong>ã€‚</p>
<h4 id="æ°¸ä¹…ä»£-å…ƒç©ºé—´">æ°¸ä¹…ä»£/å…ƒç©ºé—´</h4>
<p>æ–¹æ³•åŒºæ˜¯ä¸€ä¸ªå¸¸é©»å†…å­˜åŒºåŸŸï¼Œç”¨äºå­˜æ”¾JDKè‡ªèº«æ‰€æºå¸¦çš„ Classï¼ŒInterface çš„å…ƒæ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå­˜å‚¨çš„æ˜¯è¿è¡Œç¯å¢ƒå¿…é¡»çš„ç±»ä¿¡æ¯ï¼Œæ–¹æ³•åŒºçš„å›æ”¶æ•ˆç‡å¾ˆä½ï¼Œåœ¨full gcçš„æ—¶å€™æ‰ä¼šè§¦å‘ã€‚è€Œfull gcæ˜¯è€å¹´ä»£çš„ç©ºé—´ä¸è¶³ã€æ–¹æ³•åŒºä¸è¶³æ—¶æ‰ä¼šè§¦å‘ã€‚å¦‚æœå‡ºç° <strong>java.lang.OutOfMemoryError:PermGen space</strong>/<strong>java.lang.OutOfMemoryError:Meta space</strong>ï¼Œè¯´æ˜æ˜¯Javaè™šæ‹Ÿæœºå¯¹æ°¸ä¹…ä»£å†…å­˜è®¾ç½®ä¸å¤Ÿã€‚ä¸€èˆ¬å‡ºç°è¿™ç§æƒ…å†µï¼Œéƒ½æ˜¯ç¨‹åºå¯åŠ¨éœ€è¦åŠ è½½å¤§é‡çš„ç¬¬ä¸‰æ–¹jaråŒ…ã€‚ä¾‹å¦‚ï¼šåœ¨ä¸€ä¸ªTomcatä¸‹éƒ¨ç½²äº†å¤ªå¤šçš„åº”ç”¨ã€‚æˆ–è€…å¤§é‡åŠ¨æ€åå°„ç”Ÿæˆçš„ç±»ä¸æ–­è¢«åŠ è½½ï¼Œæœ€ç»ˆå¯¼è‡´PermåŒºè¢«å æ»¡ã€‚</p>
<p>å°½ç®¡æ–¹æ³•åŒºåœ¨é€»è¾‘ä¸Šå±äºå †çš„ä¸€éƒ¨åˆ†ï¼Œå¯¹äºHotSpotJVMè€Œè¨€ï¼Œæ–¹æ³•åŒºè¿˜æœ‰ä¸€ä¸ªåˆ«åå«åšNon-Heap(éå †)ï¼Œç›®çš„å°±æ˜¯è¦å’Œå †åˆ†å¼€ã€‚å¯¹äºHotSpotè™šæ‹Ÿæœºï¼Œå¾ˆå¤šå¼€å‘è€…ä¹ æƒ¯å°†æ–¹æ³•åŒºç§°ä¹‹ä¸ºæ°¸ä¹…ä»£ ï¼Œä½†ä¸¥æ ¼è¯´ä¸¤è€…ä¸åŒï¼Œæˆ–è€…è¯´æ˜¯ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºè€Œå·²ã€‚</p>
<h4 id="GCæ€»ç»“">GCæ€»ç»“</h4>
<p><img src="http://120.26.79.238:9000/blog/img/67bb48625de01bacfc27ce2cd653c3fd.png" alt=""></p>
<ul>
<li>é¢‘ç¹å›æ”¶æ–°ç”Ÿä»£</li>
<li>å¾ˆå°‘å›æ”¶è€å¹´ä»£</li>
<li>å‡ ä¹ä¸åŠ¨æ–¹æ³•åŒº</li>
</ul>
<p><strong>éƒ¨åˆ†æ”¶é›†ï¼š</strong></p>
<ul>
<li>å¹´è½»ä»£æ”¶é›†ï¼ˆMinor GC  /  Young GCï¼‰ï¼šæ–°ç”Ÿä»£åƒåœ¾æ”¶é›†ï¼ˆä¼Šç”¸å›­åŒº + å¹¸å­˜è€…åŒºï¼‰</li>
<li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC / FullGCï¼‰ï¼šè€å¹´ä»£åƒåœ¾æ”¶é›†</li>
<li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£ã€‚<strong>G1åƒåœ¾æ”¶é›†å™¨</strong>æœ‰è¿™ç§æ–¹å¼</li>
</ul>
<p><strong>æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ï¼š</strong></p>
<ul>
<li>æ•´ä¸ªJavaå †çš„åƒåœ¾æ”¶é›†å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†</li>
</ul>
<p><strong>å¹´è½»ä»£GCè§¦å‘æœºåˆ¶ï¼ˆMinor GC ï¼‰ï¼š</strong></p>
<p>å¹´è½»ä»£çš„Edenç©ºé—´ä¸è¶³ï¼Œè§¦å‘Minor GCã€‚</p>
<p>æ¯æ¬¡Minor GCåœ¨æ¸…ç†Edençš„åŒæ—¶ä¼šæ¸…ç†Survivor FromåŒºã€‚</p>
<p>Minor GCéå¸¸é¢‘ç¹ï¼Œå›æ”¶é€Ÿåº¦å—ã€‚</p>
<p>å¼•å‘STWï¼ˆStop The Worldï¼‰ï¼Œæš‚åœå…¶ä»–ç”¨æˆ·çº¿ç¨‹ï¼Œåƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‚</p>
<p><strong>è€å¹´ä»£GCè§¦å‘æœºåˆ¶ï¼ˆFull GC ï¼‰ï¼š</strong></p>
<p>è€å¹´ä»£æ»¡äº†ï¼Œå¯¹è±¡ä»è€å¹´ä»£æ¶ˆå¤±æ˜¯å› ä¸ºå‘ç”Ÿäº†Major GC ã€‚</p>
<p>Major GCæ¯”Minor GCé€Ÿåº¦æ…¢10å€ä»¥ä¸Šï¼ŒSTWæ—¶é—´æ›´é•¿ã€‚</p>
<p>å¦‚æœMajor GCåï¼Œå†…å­˜è¿˜ä¸è¶³ï¼Œå°±æŠ¥OOMã€‚</p>
<p><strong>Full GCè§¦å‘æœºåˆ¶ï¼š</strong></p>
<p>Full GCï¼ˆFull Garbage Collectionï¼‰æ˜¯Javaè™šæ‹Ÿæœºå¯¹å †å†…å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡è¿›è¡Œå…¨é¢å›æ”¶çš„è¿‡ç¨‹ã€‚Full GCçš„æ‰§è¡Œæ—¶æœºå–å†³äºJavaè™šæ‹Ÿæœºçš„å®ç°å’Œå…·ä½“çš„åƒåœ¾å›æ”¶ç­–ç•¥ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒFull GCå‘ç”Ÿçš„æƒ…å†µåŒ…æ‹¬ï¼š</p>
<ol>
<li>å½“å †å†…å­˜ç©ºé—´ä¸è¶³ä»¥åˆ†é…æ–°å¯¹è±¡æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡Full GCã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒJavaè™šæ‹Ÿæœºä¼šå…ˆæ‰§è¡Œä¸€æ¬¡æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰ï¼Œå¦‚æœä»ç„¶æ— æ³•æ»¡è¶³å†…å­˜éœ€æ±‚ï¼Œåˆ™ä¼šæ‰§è¡ŒFull GCã€‚</li>
<li>åœ¨æŸäº›åƒåœ¾å›æ”¶å™¨ä¸­ï¼Œå½“è€å¹´ä»£ç©ºé—´ä¸è¶³ä»¥å®¹çº³æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡æ—¶ï¼Œä¼šæ‰§è¡ŒFull GCã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨é•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­ï¼Œéšç€å¯¹è±¡çš„é€æ¸å¢åŠ ï¼Œè€å¹´ä»£ç©ºé—´å¯èƒ½ä¼šå˜å¾—ä¸è¶³ã€‚</li>
<li>æ‰‹åŠ¨è°ƒç”¨System.gc()æ–¹æ³•æˆ–Runtime.getRuntime().gc()æ–¹æ³•å¯ä»¥è§¦å‘Full GCã€‚ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™åªæ˜¯å»ºè®®Javaè™šæ‹Ÿæœºè¿›è¡Œåƒåœ¾å›æ”¶çš„è¯·æ±‚ï¼Œå¹¶ä¸èƒ½ä¿è¯ç«‹å³æ‰§è¡ŒFull GCã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒFull GCæ˜¯ä¸€é¡¹èµ„æºå¯†é›†å‹çš„æ“ä½œï¼Œä¼šå¯¼è‡´åº”ç”¨ç¨‹åºçš„åœé¡¿æ—¶é—´å¢åŠ ï¼Œå› ä¸ºåœ¨Full GCæœŸé—´ï¼Œåº”ç”¨ç¨‹åºçš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡å’Œå¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œåº”å°½é‡é¿å…é¢‘ç¹è§¦å‘Full GCï¼Œä»¥å‡å°‘å¯¹åº”ç”¨ç¨‹åºæ€§èƒ½çš„å½±å“ã€‚</p>
<h2 id="å †å‚æ•°">å †å‚æ•°</h2>
<ul>
<li><strong>-Xms</strong>è¡¨ç¤ºå †çš„èµ·å§‹å†…å­˜ï¼Œç­‰ä»·äº-XX:InitialHeapSizeï¼Œé»˜è®¤æ˜¯ç‰©ç†ç”µè„‘å†…å­˜çš„1/64ã€‚</li>
<li><strong>-Xmx</strong>è¡¨ç¤ºå †çš„æœ€å¤§å†…å­˜ï¼Œç­‰ä»·äº-XX:MaxHeapSizeï¼Œé»˜è®¤æ˜¯ç‰©ç†ç”µè„‘å†…å­˜çš„1/4ã€‚</li>
<li><strong>-Xmn</strong> è¡¨ç¤ºæ–°ç”Ÿä»£å †å¤§å°ï¼Œç­‰ä»·äº-XX:NewSizeï¼Œé»˜è®¤æ–°ç”Ÿä»£å å †çš„<strong>1/3ç©ºé—´</strong>ï¼Œè€å¹´ä»£å å †çš„<strong>2/3ç©ºé—´</strong>ã€‚</li>
</ul>
<p><strong>é€šå¸¸ä¼šå°†-Xmså’Œ-Xmxé…ç½®ç›¸åŒçš„å€¼</strong>ï¼Œç›®çš„æ˜¯ä¸ºäº†åœ¨Javaåƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåï¼Œä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †åŒºçš„å¤§å°ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>
<h3 id="OOMé”™è¯¯">OOMé”™è¯¯</h3>
<p><strong>OOMå¼‚å¸¸ï¼š</strong></p>
<p>JVMå¯åŠ¨æ—¶ï¼Œä¸ºå †åˆ†é…èµ·å§‹å†…å­˜ï¼Œå½“å †ä¸­æ•°æ®è¶…è¿‡-Xmxæ‰€æŒ‡å®šçš„æœ€å¤§å†…å­˜æ—¶ï¼Œå°†ä¼šæŠ›å‡º<strong>java.lang.OutOfMemoryError: Java heap space</strong>  å¼‚å¸¸ï¼Œæ­¤æ—¶è¯´æ˜Javaè™šæ‹Ÿæœºå †å†…å­˜ä¸å¤Ÿã€‚</p>
<p><strong>åŸå› æœ‰äºŒï¼š</strong></p>
<p>ï¼ˆ1ï¼‰Javaè™šæ‹Ÿæœºçš„<strong>å †å†…å­˜è®¾ç½®ä¸å¤Ÿ</strong>ï¼Œå¯ä»¥é€šè¿‡å‚æ•°-Xmsã€-Xmxæ¥è°ƒæ•´ã€‚</p>
<p>ï¼ˆ2ï¼‰ä»£ç ä¸­åˆ›å»ºäº†å¤§é‡å¤§å¯¹è±¡ï¼Œå¹¶ä¸”é•¿æ—¶é—´<strong>ä¸èƒ½è¢«åƒåœ¾æ”¶é›†å™¨æ”¶é›†</strong>ï¼ˆå­˜åœ¨è¢«å¼•ç”¨ï¼‰ã€‚</p>
<h2 id="VisualVMçš„ä½¿ç”¨">VisualVMçš„ä½¿ç”¨</h2>
<h3 id="OOMæ—¶è‡ªåŠ¨ç”Ÿæˆå †å†…å­˜å¿«ç…§">OOMæ—¶è‡ªåŠ¨ç”Ÿæˆå †å†…å­˜å¿«ç…§</h3>
<p>VisualVMå·¥å…·ï¼šæ‰“å¼€jvisualvmå·¥å…·  ----&gt; è½½å…¥æ–‡ä»¶ ----&gt; æŸ¥çœ‹ç±»å®ä¾‹æ•°æœ€å¤šçš„å¹¶ä¸”å’Œä¸šåŠ¡ç›¸å…³çš„å¯¹è±¡  ----&gt; æŸ¥çœ‹çº¿ç¨‹çš„æŠ¥é”™ä¿¡æ¯</p>
<table>
<thead>
<tr>
<th>1</th>
<th>è‡ªå·±æœ¬æœºæ–°å»ºè·¯å¾„D:\myDumpï¼Œç›®çš„æ˜¯å¯¹åº”å‚æ•°-XX:HeapDumpPath=D:\myDump</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>-Xms20m -Xmx20m -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=D:\myDump</td>
</tr>
<tr>
<td></td>
<td>-XX:+HeapDumpOnOutOfMemoryErrorï¼šå¼€å¯å†…å­˜æº¢å‡ºæ—¶è‡ªåŠ¨ç”Ÿæˆå†…å­˜å¿«ç…§<br/>-XX:HeapDumpPath=/xxx/dump.hprofï¼šæŒ‡å®šdumpæ–‡ä»¶çš„ä½ç½®å’Œæ–‡ä»¶åç§°</td>
</tr>
</tbody>
</table>
<h2 id="GCåƒåœ¾å›æ”¶">GCåƒåœ¾å›æ”¶</h2>
<h3 id="æ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶">æ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶</h3>
<p>æ–¹æ³•åŒºä¸­èƒ½å›æ”¶çš„å†…å®¹ä¸»è¦å°±æ˜¯ä¸å†ä½¿ç”¨çš„ç±»ã€‚åˆ¤å®šä¸€ä¸ªç±»å¯ä»¥è¢«å¸è½½ã€‚éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<p>1ã€æ­¤ç±»æ‰€æœ‰å®ä¾‹å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œåœ¨å †ä¸­ä¸å­˜åœ¨ä»»ä½•è¯¥ç±»çš„å®ä¾‹å¯¹è±¡ä»¥åŠå­ç±»å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">car = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<p>2ã€è¯¥ç±»å¯¹åº”çš„ java.lang.Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(); </span><br><span class="line">Class&lt;? <span class="keyword">extends</span> <span class="title class_">Car</span>&gt; aClass = car.getClass(); </span><br><span class="line">car = <span class="literal">null</span>;</span><br><span class="line">aClass = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<p>3ã€åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(); </span><br><span class="line">Class&lt;? <span class="keyword">extends</span> <span class="title class_">Car</span>&gt; aClass = car.getClass(); </span><br><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> aClass.getClassLoader();</span><br><span class="line"></span><br><span class="line">car = <span class="literal">null</span>;</span><br><span class="line">aClass = <span class="literal">null</span>;</span><br><span class="line">classLoader = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<p>**æ€»ç»“ï¼š**æ–¹æ³•åŒºçš„å›æ”¶é€šå¸¸æƒ…å†µä¸‹å¾ˆå°‘å‘ç”Ÿï¼Œä½†æ˜¯å¦‚æœé€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½ç‰¹å®šçš„æ˜¯å°‘æ•°çš„ç±»ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ç¨‹åºä¸­é‡Šæ”¾è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œå¸è½½å½“å‰ç±»ï¼Œåƒåœ¾å›æ”¶åŠä¼šå¯¹è¿™éƒ¨åˆ†å†…å®¹è¿›è¡Œå›æ”¶</p>
<h3 id="åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºåƒåœ¾çš„ç®—æ³•">åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºåƒåœ¾çš„ç®—æ³•</h3>
<h4 id="å¼•ç”¨è®¡æ•°æ³•">å¼•ç”¨è®¡æ•°æ³•</h4>
<ul>
<li><strong>æ€è·¯</strong>ï¼šç»™æ¯ä¸€ä¸ªå¯¹è±¡åŠ ä¸Šå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨è¯¥å¯¹è±¡ï¼Œè®¡æ•°å™¨å°±åŠ 1ï¼Œè®¡æ•°å™¨ä¸º0çš„å°±æ˜¯ä¸å¯èƒ½è¢«ä½¿ç”¨çš„ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•ã€é«˜æ•ˆ</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå½“ä¸¤ä¸ªå¯¹è±¡çš„å±æ€§å¾ªç¯å¼•ç”¨æ—¶ï¼Œè®¡æ•°å™¨çš„å€¼æ°¸è¿œä¸å¯èƒ½ä¸º0ï¼Œå°±æ— æ³•é‡Šæ”¾ã€‚</li>
</ul>
<h4 id="å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆæ ¹å¯è¾¾ï¼‰">å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆæ ¹å¯è¾¾ï¼‰</h4>
<ul>
<li><strong>æ€è·¯</strong>ï¼šé€šè¿‡å°†ä¸€äº›ç‰¹å®šçš„å¯¹è±¡è®¾ç½®ä¸ºèµ·å§‹ç‚¹GC Rootsï¼Œè¿™ä¸ªæ ¹å¯¹è±¡èƒ½åˆ°è¾¾çš„å¯¹è±¡åˆ™ä¸ºå¯ç”¨çš„ï¼Œä¸èƒ½åˆ°è¾¾çš„å¯¹è±¡åˆ™ä¸ºåƒåœ¾ã€‚</li>
<li>GC Rootsï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>1</th>
<th>æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„referenceå¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>æ–¹æ³•åŒºä¸­staticé™æ€å¼•ç”¨çš„å¯¹è±¡</td>
</tr>
<tr>
<td>3</td>
<td>æ–¹æ³•åŒºä¸­finalå¸¸é‡å¼•ç”¨çš„å¯¹è±¡</td>
</tr>
<tr>
<td>4</td>
<td>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNI(Nativeæ–¹æ³•)å¼•ç”¨çš„å¯¹è±¡</td>
</tr>
</tbody>
</table>
<h3 id="åƒåœ¾å›æ”¶ç®—æ³•-æ¸…é™¤åƒåœ¾">åƒåœ¾å›æ”¶ç®—æ³•-æ¸…é™¤åƒåœ¾</h3>
<h4 id="å¤åˆ¶ç®—æ³•ï¼ˆå¹´è½»ä»£ï¼‰">å¤åˆ¶ç®—æ³•ï¼ˆå¹´è½»ä»£ï¼‰</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong></p>
<p>1.å°†å †å†…å­˜åˆ†å‰²æˆä¸¤å—Fromç©ºé—´ Toç©ºé—´ï¼Œå¯¹è±¡åˆ†é…é˜¶æ®µï¼Œåˆ›å»ºå¯¹è±¡ã€‚</p>
<p>2.GCé˜¶æ®µå¼€å§‹ï¼Œå°†GC Rootæ¬è¿åˆ°Toç©ºé—´</p>
<p>3.å°†GC Rootå…³è”çš„å¯¹è±¡ï¼Œæ¬è¿åˆ°Toç©ºé—´</p>
<p>4.æ¸…ç†Fromç©ºé—´ï¼Œå¹¶æŠŠåç§°äº’æ¢</p>
<p><img src="http://120.26.79.238:9000/blog/img/80daaf1111bfcc8b31d379da468ca76b.png" alt=""></p>
<h4 id="æ ‡è®°æ¸…é™¤ï¼ˆè€å¹´ä»£ï¼‰">æ ‡è®°æ¸…é™¤ï¼ˆè€å¹´ä»£ï¼‰</h4>
<p>ï¼ˆ1ï¼‰**æ ‡è®°ï¼š**ä½¿ç”¨<code>å¯è¾¾æ€§åˆ†æç®—æ³•</code>ï¼Œæ ‡è®°å‡ºå¯è¾¾å¯¹è±¡ã€‚</p>
<p>ï¼ˆ2ï¼‰**æ¸…é™¤ï¼š**å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œçº¿æ€§ä¾¿éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡æ²¡æœ‰è¢«æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™å°†å…¶å›æ”¶ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/75e283a4b3bff55ac33e642cdc882381.png" alt=""></p>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>
<p>æ•ˆç‡é—®é¢˜ï¼ˆä¸¤æ¬¡éå†ï¼‰</p>
</li>
<li>
<p>ç©ºé—´é—®é¢˜ï¼ˆæ ‡è®°æ¸…é™¤åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„ç¢ç‰‡ã€‚JVMå°±ä¸å¾—ä¸ç»´æŒä¸€ä¸ª<code>å†…å­˜çš„ç©ºé—²åˆ—è¡¨</code>ï¼Œè¿™åˆæ˜¯ä¸€ç§å¼€é”€ã€‚è€Œä¸”åœ¨åˆ†é…æ•°ç»„å¯¹è±¡çš„æ—¶å€™ï¼Œå¯»æ‰¾è¿ç»­çš„å†…å­˜ç©ºé—´ä¼šä¸å¤ªå¥½æ‰¾ã€‚ï¼‰</p>
</li>
</ul>
<h4 id="æ ‡è®°å‹ç¼©ï¼ˆæ ‡è®°æ•´ç†æ¸…é™¤ï¼‰ï¼ˆè€å¹´ä»£ï¼‰">æ ‡è®°å‹ç¼©ï¼ˆæ ‡è®°æ•´ç†æ¸…é™¤ï¼‰ï¼ˆè€å¹´ä»£ï¼‰</h4>
<p><img src="http://120.26.79.238:9000/blog/img/63759c05f37131eabf3e753f326894dd.png" alt=""></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<p>æ ‡è®°æ•´ç†ç®—æ³•ä¸ä»…å¯ä»¥å¼¥è¡¥æ ‡è®°æ¸…é™¤ç®—æ³•ä¸­ï¼Œå†…å­˜åŒºåŸŸåˆ†æ•£çš„ç¼ºç‚¹ï¼Œä¹Ÿæ¶ˆé™¤äº†å¤åˆ¶ç®—æ³•å½“ä¸­ï¼Œå†…å­˜å‡åŠçš„é«˜é¢ä»£ä»·ã€‚</p>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<p>å¦‚æœå­˜æ´»çš„å¯¹è±¡è¿‡å¤šï¼Œæ•´ç†é˜¶æ®µå°†ä¼šæ‰§è¡Œè¾ƒå¤šå¤åˆ¶æ“ä½œï¼Œå¯¼è‡´ç®—æ³•æ•ˆç‡é™ä½ã€‚</p>
<h3 id="å››ç§å¼•ç”¨">å››ç§å¼•ç”¨</h3>
<h4 id="å¼ºå¼•ç”¨">å¼ºå¼•ç”¨</h4>
<p>åªè¦è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨å­˜åœ¨ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¸ä¼šå›æ”¶</p>
<h4 id="è½¯å¼•ç”¨">è½¯å¼•ç”¨</h4>
<p>å†…å­˜è¶³å¤Ÿä¸å›æ”¶ï¼Œå†…å­˜ä¸è¶³å¤Ÿå°±å›æ”¶</p>
<h4 id="å¼±å¼•ç”¨">å¼±å¼•ç”¨</h4>
<p>æ— è®ºå†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œåªè¦å‘é€åƒåœ¾å›æ”¶ï¼Œå°±ä¸€å®šä¼šå›æ”¶</p>
<h4 id="è™šå¼•ç”¨">è™šå¼•ç”¨</h4>
<p>ä¸å¼±å¼•ç”¨ä¸€æ ·ï¼Œä½†æ˜¯åœ¨åƒåœ¾å›æ”¶ä¹‹å‰ï¼Œä¼šå°†å¯¹è±¡æ·»åŠ åˆ°ä¸€ä¸ªä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p>
<p>å¯ä»¥é€šè¿‡å¼•ç”¨é˜Ÿåˆ—æ¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿåƒåœ¾å›æ”¶æˆ–è¿™ä¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶äº†</p>
<h3 id="åƒåœ¾æ”¶é›†å™¨">åƒåœ¾æ”¶é›†å™¨</h3>
<blockquote>
<p>ç°åœ¨JDK17é»˜è®¤æ˜¯G1åƒåœ¾å›æ”¶å™¨ï¼Œå¯ä»¥ä½¿ç”¨æ•ˆç‡æ›´é«˜çš„ZGCåƒåœ¾å›æ”¶å™¨</p>
</blockquote>
<p><code>-XX:+UseZGC</code></p>
<h4 id="G1åƒåœ¾å›æ”¶å™¨">G1åƒåœ¾å›æ”¶å™¨</h4>
<p><img src="http://120.26.79.238:9000/blog/img/a2d4857660d8fd2461f2ca654592431d.png" alt=""></p>
<p>G1ä¹‹å‰åˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œä¸”æ˜¯è¿ç»­çš„ç©ºé—´ã€‚G1ä¹‹åä¹Ÿå­˜åœ¨å¹´è½»ä»£ã€è€å¹´ä»£ï¼Œå¤šäº†ä¸€ä¸ªHUmongousï¼šç”¨æ¥å­˜å‚¨å†…å­˜è¶…è¿‡regionä¸€åŠçš„å¤§å¯¹è±¡ï¼Œå¦‚æœä¸å¤Ÿåˆ™ä¸¤ä¸ªHåˆå¹¶ï¼Œä½†æ˜¯ä»–ä»¬è¢«åˆ†ä¸º2048ä¸ªç©ºé—´ï¼ˆregionï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>1</th>
<th>å¹´è½»ä»£å’Œè€å¹´ä»£æ˜¯å„è‡ªç‹¬ç«‹ä¸”è¿ç»­çš„å†…å­˜å—</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>å¹´è½»ä»£æ”¶é›†ä½¿ç”¨ä¼Šç”¸å›­åŒº+å¹¸å­˜é›¶åŒº+å¹¸å­˜ä¸€åŒºè¿›è¡Œå¤åˆ¶ç®—æ³•ï¼›</td>
</tr>
<tr>
<td>3</td>
<td>è€å¹´ä»£æ”¶é›†å¿…é¡»æ‰«ææ•´ä¸ªè€å¹´ä»£åŒºåŸŸï¼›</td>
</tr>
<tr>
<td>4</td>
<td>éƒ½æ˜¯ä»¥å°½å¯èƒ½å°‘è€Œå¿«é€Ÿåœ°æ‰§è¡ŒGCä¸ºè®¾è®¡åŸåˆ™ã€‚</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>åˆå§‹æ ‡è®°</th>
<th>å’ŒCMSä¸€æ ·åªæ ‡è®°GC Rootsç›´æ¥å…³è”çš„å¯¹è±¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¹¶å‘æ ‡è®°</td>
<td>è¿›è¡ŒGC Roots Traceingè¿‡ç¨‹</td>
</tr>
<tr>
<td>æœ€ç»ˆæ ‡è®°</td>
<td>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´,å› ç¨‹åºè¿è¡Œå¯¼è‡´å‘ç”Ÿå˜åŒ–çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡</td>
</tr>
<tr>
<td>ç­›é€‰å›æ”¶</td>
<td>æ ¹æ®æ—¶é—´æ¥è¿›è¡Œä»·å€¼æœ€å¤§åŒ–æ”¶é›†</td>
</tr>
</tbody>
</table>
<p><img src="http://120.26.79.238:9000/blog/img/ef0185439913fbc13b35c7393b3965e0.png" alt=""></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>MD5Util</title>
    <url>/2025/09/15/MD5Util/</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Md5Util</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ–‡ä»¶ç”Ÿæˆmd5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getFileMD5</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> DigestUtils.md5Hex(file.getInputStream());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;getFileMD5 error&quot;</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;ä½¿ç”¨æ–‡ä»¶name&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ–‡ä»¶æµç”Ÿæˆmd5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getFileMD5</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> DigestUtils.md5Hex(bytes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;getFileMD5 error&quot;</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Markdown 2 åŸºç¡€è¯­æ³•</title>
    <url>/2022/09/27/Markdown%202%20%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<h1>Markdown 2 åŸºç¡€è¯­æ³•</h1>
<p><a href="https://markdown.com.cn/basic-syntax/lists.html">Markdown åˆ—è¡¨è¯­æ³• | Markdown å®˜æ–¹æ•™ç¨‹</a></p>
<p><a href="https://markdown.com.cn/extended-syntax/">Markdown æ‰©å±•è¯­æ³•å…¥é—¨ | Markdown å®˜æ–¹æ•™ç¨‹</a></p>
<p><a href="https://markdown.com.cn/tools.html#%E7%BC%96%E8%BE%91%E5%99%A8">Markdown å·¥å…· | Markdown å®˜æ–¹æ•™ç¨‹</a></p>
<h1>æ ‡é¢˜ï¼š</h1>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># ä¸€çº§æ ‡é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="section">## äºŒçº§æ ‡é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="section">### ä¸‰çº§æ ‡é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### å››çº§æ ‡é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="section">##### äº”çº§æ ‡é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="section">###### å…­çº§æ ‡é¢˜</span></span><br></pre></td></tr></table></figure>
<p>æ ‡é¢˜é™¤äº†å¯ä»¥é€šè¿‡ #æ¥è®¾ç½®ï¼Œè¿˜å¯ä»¥é€šè¿‡ ctrl + æ•°å­—é”® 1,2,3 æ¥è®¾ç½®</p>
<h1>åˆ—è¡¨:</h1>
<h2 id="æ— åºåˆ—è¡¨">æ— åºåˆ—è¡¨</h2>
<p>è¯­æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨ä½ çš„æ–‡å­—å‰é¢åŠ ä¸Šä¸€å…± - æˆ– * å°±è¡Œäº†.</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">-æˆ‘æ˜¯ç¬¬ä¸€è¡Œ \<span class="emphasis">*æˆ‘æ˜¯ç¬¬äºŒè¡Œ -æˆ‘æ˜¯ç¬¬ä¸‰è¡Œ</span></span><br></pre></td></tr></table></figure>
<h2 id="æœ‰åºåˆ—è¡¨">æœ‰åºåˆ—è¡¨</h2>
<p>åœ¨æ–‡å­—å‰åŠ  1. 2. 3. çš„ç¬¦å·</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">1.æˆ‘æ˜¯ç¬¬ä¸€è¡Œ 2.æˆ‘æ˜¯ç¬¬äºŒè¡Œ 3.æˆ‘æ˜¯ç¬¬ä¸‰è¡Œ</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼š- * ç­‰ç¬¦å·è¦å’Œæ–‡å­—ä¹‹é—´åŠ ä¸€å…±ç©ºæ ¼</p>
<h1>å¼•ç”¨ï¼š</h1>
<p>åªéœ€è¦åœ¨æ–‡æœ¬åœ¨ä¹‹å‰åŠ å…¥ &gt; è¿™ç§å°–æ‹¬å·</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="quote">&gt; æˆ‘ä¸€ç›´åœ¨ä½¿ç”¨å¼•ç”¨</span></span><br><span class="line"><span class="quote">&gt; é‡å¼€å§‹åˆ°ç°åœ¨</span></span><br></pre></td></tr></table></figure>
<h1>å›¾ç‰‡å’Œé“¾æ¥</h1>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">å›¾ç‰‡ä¸º:![](<span class="link"></span>)</span><br><span class="line">é“¾æ¥ä¸º:[](<span class="link"></span>)</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">[<span class="string">å›¾ç‰‡åç§°</span>](<span class="link">http://b.hiphotos.baidu.com/image/pic/item/0823dd54564e925838c205c89982d158ccbf4e</span>)</span><br></pre></td></tr></table></figure>
<p>ä½“ä¸æ–œä½“<br>
Markdown çš„ç²—ä½“å’Œæ–œä½“ä¹Ÿéå¸¸ç®€å•ï¼Œç”¨ä¸¤ä¸ª _ åŒ…å«ä¸€æ®µæ–‡æœ¬å°±æ˜¯ç²—ä½“çš„è¯­æ³•ï¼Œç”¨ä¸€ä¸ª _ åŒ…å«ä¸€æ®µæ–‡æœ¬å°±æ˜¯æ–œä½“çš„è¯­æ³•ã€‚<br>
ä¾‹å¦‚ï¼šè¿™æ˜¯<strong>ç²—ä½“</strong>ï¼Œè¿™æ˜¯<em>æ–œä½“</em></p>
<h1>è¡¨æ ¼</h1>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">| Tables        |      Are      |  Cool |</span><br><span class="line">| ------------- | :-----------: | ----: |</span><br><span class="line">| col 3 is      | right-aligned | $1600 |</span><br><span class="line">| col 2 is      |   centered    |   $12 |</span><br><span class="line">| zebra stripes |   are neat    |    $1 |</span><br></pre></td></tr></table></figure>
<p>è¡¨æ ¼è¿˜å¯ä»¥è¿™æ ·</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="code">    &lt;td&gt;hello somebody told me&lt;/td&gt;</span></span><br><span class="line"><span class="code">    &lt;td&gt;hello&lt;/td&gt;</span></span><br><span class="line"><span class="code">  &lt;/tr&gt;</span></span><br><span class="line"><span class="code">  &lt;tr&gt;</span></span><br><span class="line"><span class="code">    &lt;td&gt;sss&lt;/td&gt;</span></span><br><span class="line"><span class="code">    &lt;td&gt;dsdf&lt;/td&gt;</span></span><br><span class="line"><span class="code">  &lt;/tr&gt;</span></span><br><span class="line"><span class="code">&lt;/table&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹:</p>
<table>
  <tr>
    <td>hello somebody told me</td>
    <td>hello</td>
  </tr>
  <tr>
    <td>sss</td>
    <td>dsdf</td>
  </tr>
</table>
<h1>ä»£ç æ¡†</h1>
<p>è¿ç»­ä¸‰ä¸ªåå¼•å· `ï¼Œå°±æ˜¯æŒ‰é”® 1 å‰é¢çš„é‚£ä¸ªç¬¦å·å†åŠ ä»£ç ç±»å‹.</p>
<p><code>ä»£ç </code></p>
<h1>æ¨ªçº¿</h1>
<p>åˆ†å‰²çº¿çš„è¯­æ³•åªéœ€è¦ä¸‰ä¸ª * å·ã€‚</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br></pre></td></tr></table></figure>
<hr>
<h1>è½¬ä¹‰å­—ç¬¦</h1>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">\\ åæ–œæ </span><br><span class="line">\` åå¼•å· \* æ˜Ÿå·</span><br><span class="line">\_ ä¸‹åˆ’çº¿</span><br><span class="line">\&#123;&#125; å¤§æ‹¬å·</span><br><span class="line">\[] ä¸­æ‹¬å·</span><br><span class="line">\() å°æ‹¬å·</span><br><span class="line">\# äº•å·</span><br><span class="line">\+ åŠ å·</span><br><span class="line">\- å‡å·</span><br><span class="line">\. è‹±æ–‡å¥å·</span><br><span class="line">\! æ„Ÿå¹å·</span><br></pre></td></tr></table></figure>
<h1>å¿«æ·é”®</h1>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">ctrl+1 ä¸€çº§æ ‡é¢˜</span><br><span class="line">ctrl+2 äºŒçº§æ ‡é¢˜</span><br><span class="line">Â·Â·Â·Â·</span><br><span class="line">ctrl+shift+o æœ‰åºåˆ—è¡¨</span><br><span class="line">ctrl+u æ— åºåˆ—è¡¨</span><br><span class="line">ctrl+g æ’å…¥å›¾ç‰‡</span><br><span class="line">ctrl+l æ’å…¥è¶…é“¾æ¥</span><br><span class="line">Ctrl+B ã€€ç²—ä½“</span><br><span class="line">Ctrl+I ã€€æ–œä½“</span><br><span class="line">Ctrl+Q ã€€å¼•ç”¨</span><br><span class="line">Ctrl+K ã€€ä»£ç å—</span><br><span class="line">Ctrl+Shift+I æ’å…¥å›¾ç‰‡ï¼ˆå¤åˆ¶çš„é“¾æ¥ï¼‰</span><br></pre></td></tr></table></figure>
<h2 id="Emojiè¡¨æƒ…">Emojiè¡¨æƒ…</h2>
<p>å¤åˆ¶ç²˜è´´ï¼š<a href="https://emojipedia.org/">ğŸ“™ Emojipedia â€” ğŸ˜ƒ Home of Emoji Meanings ğŸ’ğŸ‘ŒğŸğŸ˜</a></p>
<p><a href="https://gist.github.com/rxaviers/7360908">è¡¨æƒ…ç¬¦å·ç®€ç åˆ—è¡¨</a></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">å»éœ²è¥äº†ï¼ :tent: å¾ˆå¿«å›æ¥ã€‚</span><br><span class="line"></span><br><span class="line">çœŸå¥½ç¬‘ï¼ :joy:</span><br></pre></td></tr></table></figure>
<p>å»éœ²è¥äº†ï¼ â›º å¾ˆå¿«å›æ¥ã€‚</p>
<p>çœŸå¥½ç¬‘ï¼ ğŸ˜‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatis-Plus</title>
    <url>/2025/09/15/MyBatis-Plus/</url>
    <content><![CDATA[<h1>MyBatis-Plus</h1>
<h2 id="é€»è¾‘åˆ é™¤">é€»è¾‘åˆ é™¤</h2>
<p><strong>é€»è¾‘åˆ é™¤åŠŸèƒ½</strong></p>
<p>ç”±äºæ•°æ®åº“ä¸­æ‰€æœ‰è¡¨å‡é‡‡ç”¨é€»è¾‘åˆ é™¤ç­–ç•¥ï¼Œæ‰€ä»¥æŸ¥è¯¢æ•°æ®æ—¶å‡éœ€è¦å¢åŠ è¿‡æ»¤æ¡ä»¶is_deleted=0ã€‚</p>
<p>ä¸Šè¿°æ“ä½œè™½ä¸éš¾å®ç°ï¼Œä½†æ˜¯æ¯ä¸ªæŸ¥è¯¢æ¥å£éƒ½è¦è€ƒè™‘åˆ°ï¼Œä¹Ÿæ˜¾å¾—æœ‰äº›ç¹çã€‚ä¸ºç®€åŒ–ä¸Šè¿°æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨Mybatis-Plusæä¾›çš„é€»è¾‘åˆ é™¤åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ä¸ºæŸ¥è¯¢æ“ä½œå¢åŠ is_deleted=0è¿‡æ»¤æ¡ä»¶ï¼Œå¹¶å°†åˆ é™¤æ“ä½œè½¬ä¸ºæ›´æ–°è¯­å¥ã€‚å…·ä½“é…ç½®å¦‚ä¸‹ï¼Œè¯¦ç»†ä¿¡æ¯å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p>
<h3 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h3>
<p>åœ¨application.ymlä¸­å¢åŠ å¦‚ä¸‹å†…å®¹</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line"><span class="attr">global-config:</span></span><br><span class="line">  <span class="attr">db-config:</span></span><br><span class="line">    <span class="attr">logic-delete-field:</span> <span class="string">is_deleted</span> <span class="comment"># å…¨å±€é€»è¾‘åˆ é™¤çš„å®ä½“å­—æ®µå(é…ç½®åå¯ä»¥å¿½ç•¥ä¸é…ç½®æ­¥éª¤äºŒ)</span></span><br><span class="line">    <span class="attr">logic-delete-value:</span> <span class="number">1</span> <span class="comment"># é€»è¾‘å·²åˆ é™¤å€¼(é»˜è®¤ä¸º 1)</span></span><br><span class="line">    <span class="attr">logic-not-delete-value:</span> <span class="number">0</span> <span class="comment"># é€»è¾‘æœªåˆ é™¤å€¼(é»˜è®¤ä¸º 0)</span></span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h3>
<p>åœ¨å®ä½“ç±»ä¸­çš„åˆ é™¤æ ‡è¯†å­—æ®µä¸Šå¢åŠ @TableLogicæ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;ä¸»é”®&quot;)</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åˆ›å»ºæ—¶é—´&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;æ›´æ–°æ—¶é—´&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;é€»è¾‘åˆ é™¤&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="meta">@TableField(&quot;is_deleted&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Byte isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¿½ç•¥ç‰¹å®šå­—æ®µ">å¿½ç•¥ç‰¹å®šå­—æ®µ</h2>
<p>é€šå¸¸æƒ…å†µä¸‹æ¥å£å“åº”çš„Jsonå¯¹è±¡ä¸­å¹¶ä¸éœ€è¦create_timeã€update_timeã€is_deletedç­‰å­—æ®µï¼Œè¿™æ—¶åªéœ€åœ¨å®ä½“ç±»ä¸­çš„ç›¸åº”å­—æ®µæ·»åŠ @JsonIgnoreæ³¨è§£ï¼Œè¯¥å­—æ®µå°±ä¼šåœ¨åºåˆ—åŒ–æ—¶è¢«å¿½ç•¥ã€‚</p>
<p>å…·ä½“é…ç½®å¦‚ä¸‹ï¼Œè¯¦ç»†ä¿¡æ¯å¯å‚è€ƒJacksonå®˜æ–¹æ–‡æ¡£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;ä¸»é”®&quot;)</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åˆ›å»ºæ—¶é—´&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;create_time&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;æ›´æ–°æ—¶é—´&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;update_time&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;é€»è¾‘åˆ é™¤&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableField(&quot;is_deleted&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Byte isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®è‡ªåŠ¨å¡«å……">é…ç½®è‡ªåŠ¨å¡«å……</h2>
<p>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»<code>MybatisMetaObjectHandler</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strictInsertFill(metaObject, <span class="string">&quot;createTime&quot;</span>, Date.class, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strictUpdateFill(metaObject, <span class="string">&quot;updateTime&quot;</span>, Date.class, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Minio</title>
    <url>/2025/09/15/Minio/</url>
    <content><![CDATA[<h1>MinioConfig</h1>
<p>minioæ“ä½œï¼š1.ä¸Šä¼   2.ç”Ÿå‘½å‘¨æœŸç­‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.orange.blog.web.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.minio.*;</span><br><span class="line"><span class="keyword">import</span> io.minio.messages.*;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> online.orange.blog.common.constants.FilePath;</span><br><span class="line"><span class="keyword">import</span> online.orange.blog.common.dto.MinioUploadDto;</span><br><span class="line"><span class="keyword">import</span> online.orange.blog.util.ByteUtil;</span><br><span class="line"><span class="keyword">import</span> online.orange.blog.util.HttpUtil;</span><br><span class="line"><span class="keyword">import</span> online.orange.blog.util.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> online.orange.blog.util.StringUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;minio&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinioConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.endpoint&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.accessKey&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.secretKey&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.bucketName&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.baseUrl&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String baseUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">AUTO_DELETE_TAG_KEY</span> <span class="operator">=</span> <span class="string">&quot;auto-delete&quot;</span>;</span><br><span class="line">    <span class="comment">//è‡ªåŠ¨åˆ é™¤è§„åˆ™</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">LifecycleRule</span> <span class="variable">autoDeleteRule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LifecycleRule</span>(</span><br><span class="line">            Status.ENABLED,</span><br><span class="line">            <span class="literal">null</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Expiration</span>(</span><br><span class="line">                    (ResponseDate) <span class="literal">null</span>,</span><br><span class="line">                    <span class="number">7</span>,</span><br><span class="line">                    (Boolean) <span class="literal">null</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">RuleFilter</span>(<span class="keyword">new</span> <span class="title class_">Tag</span>(AUTO_DELETE_TAG_KEY, <span class="string">&quot;true&quot;</span>)),</span><br><span class="line">            <span class="literal">null</span>,</span><br><span class="line">            <span class="literal">null</span>,</span><br><span class="line">            <span class="literal">null</span>,</span><br><span class="line">            <span class="literal">null</span></span><br><span class="line">     );</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MinioClient <span class="title function_">getMinioClient</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;LifecycleRule&gt; rules = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        rules.add(autoDeleteRule);</span><br><span class="line">        <span class="type">LifecycleConfiguration</span> <span class="variable">lifecycleConfiguration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LifecycleConfiguration</span>(rules);</span><br><span class="line">        log.info(<span class="string">&quot;åˆå§‹åŒ–minio&quot;</span>);</span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">build</span> <span class="operator">=</span> MinioClient.builder()</span><br><span class="line">                .endpoint(endpoint)</span><br><span class="line">                .credentials(accessKey, secretKey)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">LifecycleConfiguration</span> <span class="variable">lifecycle</span> <span class="operator">=</span> getLifecycle(build);</span><br><span class="line">        <span class="keyword">if</span> (lifecycle == <span class="literal">null</span>)&#123;</span><br><span class="line">            setLifecycle(lifecycleConfiguration,build);</span><br><span class="line">        &#125;</span><br><span class="line">        visualizeLifecycle(lifecycle);</span><br><span class="line">        <span class="keyword">return</span> build;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(MinioUploadDto uploadDto)</span> &#123;</span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> <span class="built_in">this</span>.getMinioClient();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">MultipartFile</span> <span class="variable">file</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file=replaceUrl(uploadDto.getFile());</span><br><span class="line">            <span class="type">byte</span>[] bytes = file.getBytes();</span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">            minioClient.putObject(PutObjectArgs.builder()</span><br><span class="line">                    .bucket(<span class="built_in">this</span>.getBucketName())</span><br><span class="line">                    .object(String.join(<span class="string">&quot;/&quot;</span>,uploadDto.getPath()))</span><br><span class="line">                    .stream(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes), bytes.length, -<span class="number">1</span>)</span><br><span class="line">                    .headers(getHeaders(originalFilename))</span><br><span class="line">                    .tags(uploadDto.getTags())</span><br><span class="line">                    .build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;ä¸Šä¼ æ–‡ä»¶å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> String.join(<span class="string">&quot;/&quot;</span>, <span class="built_in">this</span>.getBaseUrl(),<span class="built_in">this</span>.getBucketName(), uploadDto.getPath());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ–‡ä»¶ç±»å‹è¿”å›å¤´ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getHeaders</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> fileName.substring(fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>).toLowerCase();</span><br><span class="line">        Map&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. è®¾ç½® Content-Type</span></span><br><span class="line">        <span class="keyword">switch</span> (extension) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;png&quot;</span>:</span><br><span class="line">                headers.put(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;image/png&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;jpg&quot;</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;jpeg&quot;</span>:</span><br><span class="line">                headers.put(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;gif&quot;</span>:</span><br><span class="line">                headers.put(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;image/gif&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;md&quot;</span>:</span><br><span class="line">                headers.put(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/markdown&quot;</span>); <span class="comment">// æ˜ç¡®æ ‡è®° markdown ç±»å‹</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                headers.put(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. éå›¾ç‰‡ç±»æ–‡ä»¶å¼ºåˆ¶ä¸‹è½½</span></span><br><span class="line">        <span class="keyword">if</span> (!extension.matches(<span class="string">&quot;png|jpg|jpeg|gif|bmp&quot;</span>)) &#123;</span><br><span class="line">            headers.put(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment; filename=\&quot;&quot;</span> + fileName + <span class="string">&quot;\&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> headers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»é™¤å¯¹è±¡çš„æ‰€æœ‰æ ‡ç­¾</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeAllTags</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">domain</span> <span class="operator">=</span> StringUtil.getDomain(url);</span><br><span class="line">        <span class="keyword">if</span> (!domain.equals(baseUrl))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;éæœ¬ç«™åŸŸåå›¾ç‰‡&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        setTags(url, <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯¹è±¡æ ‡ç­¾</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getTags</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        String path= getObjectPath(url);</span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> getMinioClient();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Tags</span> <span class="variable">objectTags</span> <span class="operator">=</span> minioClient.getObjectTags(</span><br><span class="line">                    GetObjectTagsArgs.builder()</span><br><span class="line">                            .bucket(getBucketName())</span><br><span class="line">                            .object(path)</span><br><span class="line">                            .build());</span><br><span class="line">            <span class="keyword">return</span> objectTags.get();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è·å–å¯¹è±¡æ ‡ç­¾å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®urlè·å–è·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getObjectPath</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–è·¯å¾„</span></span><br><span class="line">        <span class="keyword">return</span> url.substring(url.indexOf(bucketName)+bucketName.length()+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * setTags</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTags</span><span class="params">(String url, Map&lt;String, String&gt; tags)</span> &#123;</span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> getMinioClient();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SetObjectTagsArgs</span> <span class="variable">build</span> <span class="operator">=</span> SetObjectTagsArgs.builder()</span><br><span class="line">                    .bucket(getBucketName())</span><br><span class="line">                    .object(getObjectPath(url))</span><br><span class="line">                    .tags(tags)</span><br><span class="line">                    .build();</span><br><span class="line">            minioClient.setObjectTags(build);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è®¾ç½®å¯¹è±¡æ ‡ç­¾å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> LifecycleConfiguration <span class="title function_">getLifecycle</span><span class="params">(MinioClient minioClient)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> minioClient.getBucketLifecycle(</span><br><span class="line">                    GetBucketLifecycleArgs.builder()</span><br><span class="line">                            .bucket(bucketName)</span><br><span class="line">                            .build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è·å–ç”Ÿå‘½å‘¨æœŸå¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLifecycle</span><span class="params">(LifecycleConfiguration lifecycle,MinioClient minioClient)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            minioClient.setBucketLifecycle(</span><br><span class="line">                    SetBucketLifecycleArgs.builder()</span><br><span class="line">                            .bucket(bucketName)</span><br><span class="line">                            .config(lifecycle)</span><br><span class="line">                            .build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è®¾ç½®ç”Ÿå‘½å‘¨æœŸå¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¸…é™¤ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clearLifecycle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> getMinioClient();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            minioClient.deleteBucketLifecycle(</span><br><span class="line">                    DeleteBucketLifecycleArgs.builder()</span><br><span class="line">                            .bucket(bucketName)</span><br><span class="line">                            .build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ¸…é™¤ç”Ÿå‘½å‘¨æœŸå¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯è§†åŒ–ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visualizeLifecycle</span><span class="params">(LifecycleConfiguration lifecycle)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lifecycle == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¯¥å­˜å‚¨æ¡¶æœªè®¾ç½®ç”Ÿå‘½å‘¨æœŸè§„åˆ™&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;LifecycleRule&gt; rules = lifecycle.rules();</span><br><span class="line">        System.out.printf(<span class="string">&quot;=== å‘ç° %d æ¡ç”Ÿå‘½å‘¨æœŸè§„åˆ™ ===%n%n&quot;</span>, rules.size());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</span><br><span class="line">            <span class="type">LifecycleRule</span> <span class="variable">rule</span> <span class="operator">=</span> rules.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è§„åˆ™åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">            System.out.printf(<span class="string">&quot;â”Œâ”€â”€â”€â”€â”€â”€ è§„åˆ™ #%d â”€â”€â”€â”€â”€â”€â”€%n&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">            System.out.printf(<span class="string">&quot;â”‚ ID: %s%n&quot;</span>, rule.id() != <span class="literal">null</span> ? rule.id() : <span class="string">&quot;(æœªæŒ‡å®š)&quot;</span>);</span><br><span class="line">            System.out.printf(<span class="string">&quot;â”‚ çŠ¶æ€: %s%n&quot;</span>, rule.status());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">            System.out.print(<span class="string">&quot;â”‚ é€‚ç”¨èŒƒå›´: &quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (rule.filter() != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (rule.filter().prefix() != <span class="literal">null</span>) &#123;</span><br><span class="line">                    System.out.print(<span class="string">&quot;å‰ç¼€[&quot;</span> + rule.filter().prefix() + <span class="string">&quot;] &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (rule.filter().tag() != <span class="literal">null</span>) &#123;</span><br><span class="line">                    System.out.print(<span class="string">&quot;æ ‡ç­¾[&quot;</span> + rule.filter().tag().key() + <span class="string">&quot;=&quot;</span></span><br><span class="line">                            + rule.filter().tag().value() + <span class="string">&quot;] &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;å…¨éƒ¨å¯¹è±¡&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿‡æœŸè®¾ç½®</span></span><br><span class="line">            System.out.print(<span class="string">&quot;â”‚ å¯¹è±¡è¿‡æœŸ: &quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (rule.expiration() != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (rule.expiration().days() != <span class="literal">null</span>) &#123;</span><br><span class="line">                    System.out.println(rule.expiration().days() + <span class="string">&quot;å¤©ååˆ é™¤&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (rule.expiration().date() != <span class="literal">null</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;åœ¨ &quot;</span> + rule.expiration().date() + <span class="string">&quot; (GMTåˆå¤œ) åˆ é™¤&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (rule.expiration().expiredObjectDeleteMarker() != <span class="literal">null</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;åˆ é™¤æ ‡è®°: &quot;</span> + rule.expiration().expiredObjectDeleteMarker());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æœªè®¾ç½®&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ†æ®µä¸Šä¼ è®¾ç½®</span></span><br><span class="line">            System.out.print(<span class="string">&quot;â”‚ åˆ†æ®µä¸Šä¼ : &quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (rule.abortIncompleteMultipartUpload() != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(rule.abortIncompleteMultipartUpload().daysAfterInitiation()</span><br><span class="line">                        + <span class="string">&quot;å¤©åä¸­æ­¢æœªå®Œæˆçš„ä¸Šä¼ &quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ä¸è‡ªåŠ¨ä¸­æ­¢&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// éå½“å‰ç‰ˆæœ¬è®¾ç½®</span></span><br><span class="line">            System.out.print(<span class="string">&quot;â”‚ éå½“å‰ç‰ˆæœ¬: &quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (rule.noncurrentVersionExpiration() != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.print(rule.noncurrentVersionExpiration().noncurrentDays() + <span class="string">&quot;å¤©ååˆ é™¤&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (rule.noncurrentVersionTransition() != <span class="literal">null</span>) &#123;</span><br><span class="line">                    System.out.print(<span class="string">&quot;ï¼Œ&quot;</span>+ rule.noncurrentVersionTransition().noncurrentDays()</span><br><span class="line">                            + <span class="string">&quot;å¤©åè½¬ä¸º&quot;</span> + rule.noncurrentVersionTransition().storageClass());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (rule.noncurrentVersionTransition() != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.print(rule.noncurrentVersionTransition().noncurrentDays()</span><br><span class="line">                        + <span class="string">&quot;å¤©åè½¬ä¸º&quot;</span> + rule.noncurrentVersionTransition().storageClass());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;æ— è®¾ç½®&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å­˜å‚¨ç±»å‹è½¬æ¢</span></span><br><span class="line">            System.out.print(<span class="string">&quot;â”‚ å­˜å‚¨è½¬æ¢: &quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (rule.transition() != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(rule.transition().days() + <span class="string">&quot;å¤©åè½¬ä¸º&quot;</span></span><br><span class="line">                        + rule.transition().storageClass());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ— è®¾ç½®&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€%n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ‰€æœ‰å¸¦æœ‰ AUTO_DELETE_TAG_KEY æ ‡ç­¾çš„ å¯¹è±¡çš„url</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getObjectByTag</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> getMinioClient();</span><br><span class="line">        List&lt;String&gt; urls = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. åˆ—å‡ºæ‰€æœ‰å¯¹è±¡</span></span><br><span class="line">            Iterable&lt;Result&lt;Item&gt;&gt; results = minioClient.listObjects(</span><br><span class="line">                    ListObjectsArgs.builder()</span><br><span class="line">                            .bucket(bucketName)</span><br><span class="line">                            .recursive(<span class="literal">true</span>)  <span class="comment">// é€’å½’åˆ—å‡ºæ‰€æœ‰å­ç›®å½•</span></span><br><span class="line">                            .build());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. éå†å¹¶æ£€æŸ¥æ ‡ç­¾</span></span><br><span class="line">            <span class="keyword">for</span> (Result&lt;Item&gt; result : results) &#123;</span><br><span class="line">                <span class="type">Item</span> <span class="variable">item</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    item = result.get();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> item.objectName();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// è·å–å¯¹è±¡æ ‡ç­¾</span></span><br><span class="line">                    <span class="type">Tags</span> <span class="variable">tags</span> <span class="operator">=</span> minioClient.getObjectTags(</span><br><span class="line">                            GetObjectTagsArgs.builder()</span><br><span class="line">                                    .bucket(bucketName)</span><br><span class="line">                                    .object(objectName)</span><br><span class="line">                                    .build());</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æ£€æŸ¥æ˜¯å¦åŒ…å«ç›®æ ‡æ ‡ç­¾</span></span><br><span class="line">                    <span class="keyword">if</span> (tags != <span class="literal">null</span> &amp;&amp; tags.get().containsKey(key)) &#123;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> baseUrl + <span class="string">&quot;/&quot;</span> + bucketName + <span class="string">&quot;/&quot;</span> + objectName;</span><br><span class="line">                        urls.add(url);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.warn(<span class="string">&quot;å¤„ç†å¯¹è±¡ &#123;&#125; æ—¶å‡ºé”™: &#123;&#125;&quot;</span>, item.objectName(), e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è·å–å¸¦ &#123;&#125; æ ‡ç­¾çš„å¯¹è±¡åˆ—è¡¨å¤±è´¥&quot;</span>, key, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æŸ¥è¯¢å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> urls;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObject</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> getMinioClient();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> getObjectPath(url);</span><br><span class="line">            minioClient.removeObject(</span><br><span class="line">                    RemoveObjectArgs.builder()</span><br><span class="line">                            .bucket(bucketName)</span><br><span class="line">                            .object(objectName)</span><br><span class="line">                            .build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;åˆ é™¤å¯¹è±¡ &#123;&#125; å¤±è´¥&quot;</span>, url, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åˆ é™¤å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯¹è±¡æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] getObjectByte(String url) &#123;</span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> getMinioClient();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> getObjectPath(url);</span><br><span class="line">            <span class="type">GetObjectArgs</span> <span class="variable">args</span> <span class="operator">=</span> GetObjectArgs.builder()</span><br><span class="line">                    .bucket(bucketName)</span><br><span class="line">                    .object(objectName)</span><br><span class="line">                    .build();</span><br><span class="line">            <span class="keyword">try</span> (<span class="type">GetObjectResponse</span> <span class="variable">response</span> <span class="operator">=</span> minioClient.getObject(args)) &#123;</span><br><span class="line">                <span class="keyword">return</span> response.readAllBytes();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è·å–å¯¹è±¡ &#123;&#125; å¤±è´¥&quot;</span>, url, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è·å–å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯¹è±¡æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getObjectString</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> getMinioClient();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> getObjectPath(url);</span><br><span class="line">            <span class="type">GetObjectArgs</span> <span class="variable">args</span> <span class="operator">=</span> GetObjectArgs.builder()</span><br><span class="line">                    .bucket(bucketName)</span><br><span class="line">                    .object(objectName)</span><br><span class="line">                    .build();</span><br><span class="line">            <span class="keyword">try</span> (<span class="type">GetObjectResponse</span> <span class="variable">response</span> <span class="operator">=</span> minioClient.getObject(args)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(response.readAllBytes(), StandardCharsets.UTF_8);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è·å–å¯¹è±¡ &#123;&#125; å¤±è´¥&quot;</span>, url, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è·å–å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›¿æ¢æ–‡ä»¶ä¸­æ‰€æœ‰éæœ¬ç«™å›¾ç‰‡åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> MultipartFile <span class="title function_">replaceUrl</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!file.getOriginalFilename().endsWith(<span class="string">&quot;.md&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> file;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">modifiedContent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(file.getBytes(), StandardCharsets.UTF_8);</span><br><span class="line"></span><br><span class="line">            List&lt;String&gt; urls = ByteUtil.getUrls(file.getBytes());</span><br><span class="line">            <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!isLocalImage(url)) &#123;</span><br><span class="line">                        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> HttpUtil.getInputStream(url);</span><br><span class="line">                        <span class="type">MinioUploadDto</span> <span class="variable">build</span> <span class="operator">=</span> MinioUploadDto.builder().build();</span><br><span class="line">                        build.setFile(inputStream, getUrlOriginalFilename(url));</span><br><span class="line">                        build.setPath(String.format(FilePath.ARTICLE_IMAGE_PATH,</span><br><span class="line">                                SecurityContextHolder.getUserAccount().getId()));</span><br><span class="line">                        <span class="type">String</span> <span class="variable">newUrl</span> <span class="operator">=</span> upload(build);</span><br><span class="line">                        log.info(<span class="string">&quot;æ›¿æ¢å›¾ç‰‡åœ°å€ï¼š&#123;&#125;-&gt;&#123;&#125;&quot;</span>, url, newUrl);</span><br><span class="line">                        modifiedContent = modifiedContent.replace(url, newUrl);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.warn(<span class="string">&quot;è·å–å›¾ç‰‡ &#123;&#125; å¤±è´¥&quot;</span>, url, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">byte</span>[] newBytes = modifiedContent.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomMultipartFile</span>(</span><br><span class="line">                    file.getName(),</span><br><span class="line">                    file.getOriginalFilename(),</span><br><span class="line">                    file.getContentType(),</span><br><span class="line">                    newBytes</span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å¤„ç†æ–‡ä»¶å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUrlByObjectPath</span><span class="params">(String objectPath)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> String.join(<span class="string">&quot;/&quot;</span>, baseUrl,bucketName, objectPath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Helper class to create a new MultipartFile</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CustomMultipartFile</span> <span class="keyword">implements</span> <span class="title class_">MultipartFile</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String originalFilename;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String contentType;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">byte</span>[] content;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">CustomMultipartFile</span><span class="params">(String name, String originalFilename, String contentType, <span class="type">byte</span>[] content)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.originalFilename = originalFilename;</span><br><span class="line">            <span class="built_in">this</span>.contentType = contentType;</span><br><span class="line">            <span class="built_in">this</span>.content = content;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123; <span class="keyword">return</span> name; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getOriginalFilename</span><span class="params">()</span> &#123; <span class="keyword">return</span> originalFilename; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getContentType</span><span class="params">()</span> &#123; <span class="keyword">return</span> contentType; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123; <span class="keyword">return</span> content == <span class="literal">null</span> || content.length == <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getSize</span><span class="params">()</span> &#123; <span class="keyword">return</span> content.length; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span>[] getBytes() &#123; <span class="keyword">return</span> content; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> InputStream <span class="title function_">getInputStream</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(content); &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transferTo</span><span class="params">(File dest)</span> <span class="keyword">throws</span> IOException, IllegalStateException &#123;</span><br><span class="line">            Files.write(dest.toPath(), content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­æ˜¯å¦ä¸ºæœ¬ç«™å›¾ç‰‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLocalImage</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">domain</span> <span class="operator">=</span> StringUtil.getDomain(url);</span><br><span class="line">        <span class="keyword">return</span> domain.equals(baseUrl);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–urlä¸­æ–‡ä»¶æ–‡ä»¶ååŒ…æ‹¬åç¼€</span></span><br><span class="line"><span class="comment">     * https://server.blog.zorange.online/files/2d1407371ac5449c993b53caeabdcb65.md</span></span><br><span class="line"><span class="comment">     * return 2d1407371ac5449c993b53caeabdcb65.md</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUrlOriginalFilename</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> url.substring(url.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Mysql é«˜çº§</title>
    <url>/2025/09/15/Mysql%20%E9%AB%98%E7%BA%A7/</url>
    <content><![CDATA[<h1>Mysql é«˜çº§</h1>
<h2 id="é…ç½®">é…ç½®</h2>
<ul>
<li><strong>é…ç½®æ–‡ä»¶è·¯å¾„</strong><br>
<code>/etc/mysql/conf.d</code></li>
<li>ä»¥<code>.cnf</code>ç»“å°¾çš„å¯ä»¥è¢«mysqlåŠ è½½</li>
<li><strong>é…ç½®æ–‡ä»¶èŠ‚ç‚¹</strong><br>
åœ¨é…ç½®æ–‡ä»¶ä¸­,é…ç½®é¡¹å†™åœ¨<code>[mysqld]</code>æˆ–<code>[mysql]</code>ä¸‹,åˆ†åˆ«ä»£è¡¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯é…ç½®</li>
</ul>
<h3 id="å­—ç¬¦é›†">å­—ç¬¦é›†</h3>
<p>MySQL 8ç‰ˆæœ¬ä¹‹å‰ï¼Œé»˜è®¤å­—ç¬¦é›†ä¸º latin1ï¼ˆISO-8859-1ï¼‰ ï¼Œä¸æ”¯æŒä¸­æ–‡ï¼Œä½¿ç”¨å‰å¿…é¡»è®¾ç½®å­—ç¬¦é›†ä¸ºutf8ï¼ˆutf8mb3ï¼‰æˆ–utf8mb4ã€‚ä»MySQL 8å¼€å§‹ï¼Œæ•°æ®åº“çš„é»˜è®¤å­—ç¬¦é›†ä¸º utf8mb4 ï¼Œä»è€Œé¿å…ä¸­æ–‡ä¹±ç çš„é—®é¢˜ã€‚</p>
<p><code> SHOW VARIABLES LIKE '%char%'</code>;</p>
<p>utf8ä¸utf8mb4</p>
<figure class="highlight plaintext"><figcaption><span>å­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦éœ€è¦ä½¿ç”¨1ï½4ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›å­—ç¬¦ä½¿ç”¨1ï½3ä¸ªå­—èŠ‚å°±å¯ä»¥è¡¨ç¤ºäº†ã€‚è€Œå­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æ‰€ç”¨çš„æœ€å¤§å­—èŠ‚é•¿åº¦ï¼Œåœ¨æŸäº›æ–¹é¢ä¼šå½±å“ç³»ç»Ÿçš„å­˜å‚¨å’Œæ€§èƒ½ï¼Œæ‰€ä»¥è®¾è®¡MySQLçš„è®¾è®¡è€…å·å·çš„å®šä¹‰äº†ä¸¤ä¸ªæ¦‚å¿µï¼š</span></figcaption><table><tr><td class="code"><pre><span class="line">utf8mb3 ï¼šé˜‰å‰²è¿‡çš„ utf8 å­—ç¬¦é›†ï¼Œåªä½¿ç”¨1ï½3ä¸ªå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ã€‚ï¼ˆæ— æ³•å­˜å‚¨emojiè¡¨æƒ…ï¼‰</span><br><span class="line">MySQL5.7ä¸­çš„utf8æ˜¯utf8mb3å­—ç¬¦é›†</span><br><span class="line">utf8mb4 ï¼šæ­£å®—çš„ utf8 å­—ç¬¦é›†ï¼Œä½¿ç”¨1ï½4ä¸ªå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ã€‚</span><br><span class="line">MySQL8.0ä¸­çš„utf8æ˜¯utf8mb4å­—ç¬¦é›†</span><br></pre></td></tr></table></figure>
<h3 id="å¤§å°å†™">å¤§å°å†™</h3>
<ul>
<li><strong>Windowsç¯å¢ƒï¼š</strong></li>
</ul>
<p>å…¨éƒ¨ä¸åŒºåˆ†å¤§å°å†™</p>
<ul>
<li><strong>Linuxç¯å¢ƒï¼š</strong></li>
</ul>
<p>1ã€æ•°æ®åº“åã€è¡¨åã€è¡¨çš„åˆ«åã€å˜é‡åä¸¥æ ¼åŒºåˆ†å¤§å°å†™ï¼›</p>
<p>2ã€åˆ—åä¸åˆ—çš„åˆ«åä¸åŒºåˆ†å¤§å°å†™ã€‚</p>
<p>3ã€å…³é”®å­—ã€å‡½æ•°åç§°ä¸åŒºåˆ†å¤§å°å†™ï¼›</p>
<ul>
<li><strong>è®¾ç½®linuxä¸åŒºåˆ†å¤§å°å†™</strong></li>
</ul>
<ol>
<li>åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®<br>
<code>lower_case_table_names=1 </code></li>
<li>Dockerå®¹å™¨</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 3309:3306 \</span><br><span class="line">-v /atguigu/mysql/mysql8/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /atguigu/mysql/mysql8/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">--name atguigu-mysql8 \</span><br><span class="line">--restart=always \</span><br><span class="line">mysql:8.0.29 --lower-case-table-names=1</span><br></pre></td></tr></table></figure>
<h3 id="sql-mode">sql_mode</h3>
<ul>
<li>
<p><strong>å®½æ¾æ¨¡å¼ï¼š</strong><br>
æ‰§è¡Œé”™è¯¯çš„SQLæˆ–æ’å…¥ä¸è§„èŒƒçš„æ•°æ®ï¼Œä¹Ÿä¼šè¢«æ¥å—ï¼Œå¹¶ä¸”ä¸æŠ¥é”™ã€‚</p>
</li>
<li>
<p><strong>ä¸¥æ ¼æ¨¡å¼ï¼š</strong><br>
æ‰§è¡Œé”™è¯¯çš„SQLæˆ–æ’å…¥ä¸è§„èŒƒçš„æ•°æ®ï¼Œä¼šæŠ¥é”™ã€‚MySQL5.7ç‰ˆæœ¬å¼€å§‹å°±å°†sql_modeé»˜è®¤å€¼è®¾ç½®ä¸ºäº†ä¸¥æ ¼æ¨¡å¼ã€‚</p>
</li>
<li>
<p><strong>æŸ¥çœ‹å’Œè®¾ç½®sql_mode</strong></p>
<ul>
<li>
<p><strong>æŸ¥è¯¢</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@session</span>.sql_mode; </span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.sql_mode; </span><br><span class="line"><span class="comment">-- æˆ–è€… </span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;sql_mode&#x27;</span>; <span class="comment">--sessionçº§åˆ«</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>ä¿®æ”¹</strong></p>
<ol>
<li>ä¸´æ—¶ä¿®æ”¹</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> sql_mode <span class="operator">=</span> <span class="string">&#x27;mode1,model2,...&#x27;</span>; <span class="comment">--å…¨å±€ï¼Œè¦é‡æ–°å¯åŠ¨å®¢æˆ·ç«¯ç”Ÿæ•ˆï¼Œé‡å¯MySQLæœåŠ¡åå¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">SET</span> SESSION sql_mode <span class="operator">=</span> <span class="string">&#x27;mode1,model2,...&#x27;</span>; <span class="comment">--å½“å‰ä¼šè¯ç”Ÿæ•ˆæ•ˆï¼Œå…³é—­å½“å‰ä¼šè¯å°±ä¸ç”Ÿæ•ˆäº†ã€‚å¯ä»¥çœç•¥SESSIONå…³é”®å­—</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>é…ç½®æ–‡ä»¶ä¿®æ”¹</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="keyword">sql</span><span class="operator">-</span>mode <span class="operator">=</span> &quot;mode1,model2,...&quot;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>sql_modeå¸¸ç”¨å€¼</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>ã€STRICT_TRANS_TABLESï¼šå¯ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œè¦æ±‚æ’å…¥æˆ–æ›´æ–°æ“ä½œä¸­çš„æ•°æ®ç±»å‹å¿…é¡»ä¸è¡¨å®šä¹‰çš„æ•°æ®ç±»å‹å®Œå…¨åŒ¹é…ï¼Œå¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚</span><br><span class="line"><span class="number">2</span>ã€NO_ZERO_IN_DATEï¼šç¦æ­¢åœ¨æ—¥æœŸä¸­çš„æœˆä»½å’Œæ—¥å­—æ®µä½¿ç”¨é›¶å€¼ï¼Œä½†<span class="string">&#x27;0000-00-00&#x27;</span>æ˜¯ä¾‹å¤–ï¼Œå¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚</span><br><span class="line"><span class="number">3</span>ã€NO_ZERO_DATEï¼šç¦æ­¢åœ¨æ—¥æœŸä¸­çš„å¹´ã€æœˆã€æ—¥å­—æ®µä½¿ç”¨é›¶å€¼ï¼Œä¾‹å¦‚<span class="string">&#x27;0000-00-00&#x27;</span>æˆ–<span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>ï¼Œå¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚</span><br><span class="line"><span class="number">4</span>ã€ERROR_FOR_DIVISION_BY_ZEROï¼šå½“é™¤æ•°ä¸ºé›¶æ—¶ï¼Œæ‰§è¡Œé™¤æ³•è¿ç®—ä¼šæŠ›å‡ºé”™è¯¯ã€‚</span><br><span class="line"><span class="number">5</span>ã€ONLY_FULL_GROUP_BYï¼šè¦æ±‚<span class="keyword">GROUP</span> <span class="keyword">BY</span>å­å¥ä¸­çš„åˆ—å¿…é¡»å‡ºç°åœ¨<span class="keyword">SELECT</span>åˆ—è¡¨ä¸­ï¼Œæˆ–è€…æ˜¯èšåˆå‡½æ•°çš„å‚æ•°ï¼Œå¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚</span><br><span class="line"><span class="number">6</span>ã€ANSI_QUOTESï¼šå¯ç”¨ANSI_QUOTESæ¨¡å¼ï¼Œè¦æ±‚ä½¿ç”¨åŒå¼•å·æ¥å¼•ç”¨å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å•å¼•å·ã€‚</span><br><span class="line">é™¤äº†ä¸Šè¿°å¸¸è§çš„sql_modeå€¼ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›é€‰é¡¹å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®ã€‚</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="é€»è¾‘æ¶æ„-é¢è¯•">é€»è¾‘æ¶æ„[é¢è¯•]</h2>
<p><img src="http://120.26.79.238:9000/blog/img/06e13c61c21738a780a701689e2c142b.png" alt=""></p>
<ul>
<li>
<p><strong>mysqlå®¢æˆ·ç«¯</strong></p>
</li>
<li>
<p><strong>mysqlæœåŠ¡å™¨ç«¯</strong></p>
<ul>
<li>
<p><strong>connectionè¿æ¥å±‚</strong>------------------&gt;ç”¨æˆ·èº«ä»½çš„è®¤è¯å’Œæˆæƒâ€”ç»´æŠ¤<code>Connnection</code>è¿æ¥æ± </p>
<ul>
<li>è®¤è¯</li>
<li>connectionè¿æ¥æ± </li>
</ul>
</li>
<li>
<p><strong>ServiceæœåŠ¡å±‚</strong></p>
<ul>
<li>
<p>æŸ¥è¯¢ç¼“å­˜(query_cache)</p>
<p>ç¼“å­˜selectæŸ¥è¯¢è¯­å¥å’Œç»“æœ</p>
</li>
<li>
<p>è§£æå™¨(parser)</p>
<p>è´Ÿè´£å¯¹sqlè¿›è¡Œè¯æ³•å’Œè¯­æ³•è§£æ</p>
<p>è¯æ³•è§£æï¼šæ£€æŸ¥sglè¯­å¥ä¸­çš„å…³é”®å­—æ˜¯å¦æ­£ç¡®</p>
<p>è¯­æ³•è§£æï¼šæŠŠæ‰‹å†™çš„SQLè½¬æ¢æœºè¯»SQLï¼Œå¹¶ç”ŸæˆSQLæ‰§è¡Œæ ‘</p>
</li>
<li>
<p>é¢„å¤„ç†å™¨(preprocessor)</p>
<p>è´Ÿè´£è¯­ä¹‰è§£æï¼Œå¹¶æ ¡éªŒæƒé™ï¼Œç”Ÿæˆæ–°çš„SQLçš„æ‰§è¡Œæ ‘</p>
</li>
<li>
<p>ä¼˜åŒ–å™¨(Optimize)</p>
<p>åœ¨ä¸æ”¹å˜æŸ¥è¯¢ç»“æœçš„å‰æä¸‹ï¼Œå¯¹SQLè¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œ<br>
æ¯”å¦‚ï¼šç”ŸæˆSQLæ‰§è¡Œè®¡åˆ’ï¼Œé€‰æ‹©åˆé€‚çš„ç´¢å¼•ï¼Œé€‰æ‹©åˆé€‚çš„é©±åŠ¨è¡¨,å°†å­æŸ¥è¯¢è½¬åŒ–ä¸ºè¿è¡¨æŸ¥è¯¢,  é€‰æ‹©å¼€é”€æœ€å°çš„è·¯å¾„,  æœ€ç»ˆç”Ÿæˆsqlæ‰§è¡Œè®¡åˆ’.</p>
</li>
</ul>
</li>
<li>
<p><strong>Pluggable Storage Engineå¼•æ“å±‚</strong></p>
<p>å¼•æ“:	<code>Innodb</code>	<code>MyISAM	</code>	<code>MEMORY	</code>	<code>BlackHole</code></p>
<p>å¯æ’æ‹”å¼•æ“å±‚</p>
<p>åŠŸèƒ½:	è´Ÿè´£æ•°æ®çš„å…·ä½“æŸ¥æ‰¾ï¼Œä»¥åŠæ•°æ®åœ¨ç£ç›˜å’Œå†…å­˜ä¹‹é—´çš„äº¤äº’</p>
</li>
<li>
<p><strong>å­˜å‚¨å±‚</strong></p>
<p>åŠŸèƒ½:	è´Ÿè´£æ•°æ®åœ¨ç£ç›˜çš„ç»„ç»‡å½¢å¼</p>
<p>æ—¥å¿—ä¿¡æ¯:	<code>redolog</code>ã€<code>unolog</code>ã€<code>binarylog</code>ã€<code>slowlog</code></p>
</li>
</ul>
</li>
</ul>
<h3 id="æŸ¥è¯¢çš„æ‰§è¡Œæµç¨‹">æŸ¥è¯¢çš„æ‰§è¡Œæµç¨‹</h3>
<p><img src="http://120.26.79.238:9000/blog/img/fcd2df398cac24c7f59718c618d10129.png" alt=""></p>
<h3 id="æŸ¥çœ‹sqlæ‰§è¡Œæµç¨‹-profiling">æŸ¥çœ‹sqlæ‰§è¡Œæµç¨‹ profiling</h3>
<ul>
<li>
<p>profiling</p>
</li>
<li>
<p>æŸ¥çœ‹æ˜¯å¦å¼€å¯</p>
<ul>
<li><code>SHOW VARIABLES LIKE '%profiling%';</code></li>
</ul>
</li>
<li>
<p>å¼€å¯profiling</p>
<ul>
<li><code>SET profiling = 1;  -- profiling = ON</code></li>
<li><code> profiling = ON</code>     é…ç½®æ–‡ä»¶</li>
</ul>
</li>
<li>
<p>æŸ¥è¯¢</p>
<ul>
<li>
<p>æ˜¾ç¤ºæœ€è¿‘çš„å‡ æ¬¡æŸ¥è¯¢ï¼š<code>SHOW PROFILES;</code></p>
</li>
<li>
<p>æŸ¥çœ‹æœ€åä¸€ä¸ªSQLçš„æ‰§è¡Œæµç¨‹ï¼š<code>SHOW PROFILE;</code></p>
</li>
<li>
<p>æŸ¥çœ‹æŒ‡å®šSQLçš„æ‰§è¡Œæµç¨‹ï¼šæŸ¥è¯¢æŒ‡å®šçš„ Query ID:    <code>SHOW PROFILE FOR QUERY 3;</code></p>
</li>
<li>
<p>æŸ¥è¯¢æ›´ä¸°å¯Œçš„å†…å®¹:  <code> SHOW PROFILE cpu,block io FOR QUERY 3;</code></p>
<ul>
<li>
<p>å‚æ•°</p>
<ul>
<li>
<p><code>ALLï¼š</code>æ˜¾ç¤ºæ‰€æœ‰çš„å¼€é”€ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><code>BLOCK IO</code>ï¼šæ˜¾ç¤ºå—IOå¼€é”€ã€‚</p>
</li>
<li>
<p><code>CONTEXT SWITCHES</code>ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚</p>
</li>
<li>
<p><code>CPU</code>ï¼šæ˜¾ç¤ºCPUå¼€é”€ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><code>IPC</code>ï¼šæ˜¾ç¤ºå‘é€å’Œæ¥æ”¶å¼€é”€ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><code>MEMORY</code>ï¼šæ˜¾ç¤ºå†…å­˜å¼€é”€ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><code>PAGE FAULTS</code>ï¼šæ˜¾ç¤ºé¡µé¢é”™è¯¯å¼€é”€ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><code>SOURCE</code>ï¼šæ˜¾ç¤ºå’ŒSource_functionï¼ŒSource_fileï¼ŒSource_lineç›¸å…³çš„å¼€é”€ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><code>SWAPS</code>ï¼šæ˜¾ç¤ºäº¤æ¢æ¬¡æ•°å¼€é”€ä¿¡æ¯ã€‚</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="å­˜å‚¨å¼•æ“">å­˜å‚¨å¼•æ“</h2>
<h3 id="æŸ¥çœ‹ä¸è®¾ç½®å¼•æ“">æŸ¥çœ‹ä¸è®¾ç½®å¼•æ“</h3>
<ul>
<li>
<p>æŸ¥çœ‹å­˜å‚¨å¼•æ“:	<code>show engines</code></p>
<p>mysql é»˜è®¤å­˜å‚¨å¼•æ“:	<code>innoDB</code></p>
<p>æŸ¥çœ‹æ¯ä¸ªè¡¨çš„å­˜å‚¨å¼•æ“: <code>show table status from åº“å;</code></p>
</li>
<li>
<p>æŸ¥çœ‹é»˜è®¤çš„å­˜å‚¨å¼•æ“:  <code>SHOW VARIABLES LIKE '%default_storage_engine%';</code></p>
</li>
<li>
<p>è®¾ç½®å­˜å‚¨å¼•æ“</p>
<ul>
<li>
<p>è®¾ç½®é»˜è®¤å­˜å‚¨å¼•æ“: 	<code>SET DEFAULT_STORAGE_ENGINE=MyISAM;</code> 	æˆ–é…ç½®æ–‡ä»¶:	<code>default-storage-engine=MyISAM</code></p>
</li>
<li>
<p>ä¸ºè¡¨è®¾ç½®ä¸åŒçš„å­˜å‚¨å¼•æ“:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> è¡¨å( å»ºè¡¨è¯­å¥ ) ENGINE <span class="operator">=</span> å­˜å‚¨å¼•æ“åç§°;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å ENGINE <span class="operator">=</span> å­˜å‚¨å¼•æ“åç§°;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student(id <span class="type">INT</span>, `name` <span class="type">VARCHAR</span>(<span class="number">16</span>),age <span class="type">INT</span>,dept <span class="type">INT</span>) ENGINE <span class="operator">=</span> MyISAM;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="å­˜å‚¨å¼•æ“ä»‹ç»">å­˜å‚¨å¼•æ“ä»‹ç»</h3>
<p><code>1. InnoDBå­˜å‚¨å¼•æ“</code></p>
<ul>
<li>
<p>InnoDBæ˜¯MySQLçš„é»˜è®¤äº‹åŠ¡å‹å¼•æ“ï¼Œå®ƒè¢«è®¾è®¡ç”¨æ¥<code>å¤„ç†å¤§é‡çš„çŸ­æœŸ(short-lived)äº‹åŠ¡</code>ã€‚å¯ä»¥ç¡®ä¿äº‹åŠ¡çš„å®Œæ•´æäº¤(Commit)å’Œå›æ»š(Rollback)ã€‚</p>
</li>
<li>
<p>é™¤éæœ‰éå¸¸ç‰¹åˆ«çš„åŸå› éœ€è¦ä½¿ç”¨å…¶ä»–çš„å­˜å‚¨å¼•æ“ï¼Œå¦åˆ™<code>åº”è¯¥ä¼˜å…ˆè€ƒè™‘InnoDBå¼•æ“</code>ã€‚</p>
</li>
<li>
<p>InnoDBä¸ä»…ç¼“å­˜ç´¢å¼•è¿˜è¦ç¼“å­˜çœŸå®æ•°æ®ï¼Œ å¯¹å†…å­˜è¦æ±‚è¾ƒ é«˜ ï¼Œè€Œä¸”å†…å­˜å¤§å°å¯¹æ€§èƒ½æœ‰å†³å®šæ€§çš„å½±å“ã€‚</p>
</li>
</ul>
<p><code>2. MyISAMå­˜å‚¨å¼•æ“</code></p>
<ul>
<li>
<p>MyISAMæä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ï¼Œä½†<code>MyISAMä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”</code>ï¼Œæœ‰ä¸€ä¸ªæ¯«æ— ç–‘é—®çš„ç¼ºé™·å°±æ˜¯å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ã€‚</p>
</li>
<li>
<p>ä¼˜åŠ¿æ˜¯è®¿é—®çš„ é€Ÿåº¦å¿« ï¼Œå¯¹äº‹åŠ¡å®Œæ•´æ€§æ²¡æœ‰è¦æ±‚æˆ–è€…ä»¥SELECTã€INSERTä¸ºä¸»çš„åº”ç”¨ã€‚</p>
</li>
<li>
<p>MyISAMåªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ®ã€‚</p>
</li>
</ul>
<p><code>3. Archiveå¼•æ“</code></p>
<ul>
<li><code>Archiveæ¡£æ¡ˆå­˜å‚¨å¼•æ“åªæ”¯æŒINSERTå’ŒSELECTæ“ä½œ</code>ã€‚</li>
<li>Archiveè¡¨é€‚åˆæ—¥å¿—å’Œæ•°æ®é‡‡é›†ï¼ˆæ¡£æ¡ˆï¼‰ç±»åº”ç”¨ã€‚</li>
<li>æ ¹æ®è‹±æ–‡çš„æµ‹è¯•ç»“è®ºæ¥çœ‹ï¼ŒArchiveè¡¨æ¯”MyISAMè¡¨è¦å°å¤§çº¦75%ï¼Œæ¯”æ”¯æŒäº‹åŠ¡å¤„ç†çš„InnoDBè¡¨å°å¤§çº¦83%ã€‚</li>
</ul>
<p><code>4. Blackholeå¼•æ“ï¼ˆé»‘æ´ï¼‰</code></p>
<ul>
<li><code>Blackholeå¼•æ“æ²¡æœ‰å®ç°ä»»ä½•å­˜å‚¨æœºåˆ¶ï¼Œå®ƒä¼šä¸¢å¼ƒæ‰€æœ‰æ’å…¥çš„æ•°æ®ï¼Œä¸åšä»»ä½•ä¿å­˜</code>ã€‚</li>
<li>ä½†æœåŠ¡å™¨ä¼šè®°å½•Blackholeè¡¨çš„æ—¥å¿—ï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºå¤åˆ¶æ•°æ®åˆ°å¤‡åº“ï¼Œæˆ–è€…ç®€å•åœ°è®°å½•åˆ°æ—¥å¿—ã€‚ä½†è¿™ç§åº”ç”¨æ–¹å¼ä¼šç¢°åˆ°å¾ˆå¤šé—®é¢˜ï¼Œå› æ­¤å¹¶ä¸æ¨èã€‚</li>
</ul>
<p><code>5. CSVå¼•æ“</code></p>
<ul>
<li><code>CSVå¼•æ“å¯ä»¥å°†æ™®é€šçš„CSVæ–‡ä»¶ä½œä¸ºMySQLçš„è¡¨æ¥å¤„ç†ï¼Œä½†ä¸æ”¯æŒç´¢å¼•</code>ã€‚</li>
<li>CSVå¼•æ“å¯ä»¥ä½œä¸ºä¸€ç§æ•°æ®äº¤æ¢çš„æœºåˆ¶ï¼Œéå¸¸æœ‰ç”¨ã€‚</li>
<li>CSVå­˜å‚¨çš„æ•°æ®ç›´æ¥å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿé‡Œï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæˆ–è€…excelè¯»å–ã€‚</li>
</ul>
<p><code>6. Memoryå¼•æ“</code></p>
<ul>
<li>å¦‚æœéœ€è¦å¿«é€Ÿåœ°è®¿é—®æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®ä¸ä¼šè¢«ä¿®æ”¹ï¼Œé‡å¯ä»¥åä¸¢å¤±ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œé‚£ä¹ˆä½¿ç”¨Memoryè¡¨æ˜¯éå¸¸æœ‰ç”¨ã€‚</li>
<li>Memoryè¡¨è‡³å°‘æ¯”MyISAMè¡¨è¦å¿«ä¸€ä¸ªæ•°é‡çº§ã€‚</li>
</ul>
<p><code>7. Federatedå¼•æ“</code></p>
<ul>
<li><code>Federatedå¼•æ“æ˜¯è®¿é—®å…¶ä»–MySQLæœåŠ¡å™¨çš„ä¸€ä¸ªä»£ç†ï¼ˆè·¨åº“å…³è”æŸ¥è¯¢ï¼‰</code>ï¼Œå°½ç®¡è¯¥å¼•æ“çœ‹èµ·æ¥æä¾›äº†ä¸€ç§å¾ˆå¥½çš„è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿç»å¸¸å¸¦æ¥é—®é¢˜ï¼Œå› æ­¤é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚</li>
</ul>
<h3 id="MyISAMå’ŒInnoDBçš„åŒºåˆ«-å¸¸è§é¢è¯•é¢˜">MyISAMå’ŒInnoDBçš„åŒºåˆ«[å¸¸è§é¢è¯•é¢˜]</h3>
<table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th>InnoDB</th>
<th>MyISAM</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ˜¯å¦æ”¯æŒäº‹åŠ¡</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡(XAåè®®)</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒè¡Œé”</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒè¡¨é”</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒå¤–é”®</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>å¢åˆ æ”¹çš„æ€§èƒ½</td>
<td>é«˜</td>
<td>ä½</td>
</tr>
<tr>
<td>è¯»çš„æ€§èƒ½</td>
<td>ä½</td>
<td>é«˜</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>ä¸»æœº(å†™)</td>
<td>ä»æœº(è¯»)</td>
</tr>
<tr>
<td>æ˜¯å¦èšç°‡ç´¢å¼•</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒMVCC</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>æ•°æ®åœ¨ç£ç›˜çš„ç»„ç»‡å½¢å¼</td>
<td>.ibd (indexã€dataã€è¡¨ç»“æ„)</td>
<td>.MYI(ç´¢å¼•)ã€.MYD(æ•°æ®)ã€.sdiï¼ˆè¡¨ç»“æ„ï¼‰</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>æ¯å¼ è¡¨å¯¹åº”ä¸€ä¸ªæ•°æ®åº“å¼•æ“ã€‚</span><br><span class="line">  <span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">from</span> åº“å;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">create</span> <span class="keyword">table</span> è¡¨å(..) engine<span class="operator">=</span>å­˜å‚¨å¼•æ“å;</span><br><span class="line">  <span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å engine<span class="operator">=</span>å­˜å‚¨å¼•æ“å;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">show</span> engines;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>å¦‚ä½•æŸ¥çœ‹æŸå¼ è¡¨çš„æ•°æ®åº“å¼•æ“ï¼Ÿ</span><br><span class="line">   <span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">from</span> æ•°æ®åº“å;</span><br><span class="line">   </span><br><span class="line"><span class="number">3.</span>å¦‚ä½•ä¿®æ”¹ä¸€å¼ è¡¨å¯¹åº”çš„æ•°æ®åº“å¼•æ“</span><br><span class="line">  <span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å  engine<span class="operator">=</span> <span class="string">&#x27;æ•°æ®åº“å¼•æ“&#x27;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="number">4.</span>å¦‚ä½•æŸ¥çœ‹æ•°æ®åº“åŠè¡¨å­˜åœ¨ç£ç›˜çš„å“ªä¸ªç›®å½•ï¼Ÿ</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="è¿è¡¨">è¿è¡¨</h2>
<ul>
<li>
<p>æ¨ªè¡Œè¿æ¥</p>
<ul>
<li><code>join</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> è¡¨<span class="number">1</span></span><br><span class="line"><span class="keyword">left</span><span class="operator">|</span><span class="keyword">right</span><span class="operator">|</span><span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line"><span class="keyword">on</span> æ¡ä»¶</span><br><span class="line"><span class="keyword">where</span> è¿‡æ»¤æ¡ä»¶</span><br></pre></td></tr></table></figure>
<ul>
<li><code>from</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="keyword">from</span> è¡¨<span class="number">1</span>,è¡¨<span class="number">2</span></span><br><span class="line"><span class="keyword">where</span> è¿æ¥æ¡ä»¶</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>çºµå‘è¿æ¥:</p>
<p>è¦æ±‚:	å±æ€§ä¸ªæ•°ä¸€è‡´,ç±»å‹ä¸€è‡´</p>
<ul>
<li>
<p><strong><code>UNION</code></strong>ï¼šå»é™¤é‡å¤çš„è®°å½•åå†åˆå¹¶ç»“æœã€‚</p>
</li>
<li>
<p><strong><code>UNION ALL</code></strong>ï¼šä¿ç•™æ‰€æœ‰è®°å½•ï¼ŒåŒ…æ‹¬é‡å¤çš„ã€‚</p>
</li>
</ul>
</li>
</ul>
<h2 id="MySQLç´¢å¼•ä»‹ç»">MySQLç´¢å¼•ä»‹ç»</h2>
<h3 id="ä»€ä¹ˆæ˜¯ç´¢å¼•">ä»€ä¹ˆæ˜¯ç´¢å¼•</h3>
<ul>
<li>æœ¬è´¨:	æ•°æ®ç»“æ„</li>
<li>ç†è§£: 	å¯¹æ¯è¡Œæ•°æ®å»ºç«‹ç´¢å¼•, ç»´æŠ¤ä¸€ä¸ªäºŒå‰æŸ¥æ‰¾æ ‘,æŸ¥æ‰¾æ•°æ®æ—¶æ ¹æ®ç´¢å¼•æŸ¥æ‰¾.</li>
<li>å­˜å‚¨:	ç£ç›˜ä¸­</li>
</ul>
<h3 id="ç´¢å¼•ä¼˜ç¼ºç‚¹">ç´¢å¼•ä¼˜ç¼ºç‚¹</h3>
<ul>
<li>ä¼˜ç‚¹:
<ul>
<li>æé«˜äº†æ£€ç´¢é€Ÿåº¦,é™ä½æ•°æ®åº“çš„IOæˆæœ¬</li>
<li>é€šè¿‡ç´¢å¼•å¯¹æ•°æ®è¿›è¡Œæ’åº, é™ä½äº†æ’åºæˆæœ¬,é™ä½äº†CPUçš„æ¶ˆè€—</li>
</ul>
</li>
<li>ç¼ºç‚¹:
<ul>
<li>åœ¨æ›´æ–°è¡¨æ—¶, è¿˜è¦æ›´æ–°ç´¢å¼•ä¿¡æ¯, é™ä½äº†æ›´æ–°é€Ÿåº¦,</li>
<li>ç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨,å ç”¨ä¸€å®šç©ºé—´</li>
</ul>
</li>
</ul>
<h3 id="ç´¢å¼•åˆ†ç±»">ç´¢å¼•åˆ†ç±»</h3>
<ul>
<li>ä»åŠŸèƒ½é€»è¾‘ä¸Šåˆ’åˆ†ï¼Œç´¢å¼•ä¸»è¦æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯<code>æ™®é€šç´¢å¼•</code>ã€<code>å”¯ä¸€ç´¢å¼•</code>ã€<code>ä¸»é”®ç´¢å¼•</code>ã€<code>å…¨æ–‡ç´¢å¼•</code>ã€‚</li>
<li>æŒ‰ç…§ä½œç”¨å­—æ®µä¸ªæ•°åˆ’åˆ†ï¼Œç´¢å¼•å¯ä»¥åˆ†ä¸º<code>å•åˆ—ç´¢å¼•</code>å’Œ<code>è”åˆç´¢å¼•</code>ã€‚</li>
<li>æŒ‰ç…§ç‰©ç†å®ç°æ–¹å¼åˆ’åˆ†ï¼Œç´¢å¼•å¯ä»¥åˆ†ä¸º2ç§ï¼Œåˆ†åˆ«æ˜¯<code>èšç°‡ç´¢å¼•</code>å’Œ<code>éèšç°‡ç´¢å¼•</code></li>
</ul>
<h3 id="Bæ ‘">Bæ ‘</h3>
<ul>
<li><code>B-Treeå³Bæ ‘ï¼ŒBalance Treeï¼Œå¹³è¡¡æ ‘,Bæ ‘å°±æ˜¯å…¸å‹çš„å¤šå‰æ ‘ï¼Œå®ƒçš„é«˜åº¦è¿œå°äºå¹³è¡¡äºŒå‰æ ‘çš„é«˜åº¦ï¼ˆå¤šè·¯å¹³è¡¡äºŒå‰æ ‘ï¼‰</code>ã€‚</li>
<li><code>Bæ ‘çš„é˜¶ï¼š</code>èŠ‚ç‚¹çš„æœ€å¤šå­èŠ‚ç‚¹ä¸ªæ•°ã€‚</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/b8e1bc0d38bda6a1ed246ef1734ac733.png" alt=""></p>
<h3 id="MySQLç´¢å¼•ç»“æ„-B-æ ‘">MySQLç´¢å¼•ç»“æ„ B+æ ‘</h3>
<ul>
<li>ç†è§£:
<ul>
<li>å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®é¡¹, æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸ºä¸€é¡µ</li>
<li>éå¶å­èŠ‚ç‚¹å­˜å‚¨ç›®å½•é¡µ:    ç›®å½•é¡¹çš„æœ€å¤§å€¼å’Œæœ€å°å€¼,   ç›®å½•é¡µä¹Ÿå¯ä»¥å­˜åœ¨ç›®å½•é¡µ,æ¯ä¸€é¡µå¤§å°é¡µä¸º16kb.</li>
<li>åŒä¸€å±‚ä¹‹é—´å­˜åœ¨äº’ç›¸ æŒ‡å‘çš„æŒ‡é’ˆ</li>
</ul>
</li>
<li>InooDBä¸€é¡µ:16kb</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/f86eb072b9b517624f45300da10e4a8b.png" alt=""></p>
<h3 id="Bæ ‘å’ŒB-æ ‘åŒºåˆ«">Bæ ‘å’ŒB+æ ‘åŒºåˆ«</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>Bæ ‘</th>
<th>B+æ ‘</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ•°æ®å­˜å‚¨</strong></td>
<td>æ•°æ®å­˜å‚¨åœ¨å†…éƒ¨èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹ä¸­</td>
<td>æ•°æ®ä»…å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹</td>
</tr>
<tr>
<td><strong>å¶å­èŠ‚ç‚¹é“¾æ¥</strong></td>
<td>å¶å­èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰é“¾è¡¨è¿æ¥</td>
<td>å¶å­èŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆå½¢æˆåŒå‘é“¾è¡¨é“¾è¡¨</td>
</tr>
<tr>
<td><strong>æŸ¥æ‰¾è·¯å¾„</strong></td>
<td>æŸ¥æ‰¾è·¯å¾„å¯ä»¥åœ¨å†…éƒ¨èŠ‚ç‚¹ç»“æŸ</td>
<td>æŸ¥æ‰¾å¿…é¡»åˆ°è¾¾å¶å­èŠ‚ç‚¹</td>
</tr>
<tr>
<td><strong>æ ‘çš„é«˜åº¦</strong></td>
<td>ç›¸å¯¹è¾ƒé«˜</td>
<td>ç›¸å¯¹è¾ƒä½</td>
</tr>
<tr>
<td><strong>èŒƒå›´æŸ¥è¯¢</strong></td>
<td>æ•ˆç‡è¾ƒä½</td>
<td>æ•ˆç‡è¾ƒé«˜ï¼Œé¡ºåºéå†æ–¹ä¾¿</td>
</tr>
<tr>
<td><strong>ç£ç›˜I/Oæ•ˆç‡</strong></td>
<td>è¾ƒä½ï¼Œå†…éƒ¨èŠ‚ç‚¹å­˜å‚¨æ•°æ®å’Œç´¢å¼•</td>
<td>è¾ƒé«˜ï¼Œå†…éƒ¨èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•ä¿¡æ¯</td>
</tr>
</tbody>
</table>
<h3 id="èšç°‡ç´¢å¼•">èšç°‡ç´¢å¼•</h3>
<ul>
<li>
<p>ä¹Ÿå«ä¸»é”®ç´¢å¼•</p>
</li>
<li>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB+æ ‘ä¸­.</li>
<li><code>é¡µå†…çš„è®°å½•</code>æ˜¯æŒ‰ç…§<code>ä¸»é”®</code>çš„å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<code>å•å‘é“¾è¡¨</code> ã€‚(é¡µå†…ç‰©ç†ä¸Šæ˜¯é¡ºåºæ’åˆ—çš„,åªæ˜¯é€»è¾‘ä¸Šçœ‹èµ·æ¥åƒé“¾è¡¨)</li>
<li>é¡µä¸é¡µä¹‹é—´ä¹Ÿæ˜¯é€šè¿‡ä¸»é”®(ç´¢å¼•)å¤§å°å½¢æˆåŒå‘é“¾è¡¨</li>
<li>éå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®(ç´¢å¼•)+é¡µå·</li>
<li>å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å®Œæ•´è®°å½•</li>
</ul>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>:</p>
<ul>
<li>å®Œæ•´æ•°æ®å’Œç´¢å¼•å­˜å‚¨åœ¨åŒä¸€ä¸ªB+æ ‘ä¸­,ä¸éœ€è¦å›è¡¨,æ¯”éèšç°‡ç´¢å¼•æŸ¥è¯¢å¿«</li>
<li>å¯¹äºä¸»é”®(èšç°‡ç´¢å¼•)çš„æ’åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾å¿«</li>
<li>æŒ‰ç…§èšç°‡ç´¢å¼•æŸ¥æ‰¾ä¸€å®šèŒƒå›´æ•°æ®æ—¶,ç”±äºæ•°æ®ä¹‹é—´å½¢æˆé“¾è¡¨,èŠ‚çœäº†IOæ“ä½œ,</li>
</ul>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>:</p>
<ul>
<li>
<p>ç”±äºæ’å…¥æ˜¯æŒ‰ç…§ä¸»é”®(ç´¢å¼•)è¿›è¡Œæ’å…¥,å¦‚æœä¸»é”®(ç´¢å¼•)ä¸æŒ‰ç…§é¡ºåºæ’å…¥æ—¶,ä¼šå¯¼è‡´é¡µå‡ºç°åˆ†è£‚,å“åº”æ€§èƒ½.</p>
<p>è§£å†³åŠæ³•: æ’å…¥æ—¶æ§åˆ¶ä¸»é”®è‡ªå¢ä¸”ä¸æ›´æ–°ä¸»é”®.  (é›ªèŠ±ç®—æ³•)</p>
</li>
<li>
<p>æ›´æ–°ä¸»é”®çš„ä»£ä»·å¾ˆé«˜ ï¼Œå› ä¸ºå°†ä¼šå¯¼è‡´è¢«æ›´æ–°çš„è¡Œç§»åŠ¨ã€‚å› æ­¤ï¼Œå¯¹äºInnoDBè¡¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬å®šä¹‰<code>ä¸»é”®ä¸ºä¸å¯æ›´æ–°</code>ã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong>é™åˆ¶ï¼š</strong></p>
<ul>
<li>InnoDBæ”¯æŒèšç°‡ç´¢å¼•, MyISAMä¸æ”¯æŒ.</li>
<li>ç”±äºæ•°æ®çš„ç‰©ç†é¡ºåºæ’åˆ—åªèƒ½æœ‰ä¸€ç§(é¡µå†…),  è€Œèšç°‡ç´¢å¼•åˆå†³å®šäº†æ•°æ®çš„é¡ºåº,æ‰€ä»¥,èšç°‡ç´¢å¼•åªèƒ½æœ‰ä¸€ä¸ª</li>
<li>å¦‚æœæ²¡æœ‰ä¸ºè¡¨å®šä¹‰ä¸»é”®ï¼ŒInnoDBä¼šé€‰æ‹©<code>éç©ºçš„å”¯ä¸€ç´¢å¼•åˆ—ä»£æ›¿</code>ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„åˆ—ï¼ŒInnoDBä¼š<code>éšå¼çš„å®šä¹‰ä¸€ä¸ªä¸»é”®</code>ä½œä¸ºèšç°‡ç´¢å¼•ã€‚</li>
<li>ä¸ºäº†å……åˆ†åˆ©ç”¨èšç°‡ç´¢å¼•çš„èšç°‡ç‰¹æ€§ï¼ŒInnoDBä¸­è¡¨çš„<code>ä¸»é”®åº”é€‰æ‹©æœ‰åºçš„id</code>ï¼Œä¸å»ºè®®ä½¿ç”¨æ— åºçš„idï¼Œæ¯”å¦‚UUIDã€MD5ã€HASHã€å­—ç¬¦ä¸²ä½œä¸ºä¸»é”®ï¼Œæ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºå¢é•¿ã€‚</li>
</ul>
</li>
</ul>
<h3 id="éèšç°‡ç´¢å¼•">éèšç°‡ç´¢å¼•</h3>
<ul>
<li>
<p>ä¹Ÿå«äºŒçº§ç´¢å¼•	è¾…åŠ©ç´¢å¼•</p>
</li>
<li>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>
<p>å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®ä¸º ç´¢å¼•å’Œä¸»é”®,å¹¶ä¸æ˜¯å®Œæ•´çš„æ•°æ®.</p>
</li>
<li>
<p>æŸ¥æ‰¾é<code>è¦†ç›–ç´¢å¼•</code>æ—¶éœ€è¦å›è¡¨</p>
<p><code>å›è¡¨</code>: å› ä¸ºéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ä¸åŒ…å«å®Œæ•´æ•°æ®,åªæœ‰ç´¢å¼•å’Œä¸»é”®,å› æ­¤,åœ¨é€šè¿‡éèšç°‡ç´¢å¼•æŸ¥æ‰¾åˆ°ä¸»é”®ä¹‹å,InnoDBéœ€è¦é€šè¿‡ä¸»é”®æŸ¥æ‰¾èšç°‡ç´¢å¼•æ¥è·å–å®Œæ•´çš„æ•°æ®.(MyISAMçš„éèšç°‡ç´¢å¼•ä¸­å­˜å‚¨çš„æ•°æ®ä¸ºç´¢å¼•å’Œæ•°æ®çš„åœ°å€å€¼,åœ¨æŸ¥æ‰¾ä¹‹å,ä¹Ÿéœ€è¦é€šè¿‡åœ°å€å€¼æ‹¿åˆ°å®Œæ•´çš„æ•°æ®)</p>
</li>
<li>
<p>ç´¢å¼•éä¸»é”®</p>
</li>
<li>
<p>å¯ä»¥æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•</p>
</li>
</ul>
</li>
<li>
<p><strong>é—®é¢˜</strong>:</p>
<ul>
<li>
<p>ä¸ºä»€ä¹ˆéèšç°‡ç´¢å¼•ä¸å­˜å‚¨å®Œæ•´æ•°æ®å‘¢?</p>
<p>ç­”: éèšç°‡ç´¢å¼•ä¸å½±å“æ•°æ®çš„ç‰©ç†é¡ºåº,æ‰€ä»¥å¯ä»¥æœ‰å¤šä¸ª,å¦‚æœæ¯ä¸ªéèšç°‡ç´¢å¼•éƒ½å­˜å‚¨å®Œæ•´æ•°æ®,å ç”¨çš„ç©ºé—´å°±éå¸¸å¤§.</p>
</li>
</ul>
</li>
</ul>
<h4 id="èšç°‡ç´¢å¼•-vs-éèšç°‡ç´¢å¼•ï¼šå¯¹æ¯”æ€»ç»“">èšç°‡ç´¢å¼• vs éèšç°‡ç´¢å¼•ï¼šå¯¹æ¯”æ€»ç»“</h4>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>èšç°‡ç´¢å¼•</th>
<th>éèšç°‡ç´¢å¼•</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ•°æ®å­˜å‚¨</strong></td>
<td>æ•°æ®å’Œç´¢å¼•ä¸€èµ·å­˜å‚¨</td>
<td>æ•°æ®å’Œç´¢å¼•åˆ†å¼€å­˜å‚¨</td>
</tr>
<tr>
<td><strong>ç´¢å¼•ç»“æ„</strong></td>
<td>å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®</td>
<td>å¶å­èŠ‚ç‚¹å­˜å‚¨æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆ(Row id æˆ–ä¸»é”®)</td>
</tr>
<tr>
<td><strong>æ•°æ®é¡ºåº</strong></td>
<td>æ•°æ®æŒ‰ç´¢å¼•é¡ºåºç‰©ç†å­˜å‚¨</td>
<td>æ•°æ®çš„ç‰©ç†é¡ºåºä¸ç´¢å¼•æ— å…³</td>
</tr>
<tr>
<td><strong>ç´¢å¼•æ•°é‡</strong></td>
<td>ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•</td>
<td>ä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•</td>
</tr>
<tr>
<td><strong>æŸ¥è¯¢æ•ˆç‡</strong></td>
<td>ç›´æ¥è¯»å–æ•°æ®ï¼Œæ•ˆç‡è¾ƒé«˜</td>
<td>éœ€è¦å…ˆæ‰¾åˆ°æŒ‡é’ˆï¼Œå†æŸ¥æ‰¾æ•°æ®ï¼Œæ•ˆç‡è¾ƒä½</td>
</tr>
<tr>
<td><strong>èŒƒå›´æŸ¥è¯¢</strong></td>
<td>é«˜æ•ˆ</td>
<td>æ•ˆç‡ç›¸å¯¹è¾ƒä½</td>
</tr>
<tr>
<td><strong>å ç”¨ç©ºé—´</strong></td>
<td>å ç”¨è¾ƒå°‘ï¼Œå› ä¸ºæ•°æ®ä¸ç´¢å¼•åˆå¹¶å­˜å‚¨</td>
<td>å ç”¨è¾ƒå¤§ï¼Œéœ€è¦é¢å¤–çš„æŒ‡é’ˆå­˜å‚¨ç©ºé—´</td>
</tr>
<tr>
<td><strong>æ›´æ–°æ’å…¥</strong></td>
<td>å¯èƒ½å¯¼è‡´é¡µåˆ†è£‚æˆ–é‡æ’ï¼Œå½±å“è¾ƒå¤§</td>
<td>å¯¹æ•°æ®æ’å…¥å½±å“è¾ƒå°</td>
</tr>
<tr>
<td><strong>åº”ç”¨åœºæ™¯</strong></td>
<td>é€‚åˆä¸»é”®æˆ–èŒƒå›´æŸ¥è¯¢</td>
<td>é€‚åˆä¼˜åŒ–ç‰¹å®šåˆ—çš„æŸ¥è¯¢</td>
</tr>
</tbody>
</table>
<h3 id="è”åˆç´¢å¼•">è”åˆç´¢å¼•</h3>
<ul>
<li>
<p>ç»„æˆç´¢å¼•çš„æœ‰å¤šä¸ªå­—æ®µ,</p>
</li>
<li>
<p>æœ¬è´¨ä¸Šä¹Ÿæ˜¯äºŒçº§ç´¢å¼•</p>
</li>
<li>
<p><strong>å¶å­èŠ‚ç‚¹</strong>ï¼šå¯¹äºéèšç°‡ç´¢å¼•ï¼ˆè”åˆç´¢å¼•ï¼‰ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯<strong>ç´¢å¼•å­—æ®µçš„å€¼</strong>å’ŒæŒ‡å‘å®é™…æ•°æ®è¡Œçš„<strong>ä¸»é”®å€¼</strong>ï¼ˆInnoDBï¼‰æˆ–<strong>æŒ‡é’ˆ</strong>ï¼ˆMyISAMï¼‰ã€‚</p>
</li>
<li>
<p>éå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯<strong>éƒ¨åˆ†ç´¢å¼•å­—æ®µçš„å€¼</strong>ä»¥åŠæŒ‡å‘ä¸‹ä¸€çº§èŠ‚ç‚¹çš„<strong>æŒ‡é’ˆ</strong>ï¼ˆé¡µå·æˆ–é¡µåœ°å€ï¼‰ã€‚</p>
<ul>
<li>å…ˆæŒ‰ç…§ç¬¬ä¸€ä¸ªå­—æ®µæ’,å¦‚æœä¸€æ ·,åˆ™æ ¹æ®ç¬¬äºŒä¸ª.</li>
</ul>
<p>éå¶å­èŠ‚ç‚¹é€šå¸¸åªå­˜å‚¨éƒ¨åˆ†ç´¢å¼•å­—æ®µçš„å€¼ï¼Œä¸éœ€è¦å­˜å‚¨å®Œæ•´çš„è”åˆç´¢å¼•å­—æ®µï¼Œå®ƒçš„ç›®çš„æ˜¯å¸®åŠ©å¿«é€Ÿå®šä½å¶å­èŠ‚ç‚¹ã€‚</p>
</li>
</ul>
<h3 id="è¦†ç›–ç´¢å¼•">è¦†ç›–ç´¢å¼•</h3>
<p>å½“ä¸€ä¸ªç´¢å¼•åŒ…å«äº†æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰åˆ—æ—¶ï¼Œè¿™ä¸ªç´¢å¼•å°±ç§°ä¸º<strong>è¦†ç›–ç´¢å¼•</strong>ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæŸ¥è¯¢çš„<strong>SELECT</strong>ã€<strong>WHERE</strong>ã€<strong>GROUP BY</strong>ã€<strong>ORDER BY</strong>è¯­å¥ä¸­æ¶‰åŠçš„æ‰€æœ‰å­—æ®µéƒ½åœ¨æŸä¸ªç´¢å¼•ä¸­ï¼Œæ•°æ®åº“å¯ä»¥åªé€šè¿‡ç´¢å¼•å®ŒæˆæŸ¥è¯¢ï¼Œè€Œä¸éœ€è¦å†å»è¡¨ä¸­è¯»å–æ•°æ®è¡Œã€‚</p>
<h3 id="MyISAMä¸­çš„ç´¢å¼•">MyISAMä¸­çš„ç´¢å¼•</h3>
<ul>
<li>
<p>MyISAMå¼•æ“ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œ<code>å¶å­èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€</code> ã€‚</p>
</li>
<li>
<p>ä¸‹å›¾æ˜¯MyISAMç´¢å¼•çš„åŸç†å›¾<code>ï¼ˆç´¢å¼•å’Œæ•°æ®åˆ†å¼€å­˜å‚¨ï¼Œæ˜¯éèšç°‡ç´¢å¼•ï¼‰</code>ï¼š</p>
</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/fa7f538a4e9af7de236026f810baa4b2.png" alt=""></p>
<h3 id="MyISAMä¸InnoDBå¯¹æ¯”">MyISAMä¸InnoDBå¯¹æ¯”</h3>
<ul>
<li>
<p>InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼Œè€ŒMyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼š</p>
<ul>
<li>InnoDBçš„è¡¨åœ¨ç£ç›˜ä¸Šå­˜å‚¨åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­ï¼š <code>.ibdï¼ˆè¡¨ç»“æ„ã€ç´¢å¼•å’Œæ•°æ®éƒ½å­˜åœ¨ä¸€èµ·,MySQL5.7è¡¨ç»“æ„æ”¾åœ¨.frmä¸­ï¼‰</code></li>
<li>MyISAMçš„è¡¨åœ¨ç£ç›˜ä¸Šå­˜å‚¨åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­ï¼š  <code>*.sdiï¼ˆæè¿°è¡¨ç»“æ„ï¼ŒMySQL5.7æ˜¯.frmï¼‰</code>ã€<code>*.MYDï¼ˆæ•°æ®ï¼‰</code>ï¼Œ<code>*.MYIï¼ˆç´¢å¼•ï¼‰</code></li>
</ul>
</li>
<li>
<p>InnoDBä¸­ä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨å®Œæ•´çš„æ•°æ®è®°å½•ï¼›å…¶ä»–ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ï¼Œå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼ ã€‚</p>
</li>
<li>
<p>InnoDBè¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”® ï¼ˆ MyISAMå¯ä»¥æ²¡æœ‰ ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥<code>éç©ºä¸”å”¯ä¸€</code>æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ã€‚å¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ã€‚</p>
</li>
<li>
<p>MyISAMä¸­æ— è®ºæ˜¯ä¸»é”®ç´¢å¼•è¿˜æ˜¯éä¸»é”®ç´¢å¼•éƒ½æ˜¯éèšç°‡çš„ï¼Œå¶å­èŠ‚ç‚¹è®°å½•çš„æ˜¯æ•°æ®çš„åœ°å€ã€‚</p>
</li>
<li>
<p><code>MyISAMçš„å›è¡¨æ“ä½œæ˜¯ååˆ†å¿«é€Ÿçš„</code>ï¼Œå› ä¸ºæ˜¯æ‹¿ç€åœ°å€åç§»é‡ç›´æ¥åˆ°æ–‡ä»¶ä¸­å–æ•°æ®çš„ï¼Œåè§‚InnoDBæ˜¯é€šè¿‡è·å–ä¸»é”®ä¹‹åå†å»èšç°‡ç´¢å¼•é‡Œæ‰¾è®°å½•ï¼Œè™½ç„¶è¯´ä¹Ÿä¸æ…¢ï¼Œä½†è¿˜æ˜¯æ¯”ä¸ä¸Šç›´æ¥ç”¨åœ°å€å»è®¿é—®ã€‚</p>
</li>
</ul>
<h3 id="ç´¢å¼•æ“ä½œ">ç´¢å¼•æ“ä½œ</h3>
<ul>
<li>
<p><strong>åˆ›å»º</strong></p>
<p>åˆ›å»ºè¡¨æ—¶:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">creat <span class="keyword">table</span> customer(</span><br><span class="line">	id <span class="type">int</span> auto_increment,</span><br><span class="line">    customer_no <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    customer_name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">primary</span> key(id),</span><br><span class="line">    <span class="keyword">unique</span> index uk_no(customer_no)</span><br><span class="line">    key idx_customer_name(cusomer_name); <span class="operator">/</span><span class="operator">/</span>å¦‚æœä¸æŒ‡å®šåç§°,ä¸åæ˜ä¸€è‡´</span><br><span class="line">    key idx_customer_no_name(cusomer_no,customer_name)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ›å»ºè¡¨æ—¶æŒ‡å®šä¸»é”®,	è‡ªåŠ¨åˆ›å»ºä¸»é”®ç´¢å¼•  <code>primay key</code></li>
<li><code>unique index uk_no(customer_no)</code> â€” å”¯ä¸€ç´¢å¼•( å½“<strong>æœ‰ä¸»é”®ç´¢å¼•</strong>æ—¶,ä¸º<strong>éèšç°‡ç´¢å¼•</strong>,<strong>æ²¡æœ‰ä¸»é”®ç´¢å¼•</strong>æ—¶ ,ä¸º<strong>èšç°‡ç´¢å¼•</strong>)</li>
<li><code>Key idx_name (customer_name)</code>   â€” æ™®é€šç´¢å¼•</li>
<li><code>key idx_name_no(,customer_name,customer_no)</code>  â€” äºŒçº§ç´¢å¼•</li>
</ul>
<blockquote>
<p>å”¯ä¸€ç´¢å¼•:</p>
<p><strong>å”¯ä¸€ç´¢å¼•</strong>åœ¨ MySQL çš„ <strong>InnoDB</strong> å¼•æ“ä¸­ä»ç„¶<strong>å¯ä»¥åŒ…å« <code>NULL</code> å€¼</strong></p>
<p><strong>æ²¡æœ‰ä¸»é”®æ—¶çš„èšç°‡ç´¢å¼•</strong>ï¼š</p>
<ul>
<li>å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼Œä½†æœ‰ä¸€ä¸ªå”¯ä¸€ç´¢å¼•ï¼ŒInnoDB ä¼šé€‰æ‹©è¯¥å”¯ä¸€ç´¢å¼•ä½œä¸ºèšç°‡ç´¢å¼•ã€‚è™½ç„¶å”¯ä¸€ç´¢å¼•å…è®¸å¤šä¸ª <code>NULL</code> å€¼ï¼Œä½†å¦‚æœè¯¥å”¯ä¸€ç´¢å¼•è¢«é€‰ä¸ºèšç°‡ç´¢å¼•ï¼ŒInnoDB ä¼šè¦æ±‚è¯¥ç´¢å¼•åˆ—ä¸­æ‰€æœ‰å€¼å¿…é¡»æ˜¯å”¯ä¸€ä¸”<strong>ä¸èƒ½ä¸º <code>NULL</code></strong>ã€‚</li>
</ul>
</blockquote>
<p>åˆ›å»ºè¡¨å:</p>
<p><code>creat</code>:</p>
<ul>
<li><code>create index ç´¢å¼•å on è¡¨å(colum_name_list)</code></li>
<li><code>create unique index ç´¢å¼•å on è¡¨å(colum_name_list)</code></li>
</ul>
<p><code>alter</code>:</p>
<ul>
<li><code>alter table customer add index idx_cusomer_name(cusomer_name)</code></li>
<li><code>alter table customer add unique idx_cusomer_name(cusomer_name)</code></li>
<li><code>alter table customer add primary key(cusomer_name)</code></li>
<li><code>alter table customer add index idx_cusomer_name_no(cusomer_name,cusomer_no)</code></li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹</strong></p>
<ul>
<li><code>show index from è¡¨å</code></li>
</ul>
</li>
<li>
<p><strong>åˆ é™¤</strong></p>
<blockquote>
<p>æ³¨æ„: åˆ é™¤ä¸»é”®ç´¢å¼•  ,å½“ä¸»é”®æœ‰è‡ªå¢æ—¶, ä¸èƒ½åˆ é™¤, å¿…é¡»å»æ‰è‡ªå¢ (è‡ªå¢çš„å¿…é¡»ä¸ºä¸»é”®)</p>
</blockquote>
<ul>
<li>
<p><code>alter table customer drop index</code> æ™®é€šç´¢å¼• | å”¯ä¸€ç´¢å¼•</p>
</li>
<li>
<p><code>alter table customer drop primary key</code>;</p>
</li>
<li>
<p><code>drop index ç´¢å¼•å on è¡¨å</code>  ä¸èƒ½åˆ é™¤ä¸»é”®ç´¢å¼•</p>
</li>
</ul>
</li>
<li>
<p><strong>æ€»ç»“</strong>:</p>
<table>
<thead>
<tr>
<th><strong>æ“ä½œç±»å‹</strong></th>
<th><strong>æ“ä½œ</strong></th>
<th><strong>SQL è¯­å¥</strong></th>
<th><strong>å¤‡æ³¨</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åˆ›å»ºç´¢å¼•</strong></td>
<td>åˆ›å»ºä¸»é”®ç´¢å¼•</td>
<td><code>PRIMARY KEY (id)</code></td>
<td>åˆ›å»ºè¡¨æ—¶è‡ªåŠ¨åˆ›å»ºï¼Œä¸”ä¸ºèšç°‡ç´¢å¼•</td>
</tr>
<tr>
<td></td>
<td>åˆ›å»ºå”¯ä¸€ç´¢å¼•</td>
<td><code>UNIQUE INDEX uk_no (customer_no)</code></td>
<td>å”¯ä¸€ç´¢å¼•ï¼Œè‹¥æ— ä¸»é”®æ—¶å¯èƒ½ä½œä¸ºèšç°‡ç´¢å¼•</td>
</tr>
<tr>
<td></td>
<td>åˆ›å»ºæ™®é€šç´¢å¼•</td>
<td><code>KEY idx_customer_name (customer_name)</code></td>
<td>æ™®é€šç´¢å¼•</td>
</tr>
<tr>
<td></td>
<td>åˆ›å»ºå¤åˆç´¢å¼•</td>
<td><code>KEY idx_customer_no_name (customer_no, customer_name)</code></td>
<td>å¤åˆç´¢å¼•ï¼ŒäºŒçº§ç´¢å¼•</td>
</tr>
<tr>
<td></td>
<td>ä½¿ç”¨ <code>CREATE INDEX</code> åˆ›å»ºæ™®é€šç´¢å¼•</td>
<td><code>CREATE INDEX idx_customer_name ON customer (customer_name)</code></td>
<td>åˆ›å»ºåå¯ä»¥é€šè¿‡ <code>SHOW INDEX</code> æŸ¥çœ‹</td>
</tr>
<tr>
<td></td>
<td>ä½¿ç”¨ <code>CREATE INDEX</code> åˆ›å»ºå”¯ä¸€ç´¢å¼•</td>
<td><code>CREATE UNIQUE INDEX idx_customer_name ON customer (customer_name)</code></td>
<td>å”¯ä¸€ç´¢å¼•å…è®¸ <code>NULL</code> å€¼</td>
</tr>
<tr>
<td></td>
<td>ä½¿ç”¨ <code>ALTER TABLE</code> æ·»åŠ æ™®é€šç´¢å¼•</td>
<td><code>ALTER TABLE customer ADD INDEX idx_customer_name (customer_name)</code></td>
<td>ä½¿ç”¨ <code>ALTER TABLE</code> æ·»åŠ ç´¢å¼•</td>
</tr>
<tr>
<td></td>
<td>ä½¿ç”¨ <code>ALTER TABLE</code> æ·»åŠ å”¯ä¸€ç´¢å¼•</td>
<td><code>ALTER TABLE customer ADD UNIQUE idx_customer_name (customer_name)</code></td>
<td>æ·»åŠ å”¯ä¸€ç´¢å¼•</td>
</tr>
<tr>
<td></td>
<td>ä½¿ç”¨ <code>ALTER TABLE</code> æ·»åŠ ä¸»é”®ç´¢å¼•</td>
<td><code>ALTER TABLE customer ADD PRIMARY KEY (customer_name)</code></td>
<td>æ·»åŠ ä¸»é”®ç´¢å¼•</td>
</tr>
<tr>
<td></td>
<td>ä½¿ç”¨ <code>ALTER TABLE</code> æ·»åŠ å¤åˆç´¢å¼•</td>
<td><code>ALTER TABLE customer ADD INDEX idx_customer_name_no (customer_name, customer_no)</code></td>
<td>å¤åˆç´¢å¼•</td>
</tr>
<tr>
<td><strong>æŸ¥çœ‹ç´¢å¼•</strong></td>
<td>æŸ¥çœ‹è¡¨çš„æ‰€æœ‰ç´¢å¼•</td>
<td><code>SHOW INDEX FROM customer</code></td>
<td>æŸ¥çœ‹è¡¨ <code>customer</code> ä¸­çš„æ‰€æœ‰ç´¢å¼•ä¿¡æ¯</td>
</tr>
<tr>
<td><strong>åˆ é™¤ç´¢å¼•</strong></td>
<td>åˆ é™¤æ™®é€šç´¢å¼•æˆ–å”¯ä¸€ç´¢å¼•</td>
<td><code>ALTER TABLE customer DROP INDEX idx_customer_name</code></td>
<td>åˆ é™¤æ™®é€šç´¢å¼•æˆ–å”¯ä¸€ç´¢å¼•</td>
</tr>
<tr>
<td></td>
<td>åˆ é™¤ä¸»é”®ç´¢å¼•</td>
<td><code>ALTER TABLE customer DROP PRIMARY KEY</code></td>
<td>å¦‚æœä¸»é”®æœ‰è‡ªå¢å±æ€§ï¼Œéœ€è¦å…ˆå»æ‰è‡ªå¢</td>
</tr>
<tr>
<td></td>
<td>åˆ é™¤ç´¢å¼•</td>
<td><code>DROP INDEX ç´¢å¼•å ON è¡¨å</code></td>
<td>ä¸èƒ½åˆ é™¤ä¸»é”®ç´¢å¼•</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="ç´¢å¼•ä½¿ç”¨åœºæ™¯">ç´¢å¼•ä½¿ç”¨åœºæ™¯ :</h3>
<p><strong>é€‚åˆä½¿ç”¨ç´¢å¼•çš„æ¸…ç©º</strong>:</p>
<ul>
<li>é¢‘ç¹ä½œä¸ºwhereæ¡ä»¶çš„å­—æ®µ</li>
<li>ç»å¸¸group by å’Œ order byçš„åˆ—</li>
<li>æœ‰å”¯ä¸€æ€§çš„é™åˆ¶çš„åˆ—</li>
<li>å¤šè¡¨join ,å¯¹è¿æ¥å­—æ®µåˆ›å»ºç´¢å¼•</li>
<li>ä½¿ç”¨é¢‘ç¹çš„</li>
<li>åŒºåˆ†åº¦é«˜çš„</li>
<li>ä½¿ç”¨å­—ç¬¦ä¸²å‰ç¼€åˆ›å»ºç´¢å¼•(èŠ‚çœç©ºé—´) : å‰ç¼€ç´¢å¼•
<ul>
<li><code>alter table è¡¨å add index idx_d(address(20))</code> ä»¥å‰20å­—ç¬¦ä½œä¸ºç´¢å¼•</li>
</ul>
</li>
</ul>
<p><strong>ä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„æƒ…å†µ:</strong></p>
<ul>
<li><code>where</code>  <code> group by</code>   <code>order by</code>  é‡Œé¢ç”¨ä¸åˆ°çš„</li>
<li>è¡¨çš„æ•°æ®<strong>è®°å½•å¤ªå°‘</strong></li>
<li>æœ‰å¤§é‡é‡å¤æ•°æ®çš„åˆ—  (<strong>åŒºåˆ†åº¦ä¸é«˜</strong>)</li>
<li>ç»å¸¸å¢åˆ æ”¹çš„è¡¨(<strong>æŸ¥è¯¢å°‘</strong> , <strong>å¢åˆ æ”¹ å¤š</strong>)</li>
<li>ä¸ç”¨å®šä¹‰å†—ä½™æˆ–é‡å¤çš„ç´¢å¼• (å·²ç»åˆ›å»ºè¿‡çš„)</li>
</ul>
<h2 id="ç´¢å¼•ä¼˜åŒ–">ç´¢å¼•ä¼˜åŒ–</h2>
<h3 id="æ•°æ®åº“ä¼˜åŒ–">æ•°æ®åº“ä¼˜åŒ–</h3>
<ul>
<li>
<p>ç´¢å¼•å¤±æ•ˆ:  ç´¢å¼•å»ºç«‹</p>
</li>
<li>
<p>å…³è”æŸ¥è¯¢å¤ªå¤šJOINï¼ˆè®¾è®¡ç¼ºé™·æˆ–ä¸å¾—å·²çš„éœ€æ±‚ï¼‰ï¼š<code>SQLä¼˜åŒ–</code></p>
</li>
<li>
<p>æ•°æ®è¿‡å¤š500Wï¼Œ2GBï¼šåˆ†åº“åˆ†è¡¨</p>
</li>
<li>
<p>æœåŠ¡å™¨è°ƒä¼˜åŠå„ä¸ªå‚æ•°è®¾ç½®ï¼ˆç¼“å†²ã€çº¿ç¨‹æ•°ç­‰ï¼‰ï¼šè°ƒæ•´my.cnf</p>
</li>
</ul>
<h3 id="æ€§èƒ½åˆ†æ-EXPLAN">æ€§èƒ½åˆ†æ(EXPLAN)</h3>
<ul>
<li>explain : ä½¿ç”¨EXPLAINå…³é”®å­—å¯ä»¥<code>æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡ŒSQLæŸ¥è¯¢è¯­å¥</code>ï¼Œä»è€ŒçŸ¥é“MySQLæ˜¯å¦‚ä½•å¤„ç†ä½ çš„SQLè¯­å¥çš„ã€‚<code>åˆ†æä½ çš„æŸ¥è¯¢è¯­å¥æˆ–æ˜¯è¡¨ç»“æ„çš„æ€§èƒ½ç“¶é¢ˆ</code>ã€‚</li>
<li>ç”¨å‘:<code> EXPLAIN + SQLè¯­å¥</code></li>
</ul>
<h4 id="explain-å„å­—æ®µè§£é‡Š">explain å„å­—æ®µè§£é‡Š</h4>
<h5 id="id">**id: **</h5>
<ul>
<li>
<p>åœ¨ä¸€ä¸ªå®Œæ•´çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œæ¯ä¸ªSELECTå…³é”®å­—ï¼Œéƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„idã€‚åŒæ—¶é€šè¿‡idä¹Ÿå¯ä»¥çŸ¥é“æ“ä½œè¡¨çš„é¡ºåºã€‚</p>
</li>
<li>
<p>id ä¸€æ ·:</p>
<p>å¯¹äºæ¶‰åŠå­æŸ¥è¯¢çš„,  æŸ¥è¯¢ä¼˜åŒ–å™¨å¯èƒ½å¯¹å­æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–,<strong>è½¬ä¸ºè¿æ¥æŸ¥è¯¢</strong>,å˜ä¸ºä¸€ä¸ªselect</p>
</li>
<li>
<p>idä¸ºnull:</p>
<p>å½“å¯¹ä¸¤å¼ è¡¨è¿›è¡Œ  union  åˆå¹¶æ—¶, ä¼šç”Ÿæˆä¸€å¼ <strong>ä¸´æ—¶è¡¨</strong>,ç„¶åå»é‡</p>
<p>å¯¹äºunion all å› ä¸ºä¸ä¼šç”Ÿæˆä¸´æ—¶è¡¨,å°±ä¸ä¼šæœ‰è¿™ä¸ªnull çš„id</p>
</li>
<li>
<p>æ‰§è¡Œçš„é¡ºåº:</p>
<ul>
<li>idå¦‚æœç›¸åŒï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œ<code>ä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œ</code></li>
<li>åœ¨æ‰€æœ‰ç»„ä¸­ï¼Œ<code>idå€¼è¶Šå¤§ï¼Œè¶Šå…ˆæ‰§è¡Œ</code></li>
<li>å…³æ³¨ç‚¹ï¼šæ¯ä¸ªidå·ç ï¼Œè¡¨ç¤ºä¸€è¶Ÿç‹¬ç«‹çš„æŸ¥è¯¢, <code>ä¸€ä¸ªsqlçš„æŸ¥è¯¢è¶Ÿæ•°è¶Šå°‘è¶Šå¥½</code></li>
</ul>
</li>
</ul>
<h5 id="table"><strong>table:</strong></h5>
<ul>
<li>
<p>æ„ä¹‰:</p>
<p>æ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„</p>
</li>
<li>
<p>é©±åŠ¨è¡¨:</p>
<p>åœ¨<strong>å¤šè¡¨è”æŸ¥</strong>ä¸­,è‹¥idç›¸åŒ,åˆ™åœ¨å‰é¢çš„ä¸º<strong>é©±åŠ¨è¡¨(<strong>é©±åŠ¨è¡¨ä¸€èˆ¬ä¼šè¿›è¡Œ</strong>å…¨è¡¨æŸ¥è¯¢æˆ–å…¨ç´¢å¼•</strong>)</p>
</li>
</ul>
<h5 id="type"><strong>type:</strong></h5>
<ul>
<li>
<p>ç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡æ˜¯:</p>
<p><code>system &gt; const &gt; eq_ref &gt; ref</code> &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; <code>range &gt; index &gt; ALL</code></p>
</li>
<li>
<p>æ¯”è¾ƒé‡è¦çš„æ˜¯:``system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL`</p>
</li>
<li>
<p>SQL æ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ï¼šè‡³å°‘è¦è¾¾åˆ° <code>range</code> çº§åˆ«ï¼Œè¦æ±‚æ˜¯ <code>ref</code> çº§åˆ«ï¼Œæœ€å¥½æ˜¯ <code>const</code>çº§åˆ«ã€‚ï¼ˆé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œè¦æ±‚ï¼‰</p>
</li>
<li>
<p>ç»“æœå€¼:</p>
<ul>
<li>**ALL: **å…¨è¡¨æ‰«æ</li>
<li>**index:**å…¨ç´¢å¼•æ‰«æã€‚å½“ä½¿ç”¨<code>è¦†ç›–ç´¢å¼•</code>ï¼Œä½†éœ€è¦æ‰«æ<code>å…¨éƒ¨çš„ç´¢å¼•è®°å½•</code>æ—¶</li>
<li>**rangeï¼š**åªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚key åˆ—æ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ï¼Œä¸€èˆ¬å°±æ˜¯åœ¨ä½ çš„whereè¯­å¥ä¸­å‡ºç°äº†betweenã€&lt;ã€&gt;ã€inç­‰çš„æŸ¥è¯¢ã€‚è¿™ç§èŒƒå›´æ‰«æç´¢å¼•æ‰«ææ¯”å…¨è¡¨æ‰«æè¦å¥½ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¼€å§‹äºç´¢å¼•çš„æŸä¸€ç‚¹ï¼Œè€Œç»“æŸäºå¦ä¸€ç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•ã€‚</li>
<li>**refï¼š**é€šè¿‡æ™®é€šäºŒçº§ç´¢å¼•åˆ—ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶</li>
<li>**eq_refï¼š**è¿æ¥æŸ¥è¯¢æ—¶é€šè¿‡<code>ä¸»é”®</code>æˆ–ä¸å…è®¸NULLå€¼çš„<code>å”¯ä¸€äºŒçº§ç´¢å¼•</code>åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ <strong>?</strong> æ•°æ®é‡çº§ï¼Œå¯èƒ½ä¼šå½±å“ç´¢å¼•çš„ä½¿ç”¨ï¼ mysql å†…éƒ¨çš„ä¼˜åŒ–å™¨ï¼</li>
<li>**constï¼š**æ ¹æ®<code>ä¸»é”®</code>æˆ–è€…<code>å”¯ä¸€äºŒçº§ç´¢å¼•</code>åˆ—ä¸<code>å¸¸æ•°</code>è¿›è¡ŒåŒ¹é…æ—¶</li>
<li>**systemï¼š**MyISAMå¼•æ“ä¸­ï¼Œå½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•æ—¶ã€‚<code>ï¼ˆè¿™æ˜¯æ‰€æœ‰typeçš„å€¼ä¸­æ€§èƒ½æœ€é«˜çš„åœºæ™¯ï¼‰</code></li>
</ul>
</li>
</ul>
<h5 id="possible-keys-å’Œ-key"><strong>possible_keys å’Œ key</strong></h5>
<ul>
<li><code>possible_keys</code>è¡¨ç¤ºæ‰§è¡ŒæŸ¥è¯¢æ—¶<code>å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•</code>ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚ æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨ã€‚</li>
<li><code>keys</code>è¡¨ç¤º<code>å®é™…ä½¿ç”¨çš„ç´¢å¼•</code>ã€‚å¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</li>
</ul>
<h5 id="key-len">key_len</h5>
<p>è¡¨ç¤ºç´¢å¼•ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œæ ¹æ®è¿™ä¸ªå€¼å¯ä»¥åˆ¤æ–­ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼Œ<code>æ£€æŸ¥æ˜¯å¦å……åˆ†åˆ©ç”¨äº†ç´¢å¼•ï¼Œé’ˆå¯¹è”åˆç´¢å¼•å€¼è¶Šå¤§è¶Šå¥½ã€‚</code></p>
<ul>
<li>å¦‚ä½•è®¡ç®—</li>
</ul>
<ol>
<li>å…ˆçœ‹ç´¢å¼•ä¸Šå­—æ®µçš„ç±»å‹+é•¿åº¦ã€‚æ¯”å¦‚ï¼šint=4 ; varchar(20) =20 ; char(20) =20</li>
<li>å¦‚æœæ˜¯varcharæˆ–è€…charè¿™ç§å­—ç¬¦ä¸²å­—æ®µï¼Œè§†å­—ç¬¦é›†è¦ä¹˜ä¸åŒçš„å€¼ï¼Œæ¯”å¦‚utf8è¦ä¹˜ 3(MySQL5.7)ï¼Œå¦‚æœæ˜¯utf8mb4è¦ä¹˜4ï¼ŒGBKè¦ä¹˜2</li>
<li>varcharè¿™ç§åŠ¨æ€å­—ç¬¦ä¸²è¦åŠ 2ä¸ªå­—èŠ‚</li>
<li>å…è®¸ä¸ºç©ºçš„å­—æ®µè¦åŠ 1ä¸ªå­—èŠ‚</li>
</ol>
<h5 id="ref">ref</h5>
<p>æ˜¾ç¤ºä¸keyä¸­çš„ç´¢å¼•è¿›è¡Œæ¯”è¾ƒçš„åˆ—æˆ–å¸¸é‡ã€‚</p>
<ul>
<li><strong>constï¼š</strong>  ä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼æ¯”è¾ƒçš„ä¸œè¥¿æ˜¯å•¥ï¼Œconstè¡¨ç¤ºä¸€ä¸ªå¸¸æ•°</li>
<li><strong><a href="http://ref=atguigudb.t1.id">ref=atguigudb.t1.id</a></strong>   å¦å¤–ä¸€ä¸ªè¡¨çš„åˆ—</li>
</ul>
<h5 id="rows">rows</h5>
<ul>
<li>MySQLè®¤ä¸ºå®ƒæ‰§è¡ŒæŸ¥è¯¢æ—¶å®é™…ä»ç´¢å¼•æ ‘ä¸­æŸ¥æ‰¾åˆ°çš„è¡Œæ•°ã€‚<code>å€¼è¶Šå°è¶Šå¥½ã€‚</code></li>
</ul>
<h5 id="filtered">filtered</h5>
<ul>
<li>æœ€åæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®å æ‰€æœ‰æœåŠ¡å™¨ç«¯ï¼ˆserverï¼‰æ£€æŸ¥è¡Œæ•°ï¼ˆrowsï¼‰çš„<code>ç™¾åˆ†æ¯”</code>ã€‚<code>å€¼è¶Šå¤§è¶Šå¥½</code>ã€‚</li>
</ul>
<p>ä¾‹å¦‚ä¸Šä¸€ä¸ªä¾‹å­ã€‚</p>
<h5 id="Extra">Extra</h5>
<p>åŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„é¢å¤–ä¿¡æ¯ã€‚é€šè¿‡è¿™äº›é¢å¤–ä¿¡æ¯æ¥<code>ç†è§£MySQLåˆ°åº•å°†å¦‚ä½•æ‰§è¡Œå½“å‰çš„æŸ¥è¯¢è¯­å¥</code>ã€‚MySQLæä¾›çš„é¢å¤–ä¿¡æ¯æœ‰å¥½å‡ åä¸ªï¼Œè¿™é‡ŒåªæŒ‘æ¯”è¾ƒé‡è¦çš„ä»‹ç»ã€‚</p>
<ul>
<li>**Using whereï¼š**ä½¿ç”¨äº†whereï¼Œä½†åœ¨whereä¸Šæœ‰å­—æ®µæ²¡æœ‰åˆ›å»ºç´¢å¼•ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºå¦‚æœæ•°æ®ä»å¼•æ“å±‚è¢«è¿”å›åˆ°serverå±‚è¿›è¡Œè¿‡æ»¤ï¼Œé‚£ä¹ˆå°±æ˜¯Using whereã€‚</li>
<li>**Using filesortï¼š**å¦‚æœå‡ºç°äº†Using filesort è¯´æ˜æ’åºæ²¡æœ‰ä½¿ç”¨ä¸Šç´¢å¼•</li>
<li><strong>Using indexï¼š</strong><code>ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•</code>ï¼Œè¡¨ç¤ºç›´æ¥è®¿é—®ç´¢å¼•å°±è¶³å¤Ÿè·å–åˆ°æ‰€éœ€è¦çš„æ•°æ®ï¼Œä¸éœ€è¦é€šè¿‡ç´¢å¼•å›è¡¨</li>
<li>**Using index conditionï¼š**å«ä½œ  <code>Index Condition Pushdown Optimization ï¼ˆç´¢å¼•ä¸‹æ¨ä¼˜åŒ–ï¼‰</code>
<ul>
<li><code>å¦‚æœæ²¡æœ‰ç´¢å¼•ä¸‹æ¨ï¼ˆICPï¼‰</code>ï¼Œé‚£ä¹ˆMySQLåœ¨å­˜å‚¨å¼•æ“å±‚æ‰¾åˆ°æ»¡è¶³<code>content1 &gt; 'z'</code>æ¡ä»¶çš„ç¬¬ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ã€‚<code>ä¸»é”®å€¼è¿›è¡Œå›è¡¨</code>ï¼Œè¿”å›å®Œæ•´çš„è®°å½•ç»™serverå±‚ï¼Œserverå±‚å†åˆ¤æ–­å…¶ä»–çš„æœç´¢æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚å¦‚æœæˆç«‹åˆ™ä¿ç•™è¯¥è®°å½•ï¼Œå¦åˆ™è·³è¿‡è¯¥è®°å½•ï¼Œç„¶åå‘å­˜å‚¨å¼•æ“å±‚è¦ä¸‹ä¸€æ¡è®°å½•ã€‚</li>
<li><code>å¦‚æœä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨ï¼ˆICPï¼‰</code>ï¼Œé‚£ä¹ˆMySQLåœ¨å­˜å‚¨å¼•æ“å±‚æ‰¾åˆ°æ»¡è¶³<code>content1 &gt; 'z'</code>æ¡ä»¶çš„ç¬¬ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ã€‚<code>ä¸ç€æ€¥æ‰§è¡Œå›è¡¨</code>ï¼Œè€Œæ˜¯åœ¨è¿™æ¡è®°å½•ä¸Šå…ˆåˆ¤æ–­ä¸€ä¸‹æ‰€æœ‰å…³äº<code>idx_content1</code>ç´¢å¼•ä¸­åŒ…å«çš„æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œä¹Ÿå°±æ˜¯<code>content1 &gt; 'z' AND content1 LIKE '%a'</code>æ˜¯å¦æˆç«‹ã€‚å¦‚æœè¿™äº›æ¡ä»¶ä¸æˆç«‹ï¼Œåˆ™ç›´æ¥è·³è¿‡è¯¥äºŒçº§ç´¢å¼•è®°å½•ï¼Œå»æ‰¾ä¸‹ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ï¼›å¦‚æœè¿™äº›æ¡ä»¶æˆç«‹ï¼Œåˆ™æ‰§è¡Œå›è¡¨æ“ä½œï¼Œè¿”å›å®Œæ•´çš„è®°å½•ç»™serverå±‚ã€‚</li>
</ul>
</li>
<li>**Using join bufferï¼š**åœ¨è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå½“<code>è¢«é©±åŠ¨è¡¨ï¼ˆt2ï¼‰ä¸èƒ½æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•æ—¶</code>ï¼ŒMySQLä¼šæå‰ç”³è¯·ä¸€å—å†…å­˜ç©ºé—´ï¼ˆjoin bufferï¼‰å­˜å‚¨é©±åŠ¨è¡¨çš„æ•°æ®ï¼Œæ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦</li>
</ul>
<h3 id="å•è¡¨ç´¢å¼•å¤±æ•ˆ">å•è¡¨ç´¢å¼•å¤±æ•ˆ</h3>
<h4 id="1-è®¡ç®—-å‡½æ•°å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">1. è®¡ç®—  å‡½æ•°å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h4>
<p>åœ¨å‡½æ•°ä¸­ä½¿ç”¨ç´¢å¼•,  ç´¢å¼•ä¸ä¼šç”Ÿæ•ˆ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æ˜¾ç¤ºæŸ¥è¯¢åˆ†æ</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> <span class="keyword">LEFT</span>(emp.name,<span class="number">3</span>) <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>; <span class="comment">--ç´¢å¼•å¤±æ•ˆ</span></span><br></pre></td></tr></table></figure>
<h4 id="2-likeä»¥-å¼€å¤´ç´¢å¼•å¤±æ•ˆ">2. likeä»¥%å¼€å¤´ç´¢å¼•å¤±æ•ˆ</h4>
<blockquote>
<p>ã€å¼ºåˆ¶ã€‘é¡µé¢æœç´¢ä¸¥ç¦å·¦æ¨¡ç³Šæˆ–è€…å…¨æ¨¡ç³Šï¼Œå¦‚æœéœ€è¦è¯·èµ°æœç´¢å¼•æ“æ¥è§£å†³ã€‚ ç”µå•†ä¸­å…¨æ–‡æ£€ç´¢es ä¸åº”è¯¥mysql</p>
</blockquote>
<p>åœ¨ä½¿ç”¨æ¨¡ç³ŠæŸ¥æ‰¾æ—¶,å¦‚æœä»¥%å¼€å¤´,ç´¢å¼•å¤±æ•ˆ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%ab%&#x27;</span>; <span class="comment">--ç´¢å¼•å¤±æ•ˆ</span></span><br></pre></td></tr></table></figure>
<h4 id="3-ä¸ç­‰äº-æˆ–è€…-ç´¢å¼•å¤±æ•ˆ">3. ä¸ç­‰äº(!= æˆ–è€…&lt;&gt;)ç´¢å¼•å¤±æ•ˆ</h4>
<p>å¦å®šå¼€å¤´,å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">!=</span>  <span class="operator">||</span>   <span class="operator">&lt;&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-IS-NOT-NULL-å’Œ-IS-NULL">4. IS NOT NULL å’Œ IS NULL</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>; <span class="comment">--ç´¢å¼•å¤±æ•ˆ</span></span><br></pre></td></tr></table></figure>
<p>**æ³¨æ„ï¼š**å½“æ•°æ®åº“ä¸­çš„æ•°æ®çš„ç´¢å¼•åˆ—çš„<code>NULLå€¼è¾¾åˆ°æ¯”è¾ƒé«˜çš„æ¯”ä¾‹çš„æ—¶å€™</code>ï¼Œå³ä½¿åœ¨IS NOT NULL çš„æƒ…å†µä¸‹ MySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šé€‰æ‹©ä½¿ç”¨ç´¢å¼•ï¼Œ<code>æ­¤æ—¶typeçš„å€¼æ˜¯rangeï¼ˆèŒƒå›´æŸ¥è¯¢ï¼‰</code></p>
<h4 id="5-ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">5. ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;123&#x27;</span>; </span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> name<span class="operator">=</span> <span class="number">123</span>; <span class="comment">--ç´¢å¼•å¤±æ•ˆ</span></span><br></pre></td></tr></table></figure>
<h4 id="6-å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±">6. å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±</h4>
<p><strong>å‡†å¤‡ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- é¦–å…ˆåˆ é™¤ä¹‹å‰åˆ›å»ºçš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CALL</span> proc_drop_index(&quot;atguigudb&quot;,&quot;emp&quot;);</span><br><span class="line"><span class="keyword">drop</span> index idx_name <span class="keyword">on</span> emp;</span><br></pre></td></tr></table></figure>
<p>**é—®é¢˜ï¼š**ä¸ºä»¥ä¸‹æŸ¥è¯¢è¯­å¥åˆ›å»ºå“ªç§ç´¢å¼•æ•ˆç‡æœ€é«˜</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢åˆ†æ</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">and</span> deptid <span class="operator">=</span> <span class="number">4</span> <span class="keyword">AND</span> emp.name <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="comment">-- æ‰§è¡ŒSQL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">and</span> deptid <span class="operator">=</span> <span class="number">4</span> <span class="keyword">AND</span> emp.name <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="comment">-- æŸ¥çœ‹æ‰§è¡Œæ—¶é—´</span></span><br><span class="line"><span class="keyword">SHOW</span> PROFILES;</span><br></pre></td></tr></table></figure>
<p><strong>åˆ›å»ºç´¢å¼•å¹¶é‡æ–°æ‰§è¡Œä»¥ä¸Šæµ‹è¯•ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºç´¢å¼•ï¼šåˆ†åˆ«åˆ›å»ºä»¥ä¸‹ä¸‰ç§ç´¢å¼•çš„ä¸€ç§ï¼Œå¹¶åˆ†åˆ«è¿›è¡Œä»¥ä¸ŠæŸ¥è¯¢åˆ†æ</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age <span class="keyword">ON</span> emp(age);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_deptid <span class="keyword">ON</span> emp(age,deptid);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_deptid_name <span class="keyword">ON</span> emp(age,deptid,`name`);</span><br></pre></td></tr></table></figure>
<p>**ç»“è®ºï¼š**å¯ä»¥å‘ç°æœ€é«˜æ•ˆçš„æŸ¥è¯¢åº”ç”¨äº†è”åˆç´¢å¼• <code>idx_age_deptid_name</code></p>
<h4 id="7-æœ€ä½³å·¦å‰ç¼€æ³•åˆ™">7. æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</h4>
<ul>
<li>å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚å³æŸ¥è¯¢ä»<code>ç´¢å¼•çš„æœ€å·¦å‰åˆ—</code>å¼€å§‹å¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚</li>
<li>è¿‡æ»¤æ¡ä»¶è¦ä½¿ç”¨ç´¢å¼•ï¼Œå¿…é¡»æŒ‰ç…§<code>ç´¢å¼•å»ºç«‹æ—¶çš„é¡ºåºï¼Œä¾æ¬¡æ»¡è¶³</code>ï¼Œä¸€æ—¦è·³è¿‡æŸä¸ªå­—æ®µï¼Œç´¢å¼•åé¢çš„å­—æ®µéƒ½æ— æ³•è¢«ä½¿ç”¨ã€‚</li>
</ul>
<h4 id="8-ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—å¤±æ•ˆ">8.ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—å¤±æ•ˆ</h4>
<ul>
<li>åœºæ™¯:
<ul>
<li>æœ‰ä¸‰ä¸ªç´¢å¼•    a,b,c,å½“è¿›è¡ŒæŸ¥è¯¢æ—¶,bç´¢å¼•ä½¿ç”¨äº†èŒƒå›´æ¡ä»¶,  é‚£ä¹ˆæŸ¥è¯¢ä¸­å°±ç®—ä½¿ç”¨äº†cç´¢å¼•,è¿˜æ˜¯ä¼šå¤±æ•ˆ</li>
<li>è§£å†³: å®šä¹‰ç´¢å¼•æ—¶,å°†éœ€è¦èŒƒå›´åˆ¤æ–­çš„ æ”¾åœ¨æœ€å,ä¾‹å¦‚,å®šä¹‰ç´¢å¼•: a,c,b</li>
</ul>
</li>
</ul>
<h3 id="å…³è”æŸ¥è¯¢ä¼˜åŒ–">å…³è”æŸ¥è¯¢ä¼˜åŒ–</h3>
<p><strong>å·¦è¿æ¥:</strong></p>
<p>é’ˆå¯¹ä¸¤å¼ è¡¨çš„è¿æ¥æ¡ä»¶æ¶‰åŠçš„åˆ—ï¼Œç´¢å¼•è¦åˆ›å»ºåœ¨è¢«é©±åŠ¨è¡¨ä¸Šï¼Œé©±åŠ¨è¡¨å°½é‡æ˜¯å°è¡¨</p>
<ul>
<li>å¦‚æœé©±åŠ¨è¡¨ä¸Šæ²¡æœ‰whereè¿‡æ»¤æ¡ä»¶
<ul>
<li>å½“é©±åŠ¨è¡¨çš„è¿æ¥æ¡ä»¶æ²¡æœ‰ç´¢å¼•æ—¶ï¼Œé©±åŠ¨è¡¨æ˜¯å…¨è¡¨æ‰«æ</li>
<li>å½“é’ˆå¯¹é©±åŠ¨è¡¨çš„è¿æ¥æ¡ä»¶å»ºç«‹ç´¢å¼•æ—¶ï¼Œé©±åŠ¨è¡¨ä¾ç„¶è¦è¿›è¡Œå…¨ç´¢å¼•æ‰«æ</li>
<li>å› æ­¤ï¼Œæ­¤æ—¶å»ºç«‹åœ¨é©±åŠ¨è¡¨ä¸Šçš„è¿æ¥æ¡ä»¶ä¸Šçš„ç´¢å¼•æ˜¯æ²¡æœ‰å¤ªå¤§æ„ä¹‰çš„</li>
</ul>
</li>
<li>å¦‚æœé©±åŠ¨è¡¨ä¸Šæœ‰whereè¿‡æ»¤æ¡ä»¶ï¼Œé‚£ä¹ˆé’ˆå¯¹è¿‡æ»¤æ¡ä»¶åˆ›å»ºçš„ç´¢å¼•æ˜¯æœ‰å¿…è¦çš„</li>
</ul>
<p><strong>å†…è¿æ¥:</strong></p>
<p>åœ¨å†…è¿æ¥ä¸­, ä¸¤è¡¨éƒ½å¯ä»¥åšä¸»è¡¨</p>
<p>å‘ç°å³ä½¿äº¤æ¢è¡¨çš„ä½ç½®ï¼ŒMySQLä¼˜åŒ–å™¨ä¹Ÿä¼šè‡ªåŠ¨é€‰æ‹©é©±åŠ¨è¡¨ï¼Œè‡ªåŠ¨é€‰æ‹©é©±åŠ¨è¡¨çš„åŸåˆ™æ˜¯ï¼šç´¢å¼•åˆ›å»ºåœ¨è¢«é©±åŠ¨è¡¨ä¸Šï¼Œé©±åŠ¨è¡¨æ˜¯å°è¡¨ã€‚</p>
<p>æ€»ç»“</p>
<ul>
<li>ä¸Šæ¥å°±ç»™è¿è¡¨å­—æ®µåˆ›å»ºç´¢å¼•</li>
<li>ä¼˜åŒ–å™¨åœ¨é€‰æ‹©é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨çš„æ—¶å€™ï¼Œæ˜¯ä¼˜å…ˆæ ¹æ®ç´¢å¼•ç¡®å®šï¼Œå†è·Ÿæ®æ•°æ®é‡</li>
<li>èƒ½è¿è¡¨çš„å°±ç›´æ¥è¿è¡¨æŸ¥è¯¢ï¼Œå°½é‡ä¸è¦ä½¿ç”¨å­æŸ¥è¯¢ã€‚</li>
</ul>
<h3 id="å­æŸ¥è¯¢ä¼˜åŒ–">å­æŸ¥è¯¢ä¼˜åŒ–</h3>
<p>å°½é‡ä¸è¦ä½¿ç”¨NOT IN æˆ–è€… NOT EXISTSï¼Œç”¨LEFT JOIN xxx ON xx = xx WHERE xx IS NULLæ›¿ä»£</p>
<h3 id="æ’åºä¼˜åŒ–">æ’åºä¼˜åŒ–</h3>
<h4 id="ç´¢å¼•å¤±æ•ˆ">ç´¢å¼•å¤±æ•ˆ</h4>
<ul>
<li>
<p>æ— è¿‡æ»¤,ä¸ç´¢å¼•</p>
<p>æ²¡æœ‰è¿‡æ»¤limitæˆ–where æ¡ä»¶åˆ¤æ–­,ç´¢å¼•å¤±æ•ˆ</p>
</li>
<li>
<p>é¡ºåºé”™,ä¸ç´¢å¼• ,</p>
<p>å®šä¹‰ç´¢å¼•é¡ºåºä¸ä½¿ç”¨ç´¢å¼•é¡ºåºä¸ä¸€è‡´</p>
</li>
<li>
<p>åå‘å,ä¸ç´¢å¼• ,</p>
<p>ä¸åŒå­—æ®µæ’åº,ä¸€ä¸ªå‡åº,ä¸€ä¸ªé™åº</p>
</li>
</ul>
<p>ä¼˜åŒ–æ€è·¯:</p>
<p>å°½é‡è®©whereçš„è¿‡æ»¤æ¡ä»¶å’Œæ’åºä½¿ç”¨ä¸Šç´¢å¼•</p>
<h4 id="åŒè·¯æ’åºå’Œå•è·¯æ’åº">åŒè·¯æ’åºå’Œå•è·¯æ’åº</h4>
<p>å¦‚æœæ’åºæ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œå¼•èµ·äº†filesortï¼ˆæ‰‹å·¥æ’åºï¼‰ï¼Œé‚£ä¹ˆfilesortæœ‰ä¸¤ç§ç®—æ³•</p>
<ul>
<li>åŒè·¯æ’åº:ä¸¤æ¬¡IO</li>
<li>å•è·¯æ’åº:ä¸€æ¬¡IO</li>
</ul>
<p><strong>åŒè·¯æ’åºï¼ˆæ…¢ï¼‰</strong></p>
<p><code>MySQL 4.1ä¹‹å‰æ˜¯ä½¿ç”¨åŒè·¯æ’åºï¼Œ</code>å­—é¢æ„æ€å°±æ˜¯<code>ä¸¤æ¬¡æ‰«æç£ç›˜</code>ï¼Œæœ€ç»ˆå¾—åˆ°æ•°æ®ã€‚</p>
<ul>
<li>
<p>é¦–å…ˆï¼Œæ ¹æ®è¡ŒæŒ‡é’ˆ<code>ä»ç£ç›˜</code>å–<code>æ’åºå­—æ®µ,ä¸»é”®</code>ï¼Œåœ¨bufferè¿›è¡Œæ’åºã€‚</p>
</li>
<li>
<p>å†æŒ‰ç…§æ’åºå­—æ®µçš„é¡ºåº<code>ä»ç£ç›˜</code>å–<code>å…¶ä»–å­—æ®µ</code>ã€‚</p>
</li>
</ul>
<p><code>å–ä¸€æ‰¹æ•°æ®ï¼Œè¦å¯¹ç£ç›˜è¿›è¡Œä¸¤æ¬¡æ‰«æã€‚</code>ä¼—æ‰€å‘¨çŸ¥ï¼ŒIOæ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥åœ¨mysql4.1ä¹‹åï¼Œå‡ºç°äº†ç¬¬äºŒç§æ”¹è¿›çš„ç®—æ³•ï¼Œå°±æ˜¯å•è·¯æ’åºã€‚</p>
<p><strong>å•è·¯æ’åºï¼ˆå¿«ï¼‰</strong></p>
<ul>
<li>
<p>ä»ç£ç›˜è¯»å–æŸ¥è¯¢éœ€è¦çš„<code>æ‰€æœ‰å­—æ®µ</code>ï¼ŒæŒ‰ç…§order byåˆ—åœ¨bufferå¯¹å®ƒä»¬è¿›è¡Œæ’åºã€‚</p>
</li>
<li>
<p>ç„¶åæ‰«ææ’åºåçš„åˆ—è¡¨è¿›è¡Œè¾“å‡ºã€‚</p>
</li>
</ul>
<p>å®ƒçš„æ•ˆç‡æ›´å¿«ä¸€äº›ï¼Œå› ä¸º<code>åªè¯»å–ä¸€æ¬¡ç£ç›˜</code>ï¼Œé¿å…äº†ç¬¬äºŒæ¬¡è¯»å–æ•°æ®ã€‚<code>å¹¶ä¸”æŠŠéšæœºIOå˜æˆäº†é¡ºåºIO</code>ã€‚ä½†æ˜¯å®ƒä¼š<code>ä½¿ç”¨æ›´å¤šçš„ç©ºé—´</code>ï¼Œ å› ä¸ºå®ƒæŠŠæ¯ä¸€è¡Œéƒ½ä¿å­˜åœ¨å†…å­˜ä¸­äº†ã€‚</p>
<p><strong>ç»“è®ºåŠå¼•ç”³å‡ºçš„é—®é¢˜</strong></p>
<ul>
<li>å•è·¯æ¯”å¤šè·¯è¦å¤šå ç”¨æ›´å¤šå†…å­˜ç©ºé—´</li>
<li>å› ä¸ºå•è·¯æ˜¯æŠŠæ‰€æœ‰å­—æ®µéƒ½å–å‡ºï¼Œæ‰€ä»¥æœ‰å¯èƒ½å–å‡ºçš„æ•°æ®çš„æ€»å¤§å°è¶…å‡ºäº†<code>sort_buffer_size</code>çš„å®¹é‡ï¼Œå¯¼è‡´æ¯æ¬¡åªèƒ½å–<code>sort_buffer_size</code>å®¹é‡å¤§å°çš„æ•°æ®ï¼Œè¿›è¡Œæ’åºï¼ˆåˆ›å»ºtmpæ–‡ä»¶ï¼Œå¤šè·¯åˆå¹¶ï¼‰ï¼Œæ’å®Œå†å–sort_bufferå®¹é‡å¤§å°ï¼Œå†æ’â€¦â€¦ä»è€Œå¤šæ¬¡I/Oã€‚</li>
<li><code>å•è·¯æœ¬æ¥æƒ³çœä¸€æ¬¡I/Oæ“ä½œï¼Œåè€Œå¯¼è‡´äº†å¤§é‡çš„I/Oæ“ä½œï¼Œåè€Œå¾—ä¸å¿å¤±ã€‚</code></li>
</ul>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong></p>
<ul>
<li>
<p><code>å‡å°‘select åé¢çš„æŸ¥è¯¢çš„å­—æ®µï¼š</code>Order byæ—¶<code>select * æ˜¯ä¸€ä¸ªå¤§å¿Œ</code>ã€‚æŸ¥è¯¢å­—æ®µè¿‡å¤šä¼šå ç”¨sort_buffer_sizeçš„å®¹é‡ã€‚</p>
</li>
<li>
<p><code>å¢å¤§sort_buffer_sizeå‚æ•°çš„è®¾ç½®ï¼š</code>å½“ç„¶ï¼Œè¦æ ¹æ®ç³»ç»Ÿçš„èƒ½åŠ›å»æé«˜ï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°æ˜¯é’ˆå¯¹æ¯ä¸ªè¿›ç¨‹ï¼ˆconnectionï¼‰çš„ 1M-8Mä¹‹é—´è°ƒæ•´ã€‚ MySQL8.0ï¼ŒInnoDBå­˜å‚¨å¼•æ“é»˜è®¤å€¼æ˜¯1048576å­—èŠ‚ï¼Œ1MBã€‚</p>
</li>
<li>
<p><code>å¢å¤§max_length_for_sort_dataå‚æ•°çš„è®¾ç½®ï¼š</code>MySQLæ ¹æ®max_length_for_sort_dataå˜é‡æ¥ç¡®å®šä½¿ç”¨å“ªç§ç®—æ³•ï¼Œé»˜è®¤å€¼æ˜¯4096å­—èŠ‚ï¼Œå¦‚æœéœ€è¦è¿”å›çš„åˆ—çš„æ€»é•¿åº¦å¤§äºmax_length_for_sort_dataï¼Œä½¿ç”¨åŒè·¯æ’åºç®—æ³•ï¼Œå¦åˆ™ä½¿ç”¨å•è·¯æ’åºç®—æ³•ã€‚ä½†æ˜¯å¦‚æœè®¾çš„å¤ªé«˜ï¼Œæ•°æ®æ€»å®¹é‡è¶…å‡ºsort_buffer_sizeçš„æ¦‚ç‡å°±å¢å¤§ï¼Œæ˜æ˜¾ç—‡çŠ¶æ˜¯é«˜çš„ç£ç›˜I/Oæ´»åŠ¨å’Œä½çš„å¤„ç†å™¨ä½¿ç”¨ç‡ã€‚1024-8192ä¹‹é—´è°ƒæ•´ã€‚</p>
</li>
</ul>
<h3 id="åˆ†ç»„ä¼˜åŒ–">åˆ†ç»„ä¼˜åŒ–</h3>
<ul>
<li><code>group by ä½¿ç”¨ç´¢å¼•çš„åŸåˆ™å‡ ä¹è·Ÿorder byä¸€è‡´</code>ã€‚ä½†æ˜¯group by å³ä½¿æ²¡æœ‰è¿‡æ»¤æ¡ä»¶ç”¨åˆ°ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ç´¢å¼•ï¼ˆOrder By å¿…é¡»æœ‰è¿‡æ»¤æ¡ä»¶æ‰èƒ½ä½¿ç”¨ä¸Šç´¢å¼•ï¼‰</li>
<li>åŒ…å«äº†order byã€group byã€distinctè¿™äº›æŸ¥è¯¢çš„è¯­å¥ï¼Œwhereæ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„ç»“æœé›†è¯·ä¿æŒåœ¨1000è¡Œä»¥å†…ï¼Œå¦åˆ™SQLä¼šå¾ˆæ…¢ã€‚</li>
</ul>
<h4 id="è¦†ç›–ç´¢å¼•ä¼˜åŒ–">è¦†ç›–ç´¢å¼•ä¼˜åŒ–</h4>
<ul>
<li>ç¦æ­¢ä½¿ç”¨select *ï¼Œç¦æ­¢æŸ¥è¯¢ä¸ä¸šåŠ¡æ— å…³å­—æ®µ</li>
<li>å°½é‡åˆ©ç”¨è¦†ç›–ç´¢å¼•</li>
</ul>
<h4 id="ä¼˜åŒ–å£è¯€">ä¼˜åŒ–å£è¯€</h4>
<p>å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±ï¼Œæœ€å·¦å‰ç¼€è¦éµå®ˆï¼›<br>
å¸¦å¤´å¤§å“¥ä¸èƒ½æ­»ï¼Œä¸­é—´å…„å¼Ÿä¸èƒ½æ–­ï¼›<br>
ç´¢å¼•åˆ—ä¸Šå°‘è®¡ç®—ï¼ŒèŒƒå›´ä¹‹åå…¨å¤±æ•ˆï¼›<br>
likeç™¾åˆ†å†™æœ€å³ï¼Œè¦†ç›–ç´¢å¼•ä¸å†™*ï¼›</p>
<p>ä¸ç­‰ç©ºå€¼è¿˜æœ‰orï¼Œç´¢å¼•å¤±æ•ˆè¦å°‘ç”¨ï¼›<br>
varå¼•å·ä¸èƒ½ä¸¢ï¼Œsqlé«˜çº§ä¹Ÿä¸éš¾ï¼›</p>
<h2 id="æ…¢æŸ¥è¯¢æ—¥å¿—">æ…¢æŸ¥è¯¢æ—¥å¿—</h2>
<ul>
<li>
<p><strong>ä»‹ç»:</strong> ä¸€ç§æ—¥å¿—, è®°å½•æœ‰å“ªäº›sqlæ‰§è¡Œè¶…å‡ºäº†é˜ˆå€¼.</p>
</li>
<li>
<p><strong>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</strong></p>
<p>é»˜è®¤æƒ…å†µä¸‹æ•°æ®åº“æ²¡æœ‰å¼€å¯ æ…¢æŸ¥è¯¢æ—¥å¿—.</p>
<p>æ…¢æŸ¥è¯¢æ—¥å¿—å¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“</p>
<ul>
<li>
<p>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log<span class="operator">=</span><span class="number">1</span>; </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½®æ–‡ä»¶è®¾ç½®</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">slow_query_log</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">slow_query_log_file</span>=<span class="string">slow-query.log</span></span><br><span class="line"><span class="attr">long-query_time</span>=<span class="string">0.1#æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ—¶é—´å®šä¹‰ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ä¸º10ç§’ï¼Œå¤šä¹…å°±ç®—æ…¢æŸ¥è¯¢çš„æ—¥å¿—</span></span><br><span class="line"><span class="attr">log_queries_not_using_indexes</span>=<span class="string">1#å°†æ‰€æœ‰æ²¡æœ‰ä½¿ç”¨å¸¦ç´¢å¼•çš„æŸ¥è¯¢è¯­å¥å…¨éƒ¨å†™åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢æ˜¯å¦å¼€å¯,ä»¥åŠæ—¥å¿—ä½ç½®:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%slow_query_log%&#x27;</span>; </span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>ä¿®æ”¹é˜ˆå€¼</strong></p>
<ul>
<li>é»˜è®¤é˜ˆå€¼ä¸º10ç§’</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%long_query_time%&#x27;</span>; <span class="comment">-- æŸ¥çœ‹å€¼ï¼šé»˜è®¤10ç§’</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time<span class="operator">=</span><span class="number">0.1</span>; <span class="comment">-- è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒçŸ­çš„æ—¶é—´ï¼Œä¾¿äºæµ‹è¯•</span></span><br></pre></td></tr></table></figure>
<p>â€‹	<strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li><strong>éœ€è¦é‡æ–°ç™»å½•å®¢æˆ·ç«¯</strong>ä½¿ä¸Šé¢çš„è®¾ç½®ç”Ÿæ•ˆ</li>
<li>å‡å¦‚è¿è¡Œæ—¶é—´æ­£å¥½ç­‰äºlong_query_timeçš„æƒ…å†µï¼Œå¹¶ä¸ä¼šè¢«è®°å½•ä¸‹æ¥ã€‚</li>
<li>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨mysqlæºç é‡Œæ˜¯åˆ¤æ–­å¤§äºlong_query_timeï¼Œè€Œéå¤§äºç­‰äºã€‚</li>
</ul>
</li>
<li>
<p><strong>æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—æ•°:</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;%Slow_queries%&#x27;</span>; </span><br></pre></td></tr></table></figure>
<p>å­˜å‚¨è·¯å¾„: <code>vim /var/lib/mysql/atguigu-slow.log</code></p>
</li>
</ul>
<h3 id="æ—¥å¿—åˆ†æå·¥å…·-mysqldumpslow">æ—¥å¿—åˆ†æå·¥å…·(mysqldumpslow)</h3>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚æœè¦æ‰‹å·¥åˆ†ææ—¥å¿—ï¼ŒæŸ¥æ‰¾ã€åˆ†æSQLï¼Œæ˜¾ç„¶æ˜¯ä¸ªä½“åŠ›æ´»ï¼ŒMySQLæä¾›äº†æ—¥å¿—åˆ†æå·¥å…·mysqldumpslowã€‚é€€å‡ºmysqlå‘½ä»¤è¡Œï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹mysqldumpslowçš„å¸®åŠ©ä¿¡æ¯</span></span><br><span class="line">mysqldumpslow <span class="comment">--help</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å·¥ä½œå¸¸ç”¨å‚è€ƒ</span></span><br><span class="line"><span class="comment">-- 1.å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„10ä¸ªSQL</span></span><br><span class="line">mysqldumpslow <span class="operator">-</span>s r <span class="operator">-</span>t <span class="number">10</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>atguigu<span class="operator">-</span>slow.log</span><br><span class="line"><span class="comment">-- 2.å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„10ä¸ªSQL</span></span><br><span class="line">mysqldumpslow <span class="operator">-</span>s c <span class="operator">-</span>t <span class="number">10</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>atguigu<span class="operator">-</span>slow.log</span><br><span class="line"><span class="comment">-- 3.å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰10æ¡é‡Œé¢å«æœ‰å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥</span></span><br><span class="line">mysqldumpslow <span class="operator">-</span>s t <span class="operator">-</span>t <span class="number">10</span> <span class="operator">-</span>g &quot;left join&quot; <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>atguigu<span class="operator">-</span>slow.log</span><br><span class="line"><span class="comment">-- 4.å¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ | å’Œmore ä½¿ç”¨ ï¼Œå¦åˆ™è¯­å¥è¿‡å¤šæœ‰å¯èƒ½å‡ºç°çˆ†å±æƒ…å†µ</span></span><br><span class="line">mysqldumpslow <span class="operator">-</span>s r <span class="operator">-</span>t <span class="number">10</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>atguigu<span class="operator">-</span>slow.log <span class="operator">|</span> more</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>-a: ä¸å°†æ•°å­—æŠ½è±¡æˆNï¼Œå­—ç¬¦ä¸²æŠ½è±¡æˆS</p>
</li>
<li>
<p>-s: æ˜¯è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åºï¼›</p>
<ul>
<li>
<p>c: sqlè¯­å¥çš„è®¿é—®æ¬¡æ•°</p>
</li>
<li>
<p>l: é”å®šæ—¶é—´</p>
</li>
<li>
<p>r: è¿”å›æ•°æ®è®°å½•é›†çš„æ€»æ•°é‡</p>
</li>
<li>
<p>t: æŸ¥è¯¢æ—¶é—´</p>
</li>
<li>
<p>al:å¹³å‡é”å®šæ—¶é—´</p>
</li>
<li>
<p>ar:å¹³å‡è¿”å›è®°å½•æ•°</p>
</li>
<li>
<p>at:å¹³å‡æŸ¥è¯¢æ—¶é—´</p>
</li>
</ul>
</li>
<li>
<p>-t: å³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ®ï¼›</p>
</li>
<li>
<p>-g: åè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„ï¼›</p>
</li>
</ul>
<h2 id="è§†å›¾">è§†å›¾</h2>
<ul>
<li>
<p><strong>ä»‹ç»:</strong></p>
<p>è§†å›¾æ˜¯å»ºç«‹åœ¨è¡¨ä¹‹ä¸Šçš„ä¼ªè¡¨ï¼Œè§†å›¾æœ¬èº«<strong>ä¸å­˜å‚¨æ•°æ®</strong>ï¼Œè§†å›¾ä¸­çš„æ•°æ®éƒ½æ˜¯è§†å›¾åº•å±‚è¡¨ä¸­çš„æ•°æ®,<strong>å­˜å‚¨çš„æ˜¯sqlé€»è¾‘</strong>ã€‚</p>
</li>
<li>
<p><strong>ä½œç”¨:</strong></p>
<ul>
<li>ä¿è¯æ•°æ®çš„å®‰å…¨</li>
<li>å­˜å‚¨å¤æ‚çš„ä¸šåŠ¡é€»è¾‘</li>
</ul>
</li>
<li>
<p><strong>ä½¿ç”¨åœºæ™¯:</strong></p>
<ul>
<li>å…±ç”¨æŸ¥è¯¢ç»“æœ</li>
<li>æŠ¥è¡¨</li>
<li>å¤æ‚sqlä½¿ç”¨</li>
</ul>
</li>
<li>
<p><strong>è¯­æ³•:</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">è§†å›¾çš„è¯­æ³•ï¼š</span><br><span class="line">è§†å›¾çš„åˆ›å»ºï¼š</span><br><span class="line"><span class="keyword">create</span> [<span class="keyword">or</span> replace] <span class="keyword">view</span> è§†å›¾å  <span class="keyword">as</span> <span class="keyword">select</span>æŸ¥è¯¢è¯­å¥<span class="operator">!</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t5 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1;</span><br><span class="line">  </span><br><span class="line">è§†å›¾çš„ä¿®æ”¹ï¼š</span><br><span class="line"><span class="keyword">update</span> è§†å›¾å <span class="keyword">set</span> åˆ—å<span class="operator">=</span>åˆ—å€¼,åˆ—å<span class="operator">=</span>åˆ—å€¼ <span class="keyword">where</span> æ¡ä»¶</span><br><span class="line">  </span><br><span class="line">è§†å›¾åˆ é™¤ï¼š</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> è§†å›¾å <span class="keyword">where</span> æ¡ä»¶</span><br><span class="line">    </span><br><span class="line">è§†å›¾çš„æŸ¥è¯¢ï¼š</span><br><span class="line"><span class="keyword">select</span> åˆ—å <span class="keyword">from</span> è§†å›¾å <span class="keyword">where</span> æ¡ä»¶</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="åˆ›å»º">åˆ›å»º</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è¯­æ³•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name </span><br><span class="line"><span class="keyword">AS</span> <span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¾‹å¦‚ï¼šæ±‚æ‰€æœ‰äººç‰©å¯¹åº”çš„æŒé—¨åç§°</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> v_ceo <span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> emp.name, ceo.name <span class="keyword">AS</span> ceoname </span><br><span class="line"><span class="keyword">FROM</span> t_emp emp</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> t_dept dept <span class="keyword">ON</span> emp.deptid <span class="operator">=</span> dept.id </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> t_emp ceo <span class="keyword">ON</span> dept.ceo <span class="operator">=</span> ceo.id;</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨">ä½¿ç”¨</h4>
<p><strong>æŸ¥è¯¢</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è¯­æ³•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> view_name; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> v_ceo; </span><br></pre></td></tr></table></figure>
<p><strong>æ›´æ–°</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è¯­æ³•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> view_name </span><br><span class="line"><span class="keyword">AS</span> <span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> <span class="keyword">condition</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å»ºè®®ç›´æ¥åˆ é™¤é‡æ–°åˆ›å»º</span></span><br></pre></td></tr></table></figure>
<p><strong>åˆ é™¤</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> view_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> v_ceo;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„: ä¿®æ”¹ è§†å›¾çš„ä¿¡æ¯ ,æºè¡¨çš„ä¿¡æ¯ä¹Ÿä¼šå˜,  ä¿®æ”¹æºè¡¨,è§†å›¾çš„ä¹Ÿä¼šæ›´æ–°.</p>
</blockquote>
<h2 id="MVCC-ç•¥è®²">MVCC (ç•¥è®²)</h2>
<ul>
<li>
<p><em>MVCC</em>ï¼Œæ˜¯Multiversion Concurrency Controlçš„ç¼©å†™ï¼Œç¿»è¯‘è¿‡æ¥æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œä»–ä¹Ÿæ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„è§£å†³æ–¹æ¡ˆã€‚</p>
</li>
<li>
<p>åœ¨æ•°æ®çš„å¹¶å‘åœºæ™¯ä¸­:  MVCCæ˜¯ç”¨æ¥è§£å†³<strong>è¯»-å†™å¹¶å‘</strong>çš„</p>
</li>
<li>
<p><strong>åªå·¥ä½œåœ¨å¯é‡å¤è¯»å’Œè¯»å·²æäº¤åœºæ™¯ä¸‹</strong></p>
<ul>
<li>
<p>è¯»-è¯»å¹¶å‘</p>
</li>
<li>
<p>å†™-å†™å¹¶å‘: é”ï¼ˆæ‚²è§‚é”+ä¹è§‚é”ï¼‰</p>
</li>
<li>
<p>è¯»-å†™å¹¶å‘: MVCC</p>
</li>
</ul>
</li>
</ul>
<h3 id="å¿«ç…§è¯»å’Œå½“å‰è¯»">å¿«ç…§è¯»å’Œå½“å‰è¯»</h3>
<h4 id="å½“å‰è¯»">å½“å‰è¯»</h4>
<ul>
<li>
<p>è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°æ•°æ®(ä¸æ˜¯å†å²ç‰ˆæœ¬)</p>
</li>
<li>
<p>è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•,æ‰€ä»¥<strong>ä¼šå¯¹å½“å‰è®°å½•åŠ é”</strong>.</p>
</li>
<li>
<p>æ‰€ä»¥å½“å‰è¯»å°±æ˜¯<strong>åŠ é”çš„è¯»æ“ä½œ</strong></p>
</li>
<li>
<p>åŠ é”çš„select æˆ–è€…å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹éƒ½ä¼šè¿›è¡Œå½“å‰è¯»</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> xx_table LOCK <span class="keyword">IN</span> SHARE MODE;  # å…±äº«é”</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> xx_table <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;			# æ’å®ƒé”</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> xx_table ...					# æ’å®ƒé”</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> xx_table ...					# æ’å®ƒé”</span><br><span class="line"><span class="keyword">UPDATE</span> xx_table ...							# æ’å®ƒé”</span><br></pre></td></tr></table></figure>
<h4 id="å¿«ç…§è¯»">å¿«ç…§è¯»</h4>
<ul>
<li>
<p><strong>ä¸åŠ é”çš„ç®€å•çš„ SELECT éƒ½å±äºå¿«ç…§è¯»</strong>ï¼Œå³ä¸åŠ é”çš„éé˜»å¡</p>
</li>
<li>
<p><strong>åœºæ™¯:</strong></p>
<p>åŸºäºæé«˜å¹¶å‘æ€§èƒ½çš„è€ƒè™‘,  å¿«ç…§è¯»æ˜¯åŸºäºMVCC,  åœ¨å¾ˆå¤šæƒ…å†µä¸‹,é¿å…äº†åŠ é”, å‡ä½äº†å¼€é”€</p>
<p>å¤šç‰ˆæœ¬ï¼Œé‚£ä¹ˆ<strong>å¿«ç…§è¯»å¯èƒ½è¯»åˆ°çš„å¹¶ä¸ä¸€å®šæ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œæœ‰å¯èƒ½æ˜¯ä¹‹å‰çš„å†å²ç‰ˆæœ¬</strong>ã€‚ å¿«ç…§è¯»çš„å‰ææ˜¯éš”ç¦»çº§åˆ«ä¸æ˜¯ä¸²è¡Œçº§åˆ«ï¼Œä¸²è¡Œçº§åˆ«ä¸‹çš„å¿«ç…§è¯»ä¼šé€€åŒ–æˆå½“å‰è¯»ã€‚</p>
</li>
</ul>
<h4 id="MVCCè¯»å–åˆ†æ-è¯»å·²æäº¤ã€å¯é‡å¤è¯»">MVCCè¯»å–åˆ†æ[è¯»å·²æäº¤ã€å¯é‡å¤è¯»]</h4>
<p><img src="http://120.26.79.238:9000/blog/img/d424fd65c0ac5134a531e1262e41084e.png" alt=""></p>
<ol>
<li>åœ¨<strong>è¯»å·²æäº¤</strong>çš„éš”ç¦»çº§åˆ«ä¸‹: select åç§° æŸ¥æ‰¾çš„éƒ½æ˜¯æœ€æ–°çš„æ•°æ®,æ­¤æ—¶å¦‚æœæœ‰æ–°äº‹åŠ¡æ›´æ–°æ•°æ®ä¸”æäº¤,  åœ¨æ­¤æœŸé—´çš„ select è¯»å–åˆ°çš„åŒä¸€æ¡æ•°æ®å¯èƒ½ä¸åŒ</li>
<li>åœ¨<strong>å¯é‡å¤è¯»</strong>éš”ç¦»çº§åˆ«ä¸‹: å½“ç¬¬ä¸€æ¬¡æäº¤select ä¹‹å, MVCCä¼šç”Ÿæˆä¸€ä¸ªå½“å‰æŸ¥æ‰¾çš„å¿«ç…§, å½“å†æ¬¡select æ—¶,ä¼šè¿”å›è¿™ä¸ªå¿«ç…§, æ— è®ºæ˜¯å¦æœ‰å…¶ä»–äº‹åŠ¡æäº¤, æ­¤æ—¶åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸‹çš„ä¸¤æ¬¡selectçš„æ•°æ®ä¸€å®šä¸€æ ·,ä½†ä¸ä¸€å®šæ˜¯æœ€æ–°æ•°æ®.</li>
</ol>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<p>1.åœ¨è¯»å·²æäº¤ï¼ˆRead Committed:ç®€ç§°RCï¼‰éš”ç¦»çº§åˆ«ä¸‹,ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ¯ä¸€æ¬¡ SELECT æŸ¥è¯¢éƒ½ä¼šé‡æ–°è·å–ä¸€æ¬¡ Read Viewã€è¯»è§†å›¾ã€‘ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/c8a74c4f4bfc4df90c8824e53ed81947.png" alt=""></p>
<p>2.åœ¨å¯é‡å¤è¯»ï¼ˆRepeatable Read:ç®€ç§°RRï¼‰éš”ç¦»çº§åˆ«ä¸‹,ä¸€ä¸ªäº‹åŠ¡ä¸­åªåœ¨ç¬¬ä¸€æ¬¡ SELECT çš„æ—¶å€™ä¼š è·å–ä¸€æ¬¡ Read Viewï¼Œè€Œåé¢æ‰€æœ‰çš„ SELECT</p>
<p>éƒ½ä¼šå¤ç”¨è¿™ä¸ª Read Viewã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/a46d3d6e688932d2ed0608386e4b54b4.png" alt=""></p>
<h4 id="æ— ç´¢å¼•ç´¢å¼•å¤±æ•ˆæƒ…å†µ">æ— ç´¢å¼•ç´¢å¼•å¤±æ•ˆæƒ…å†µ</h4>
<ul>
<li>å½“å¯¹InnoDBå¼•æ“ä¸‹çš„è¡¨è¿›è¡Œæ›´æ–°,  å¦‚æœ ç´¢å¼•å¤±æ•ˆ, æ­¤æ—¶ å°±ä¸ä¼šåŠ  è¡Œé”,è€Œæ˜¯ åŠ è¡¨é” .</li>
</ul>
<h3 id="å„ç§æ—¥å¿—è¯´æ˜">å„ç§æ—¥å¿—è¯´æ˜</h3>
<p>1.æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆSlow Query Logï¼‰ï¼šè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šé˜ˆå€¼çš„æŸ¥è¯¢è¯­å¥ã€‚æ…¢æŸ¥è¯¢æ—¥å¿—å¯ä»¥å¸®åŠ©ä½ æ‰¾å‡ºæ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„æŸ¥è¯¢ï¼Œä»¥ä¾¿è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>
<p>2.äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼‰ï¼šè®°å½•æ‰€æœ‰å¯¹æ•°æ®åº“çš„æ›´æ”¹æ“ä½œï¼ŒåŒ…æ‹¬æ•°æ®ä¿®æ”¹ã€è¡¨ç»“æ„å˜æ›´ç­‰ã€‚äºŒè¿›åˆ¶æ—¥å¿—å¯ä»¥ç”¨äºæ•°æ®æ¢å¤ã€ä¸»ä»å¤åˆ¶ç­‰åœºæ™¯ã€‚</p>
<p>relay log: ä¸­ç»§æ—¥å¿—</p>
<p>3.äº‹åŠ¡æ—¥å¿—ï¼š</p>
<p>ä¹Ÿç§°ä¸ºé‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰,ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼šè®°å½•æ­£åœ¨è¿›è¡Œçš„äº‹åŠ¡çš„æ›´æ”¹æ“ä½œã€‚äº‹åŠ¡æ—¥å¿—ç”¨äºä¿è¯æ•°æ®åº“çš„ACIDç‰¹æ€§ï¼Œå¹¶æ”¯æŒå´©æºƒæ¢å¤ã€‚</p>
<p>ACID: åŸå­æ€§  ä¸€è‡´æ€§  éš”ç¦»æ€§  æŒä¹…æ€§</p>
<p>undo logï¼šä¿è¯äº‹åŠ¡çš„åŸå­æ€§ å’Œ ä¸€è‡´æ€§</p>
<p>éš”ç¦»æ€§ï¼š</p>
<p>MVCC:undo log+ReadView(è§†å›¾å¿«ç…§)</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Nacosæºç è§£æ</title>
    <url>/2025/09/15/Nacos%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<ol>
<li>
<p>jaråŒ…æŒ‡å®šé…ç½®æ–‡ä»¶</p>
<p>â€“spring.config.location=/ect/server/application.yml</p>
<p>ä¼˜å…ˆçº§, --spring.config.locationå¤§äºjaråŒ…ä¸­çš„é…ç½®</p>
</li>
<li>
<p>spring boot çš„é¡¹ç›®</p>
</li>
<li>
<p>é€šä¿¡éƒ½æ˜¯ä½¿ç”¨Rest APIé€šä¿¡</p>
</li>
<li>
<p>æ³¨å†Œçš„å•ä½æ˜¯å®ä¾‹, æœ€å°å•å…ƒæ˜¯å®ä¾‹</p>
</li>
<li>
<p>å•é›†ç¾¤çš„nacos çš„åŠŸèƒ½</p>
<ul>
<li>æœåŠ¡å‘ç°</li>
<li>å¿ƒè·³æ£€æµ‹</li>
<li>æœåŠ¡æ³¨å†Œ</li>
</ul>
</li>
<li>
<p>å®ä¾‹:<code> isemphere: true /false</code></p>
<ul>
<li>ä¸´æ—¶å®ä¾‹ :APæ¶æ„(æ³¨å†Œä¸­å¿ƒ)</li>
<li>æ°¸ä¹…å®ä¾‹ :CPæ¶æ„(é…ç½®ä¸­å¿ƒ)</li>
</ul>
</li>
<li>
<p>æœåŠ¡æ³¨å†Œçš„è¯·æ±‚æ–¹å¼:</p>
<ul>
<li>1.xç‰ˆæœ¬ä½¿ç”¨http / httpsè¯·æ±‚</li>
<li>2.xç‰ˆæœ¬åŠä»¥å: grpcè¯·æ±‚</li>
</ul>
</li>
<li>
<p>AutoConfigreAfter ( {xxxx.class ,xxx.class}) åœ¨åœ¨è¿™å†™é…ç½®åŠ è½½ä¹‹åå†åŠ è½½ é¡ºåº</p>
</li>
<li>
<p>å®ä¾‹æ³¨å†Œè¯·æ±‚å‘é€æ—¶æœº:</p>
<p>Spring ç›‘å¬å™¨ApplicationListener ç›‘å¬WenInit åˆå§‹åŒ–å®Œæˆå å‘é€è¯·æ±‚;</p>
</li>
<li>
<p>spring boot web å®¹å™¨</p>
<ul>
<li>tomcat : é»˜è®¤</li>
<li>undertow</li>
<li>jetty</li>
</ul>
</li>
<li>
<p>nacosæ³¨å†Œè¡¨ç»“æ„</p>
</li>
</ol>
<ul>
<li>Nacos æ³¨å†Œè¡¨ç»“æ„çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªåŒå±‚ <code>Map</code> ç»“æ„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
<ul>
<li>
<p><strong>æœ€å¤–å±‚ Map</strong>:</p>
<ul>
<li><strong>Key</strong>: <code>nameSpace</code> (å‘½åç©ºé—´)</li>
<li><strong>Value</strong>: ä¸€ä¸ª <code>Map</code></li>
</ul>
</li>
<li>
<p><strong>ç¬¬äºŒå±‚ Map</strong>: ConcurrentHashMap</p>
<ul>
<li><strong>Key</strong>:  <code> ServiceName</code> (ç»„::æœåŠ¡åç§°)</li>
<li><strong>Value</strong>: <code>Service</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†ä¸€äº›å…³é”®å±æ€§ã€‚</li>
</ul>
</li>
<li>
<p><strong>Service å¯¹è±¡çš„å±æ€§</strong>:</p>
<ul>
<li><strong><code>clusterMap</code></strong>: ä¸€ä¸ª <code>Map</code>ï¼Œç”¨äºç®¡ç†ä¸åŒçš„é›†ç¾¤
<ul>
<li><strong>Key</strong>: é›†ç¾¤åç§° (<code>clusterName</code>)</li>
<li><strong>Value</strong>: ä¸€ä¸ª <code>Set</code>ï¼ŒåŒ…å«é›†ç¾¤å†…çš„ <code>Instance</code> å¯¹è±¡é›†åˆ</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Instance å¯¹è±¡</strong>:</p>
<ul>
<li>è¡¨ç¤ºå…·ä½“çš„æœåŠ¡å®ä¾‹ï¼ŒåŒ…å«å®ä¾‹çš„ IP åœ°å€ã€ç«¯å£ã€æƒé‡ã€å¥åº·çŠ¶æ€ç­‰ä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">+----------------------------------------------------------+</span><br><span class="line">|                        NameSpace                        |</span><br><span class="line">|                    (æœ€å¤–å±‚ Map)                          |</span><br><span class="line">| +-----------------------------------------------------+  |</span><br><span class="line">| |               groupName::ServiceName (ç»„::æœåŠ¡åç§°)   |  |</span><br><span class="line">| | +-------------------------------------------------+ |  |</span><br><span class="line">| | |               clusterMap (é›†ç¾¤ç®¡ç†)              | |  |</span><br><span class="line">| | | +---------------------------------------------+ | |  |</span><br><span class="line">| | | |         clusterName (é›†ç¾¤åç§°)              | | |  |</span><br><span class="line">| | | | +-----------------------------------------+ | | |  |</span><br><span class="line">| | | | |           InstanceSet (å®ä¾‹é›†åˆ)         | | | |  |</span><br><span class="line">| | | | |  +-----------------------------------+  | | | |  |</span><br><span class="line">| | | | |  | Instance (å®ä¾‹)                  |  | | | |  |</span><br><span class="line">| | | | |  | - IP åœ°å€                         |  | | | |  |</span><br><span class="line">| | | | |  | - ç«¯å£                             |  | | | |  |</span><br><span class="line">| | | | |  | - æƒé‡                             |  | | | |  |</span><br><span class="line">| | | | |  | - å¥åº·çŠ¶æ€                         |  | | | |  |</span><br><span class="line">| | | | |  +-----------------------------------+  | | | |  |</span><br><span class="line">| | | | +-----------------------------------------+ | | |  |</span><br><span class="line">| | | +---------------------------------------------+ | |  |</span><br><span class="line">| | +-------------------------------------------------+ |  |</span><br><span class="line">| +-----------------------------------------------------+  |</span><br><span class="line">+----------------------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>ä¸€ Nacos çš„æ ¸å¿ƒåŠŸèƒ½</h1>
<h2 id="é€šä¿¡æœºåˆ¶">é€šä¿¡æœºåˆ¶</h2>
<ul>
<li>
<ol>
<li>åœ¨<code>1.x</code>ç‰ˆæœ¬ä¸­, Nacos çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡Restfulé£æ ¼çš„è¯·æ±‚é€šä¿¡çš„</li>
<li>åœ¨<code>2.x</code>ç‰ˆæœ¬ä¹‹å, æ”¹ç”¨äº†grpcçš„æ–¹å¼</li>
</ol>
</li>
</ul>
<h2 id="æœåŠ¡æ³¨å†Œ">æœåŠ¡æ³¨å†Œ</h2>
<blockquote>
<p>naocs æœåŠ¡å®¢æˆ·ç«¯,åœ¨å¯åŠ¨æ—¶, ä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„nacos çš„æœåŠ¡ç«¯é…ç½®ä¿¡æ¯, å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚, å°†å®¢æˆ·ç«¯çš„å…ƒæ•°æ®å‘é€ç»™æœåŠ¡ç«¯, æ¯”å¦‚: ip \  port \ æœåŠ¡å  ç­‰ä¿¡æ¯.</p>
<p>æœåŠ¡ç«¯æ¥æ”¶åˆ°æ•°æ®å, ä¼šå°†å®¢æˆ·ç«¯çš„å…ƒæ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªåŒå±‚mapä¸­</p>
</blockquote>
<p>æœåŠ¡æ³¨å†Œçš„æ—¶é—´: åœ¨å®¢æˆ·ç«¯å¯åŠ¨æ—¶, nacoså®¢æˆ·ç«¯ä½¿ç”¨äº†springçš„ç›‘å¬å™¨ApplicaitonListener,ç›‘å¬WebServerInitializedEvent æ˜¯äº‹ä»¶, å½“webæœåŠ¡å™¨å¯åŠ¨å, å‘é€ä¸€ä¸ªè¯·æ±‚ç»™æœåŠ¡ç«¯æ³¨å†ŒæœåŠ¡.</p>
<p>å‘é€çš„è¯·æ±‚åœ°å€ : Http: nacosip:nacosç«¯å£å·/nacos/v1/ns/instance å‘é€ä¸€ä¸ªPostè¯·æ±‚, å¸¦ä¸Šè¯·æ±‚å¤´å’Œè¯·æ±‚å‚æ•° : å…ƒæ•°æ® \ Ip \ ç«¯å£ \ æœåŠ¡å \ namspace ç­‰</p>
<h2 id="æœåŠ¡å¿ƒè·³æ£€æµ‹">æœåŠ¡å¿ƒè·³æ£€æµ‹</h2>
<blockquote>
<p>åœ¨å®¢æœç«¯æœåŠ¡æ³¨å†ŒæˆåŠŸä¹‹å, Nacos çš„å®¢æˆ·ç«¯ä¼šç»´æŠ¤ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ , æ¥æŒç»­çš„å‘é€è¯·æ±‚ç»™æœåŠ¡ç«¯ ,å‘Šè¯‰æœåŠ¡ç«¯è‡ªå·±è¿˜æ´»ç€ ,é»˜è®¤æ˜¯æ¯5ç§’å‘é€ä¸€æ¬¡, é˜²æ­¢æœåŠ¡åœ¨æ³¨å†Œä¸­å¿ƒè¢«å‰”é™¤</p>
</blockquote>
<h2 id="æœåŠ¡çš„å¥åº·æ£€æŸ¥">æœåŠ¡çš„å¥åº·æ£€æŸ¥</h2>
<blockquote>
<p>Nacosçš„æœåŠ¡ç«¯ä¹Ÿä¼šç»´æŠ¤ä¸€ä¸ªå®šæ—¶ä»»åŠ¡, é€šè¿‡åˆ¤æ–­å½“å‰æ—¶é—´å’Œå®ä¾‹æœ€åä¸€æ¬¡çš„æ£€æµ‹æ—¶é—´, å¦‚æœè¶…è¿‡äº†15ç§’, å°±å°†è¯¥å®ä¾‹çš„å¥åº·çŠ¶æ€æ”¹ä¸ºfalse ,é»˜è®¤æ˜¯true, å¦‚æœè¶…è¿‡äº†30 ç§’, åˆ™ç›´æ¥å°†è¯¥æœåŠ¡ä»nacosä¸­å‰”é™¤</p>
</blockquote>
<h2 id="æœåŠ¡å‘ç°">æœåŠ¡å‘ç°</h2>
<blockquote>
<p>æœåŠ¡ç«¯åœ¨æ³¨å†Œåˆ°nacoså, åœ¨è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡æ—¶, ä¼šå‘é€è¯·æ±‚ç»™æœåŠ¡ç«¯, æ‹‰å–æœåŠ¡ç«¯ä¸­æ‰€æ³¨å†Œçš„æœåŠ¡æ¸…å•,å¹¶ä¸”ç¼“å­˜åœ¨å®¢æˆ·ç«¯æœ¬åœ°,åŒæ—¶ä¼šå¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡,å®šæ—¶ä»æœåŠ¡ç«¯æ‹‰å–æœ€æ–°æœåŠ¡æ¸…å•</p>
<p>æ‰€ä»¥åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶, é€Ÿåº¦ä¼šç›¸å¯¹æ…¢æœ‰ç‚¹ , åç»­ä¸»è¦é€šè¿‡æŸ¥æ‰¾ç¼“å­˜ä¸­çš„æœåŠ¡åˆ—è¡¨æ¥è°ƒç”¨, é å®šæ—¶ä»»åŠ¡æ¥å®šæ—¶æ›´æ–°ç¼“å­˜ä¸­çš„æœåŠ¡åˆ—è¡¨</p>
</blockquote>
<h2 id="NacosæœåŠ¡æ³¨å†Œè¡¨ç»“æ„">NacosæœåŠ¡æ³¨å†Œè¡¨ç»“æ„</h2>
<ul>
<li>
<p>åŒMapç»“æ„:<code>HashMap&lt;String,CurrentHashMap&lt;String,Service&gt;&gt; </code></p>
<ul>
<li>
<p>ç¬¬ä¸€å±‚æ˜¯ä¸€ä¸ªHashMap ,Key æ˜¯ <code>nameSpace</code>, Value æ˜¯ä¸€ä¸ªCurrentHashMap&lt;Service,&gt;</p>
</li>
<li>
<p>ç¬¬äºŒå±‚çš„CurrentHashMapçš„ Key æ˜¯ <code>GroupName::ServiceName</code>, Value æ˜¯ Service å¯¹è±¡</p>
<p>Groupæœ¬èº«æ²¡æœ‰å•ç‹¬çš„ä¸€ä¸ªå±‚çº§, é€šå¸¸æ˜¯ç›´æ¥æºå¸¦åœ¨ServiceNameåé¢,åœ¨æŸ¥æ‰¾æ—¶å°±å¯ä»¥åˆ¤æ–­å±äºå“ªä¸ªç»„äº†</p>
</li>
<li>
<p>Serviceå¯¹è±¡: Service å¯¹è±¡ä¸­åˆæœ‰ä¸€ä¸ª<code>custerMap</code> é›†ç¾¤map</p>
</li>
<li>
<p>custerMapçš„ Key æ˜¯custerName , Value æ˜¯ä¸€ä¸ªCluster å¯¹è±¡</p>
</li>
<li>
<p>åœ¨Cluster å¯¹è±¡ä¸­, å­˜åœ¨ä¸€ä¸ªseté›†åˆ, é‡Œé¢å­˜æ”¾çš„å…ƒç´ å°±æ˜¯å®ä¾‹Instanceå¯¹è±¡ , Instance å¯¹è±¡ä¸­çš„å±æ€§å­˜æ”¾ç€å®¢æˆ·ç«¯ä¼ çš„å…ƒæ•°æ®</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">+----------------------------------------------------------+</span><br><span class="line">|                        NameSpace                        |</span><br><span class="line">|                    (æœ€å¤–å±‚ Map)                          |</span><br><span class="line">| +-----------------------------------------------------+  |</span><br><span class="line">| |               GroupName::ServiceName (æœåŠ¡åç§°)      |  |</span><br><span class="line">| | +-------------------------------------------------+ |  |</span><br><span class="line">| | |               clusterMap (é›†ç¾¤ç®¡ç†)              | |  |</span><br><span class="line">| | | +---------------------------------------------+ | |  |</span><br><span class="line">| | | |         clusterName (é›†ç¾¤åç§°)              | | |  |</span><br><span class="line">| | | | +-----------------------------------------+ | | |  |</span><br><span class="line">| | | | |           InstanceSet (å®ä¾‹é›†åˆ)         | | | |  |</span><br><span class="line">| | | | |  +-----------------------------------+  | | | |  |</span><br><span class="line">| | | | |  | Instance (å®ä¾‹)                  |  | | | |  |</span><br><span class="line">| | | | |  | - IP åœ°å€                         |  | | | |  |</span><br><span class="line">| | | | |  | - ç«¯å£                             |  | | | |  |</span><br><span class="line">| | | | |  | - æƒé‡                             |  | | | |  |</span><br><span class="line">| | | | |  | - å¥åº·çŠ¶æ€                         |  | | | |  |</span><br><span class="line">| | | | |  +-----------------------------------+  | | | |  |</span><br><span class="line">| | | | +-----------------------------------------+ | | |  |</span><br><span class="line">| | | +---------------------------------------------+ | |  |</span><br><span class="line">| | +-------------------------------------------------+ |  |</span><br><span class="line">| +-----------------------------------------------------+  |</span><br><span class="line">+----------------------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>äºŒ OpenFeign  + Nacos è°ƒç”¨æµç¨‹</h1>
<ol>
<li>Nacoså®¢æˆ·ç«¯åœ¨å¯åŠ¨æ—¶,æ ¹æ®æœåŠ¡æ³¨å†Œæœºåˆ¶å°†æœåŠ¡æ³¨å†Œåˆ°Nacosæ³¨å†Œä¸­å¿ƒ.</li>
<li>nacoså®¢æˆ·ç«¯ä¼šé€šè¿‡å¿ƒè·³æ£€æµ‹æœºåˆ¶å®šæ—¶åœ¨Nacosçš„æœåŠ¡ç«¯æ›´æ–°å½“å‰å®ä¾‹çš„å¥åº·çŠ¶æ€, é˜²æ­¢è¢«NacosæœåŠ¡ç«¯å‰”é™¤, NacosæœåŠ¡ç«¯åˆ™æ ¹æ®å½“å‰æ—¶é—´å’Œå®ä¾‹æœ€åä¸€æ¬¡çš„æŠ¥å‘Šæ—¶é—´åšå¯¹æ¯”, å¦‚æœè¶…è¿‡äº†15ç§’,åˆ™å°†è¯¥å®ä¾‹çš„å¥åº·çŠ¶æ€æ ‡è®°ä¸ºfalse, å¦‚æœè¶…è¿‡äº†30 ç§’, åˆ™ç›´æ¥å°†è¯¥æœåŠ¡å‰”é™¤æ‰</li>
<li>nacoså®¢æˆ·ç«¯é€šè¿‡æœåŠ¡å‘ç°æœºåˆ¶, æ‹‰å–NacosæœåŠ¡ç«¯ä¸­çš„æœåŠ¡åˆ—è¡¨, ç„¶åæ ¹æ®Ribbonçš„è´Ÿè½½å‡è¡¡æœºåˆ¶, é€‰æ‹©ä¸€ä¸ªæœåŠ¡çš„ipå’Œç«¯å£å·è¿›è°ƒç”¨</li>
</ol>
<h1>ä¸‰ NacosæœåŠ¡ç«¯å…·ä½“å¤„ç†æ³¨å†Œæµç¨‹</h1>
<h2 id="1-åŠŸèƒ½">1. <strong>åŠŸèƒ½</strong> :</h2>
<p>Nacosåœ¨è¿›è¡ŒæœåŠ¡æ³¨å†Œæ—¶, ä¸»è¦çš„å·¥ä½œå°±æ˜¯å°†å®ä¾‹æ·»åŠ åˆ°æ³¨å†Œè¡¨ä¸­å¯¹åº”æœåŠ¡çš„å¯¹åº”Clusterä¸‹çš„setä¸­, é‡Œé¢å­˜æ”¾ç€å½“å‰æœåŠ¡ä¸‹æ‰€æœ‰é›†ç¾¤ä¸‹çš„æ‰€æœ‰æœåŠ¡</p>
<h2 id="2-ä¸»è¦å®ç°">2. **ä¸»è¦å®ç°: **</h2>
<p><strong>æ€æƒ³:</strong>  Nacosåœ¨è¿›è¡Œå¤„ç†æ—¶ , é‡‡ç”¨åŒæ­¥åŠ å¼‚æ­¥æ€æƒ³,</p>
<p><img src="http://120.26.79.238:9000/blog/img/792414e7235dd9299f62725cfd8febe5.png" alt=""></p>
<h3 id="2-1-åœ¨åŒæ­¥ä¸­åšçš„äº‹">2.1 åœ¨åŒæ­¥ä¸­åšçš„äº‹</h3>
<ol>
<li>
<p>è§£æå®¢æˆ·ç«¯æ³¨å†ŒæœåŠ¡æ—¶å‘é€çš„è¯·æ±‚ä¸­çš„æ•°æ®</p>
</li>
<li>
<p>å¦‚æœè¯¥æœåŠ¡æ˜¯ç¬¬ä¸€æ¬¡æ³¨å†Œ, é¦–å…ˆä¼šå…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„Serviceå¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">createEmptyService(namespaceId, serviceName, instance.isEphemeral());</span><br><span class="line"><span class="type">Service</span> <span class="variable">service</span> <span class="operator">=</span> getService(namespaceId, serviceName);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ„å»ºä¸€ä¸ªåŒå±‚Mapç»“æ„, å°†Serviceæ”¾è¿›å»</p>
</li>
<li>
<p>åˆå§‹åŒ–è¯¥æœåŠ¡</p>
<p>åœ¨åˆå§‹åŒ–è¯¥æœåŠ¡æ—¶,</p>
<ol>
<li>
<p>ä½¿ç”¨å®šæ—¶ä»»åŠ¡çš„çº¿ç¨‹æ± å¼€å¯äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡, å¯¹å®ä¾‹åšå¿ƒè·³æ£€æµ‹,</p>
<p>å¿ƒè·³æ£€æµ‹:  é€šè¿‡åˆ¤æ–­å®ä¾‹çš„æœ€åä¸€æ¬¡çš„æŠ¥å‘Šæ—¶é—´ å’Œå½“å‰æ—¶é—´çš„å·®å€¼, å¦‚æœå¤§äº15ç§’ åˆ™å°†è¯¥å®ä¾‹çš„å¥åº·çŠ¶æ€æ”¹ä¸ºfalse. å¦‚æœä¸å¤§äº ,åˆ™ä¸å˜ä¸ºtrue ,</p>
<p>å¦‚æœå¤§äº 30 ç§’, åˆ™å°†è¯¥å®ä¾‹ä»æœåŠ¡ä¸­ç§»é™¤ , å¦‚æœä¸å¤§äºå°±ä¸ç§»é™¤</p>
</li>
</ol>
</li>
<li>
<p>åšå®Œè¿™äº›å, å°†è¯¥å®ä¾‹å¯¹è±¡ å­˜æ”¾åœ¨ä¸€ä¸ªä¸´æ—¶çš„Mapä¸­.</p>
</li>
<li>
<p>æœ€åå†å°†å®ä¾‹å¯¹è±¡ä»ä¸´æ—¶mapå–å‡º, æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­, task.add(Pair.with)</p>
<p>è¯¥é˜»å¡é˜Ÿåˆ—ä¸ºLinedBlockingQueueé˜»å¡é˜Ÿåˆ—, é»˜è®¤å¤§å°ä¸º1024 * 1024</p>
</li>
</ol>
<h3 id="2-2-å¼‚æ­¥çº¿ç¨‹åšçš„äº‹-notifiyer">2.2 å¼‚æ­¥çº¿ç¨‹åšçš„äº‹(notifiyer)</h3>
<ol>
<li>å¼‚æ­¥çº¿ç¨‹notiyer ä»é˜»å¡é˜Ÿåˆ—å‡ºPairå¯¹è±¡, ä½¿ç”¨<code>Task.take()</code>è·å–, å¹¶å°†è¯¥å®ä¾‹å­˜æ”¾åˆ°Clusterå¯¹è±¡ä¸­ ,</li>
<li>æ›´æ–°Clusterå¯¹è±¡ä¸­çš„æ•°æ®çš„æ“ä½œ</li>
<li>è¿›è¡Œå„ç§å®ä¾‹çš„CRUDæ¯”å¯¹</li>
<li>å¾—åˆ°æœ€ç»ˆè¦æ³¨å†Œçš„å®ä¾‹å¯¹è±¡</li>
<li>æœ€åå°†è¯¥å®ä¾‹å­˜æ”¾åœ¨åœ¨æ³¨å†Œè¡¨ä¸­çš„è¯¥serviceä¸‹çš„Cluster å¯¹è±¡ä¸­seté›†åˆä¸­</li>
</ol>
<p>è¿™æ ·, å®ä¾‹å°±ç›¸å½“äºå­˜æ”¾åœ¨äº†æ³¨å†Œè¡¨ä¸­.  å¹¶ä¸”è¿™ä¸ªçº¿ç¨‹æ˜¯åœ¨æœåŠ¡å¯åŠ¨æ—¶ä¸€ç§å­˜åœ¨çš„, Nacosä½¿ç”¨çš„@PostConstrctæ³¨è§£å’Œ@Service æ¥è®©è¯¥çº¿ç¨‹åœ¨æœåŠ¡å¯åŠ¨æ—¶å°±è¿è¡Œ .</p>
<p>å¯¹äºè¿™ç§éœ€è¦ä¸€ç›´æ‰§è¡Œçš„ä»»åŠ¡,  æ—¢éœ€è¦è®©è¿™ä¸ªä»»åŠ¡ä¸€ç›´æ‰§è¡Œä¸‹å», åˆè¦é˜²æ­¢ è¿™ä¸ªä»»åŠ¡å¤§é‡çš„æ¶ˆè€—CPUèµ„æº</p>
<p>æˆ‘åœ¨Nacosä¸­å°±å­¦åˆ°äº†ä¸€ç§å¾ˆå¥½çš„è§£å†³åŠæ³•, å®ƒé¦–å…ˆé€šè¿‡åœ¨è¯¥ä»»åŠ¡ä¸­åŠ å…¥while (true) <code>å¾ªç¯</code>, æ¥ç¡®ä¿è¯¥çº¿ç¨‹å¯ä»¥ä¸€ç›´æ‰§è¡Œä¸‹å», å¹¶ä¸”,ä¸ºäº†é˜²æ­¢è¯¥çº¿ç¨‹ä¸€ç›´å¾ªç¯æ¶ˆè€—èµ„æº, æ‰€ä»¥Nacosåœ¨è¿™é‡Œå®ƒä½¿ç”¨çš„æ˜¯ä¸€ä¸ª<code>é˜»å¡é˜Ÿåˆ—,</code> å½“è¯¥ä»»åŠ¡ è·å–ä¸å®ä¾‹å¯¹è±¡æ—¶,ä¼šè¿›å…¥é˜»å¡çŠ¶æ€, åªæœ‰å½“æ–°çš„å®ä¾‹å¯¹è±¡è¢«æ·»åŠ è¿›æ¥, è¯¥çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œ. è¿™æ ·å°±å¾ˆå¥½çš„è§£å†³äº†æ¶ˆè€—CPUèµ„æºçš„é—®é¢˜. ç„¶å,while å¾ªç¯å…¶å®å¹¶ä¸èƒ½ç™¾åˆ†ç™¾ä¿è¯è¯¥çº¿ç¨‹èƒ½ä¸€ç›´å¾ªç¯ä¸‹å», å½“è¯¥ä»»åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†<code>å¼‚å¸¸</code>, è¯¥ä»»åŠ¡ä¹Ÿä¼šåœæ­¢  , å› æ­¤, åœ¨è¿™ä¸ªä»»åŠ¡çš„whileå¾ªç¯ä¸­,è¿˜é€šè¿‡<code>try-catch</code>åŒ…å›´, å°†å¼‚å¸¸ç›´æ¥å¤„ç†, è¿™æ ·, å°±ç®—å‘ç”Ÿäº†å¼‚å¸¸, è¯¥ä»»åŠ¡ä¹Ÿä¸ä¼šåœæ­¢äº†.</p>
<h1>æ³¨å†Œè¡¨å®åˆ—çš„å¤šçº¿ç¨‹è¯»å–çš„é—®é¢˜å’Œè§£å†³åŠæ³•</h1>
<h2 id="â”é—®é¢˜">â”é—®é¢˜</h2>
<p>åœ¨å¯¹æ³¨å†Œè¡¨ä¸­çš„å®ä¾‹çš„æ“ä½œ, åœ¨Nacosä¸­ä¸»è¦å°±ä¸¤ç§,å­˜å’Œå–, è¿™æ ·å°±æœ‰ä¸€ä¸ªé—®é¢˜, å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹å¯¹è¯¥seté›†åˆè¿›è¡Œæ“ä½œ, ä¸€ä¸ªçº¿ç¨‹è¯»æ•°æ®, å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ¥å­˜æ•°æ®,</p>
<ol>
<li>å½“å†™çº¿ç¨‹è¿˜æ²¡æœ‰å†™è¿›å», è¯»çº¿ç¨‹å°±è¯»å®Œäº†, å°±ä¼šé€ æˆ<code>æ•°æ®ä¸ä¸€è‡´</code></li>
<li>åœ¨å­˜çš„è¿‡ç¨‹ä¸­,å¦‚æœå…¶ä»–çº¿ç¨‹åŒæ—¶å–, é‚£ä¹ˆè¯»å–åˆ°çš„æ•°æ®å°±å¯èƒ½æ˜¯é”™è¯¯çš„ä¸€ä¸ªæ•°æ®,  <code>è¯»å†™å†²çªé—®é¢˜</code></li>
</ol>
<h2 id="ğŸ’¡è§£å†³åŠæ³•">ğŸ’¡è§£å†³åŠæ³•</h2>
<p>å¯¹äºè¿™ç§å¤šçº¿ç¨‹åŒæ—¶å­˜å‚¨çš„é—®é¢˜, ä¸€èˆ¬çš„è§£å†³åŠæ³•å°±æ˜¯åŠ é” , ä½†æ˜¯åŠ é”çš„å¼Šç«¯å¤ªå¤§äº†, è™½ç„¶åŠ é”èƒ½å¾ˆå¥½çš„è§£å†³<code>è¯»å†™å†²çªé—®é¢˜</code>  å’Œ <code>æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜</code>. ä½†æ˜¯,åœ¨Nacosæºç ä¸­, å®ƒå¹¶æ²¡æœ‰å»ä½¿ç”¨åŠ é”, è€Œæ˜¯é‡‡ç”¨äº†å†™æ—¶å¤åˆ¶çš„è§£å†³åŠæ³•. å› ä¸ºåœ¨Nacosçš„å®˜ç½‘ä¸­ä¹Ÿä»‹ç»äº†,Nacos çš„TPSèƒ½è¾¾åˆ°13000 ,å¦‚æœä½¿ç”¨é”, é‚£ä¹ˆå¯¹äºå¹¶å‘çš„æ€§èƒ½å°±ä¼šå¾ˆå·®, TPSå¾ˆéš¾è¾¾åˆ°13000, é‡‡ç”¨å†™æ—¶å¤åˆ¶, è™½ç„¶è¿˜æ˜¯å­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜, ä½†æ˜¯ç¡®ä¿äº†æœ€ç»ˆä¸€è‡´æ€§, è€Œä¸”è¿˜æ‹¥æœ‰å¾ˆå¥½çš„å¹¶å‘æ€§èƒ½.</p>
<p><code>å†™æ—¶å¤åˆ¶: </code></p>
<p><strong>åŸç†:</strong></p>
<p>å°±æ˜¯åœ¨ä¸€ä¸ªå®¹å™¨ä¸­å­˜åœ¨ä¸¤ç§æ“ä½œ, å†™å’Œè¯»æ—¶, å½“åªæœ‰è¯»æ—¶ , æ‰€æœ‰çš„è¯»çº¿ç¨‹éƒ½æ˜¯æ“ä½œçš„åŒä¸€ä¸ªå®¹å™¨,</p>
<p>ä½†æ˜¯,å¦‚æœæ˜¯å†™æ“ä½œ, å®ƒä¸ä¼šå»æ“ä½œåŸå®¹å™¨, è€Œæ˜¯å…ˆå°†åŸå®¹å™¨ä¸­å¤åˆ¶ä¸€ä»½, æ“ä½œé‚£ä¸ªå¤åˆ¶å‡ºçš„æ–°å®¹å™¨, å½“å†™æ“ä½œå®Œæˆå, å†å°†æ—§çš„å®¹å™¨æ›¿æ¢æˆæ–°çš„å®¹å™¨.</p>
<p>è¿™æ ·,å°±èƒ½å¾ˆå¥½çš„è§£å†³å¹¶å‘è¯»å†™é—®é¢˜</p>
<p><strong>ä½†æ˜¯:</strong></p>
<p>è™½ç„¶å†™æ—¶å¤åˆ¶è™½ç„¶è¯»ä¸è¯», è¯»ä¸å†™ä¹‹é—´æ²¡æœ‰å†²çª, ä½†æ˜¯å†™äºå†™ä¹‹é—´è¿˜æ˜¯ä¼šå­˜åœ¨å¹¶å‘çš„å†²çª, å¦‚æœå­˜åœ¨å¹¶å‘çš„ç¯å¢ƒ, è¿˜æ˜¯å¾—é€šè¿‡åŠ é”æ¥è§£å†³. ä¸è¿‡,åœ¨Nacosçš„æœåŠ¡æ³¨å†Œä¸­å¹¶ä¸å­˜åœ¨å¹¶å‘çš„å†™, å› ä¸ºè¯¥ä»»åŠ¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹, å¹¶ä¸”æ˜¯é€šè¿‡æ‹¿å–é˜»å¡é˜Ÿåˆ—ä¸­çš„æ•°æ®æ¥ä¸€ä¸ªä¸ªå†™çš„.è°å…ˆå­˜è°å°±å…ˆå†™</p>
<h2 id="â“é˜»å¡é˜Ÿåˆ—å¯¹å †ç§¯å—">â“é˜»å¡é˜Ÿåˆ—å¯¹å †ç§¯å—?</h2>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå †ç§¯, Nacosæœ¬èº«å¤„ç†è¿™ä¸ªé€»è¾‘å°±å¾ˆå¿«, ä½†æ˜¯ä¹Ÿå¯èƒ½å‘ç”Ÿäººä¸ºçš„æ”»å‡» ,</p>
<p>ç¨‹åºå‘˜é€šè¿‡ç¼–å†™è„šæœ¬, ä¸€æ¬¡æ€§å‘é€å¤§é‡çš„æ³¨å†Œè¯·æ±‚, é™¤æ­¤ä¹‹å¤–,ä¸ä¼šå‡ºç°å †ç§¯é—®é¢˜</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>MyBatis</title>
    <url>/2025/09/15/MyBatis/</url>
    <content><![CDATA[<h1>MyBatis</h1>
<h2 id="è®¾ç½®ç±»å‹åˆ«å">è®¾ç½®ç±»å‹åˆ«å:</h2>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é»˜è®¤ä¸ºåˆ«åä¸ºç±»åï¼ˆä¸åŒºåˆ†å¤§å°å†™--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;online.zorange.entity.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;aaa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">typeAlias</span>&gt;</span>  </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--é€šè¿‡åŒ…æ¥è®¾ç½®åˆ«å--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;online.zorange.entity&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="é»˜è®¤ç±»å‹åˆ«å">é»˜è®¤ç±»å‹åˆ«å</h3>
<table>
<thead>
<tr>
<th style="text-align:left">åˆ«å</th>
<th style="text-align:left">æ˜ å°„çš„ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">_byte</td>
<td style="text-align:left">byte</td>
</tr>
<tr>
<td style="text-align:left">_long</td>
<td style="text-align:left">long</td>
</tr>
<tr>
<td style="text-align:left">_short</td>
<td style="text-align:left">short</td>
</tr>
<tr>
<td style="text-align:left">_int</td>
<td style="text-align:left">int</td>
</tr>
<tr>
<td style="text-align:left">_integer</td>
<td style="text-align:left">int</td>
</tr>
<tr>
<td style="text-align:left">_double</td>
<td style="text-align:left">double</td>
</tr>
<tr>
<td style="text-align:left">_float</td>
<td style="text-align:left">float</td>
</tr>
<tr>
<td style="text-align:left">_boolean</td>
<td style="text-align:left">boolean</td>
</tr>
<tr>
<td style="text-align:left">string</td>
<td style="text-align:left">String</td>
</tr>
<tr>
<td style="text-align:left">byte</td>
<td style="text-align:left">Byte</td>
</tr>
<tr>
<td style="text-align:left">long</td>
<td style="text-align:left">Long</td>
</tr>
<tr>
<td style="text-align:left">short</td>
<td style="text-align:left">Short</td>
</tr>
<tr>
<td style="text-align:left">int</td>
<td style="text-align:left">Integer</td>
</tr>
<tr>
<td style="text-align:left">integer</td>
<td style="text-align:left">Integer</td>
</tr>
<tr>
<td style="text-align:left">double</td>
<td style="text-align:left">Double</td>
</tr>
<tr>
<td style="text-align:left">float</td>
<td style="text-align:left">Float</td>
</tr>
<tr>
<td style="text-align:left">boolean</td>
<td style="text-align:left">Boolean</td>
</tr>
<tr>
<td style="text-align:left">date</td>
<td style="text-align:left">Date</td>
</tr>
<tr>
<td style="text-align:left">decimal</td>
<td style="text-align:left">BigDecimal</td>
</tr>
<tr>
<td style="text-align:left">bigdecimal</td>
<td style="text-align:left">BigDecimal</td>
</tr>
<tr>
<td style="text-align:left">object</td>
<td style="text-align:left">Object</td>
</tr>
<tr>
<td style="text-align:left">map</td>
<td style="text-align:left">Map</td>
</tr>
<tr>
<td style="text-align:left">hashmap</td>
<td style="text-align:left">HashMap</td>
</tr>
<tr>
<td style="text-align:left">list</td>
<td style="text-align:left">List</td>
</tr>
<tr>
<td style="text-align:left">arraylist</td>
<td style="text-align:left">ArrayList</td>
</tr>
<tr>
<td style="text-align:left">collection</td>
<td style="text-align:left">Collection</td>
</tr>
<tr>
<td style="text-align:left">iterator</td>
<td style="text-align:left">Iterator</td>
</tr>
</tbody>
</table>
<h2 id="sqlå‚æ•°èµ‹å€¼">sqlå‚æ•°èµ‹å€¼</h2>
<ol>
<li>#{}   : ï¼Ÿå ä½ç¬¦,	ä¼šè‡ªåŠ¨æ·»åŠ å•å¼•å·</li>
<li>${}   :  å­—ç¬¦ä¸²æ‹¼æ¥        ä¸ä¼šè‡ªåŠ¨æ·»åŠ </li>
</ol>
<h3 id="å•ä¸ªç®€å•å‚æ•°">å•ä¸ªç®€å•å‚æ•°</h3>
<p>åœ¨#{}ä¸­å¯ä»¥ä»»æ„å¡«å…¥å‚æ•°ã€‚ä¸å¿…ä¸å‚æ•°åç›¸åŒã€‚</p>
<p>åœ¨${}ä¸­ä¹Ÿå¯ä»¥ä»»æ„å¡«å…¥ï¼Œä½†æ˜¯å¦‚æœè¦åŠ å•å¼•å·ï¼Œè¿™ç§æ–¹æ³•è¦æ‰‹åŠ¨åŠ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByName</span><span class="params">(String username)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;online.zorange.entity&quot;</span>&gt;</span></span><br><span class="line">  select * from user where username= #&#123;username&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="å¤æ‚ç±»å‹å‚æ•°">å¤æ‚ç±»å‹å‚æ•°</h3>
<h4 id="å¤šä¸ªå‚æ•°ä¼ å…¥">å¤šä¸ªå‚æ•°ä¼ å…¥</h4>
<p>å°†Useræ”¾å…¥Mapé›†åˆ,é€šè¿‡keyè·å–.</p>
<p>å°†keyè®¾ç½®ä¸ºarg1, arg0â€¦, param1, param2â€¦ä¸ºé”®æ·»åŠ åˆ°Mapé›†åˆä¸­.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String usrame, String password)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;login&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">	select * from user where username=#&#123;param0|arg0&#125; and password=#&#123;param1|arg1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="ä»¥Mapé›†åˆä¼ å…¥">ä»¥Mapé›†åˆä¼ å…¥</h4>
<p>æ­¤æ—¶å‚æ•°ä»¥keyè·å–ï¼Œè‡ªå®šä¹‰è®¾ç½®çš„key</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(Map&lt;String,String&gt; map)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String,String&gt; map=<span class="keyword">new</span> <span class="title class_">Map</span>&lt;&gt;;</span><br><span class="line">map.put(<span class="string">&quot;username&quot;</span>,user.username);</span><br><span class="line">map.put(<span class="string">&quot;password&quot;</span>,user.password);</span><br><span class="line">UserMapper.login(map)</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;login&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">	select * from user where username= #&#123;&#125; and password = #&#123;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="æ³¨è§£æ ‡è®°">æ³¨è§£æ ‡è®°</h4>
<p>@Param</p>
<ol>
<li>
<p>åœ¨å‚æ•°ä¸ŠåŠ @Param</p>
<p>keyä¸º@paramä¸­çš„value å’Œ  ä»¥param1ï¼Œparam2â€¦ä¸ºkey</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username,</span></span><br><span class="line"><span class="params">                  <span class="meta">@Param(&quot;password&quot;)</span> String password)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="å®ä½“ç±»ä¼ å…¥">å®ä½“ç±»ä¼ å…¥</h4>
<p>keyä¸ºå®ä½“çš„å±æ€§åï¼Œå€¼ä¸ºå±æ€§å€¼.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> USer <span class="title function_">login</span><span class="params">(User user)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;login&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span> &gt;</span></span><br><span class="line">    select * from user where username=#&#123;username&#125; and password=#&#123;password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ•°æ®è¾“å‡º">æ•°æ®è¾“å‡º</h2>
<h3 id="å®ä½“ç±»">å®ä½“ç±»</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">User <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">List&lt;User&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">	select * from user where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span> &gt;</span></span><br><span class="line">	select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="å•è¡Œå•åˆ—">å•è¡Œå•åˆ—</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Integer&quot;</span>&gt;</span></span><br><span class="line">	select count(id) from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="å¤šè¡¨è”æŸ¥è¿”å›ç»“æœ">å¤šè¡¨è”æŸ¥è¿”å›ç»“æœ</h3>
<p>ä½¿ç”¨mapé›†åˆæˆ– è‡ªå®šä¹‰è¿”å›ç±»</p>
<p>ä½¿ç”¨Map:</p>
<p>å•æ¡æ•°æ®</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">findArticleAndUserType</span><span class="params">(Integer userId,Integer ArticleId)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findArticleAndUserType&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">	select article.*,user.type from user </span><br><span class="line">    inner join aritcle</span><br><span class="line">    on article.userId=user.id</span><br><span class="line">    where user.id=#&#123;userId&#125; and article.id=#&#123;articleId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¤šæ¡æ•°æ®ç±»å‹ä¸ºMapçš„é›†åˆ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">findAll</span><span class="params">(Integer userId,Integer articleid)</span></span><br></pre></td></tr></table></figure>
<h3 id="è·å–è‡ªå¢çš„ä¸»é”®">è·å–è‡ªå¢çš„ä¸»é”®</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">insertEmployee</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- int insertEmployee(Employee employee); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- useGeneratedKeyså±æ€§å­—é¢æ„æ€å°±æ˜¯â€œä½¿ç”¨ç”Ÿæˆçš„ä¸»é”®â€ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- keyPropertyå±æ€§å¯ä»¥æŒ‡å®šä¸»é”®åœ¨å®ä½“ç±»å¯¹è±¡ä¸­å¯¹åº”çš„å±æ€§åï¼ŒMybatisä¼šå°†æ‹¿åˆ°çš„ä¸»é”®å€¼å­˜å…¥è¿™ä¸ªå±æ€§ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertEmployee&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;empId&quot;</span>&gt;</span></span><br><span class="line">  insert into t_emp(emp_name,emp_salary)</span><br><span class="line">  values(#&#123;empName&#125;,#&#123;empSalary&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="å…¨å±€é…ç½®è‡ªåŠ¨è¯†åˆ«é©¼å³°å¼å‘½åè§„åˆ™">å…¨å±€é…ç½®è‡ªåŠ¨è¯†åˆ«é©¼å³°å¼å‘½åè§„åˆ™</h2>
<p>åœ¨Mybatiså…¨å±€é…ç½®æ–‡ä»¶åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨settingså¯¹Mybatiså…¨å±€è¿›è¡Œè®¾ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- å°†xxx_xxxè¿™æ ·çš„åˆ—åè‡ªåŠ¨æ˜ å°„åˆ°xxXxxè¿™æ ·é©¼å³°å¼å‘½åçš„å±æ€§å --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>SQLè¯­å¥ä¸­å¯ä»¥ä¸ä½¿ç”¨åˆ«å</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Employee selectEmployee(Integer empId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployee&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  select emp_id,emp_name,emp_salary from t_emp where emp_id=#&#123;empId&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ¨¡ç³ŠæŸ¥è¯¢">æ¨¡ç³ŠæŸ¥è¯¢</h2>
<p>Concat(â€™%â€˜ï¼Œ#{}ï¼Œâ€™%â€˜)     ===   â€%â€#{}â€œ%â€œ   =     â€˜%${}%â€™</p>
<p>é—®é¢˜ï¼š</p>
<ol>
<li>
<p>in  (#{})  æ—¶ #{} ä¼šæ·»åŠ å•å¼•å·====in(â€˜1,2,3â€™) ä¼šæŠ¥é”™.</p>
<p>ï¼Ÿ :æ˜¯ä¸æ˜¯å¯ä»¥ in (#{},#{})</p>
</li>
</ol>
<h2 id="è‡ªå®šä¹‰æ˜ å°„">è‡ªå®šä¹‰æ˜ å°„</h2>
<p>resultMapç»“æœæ˜ å°„ï¼Œ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span> &gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">	select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>å…³è”å…³ç³»</th>
<th>é…ç½®é¡¹å…³é”®è¯</th>
<th>æ‰€åœ¨é…ç½®æ–‡ä»¶å’Œå…·ä½“ä½ç½®</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯¹ä¸€</td>
<td>associationæ ‡ç­¾/javaTypeå±æ€§ <strong>å®ä½“ç±»</strong></td>
<td>Mapperé…ç½®æ–‡ä»¶ä¸­çš„resultMapæ ‡ç­¾å†…</td>
</tr>
<tr>
<td>å¯¹å¤š</td>
<td>collectionæ ‡ç­¾/ofTypeå±æ€§ <strong>é›†åˆ</strong></td>
<td>Mapperé…ç½®æ–‡ä»¶ä¸­çš„resultMapæ ‡ç­¾å†…</td>
</tr>
</tbody>
</table>
<h3 id="ä¸€å¯¹ä¸€ï¼š">ä¸€å¯¹ä¸€ï¼š</h3>
<p>ä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªèº«ä»½è¯:</p>
<p>åœ¨ç”¨æˆ·ç±»ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªèº«ä»½è¯ï¼Œæ‰€ä»¥åœ¨ç”¨æˆ·ç±»ä¸­è®¾ç½®ä¸€ä¸ªå­—æ®µä¸ºèº«ä»½è¯ç±»ï¼Œ</p>
<p>åœ¨æŸ¥æ‰¾ç”¨æˆ·æ—¶ï¼Œå°†ç”¨æˆ·æ‰€åœ¨çš„èº«ä»½è¯ä¹ŸæŸ¥æ‰¾å‡ºæ¥ã€‚</p>
<p>ä½†æ˜¯åœ¨æŸ¥æ‰¾æ—¶ï¼Œè·å¾—çš„æ˜¯èº«ä»½è¯çš„idå’Œç­çº§çš„å±æ€§ï¼Œè€Œç”¨æˆ·çš„ç±»ä¸­åªæœ‰èº«ä»½è¯çš„å¯¹è±¡ï¼Œ</p>
<p>è¿™æ—¶ï¼ŒæŸ¥æ‰¾åˆ°çš„ç»“æœé›†å°±ä¸èƒ½ä¸€ä¸€å¯¹åº”ï¼Œæ‰€ä»¥ï¼Œå°±éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªç»“æœé›†ï¼Œå°†ç­çº§çš„å±æ€§èµ‹å€¼ç»™èº«ä»½è¯å¯¹è±¡ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åˆ›å»ºresultMapå®ç°â€œå¯¹ä¸€â€å…³è”å…³ç³»æ˜ å°„ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- idå±æ€§ï¼šé€šå¸¸è®¾ç½®ä¸ºè¿™ä¸ªresultMapæ‰€æœåŠ¡çš„é‚£æ¡SQLè¯­å¥çš„idåŠ ä¸Šâ€œResultMapâ€ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- typeå±æ€§ï¼šè¦è®¾ç½®ä¸ºè¿™ä¸ªresultMapæ‰€æœåŠ¡çš„é‚£æ¡SQLè¯­å¥æœ€ç»ˆè¦è¿”å›çš„ç±»å‹ --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;selectOrderWithCustomerResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;order&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- å…ˆè®¾ç½®Orderè‡ªèº«å±æ€§å’Œå­—æ®µçš„å¯¹åº”å…³ç³» --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;order_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderId&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;order_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderName&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- ä½¿ç”¨associationæ ‡ç­¾é…ç½®â€œå¯¹ä¸€â€å…³è”å…³ç³» --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- propertyå±æ€§ï¼šåœ¨Orderç±»ä¸­å¯¹ä¸€çš„ä¸€ç«¯è¿›è¡Œå¼•ç”¨æ—¶ä½¿ç”¨çš„å±æ€§å --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- javaTypeå±æ€§ï¼šä¸€çš„ä¸€ç«¯ç±»çš„å…¨ç±»å --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;customer&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;customer&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®Customerç±»çš„å±æ€§å’Œå­—æ®µåä¹‹é—´çš„å¯¹åº”å…³ç³» --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;customer_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;customerId&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;customer_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;customerName&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Order selectOrderWithCustomer(Integer orderId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectOrderWithCustomer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;selectOrderWithCustomerResultMap&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  SELECT order_id,order_name,c.customer_id,customer_name</span><br><span class="line">  FROM t_order o</span><br><span class="line">  LEFT JOIN t_customer c</span><br><span class="line">  ON o.customer_id=c.customer_id</span><br><span class="line">  WHERE o.order_id=#&#123;orderId&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="ä¸€å¯¹å¤šï¼š">ä¸€å¯¹å¤šï¼š</h3>
<p>ä¸€ä¸ªç”¨æˆ·å¯¹åº”å¤šä¸ªè¯¾ç¨‹ï¼Œå³åœ¨ç”¨æˆ·ç±»ä¸­å®šä¹‰ä¸€ä¸ªè¯¾ç¨‹ç±»çš„é›†åˆç±»å‹ã€‚</p>
<p>åœ¨æŸ¥æ‰¾ç”¨æˆ·æ—¶ï¼ŒæŸ¥æ‰¾ç”¨æˆ·çš„æ‰€æœ‰è¯¾ç¨‹ã€‚</p>
<p>å³æŸ¥æ‰¾å‡ºæ¥çš„æ•°æ®ï¼Œå­˜åœ¨ç›¸åŒçš„ç”¨æˆ·æ•°æ®å¯¹åº”ä¸åŒçš„è¯¾ç¨‹æ•°æ®ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®resultMapå®ç°ä»Customeråˆ°OrderListçš„â€œå¯¹å¤šâ€å…³è”å…³ç³» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;selectCustomerWithOrderListResultMap&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;customer&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- æ˜ å°„Customeræœ¬èº«çš„å±æ€§ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;customer_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;customerId&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;customer_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;customerName&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- collectionæ ‡ç­¾ï¼šæ˜ å°„â€œå¯¹å¤šâ€çš„å…³è”å…³ç³» --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- propertyå±æ€§ï¼šåœ¨Customerç±»ä¸­ï¼Œå…³è”â€œå¤šâ€çš„ä¸€ç«¯çš„å±æ€§å --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ofTypeå±æ€§ï¼šé›†åˆå±æ€§ä¸­å…ƒç´ çš„ç±»å‹ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orderList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;order&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ˜ å°„Orderçš„å±æ€§ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;order_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderId&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;order_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderName&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Customer selectCustomerWithOrderList(Integer customerId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCustomerWithOrderList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;selectCustomerWithOrderListResultMap&quot;</span>&gt;</span></span><br><span class="line">  SELECT c.customer_id,c.customer_name,o.order_id,o.order_name</span><br><span class="line">  FROM t_customer c</span><br><span class="line">  LEFT JOIN t_order o</span><br><span class="line">  ON c.customer_id=o.customer_id</span><br><span class="line">  WHERE c.customer_id=#&#123;customerId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="å¤šå¯¹å¤šï¼š">å¤šå¯¹å¤šï¼š</h3>
<p>ä¸å¤šå¯¹ä¸€çš„åŒºåˆ«ï¼š</p>
<p>sqlè¯­å¥éœ€è¦æŸ¥æ‰¾ä¸‰å¼ è¡¨ï¼ŒresultMapå¤„ç†ä¸å¤šå¯¹ä¸€ä¸€æ ·ã€‚</p>
<h3 id="åˆ†éƒ¨æŸ¥è¯¢ï¼š">åˆ†éƒ¨æŸ¥è¯¢ï¼š</h3>
<h2 id="å¤šè¡¨æ˜ å°„ä¼˜åŒ–">å¤šè¡¨æ˜ å°„ä¼˜åŒ–</h2>
<table>
<thead>
<tr>
<th>settingå±æ€§</th>
<th>å±æ€§å«ä¹‰</th>
<th>å¯é€‰å€¼</th>
<th>é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>autoMappingBehavior</td>
<td>æŒ‡å®š MyBatis åº”å¦‚ä½•è‡ªåŠ¨æ˜ å°„åˆ—åˆ°å­—æ®µæˆ–å±æ€§ã€‚ NONE è¡¨ç¤ºå…³é—­è‡ªåŠ¨æ˜ å°„ï¼›PARTIAL åªä¼šè‡ªåŠ¨æ˜ å°„æ²¡æœ‰å®šä¹‰åµŒå¥—ç»“æœæ˜ å°„çš„å­—æ®µã€‚ FULL ä¼šè‡ªåŠ¨æ˜ å°„ä»»ä½•å¤æ‚çš„ç»“æœé›†ï¼ˆæ— è®ºæ˜¯å¦åµŒå¥—ï¼‰ã€‚</td>
<td>NONE, PARTIAL, FULL</td>
<td>PARTIAL</td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬å¯ä»¥å°†autoMappingBehaviorè®¾ç½®ä¸ºfull,è¿›è¡Œå¤šè¡¨resultMapæ˜ å°„çš„æ—¶å€™ï¼Œå¯ä»¥çœç•¥ç¬¦åˆåˆ—å’Œå±æ€§å‘½åæ˜ å°„è§„åˆ™ï¼ˆåˆ—å=å±æ€§åï¼Œæˆ–è€…å¼€å¯é©¼å³°æ˜ å°„ä¹Ÿå¯ä»¥è‡ªåŠ¨æ˜ å°„ï¼‰çš„resultæ ‡ç­¾ï¼</p>
<p>ä¿®æ”¹mybati-sconfig.xml:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¼€å¯resultMapè‡ªåŠ¨æ˜ å°„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;FULL&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹teacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;teacherMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;tId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;t_id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å¯è‡ªåŠ¨æ˜ å°„,å¹¶ä¸”å¼€å¯é©¼å³°å¼æ”¯æŒ!å¯ä»¥çœç•¥ result!--&gt;</span>    idä¸èƒ½çœ</span><br><span class="line"><span class="comment">&lt;!--        &lt;result property=&quot;tName&quot; column=&quot;t_name&quot; /&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;student&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;s_id&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;result property=&quot;sName&quot; column=&quot;s_name&quot; /&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="åŠ¨æ€è¯­å¥">åŠ¨æ€è¯­å¥</h2>
<h3 id="å¤šæ¡ä»¶åˆ¤æ–­">å¤šæ¡ä»¶åˆ¤æ–­</h3>
<h4 id="ifæ ‡ç­¾">ifæ ‡ç­¾</h4>
<p>æ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦æ‹¼æ¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">selecct</span> &gt;</span></span><br><span class="line">select * from user where </span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null and id!=&#x27;&#x27;&quot;</span>&gt;</span>id=#&#123;id&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null and name!=&#x27;&#x27;&quot;</span>&gt;</span>name=#&#123;&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password!=null and password!=&#x27;&#x27;&quot;</span>&gt;</span>password=#&#123;&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selecct</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é—®é¢˜:å½“ç¬¬ä¸€ä¸ªifä¸æˆç«‹æ—¶ï¼Œä¼šå»æ‰å¤šä½™whereï¼Œand</p>
<p>è§£å†³:åŠ ä¸Šæ’æˆç«‹æ¡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">selecct</span> &gt;</span></span><br><span class="line">select * from user where and 1=1</span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null and id!=&#x27;&#x27;&quot;</span>&gt;</span>id=#&#123;id&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null and name!=&#x27;&#x27;&quot;</span>&gt;</span>name=#&#123;&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password!=null and password!=&#x27;&#x27;&quot;</span>&gt;</span>password=#&#123;&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selecct</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="whereæ ‡ç­¾">whereæ ‡ç­¾</h4>
<p>è‡ªåŠ¨ç”Ÿæˆwhereæ¡ä»¶ï¼Œè‡ªåŠ¨åˆ é™¤å¤šä½™çš„andå’Œor</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">selecct</span> &gt;</span></span><br><span class="line">select * from user </span><br><span class="line">	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null and id!=&#x27;&#x27;&quot;</span>&gt;</span>id=#&#123;id&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null and name!=&#x27;&#x27;&quot;</span>&gt;</span>and name=#&#123;&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password!=null and password!=&#x27;&#x27;&quot;</span>&gt;</span>and password=#&#123;&#125;			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">selecct</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="trimæ ‡ç­¾">trimæ ‡ç­¾</h4>
<p>ä½¿ç”¨trimæ ‡ç­¾æ§åˆ¶æ¡ä»¶éƒ¨åˆ†ä¸¤ç«¯æ˜¯å¦åŒ…å«æŸäº›å­—ç¬¦</p>
<ul>
<li>prefixå±æ€§ï¼šæŒ‡å®šè¦åŠ¨æ€æ·»åŠ çš„å‰ç¼€</li>
<li>suffixå±æ€§ï¼šæŒ‡å®šè¦åŠ¨æ€æ·»åŠ çš„åç¼€</li>
<li>prefixOverrideså±æ€§ï¼šæŒ‡å®šè¦åŠ¨æ€å»æ‰çš„å‰ç¼€ï¼Œä½¿ç”¨â€œ|â€åˆ†éš”æœ‰å¯èƒ½çš„å¤šä¸ªå€¼</li>
<li>suffixOverrideså±æ€§ï¼šæŒ‡å®šè¦åŠ¨æ€å»æ‰çš„åç¼€ï¼Œä½¿ç”¨â€œ|â€åˆ†éš”æœ‰å¯èƒ½çš„å¤šä¸ªå€¼</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;and&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null and id!=&#x27;&#x27;&quot;</span>&gt;</span>id=#&#123;id&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null and name!=&#x27;&#x27;&quot;</span>&gt;</span>and name=#&#123;&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password!=null and password!=&#x27;&#x27;&quot;</span>&gt;</span>and password=#&#123;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="set">set</h4>
<p>åŠ¨æ€å»æ‰å¤šä½™çš„é€—å·</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null&quot;</span>&gt;</span></span><br><span class="line">            emp_name=#&#123;empName&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empSalary <span class="symbol">&amp;lt;</span> 3000&quot;</span>&gt;</span></span><br><span class="line">            emp_salary=#&#123;empSalary&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="choose-when-otherwise">choose/when/otherwise</h4>
<p>ç›¸å½“äºifâ€¦else   ifâ€¦else</p>
<p>switchâ€¦caseâ€¦defaultï¼ŒæŒ‰é¡ºåºæŸ¥ï¼Œæ»¡è¶³ä¸€ä¸ªç›´æ¥é€€å‡º</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployeeByConditionByChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">    select emp_id,emp_name,emp_salary from t_emp</span><br><span class="line">    where</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empName != null&quot;</span>&gt;</span>emp_name=#&#123;empName&#125;<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empSalary <span class="symbol">&amp;lt;</span> 3000&quot;</span>&gt;</span>emp_salary <span class="symbol">&amp;lt;</span> 3000<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span>1=1<span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     ç¬¬ä¸€ç§æƒ…å†µï¼šç¬¬ä¸€ä¸ªwhenæ»¡è¶³æ¡ä»¶ where emp_name=?</span></span><br><span class="line"><span class="comment">     ç¬¬äºŒç§æƒ…å†µï¼šç¬¬äºŒä¸ªwhenæ»¡è¶³æ¡ä»¶ where emp_salary &lt; 3000</span></span><br><span class="line"><span class="comment">     ç¬¬ä¸‰ç§æƒ…å†µï¼šä¸¤ä¸ªwhenéƒ½ä¸æ»¡è¶³ where 1=1 æ‰§è¡Œäº†otherwise</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="foreach">foreach</h4>
<ol>
<li>
<p>æ‰¹é‡æ’å…¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    collectionå±æ€§ï¼šè¦éå†çš„é›†åˆ</span></span><br><span class="line"><span class="comment">    itemå±æ€§ï¼šéå†é›†åˆçš„è¿‡ç¨‹ä¸­èƒ½å¾—åˆ°æ¯ä¸€ä¸ªå…·ä½“å¯¹è±¡ï¼Œåœ¨itemå±æ€§ä¸­è®¾ç½®ä¸€ä¸ªåå­—ï¼Œå°†æ¥é€šè¿‡è¿™ä¸ªåå­—å¼•ç”¨éå†å‡ºæ¥çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">    separatorå±æ€§ï¼šæŒ‡å®šå½“foreachæ ‡ç­¾çš„æ ‡ç­¾ä½“é‡å¤æ‹¼æ¥å­—ç¬¦ä¸²æ—¶ï¼Œå„ä¸ªæ ‡ç­¾ä½“å­—ç¬¦ä¸²ä¹‹é—´çš„åˆ†éš”ç¬¦</span></span><br><span class="line"><span class="comment">    openå±æ€§ï¼šæŒ‡å®šæ•´ä¸ªå¾ªç¯æŠŠå­—ç¬¦ä¸²æ‹¼å¥½åï¼Œå­—ç¬¦ä¸²æ•´ä½“çš„å‰é¢è¦æ·»åŠ çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">    closeå±æ€§ï¼šæŒ‡å®šæ•´ä¸ªå¾ªç¯æŠŠå­—ç¬¦ä¸²æ‹¼å¥½åï¼Œå­—ç¬¦ä¸²æ•´ä½“çš„åé¢è¦æ·»åŠ çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">    indexå±æ€§ï¼šè¿™é‡Œèµ·ä¸€ä¸ªåå­—ï¼Œä¾¿äºåé¢å¼•ç”¨</span></span><br><span class="line"><span class="comment">        éå†Listé›†åˆï¼Œè¿™é‡Œèƒ½å¤Ÿå¾—åˆ°Listé›†åˆçš„ç´¢å¼•å€¼</span></span><br><span class="line"><span class="comment">        éå†Mapé›†åˆï¼Œè¿™é‡Œèƒ½å¤Ÿå¾—åˆ°Mapé›†åˆçš„key</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;empList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;values&quot;</span> <span class="attr">index</span>=<span class="string">&quot;myIndex&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åœ¨foreachæ ‡ç­¾å†…éƒ¨å¦‚æœéœ€è¦å¼•ç”¨éå†å¾—åˆ°çš„å…·ä½“çš„ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦ä½¿ç”¨itemå±æ€§å£°æ˜çš„åç§° --&gt;</span></span><br><span class="line">    (#&#123;emp.empName&#125;,#&#123;myIndex&#125;,#&#123;emp.empSalary&#125;,#&#123;emp.empGender&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ‰¹é‡æ›´æ–°</p>
<p>ä¸Šé¢æ‰¹é‡æ’å…¥çš„ä¾‹å­æœ¬è´¨ä¸Šæ˜¯ä¸€æ¡SQLè¯­å¥ï¼Œè€Œå®ç°æ‰¹é‡æ›´æ–°åˆ™éœ€è¦å¤šæ¡SQLè¯­å¥æ‹¼èµ·æ¥ï¼Œç”¨åˆ†å·åˆ†å¼€ã€‚ä¹Ÿå°±æ˜¯ä¸€æ¬¡æ€§å‘é€å¤šæ¡SQLè¯­å¥è®©æ•°æ®åº“æ‰§è¡Œã€‚æ­¤æ—¶éœ€è¦åœ¨æ•°æ®åº“è¿æ¥ä¿¡æ¯çš„URLåœ°å€ä¸­è®¾ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">atguigu.dev.url=jdbc:mysql:///mybatis-example?allowMultiQueries=true</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- int updateEmployeeBatch(@Param(&quot;empList&quot;) List&lt;Employee&gt; empList) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmployeeBatch&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;empList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;;&quot;</span>&gt;</span></span><br><span class="line">        update t_emp set emp_name=#&#123;emp.empName&#125; where emp_id=#&#123;emp.empId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="sqlç‰‡æ®µ">sqlç‰‡æ®µ</h4>
<p>æŠ½å–é‡å¤çš„sql</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨sqlæ ‡ç­¾æŠ½å–é‡å¤å‡ºç°çš„SQLç‰‡æ®µ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;mySelectSql&quot;</span>&gt;</span></span><br><span class="line">    select emp_id,emp_name,emp_age,emp_salary,emp_gender from t_emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¼•ç”¨å·²æŠ½å–çš„SQLç‰‡æ®µ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨includeæ ‡ç­¾å¼•ç”¨å£°æ˜çš„SQLç‰‡æ®µ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;mySelectSql&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="MyBatisé«˜çº§æ‰©å±•ï¼ˆåˆ†é¡µæ’ä»¶ï¼‰">MyBatisé«˜çº§æ‰©å±•ï¼ˆåˆ†é¡µæ’ä»¶ï¼‰</h2>
<p>å…·ä½“æ¥è¯´ï¼ŒMyBatis çš„æ’ä»¶æœºåˆ¶åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªç»„ä»¶ï¼š</p>
<ol>
<li><code>Interceptor</code>ï¼ˆæ‹¦æˆªå™¨ï¼‰ï¼šå®šä¹‰ä¸€ä¸ªæ‹¦æˆªæ–¹æ³• <code>intercept</code>ï¼Œè¯¥æ–¹æ³•åœ¨æ‰§è¡Œ SQL è¯­å¥ã€æ‰§è¡ŒæŸ¥è¯¢ã€æŸ¥è¯¢ç»“æœçš„æ˜ å°„æ—¶ä¼šè¢«è°ƒç”¨ã€‚</li>
<li><code>Invocation</code>ï¼ˆè°ƒç”¨ï¼‰ï¼šå®é™…ä¸Šæ˜¯å¯¹è¢«æ‹¦æˆªçš„æ–¹æ³•çš„å°è£…ï¼Œå°è£…äº† <code>Object target</code>ã€<code>Method method</code> å’Œ <code>Object[] args</code> è¿™ä¸‰ä¸ªå­—æ®µã€‚</li>
<li><code>InterceptorChain</code>ï¼ˆæ‹¦æˆªå™¨é“¾ï¼‰ï¼šå¯¹æ‰€æœ‰çš„æ‹¦æˆªå™¨è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬å°†æ‰€æœ‰çš„ Interceptor é“¾æ¥æˆä¸€æ¡é“¾ï¼Œå¹¶åœ¨æ‰§è¡Œ SQL è¯­å¥æ—¶æŒ‰é¡ºåºè°ƒç”¨ã€‚</li>
</ol>
<p>æ’ä»¶çš„å¼€å‘éå¸¸ç®€å•ï¼Œåªéœ€è¦å®ç° Interceptor æ¥å£ï¼Œå¹¶ä½¿ç”¨æ³¨è§£ <code>@Intercepts</code> æ¥æ ‡æ³¨éœ€è¦æ‹¦æˆªçš„å¯¹è±¡å’Œæ–¹æ³•ï¼Œç„¶ååœ¨ MyBatis çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ’ä»¶å³å¯ã€‚</p>
<ol>
<li>
<p>ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åœ¨mybatisé…ç½®æ–‡ä»¶ä¸­é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;helperDialect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTeacherRelationshipToMulti</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">TeacherMapper</span> <span class="variable">teacherMapper</span> <span class="operator">=</span> session.getMapper(TeacherMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å¯åˆ†é¡µ</span></span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢Customerå¯¹è±¡åŒæ—¶å°†å…³è”çš„Orderé›†åˆæŸ¥è¯¢å‡ºæ¥</span></span><br><span class="line">    List&lt;Teacher&gt; allTeachers = teacherMapper.findAllTeachers();</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">    PageInfo&lt;Teacher&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(allTeachers);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;pageInfo = &quot;</span> + pageInfo);</span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> pageInfo.getTotal(); <span class="comment">// è·å–æ€»è®°å½•æ•°</span></span><br><span class="line">    System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line">    <span class="type">int</span> <span class="variable">pages</span> <span class="operator">=</span> pageInfo.getPages();  <span class="comment">// è·å–æ€»é¡µæ•°</span></span><br><span class="line">    System.out.println(<span class="string">&quot;pages = &quot;</span> + pages);</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> pageInfo.getPageNum(); <span class="comment">// è·å–å½“å‰é¡µç </span></span><br><span class="line">    System.out.println(<span class="string">&quot;pageNum = &quot;</span> + pageNum);</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> pageInfo.getPageSize(); <span class="comment">// è·å–æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</span></span><br><span class="line">    System.out.println(<span class="string">&quot;pageSize = &quot;</span> + pageSize);</span><br><span class="line">    List&lt;Teacher&gt; teachers = pageInfo.getList(); <span class="comment">//è·å–æŸ¥è¯¢é¡µçš„æ•°æ®é›†åˆ</span></span><br><span class="line">    System.out.println(<span class="string">&quot;teachers = &quot;</span> + teachers);</span><br><span class="line">    teachers.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="é€†å‘å·¥ç¨‹-ä»£ç ç”Ÿæˆå™¨">é€†å‘å·¥ç¨‹ (ä»£ç ç”Ÿæˆå™¨)</h2>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Nacosé…ç½®ä¸­å¿ƒ</title>
    <url>/2025/09/15/Nacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/</url>
    <content><![CDATA[<h1>Nacosé…ç½®ä¸­å¿ƒ</h1>
<h2 id="ç»Ÿä¸€é…ç½®ç®¡ç†">ç»Ÿä¸€é…ç½®ç®¡ç†</h2>
<ul>
<li>å½“å¾®æœåŠ¡éƒ¨ç½²çš„å®ä¾‹è¶Šæ¥è¶Šå¤šï¼Œè¾¾åˆ°æ•°åã€æ•°ç™¾æ—¶ï¼Œé€ä¸ªä¿®æ”¹å¾®æœåŠ¡é…ç½®å°±æ˜¾å¾—ååˆ†çš„ä¸æ–¹ä¾¿ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å‡ºé”™ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§ç»Ÿä¸€é…ç½®ç®¡ç†æ–¹æ¡ˆï¼Œå¯ä»¥é›†ä¸­ç®¡ç†æ‰€æœ‰å®ä¾‹çš„é…ç½®ã€‚</li>
<li>nacosä¸€æ–¹é¢å¯ä»¥å°†é…ç½®é›†ä¸­ç®¡ç†ï¼Œå¦ä¸€æ–¹å¯ä»¥åœ¨é…ç½®å˜æ›´æ—¶ï¼ŒåŠæ—¶é€šçŸ¥å¾®æœåŠ¡ï¼Œå®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/d923af8cb110e8c0b7cccfaec19767cb.png" alt=""></p>
<h2 id="Nacoså…¥é—¨">Nacoså…¥é—¨</h2>
<h3 id="1-åœ¨nacosä¸­æ·»åŠ é…ç½®">1.åœ¨nacosä¸­æ·»åŠ é…ç½®</h3>
<ul>
<li>é…ç½®çš„é€‰é¡¹ä¸æœåŠ¡é…ç½®åŸºæœ¬ä¸€è‡´</li>
<li>åªæœ‰ä¸€ä¸ªåŒºåˆ«ï¼šæœåŠ¡åæ”¹æˆäº†é…ç½®æ–‡ä»¶çš„idï¼ˆ<strong>Data ID</strong>ï¼‰</li>
<li>éƒ½æœ‰ namespaceå’Œgroup</li>
</ul>
<h3 id="2-å¾®æœåŠ¡é›†æˆé…ç½®ä¸­å¿ƒ">2.å¾®æœåŠ¡é›†æˆé…ç½®ä¸­å¿ƒ</h3>
<p>å¾®æœåŠ¡éœ€è¦è¿›è¡Œæ”¹é€ ï¼Œä»Nacosé…ç½®ä¸­å¿ƒä¸­è·å–é…ç½®ä¿¡æ¯è¿›è¡Œä½¿ç”¨ã€‚</p>
<p>æ­¥éª¤ï¼š</p>
<p>1ã€åœ¨spzx-cloud-userå¾®æœåŠ¡ä¸­ï¼Œå¼•å…¥spring-cloud-starter-alibaba-nacos-configä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacosä½œä¸ºé…ç½®ä¸­å¿ƒæ—¶æ‰€å¯¹åº”çš„ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2ã€åœ¨spzx-cloud-useré¡¹ç›®çš„ /src/main/resources/application.yml é…ç½®æ–‡ä»¶ä¸­é…ç½® Nacos Config åœ°å€å¹¶å¼•å…¥æœåŠ¡é…ç½®</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é…ç½®æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.136</span><span class="number">.142</span><span class="string">:8848</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">import:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nacos:spzx-cloud-user-dev.yml</span></span><br></pre></td></tr></table></figure>
<h3 id="è¯»å–è‡ªå®šä¹‰é…ç½®">è¯»å–è‡ªå®šä¹‰é…ç½®</h3>
<ul>
<li>@value</li>
<li>@ConfigurationProperties(prefix=â€œaaaâ€)</li>
</ul>
<p><strong>åŒºåˆ«</strong></p>
<p><code>@ConfigurationProperties</code> å½“nacosé…ç½®æ–‡ä»¶æ›´æ–°æ—¶ï¼Œé‡Œé¢çš„å‚æ•°å¯ä»¥çƒ­æ›´æ–°ï¼ˆåŒæ­¥æ›´æ–°ï¼‰</p>
<p><code>@Value</code> ä¸èƒ½çƒ­æ›´æ–°ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨<code>@RefreshScope</code>åŠ åœ¨ç±»ä¸Šï¼Œå®ç°çƒ­æ›´æ–°</p>
<h3 id="é…ç½®ä¼˜å…ˆçº§">é…ç½®ä¼˜å…ˆçº§</h3>
<p>ä¼˜å…ˆçº§é¡ºåºï¼šNacosé…ç½®ä¸­å¿ƒçš„é…ç½®(åå¯¼å…¥çš„é…ç½® &gt; å…ˆå¯¼å…¥çš„é…ç½®) &gt; application.yml</p>
<h2 id="æ‹“å±•ï¼šåŠ è½½ymlæ–‡ä»¶çš„ä¸¤ç§æ–¹å¼">æ‹“å±•ï¼šåŠ è½½ymlæ–‡ä»¶çš„ä¸¤ç§æ–¹å¼</h2>
<p>æ–°ç‰ˆæ–¹å¼ï¼šåŠ è½½ymlæ–‡ä»¶çš„æ–¹å¼çš„æ–¹å¼æ˜¯æ–°ç‰ˆä¸­çš„æ–¹å¼ï¼šspring.config.import</p>
<p>æ—§ç‰ˆæ–¹å¼ï¼šå€ŸåŠ©äº<code>bootstrap.properties</code>ï¼Œ<code>bootstrap.yml</code>æ–‡ä»¶ï¼Œä¸è¿‡ ä»æŠ€æœ¯ä¸Šè®²<code>bootstrap.properties</code>ï¼Œ<code>bootstrap.yml</code> <strong>å…¶æ–‡ä»¶å·²è¢«å¼ƒç”¨</strong>ã€‚</p>
<p>å¦‚æœä½¿ç”¨æ—§ç‰ˆæ–¹å¼ï¼šéœ€è¦ä¸¤æ­¥ï¼šã€æ—§ç‰ˆæ–¹å¼å°±ä¸éœ€è¦application.ymlæ–‡ä»¶äº†ã€‘</p>
<p>ç¬¬ä¸€æ­¥:éœ€è¦å¯¼å…¥spring-cloud-starter-bootstrapä¾èµ–ä¿¡æ¯</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥ï¼šåœ¨src/main/resourceç›®å½•ä¸‹åˆ›å»ºbootstrap.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># å¦‚æœä¸æƒ³ä½¿ç”¨ Nacos è¿›è¡Œé…ç½®ç®¡ç†ï¼Œè®¾ç½®ä¸º false å³å¯</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span> <span class="comment"># ç»„ï¼Œé»˜è®¤ä¸º DEFAULT_GROUP</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># é…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œé»˜è®¤ä¸º properties</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">483bb765-a42d-4112-90bc-50b8dff768b3</span> <span class="comment">#æŒ‡å®šåç§°ç©ºé—´çš„id,å¦‚æœæ˜¯publicåç§°ç©ºé—´ï¼Œè¿™é‡Œå¯ä»¥çœç•¥ã€‚</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/spzx-cloud-user</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">spzx-cloud-user</span></span><br></pre></td></tr></table></figure>
<h3 id="DataId">DataId</h3>
<p>è¯´æ˜ï¼šä¹‹æ‰€ä»¥éœ€è¦é…ç½® <code>spring.application.name</code>ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯æ„æˆ Nacos é…ç½®ç®¡ç† <code>dataId</code>å­—æ®µçš„ä¸€éƒ¨åˆ†ã€‚åœ¨ Nacos Spring Cloud ä¸­ï¼Œ<code>dataId</code> çš„å®Œæ•´æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">$&#123;prefix&#125;-$&#123;spring.profile.active&#125;.$&#123;file-extension&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>prefix</code> é»˜è®¤ä¸º <code>spring.application.name</code> çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>spring.cloud.nacos.config.prefix</code>æ¥é…ç½®ã€‚</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è‹¥ä¸æŒ‡å®šï¼Œé»˜è®¤é‡‡ç”¨åº”ç”¨åçš„æ–¹æ¡ˆ</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">spzx-cloud-user</span></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨æŒ‡å®šé…ç½®çš„dataIDå‰ç¼€æ ‡è¯†</span></span><br><span class="line"><span class="comment"># spring.cloud.nacos.config.prefix=spzx-cloud-user</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>spring.profile.active</code> å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„ profileã€‚<strong>æ³¨æ„ï¼šå½“ <code>spring.profile.active</code> ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„è¿æ¥ç¬¦ <code>-</code> ä¹Ÿå°†ä¸å­˜åœ¨ï¼ŒdataId çš„æ‹¼æ¥æ ¼å¼å°†å˜æˆ <code>$&#123;prefix&#125;.$&#123;file-extension&#125;</code></strong></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># devè¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>file-exetension</code> ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼,é»˜è®¤ä¸ºpropertiesç±»å‹ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>spring.cloud.nacos.config.file-extension</code> æ¥é…ç½®,ç›®å‰æ”¯æŒçš„ç±»å‹æœ‰ TEXTã€JSONã€XMLã€YAMLã€HTMLã€Propertiesã€‚</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šé…ç½®æ–‡ä»¶ç±»å‹ä¸ºyamlæ–‡ä»¶</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.file-extension</span>=<span class="string">yaml</span></span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆé…ç½®ï¼š</p>
<p>â€‹    ç»è¿‡å‰é¢ä¸‰ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬æœ€ç»ˆåœ¨nacosé…ç½®ä¸­å¿ƒçš„æ§åˆ¶å°æ–°å¢é…ç½®æ–‡ä»¶å°±æ˜¯ï¼šspzx-cloud-user-dev.yaml</p>
<p>é€šå¸¸æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰ Namespaceï¼ŒGroupï¼ŒDataIdï¼š</p>
<ul>
<li><code>Namespace</code>ï¼šä»£è¡¨ä¸åŒçš„<strong>ç¯å¢ƒ</strong>ï¼Œå¦‚ï¼šå¼€å‘ã€æµ‹è¯•ï¼Œ ç”Ÿäº§ç­‰ï¼›</li>
<li><code>Group</code>ï¼šä»£è¡¨æŸä¸ª<strong>é¡¹ç›®</strong>ï¼Œå¦‚ï¼šXXç‰©æµé¡¹ç›®ï¼ŒXXæ•™è‚²é¡¹ç›®ï¼›</li>
<li><code>DataId</code>ï¼šæ¯ä¸ªé¡¹ç›®ä¸‹å¾€å¾€æœ‰è‹¥å¹²ä¸ª<strong>åº”ç”¨</strong>ï¼Œæ¯ä¸ªé…ç½®é›†(DataId)æ˜¯ä¸€ä¸ªåº”ç”¨çš„<strong>ä¸»é…ç½®æ–‡ä»¶</strong></li>
</ul>
</li>
</ul>
<h2 id="å…¬å…±é…ç½®">å…¬å…±é…ç½®</h2>
<p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¤šä¸ªæ¨¡å—å¯èƒ½ä¼šæœ‰å¾ˆå¤šå…±ç”¨çš„é…ç½®ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼ŒRedis è¿æ¥ä¿¡æ¯ï¼ŒRabbitMQ è¿æ¥ä¿¡æ¯ï¼Œç›‘æ§é…ç½®ç­‰ç­‰ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¸Œæœ›å¯ä»¥åŠ è½½å¤šä¸ªé…ç½®ï¼Œå¤šä¸ªé¡¹ç›®å…±äº«åŒä¸€ä¸ªé…ç½®ä¹‹ç±»ç­‰åŠŸèƒ½ï¼ŒNacos Config ä¹Ÿç¡®å®æ”¯æŒã€‚</p>
<p>Nacosåœ¨é…ç½®è·¯å¾„spring.cloud.nacos.config.extension-configsä¸‹ï¼Œå…è®¸æˆ‘ä»¬æŒ‡å®šâ¼€ä¸ªæˆ–å¤šä¸ªé¢å¤–é…ç½®ã€‚<br>
Nacosåœ¨é…ç½®è·¯å¾„spring.cloud.nacos.config.shared-configsä¸‹ï¼Œå…è®¸æˆ‘ä»¬æŒ‡å®šâ¼€ä¸ªæˆ–å¤šä¸ªå…±äº«é…ç½®ã€‚</p>
<p>ä¸Šè¿°ä¸¤ç±»é…ç½®éƒ½â½€æŒä¸‰ä¸ªå±æ€§ï¼š</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">data-id(å¼•ç”¨çš„é…ç½®æ–‡ä»¶å…¨ç§°)</span><br><span class="line">group(é»˜è®¤ä¸ºå­—ç¬¦ä¸²DEFAULT<span class="built_in">_</span>GROUP)</span><br><span class="line">refresh(é»˜è®¤ä¸ºfalse)    //æ˜¯å¦å¼€å¯çƒ­æ›´æ–°</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>è¿™ä¸¤ç§é…ç½®æ–¹å¼éƒ½å¯ä»¥åŒæ—¶å¯¼å…¥å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œå› æ­¤å°±æœ‰ä¸¤ç§ï¼ˆéƒ½æœ‰ä¸¤ç§ï¼ŒæŠŠextensionæ›¿æ¢æˆsharedï¼‰æ–¹å¼,</p>
<ol>
<li>
<p>ä¸‹æ ‡</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">      	<span class="string">extension-configs[0]:</span></span><br><span class="line">      		<span class="attr">data-id:</span> <span class="string">xxxxx</span></span><br><span class="line">      		<span class="attr">group:</span> </span><br><span class="line">      		<span class="attr">refresh:</span> <span class="literal">true</span></span><br><span class="line">      	<span class="string">extension-configs[1]:</span></span><br><span class="line">      		<span class="attr">data-id:</span> <span class="string">yyyyy</span></span><br><span class="line">      		<span class="attr">group:</span> </span><br><span class="line">      		<span class="attr">refresh:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>-</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">      	<span class="attr">extension-configs:</span></span><br><span class="line">      		<span class="bullet">-</span> <span class="attr">data-id:</span> <span class="string">xxx.uml</span></span><br><span class="line">      			<span class="attr">graoup:</span></span><br><span class="line">      			<span class="attr">refresh:</span> <span class="literal">true</span></span><br><span class="line">      		<span class="bullet">-</span> <span class="attr">data-id:</span> <span class="string">yyyy.uml</span></span><br><span class="line">      			<span class="attr">graoup:</span></span><br><span class="line">      			<span class="attr">refresh:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h3 id="ä¸åŒæ–¹å¼é…ç½®åŠ è½½ä¼˜å…ˆçº§">ä¸åŒæ–¹å¼é…ç½®åŠ è½½ä¼˜å…ˆçº§</h3>
<p>Nacos é…ç½®ä¸­å¿ƒç›®å‰æä¾›ä»¥ä¸‹ä¸‰ç§é…ç½®èƒ½åŠ›ä» Nacos æ‹‰å–ç›¸å…³çš„é…ç½®ï¼Œå½“ä¸‰ç§æ–¹å¼å…±åŒä½¿ç”¨æ—¶ï¼Œä»–ä»¬çš„ä¸€ä¸ªä¼˜å…ˆçº§å…³ç³»æ˜¯:A &lt; B &lt; Cï¼š</p>
<ul>
<li>Aï¼šé€šè¿‡ spring.cloud.nacos.config.shared-configs[n].data-id æ”¯æŒå¤šä¸ªå…±äº« Data Id çš„é…ç½®</li>
<li>Bï¼šé€šè¿‡ spring.cloud.nacos.config.extension-configs[n].data-id çš„æ–¹å¼æ”¯æŒå¤šä¸ªæ‰©å±• Data Id çš„é…ç½®</li>
<li>Cï¼šé€šè¿‡å†…éƒ¨ç›¸å…³è§„åˆ™(spring.cloud.nacos.config.prefixã€spring.cloud.nacos.config.file-extensionã€spring.cloud.nacos.config.group)è‡ªåŠ¨ç”Ÿæˆç›¸å…³çš„ Data Id é…ç½®ã€‚</li>
</ul>
<h3 id="å…±äº«é…ç½®å’Œæ‹“å±•é…ç½®çš„åŒºåˆ«">å…±äº«é…ç½®å’Œæ‹“å±•é…ç½®çš„åŒºåˆ«</h3>
<p>åœ¨Nacosä¸­ï¼Œ<code>shared-configs</code>å’Œ<code>extension-configs</code>æ˜¯ä¸¤ç§ä¸åŒçš„é…ç½®å­˜å‚¨æ–¹å¼ï¼Œå®ƒä»¬ä¸»è¦ç”¨äºä¸åŒçš„åœºæ™¯å’Œç›®çš„ï¼š</p>
<ol>
<li><strong>shared-configs</strong>ï¼š
<ul>
<li><strong>ä½œç”¨</strong>ï¼šç”¨äºå­˜å‚¨åº”ç”¨ç¨‹åºçš„å…±äº«é…ç½®ï¼Œå³å¤šä¸ªåº”ç”¨ç¨‹åºå¯ä»¥å…±åŒä½¿ç”¨çš„é…ç½®ä¿¡æ¯ã€‚</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šè¿™äº›é…ç½®é¡¹é€šå¸¸æ˜¯å¤šä¸ªå¾®æœåŠ¡æˆ–åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«çš„æ ¸å¿ƒé…ç½®ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€å…¬å…±æœåŠ¡çš„åœ°å€ã€å…¨å±€æ€§çš„é…ç½®å‚æ•°ç­‰ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šé€šè¿‡å°†è¿™äº›å…±äº«é…ç½®æ”¾åœ¨<code>shared-configs</code>ä¸­ï¼Œå¯ä»¥å®ç°ç»Ÿä¸€ç®¡ç†å’Œæ›´æ–°ï¼Œç¡®ä¿æ‰€æœ‰ä½¿ç”¨è¿™äº›é…ç½®çš„åº”ç”¨ç¨‹åºåœ¨é…ç½®å˜æ›´æ—¶èƒ½å¤ŸåŠæ—¶è·å–æœ€æ–°çš„é…ç½®ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li><strong>extension-configs</strong>ï¼š
<ul>
<li><strong>ä½œç”¨</strong>ï¼šç”¨äºå­˜å‚¨åº”ç”¨ç¨‹åºçš„æ‰©å±•é…ç½®ï¼Œå³ç‰¹å®šäºæŸä¸ªåº”ç”¨æˆ–æ¨¡å—çš„é…ç½®ä¿¡æ¯ã€‚</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šè¿™äº›é…ç½®é¡¹æ˜¯åº”ç”¨ç¨‹åºç‰¹æœ‰çš„ï¼Œé€šå¸¸æ˜¯å„ä¸ªå¾®æœåŠ¡æˆ–æ¨¡å—éœ€è¦çš„ç‰¹å®šé…ç½®ï¼Œå¦‚æ¯ä¸ªå¾®æœåŠ¡çš„ä¸šåŠ¡ç›¸å…³çš„é…ç½®ã€ç‰¹å®šåŠŸèƒ½çš„å¼€å…³ç­‰ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå°†è¿™äº›é…ç½®æ”¾åœ¨<code>extension-configs</code>ä¸­æœ‰åŠ©äºä¿æŒé…ç½®çš„ç‹¬ç«‹æ€§å’Œéš”ç¦»æ€§ï¼Œé¿å…ä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´çš„é…ç½®æ··æ·†å’Œå†²çªã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“</strong>ï¼š</p>
<ul>
<li><code>shared-configs</code>é€‚ç”¨äºå­˜å‚¨å…¨å±€å’Œå…±äº«çš„é…ç½®ï¼Œä»¥ç¡®ä¿å¤šä¸ªåº”ç”¨ç¨‹åºèƒ½å¤Ÿå…±äº«å’ŒåŒæ­¥è¿™äº›é…ç½®ã€‚</li>
<li><code>extension-configs</code>é€‚ç”¨äºå­˜å‚¨ç‰¹å®šåº”ç”¨ç¨‹åºæˆ–æœåŠ¡çš„ä¸ªæ€§åŒ–é…ç½®ï¼Œä»¥ç¡®ä¿æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½èƒ½è·å–åˆ°å…¶æ‰€éœ€çš„ç‰¹å®šé…ç½®ä¿¡æ¯ã€‚</li>
</ul>
<p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæ ¹æ®é…ç½®çš„å…±äº«ç¨‹åº¦å’Œåº”ç”¨çš„åŠŸèƒ½éœ€æ±‚ï¼Œå¯ä»¥çµæ´»é€‰æ‹©å°†é…ç½®é¡¹å­˜å‚¨åœ¨å“ªç§é…ç½®ä¸­å¿ƒä¸­ã€‚</p>
<h2 id="Nacosåšé…ç½®ä¸­å¿ƒæ•°æ®æŒä¹…åŒ–åˆ°mysql">Nacosåšé…ç½®ä¸­å¿ƒæ•°æ®æŒä¹…åŒ–åˆ°mysql</h2>
<ul>
<li>
<p>ç¬¬ä¸€æ­¥ï¼šåœ¨navicatåˆ›å»ºnacos_configåº“ï¼Œå¹¶å°†nacos/confç›®å½•ä¸‹çš„mysql-schema.sqlæ–‡ä»¶åœ¨navicatä¸­å¯¼å…¥</p>
</li>
<li>
<p>ç¬¬äºŒæ­¥ï¼šåœ¨conf ä¸‹æ‰¾åˆ°application.properties æ–‡ä»¶ï¼Œè¿›è¡Œé…ç½®ã€‚é…ç½®æ–‡ä»¶å¦‚ä¸‹:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### Connect URL of DB:</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password.0</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç¬¬ä¸‰æ­¥ï¼šé…ç½®ç½®å®Œæˆå¯åŠ¨nacosï¼Œæ“ä½œå°±å¯ä»¥æŒä¹…åŒ–</p>
</li>
</ul>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>OCR å›¾å½¢è½¬æ–‡å­—</title>
    <url>/2022/12/19/OCR%20%E5%9B%BE%E5%BD%A2%E8%BD%AC%E6%96%87%E5%AD%97/</url>
    <content><![CDATA[<h1>OCR å›¾åƒè½¬æ–‡å­—</h1>
<h2 id="æ¶‰åŠæ¶‰åŠè½¯ä»¶ï¼š">æ¶‰åŠæ¶‰åŠè½¯ä»¶ï¼š</h2>
<h3 id="Snipaste">Snipaste</h3>
<ol>
<li>åŠŸèƒ½ï¼šå¿«æ·æˆªå›¾</li>
<li>ä¼˜ç‚¹ï¼šæ–¹ä¾¿ã€å¿«æ·ã€å°å·§ã€ã€</li>
</ol>
<h3 id="Tesseract-OCR">Tesseract-OCR</h3>
<ol>
<li>åŠŸèƒ½ï¼šTesseract-OCR æ˜¯ä¸€ç§å¼€æºçš„æ–‡æœ¬è¯†åˆ«è½¯ä»¶ï¼Œå¯ä»¥å°†æ‰«æçš„æ–‡æ¡£æˆ–è€…å›¾ç‰‡ä¸­çš„æ–‡æœ¬è¯†åˆ«æˆç”µå­æ–‡æœ¬ã€‚å®ƒå¯ä»¥è¯†åˆ«å¤šç§è¯­è¨€ï¼ŒåŒ…æ‹¬è‹±è¯­ã€æ³•è¯­ã€å¾·è¯­ã€è¥¿ç­ç‰™è¯­ã€æ„å¤§åˆ©è¯­å’Œè®¸å¤šå…¶ä»–è¯­è¨€ã€‚</li>
</ol>
<p>Tesseract-OCR ä½¿ç”¨ç¥ç»ç½‘ç»œæŠ€æœ¯æ¥è¯†åˆ«æ–‡æœ¬ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼ŒåŒ…æ‹¬ Windowsã€Linux å’Œ MacOSã€‚å®ƒå¯ä»¥è¢«ç”¨äº è‡ª åŠ¨åŒ–æ–‡æ¡£å¤„ç†ã€æ–‡æœ¬æŒ–æ˜å’Œå…¶ä»–åº”ç”¨ç¨‹åºä¸­ã€‚</p>
<p>Tesseract-OCR è¿˜å¯ä»¥æ”¯æŒè‡ªå®šä¹‰å­—ä½“ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è®­ç»ƒæ¥æé«˜è¯†åˆ«ç²¾åº¦ã€‚å®ƒæä¾›äº†ä¸€ç»„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œæ–‡æœ¬è¯†åˆ«å’Œå¤„ ç†ã€‚</p>
<ol start="2">
<li>ä¼˜ç‚¹ï¼šä¼˜ç‚¹ï¼šå¼€æºã€å¤šè¯­è¨€æ”¯æŒã€è‡ªå®šä¹‰å­—ä½“ã€è·¨å¹³å°ç­‰ã€‚</li>
</ol>
<h3 id="å…·ä½“æ€è·¯">å…·ä½“æ€è·¯:</h3>
<p>ç”¨ Snipaste æ¥å¿«æ·æˆªå›¾ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å°†æƒ³è¦è¯†åˆ«çš„å›¾ç‰‡åˆ†å¤šæ¬¡æˆªå–ï¼ŒSnipate çš„å›¾ç‰‡åç§°å’Œè·¯å¾„éƒ½æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ã€‚é‚£ä¹ˆåœ¨è·å–å›¾ç‰‡è·¯å¾„æ—¶æ˜¯å¯ä»¥å®ç°è‡ªåŠ¨è·å–çš„</p>
<p>ç¼ºç‚¹ï¼šå› ä¸ºæ¯ä¸ªçš„ Snipaste çš„è®¾ç½®å¯èƒ½ä¸ªæœ‰ä¸åŒï¼Œå› æ­¤æ¢ç”¨æˆ·æ—¶ï¼Œéœ€è¦ä¿®æ”¹ç¨‹åºçš„è§„åˆ¶ã€‚</p>
<p>ç”¨ python ç¼–ç¨‹ï¼Œè·å–å›¾ç‰‡è·¯å¾„ï¼ŒORC æ¥è¯†åˆ«å›¾ç‰‡æ–‡å­—ã€‚è®¾è®¡ä¸€ä¸ª GUI æ¥æ˜¾ç¤ºè¯†åˆ«çš„æ–‡å­—ï¼Œå’Œäº¤äº’æŒ‰é’®æ¥ä¾›ç”¨æˆ·è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œã€‚</p>
<h3 id="å®ç°ä»£ç ">å®ç°ä»£ç :</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> tkinter</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ Tkinter ç•Œé¢</span></span><br><span class="line">root = tkinter.Tk()</span><br><span class="line">root.title(<span class="string">&quot;OCRå›¾ç‰‡è½¬æ–‡å­—&quot;</span>)</span><br><span class="line"><span class="comment"># è·å–å±å¹•å®½åº¦å’Œé«˜åº¦</span></span><br><span class="line">screen_width = root.winfo_screenwidth()</span><br><span class="line">screen_height = root.winfo_screenheight()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—çª—å£çš„ä½ç½®</span></span><br><span class="line">x = (screen_width - <span class="number">500</span>) // <span class="number">2</span></span><br><span class="line">y = (screen_height - <span class="number">300</span>) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®çª—å£çš„ä½ç½®å’Œå¤§å°</span></span><br><span class="line">root.geometry(<span class="string">&quot;500x300+&#123;&#125;+&#123;&#125;&quot;</span>.<span class="built_in">format</span>(x, y))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ–‡æœ¬åŒºåŸŸ</span></span><br><span class="line">text = tkinter.Text(root, font=(<span class="string">&quot;å¾®è½¯é›…é»‘&quot;</span>, <span class="number">10</span>, <span class="string">&#x27;bold&#x27;</span>))</span><br><span class="line">text.place(x=<span class="number">0</span>, y=<span class="number">0</span>, width=<span class="number">350</span>, height=<span class="number">300</span>)</span><br><span class="line">text.config(fg=<span class="string">&quot;black&quot;</span>)</span><br><span class="line">text.insert(<span class="string">&quot;end&quot;</span>, <span class="string">&quot;hello&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ ‡ç­¾1</span></span><br><span class="line">lab_one = tkinter.Label(root, text=<span class="string">&#x27;URL:&#x27;</span>, font=(<span class="string">&quot;Arial&quot;</span>, <span class="number">16</span>, <span class="string">&#x27;bold&#x27;</span>))</span><br><span class="line">lab_one.place(x=<span class="number">360</span>, y=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ–‡æœ¬åŒºåŸŸ</span></span><br><span class="line">entry_id = tkinter.Entry(root, font=(<span class="string">&#x27;Arial&#x27;</span>, <span class="number">12</span>, <span class="string">&#x27;bold&#x27;</span>))</span><br><span class="line">entry_id.place(x=<span class="number">410</span>, y=<span class="number">30</span>)</span><br><span class="line">entry_id.insert(<span class="string">&quot;end&quot;</span>,<span class="string">&quot;-1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ ‡ç­¾2</span></span><br><span class="line">lab_now = tkinter.Label(root, text=<span class="string">&#x27;0&#x27;</span>, font=(<span class="string">&#x27;Arial&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;bold&#x27;</span>))</span><br><span class="line">lab_now.place(x=<span class="number">450</span>, y=<span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è·å–æ—¥æœŸå‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">data</span>():</span><br><span class="line">    y = <span class="string">&#x27;_&#x27;</span> + <span class="built_in">str</span>(datetime.datetime.now().year)</span><br><span class="line">    m = <span class="string">&#x27;-&#x27;</span> + <span class="built_in">str</span>(datetime.datetime.now().month) + <span class="string">&#x27;-&#x27;</span></span><br><span class="line">    d = <span class="built_in">str</span>(datetime.datetime.now().day) + <span class="string">&quot;_&quot;</span></span><br><span class="line">    <span class="keyword">return</span> y + m + d</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æŒ‰é’®ç‚¹å‡»å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">button_click</span>():</span><br><span class="line">    url=entry_id.get()</span><br><span class="line">    <span class="keyword">if</span>(url==<span class="string">&#x27;-1&#x27;</span>):</span><br><span class="line">        url=<span class="built_in">str</span>(<span class="built_in">int</span>(lab_now.cget(<span class="string">&quot;text&quot;</span>))+<span class="number">1</span>)</span><br><span class="line">        lab_now.config(text=url)</span><br><span class="line">    <span class="keyword">elif</span>(<span class="built_in">int</span>(url)&gt;<span class="built_in">int</span>(lab_now.cget(<span class="string">&quot;text&quot;</span>))):</span><br><span class="line">        lab_now.config(text=url)</span><br><span class="line">    image_url=<span class="string">&#x27;E:\\æˆªå›¾\\Orange&#x27;</span>+data()+url+<span class="string">&quot;.png&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(image_url)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        image=Image.<span class="built_in">open</span>(image_url)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        lab_now.config(text=<span class="built_in">str</span>(<span class="built_in">int</span>(url)-<span class="number">1</span>))</span><br><span class="line">    <span class="comment"># ä½¿ç”¨ä¸­æ–‡å’Œè‹±æ–‡çš„ OCR è¯†åˆ«ï¼Œä½¿ç”¨å•åˆ—æ¨¡å¼è¿›è¡ŒOCRè¯†åˆ«</span></span><br><span class="line">    out = pytesseract.image_to_string(image, lang=<span class="string">&quot;chi_sim+eng&quot;</span>, config=<span class="string">&quot;--psm 6&quot;</span>)</span><br><span class="line"></span><br><span class="line">    text.delete(<span class="string">&quot;1.0&quot;</span>,<span class="string">&quot;end&quot;</span>)</span><br><span class="line">    text.insert(<span class="string">&quot;1.0&quot;</span>,out)</span><br><span class="line"></span><br><span class="line">button1=tkinter.Button(root,text=<span class="string">&quot;è·å–&quot;</span>,font=(<span class="string">&quot;Arial&quot;</span>,<span class="number">16</span>,<span class="string">&#x27;bold&#x27;</span>),command=button_click)</span><br><span class="line">button1.place(x=<span class="number">360</span>,y=<span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‚¹å‡»nextæŒ‰é’®äº‹ä»¶</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">click_next</span>():</span><br><span class="line">    entry_id.delete(<span class="number">0</span>,<span class="string">&quot;end&quot;</span>)</span><br><span class="line">    entry_id.insert(<span class="number">0</span>,<span class="string">&quot;-1&quot;</span>)</span><br><span class="line">    <span class="comment"># print(entry_id.get())</span></span><br><span class="line">    button_click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨å‘å‰æŒ‰é’®</span></span><br><span class="line">button_go=tkinter.Button(root,text=<span class="string">&quot;max_next&quot;</span>,font=(<span class="string">&quot;å¾®è½¯é›…é»‘&quot;</span>,<span class="number">10</span>,<span class="string">&#x27;bold&#x27;</span>),command=click_next)</span><br><span class="line">button_go.place(x=<span class="number">360</span>,y=<span class="number">120</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Code</category>
      </categories>
      <tags>
        <tag>OCR</tag>
      </tags>
  </entry>
  <entry>
    <title>Orange blog é¡¹ç›®éœ€æ±‚æ–‡æ¡£</title>
    <url>/2025/09/15/Orange%20blog%20%E9%A1%B9%E7%9B%AE%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<h1>blog</h1>
<h2 id="éœ€æ±‚">éœ€æ±‚</h2>
<ol>
<li>å¯†ç ä¿®æ”¹åŠŸèƒ½ï¼Œä¸ªäººä¿¡æ¯è¯¦æƒ…ï¼Œæµè§ˆé‡ï¼Œç‚¹èµé‡,é˜…è¯»é‡æ•°æ®</li>
</ol>
<h2 id="bug">bug</h2>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>RabbitMQ</title>
    <url>/2025/09/15/RabbitMQ/</url>
    <content><![CDATA[<h1>RabbitMQ</h1>
<h2 id="æ¶ˆæ¯ä¸­é—´ä»¶æ¦‚è¿°">æ¶ˆæ¯ä¸­é—´ä»¶æ¦‚è¿°</h2>
<h3 id="æ¶ˆæ¯é˜Ÿåˆ—ç®€ä»‹">æ¶ˆæ¯é˜Ÿåˆ—ç®€ä»‹</h3>
<p>æ¶ˆæ¯é˜Ÿåˆ—(message queue)ç®€ç§°MQï¼Œæ˜¯ä¸€ç§ä»¥â€œ<strong>å…ˆè¿›å…ˆå‡º</strong>â€çš„æ•°æ®ç»“æ„ä¸ºåŸºç¡€çš„æ¶ˆæ¯æœåŠ¡å™¨ã€‚</p>
<p><strong>æ¶ˆæ¯</strong>ï¼šåœ¨ä¸¤ä¸ªç³»ç»Ÿè¦ä¼ è¾“çš„æ•°æ®</p>
<p><strong>ä½œç”¨</strong>ï¼šå®ç°æ¶ˆæ¯çš„ä¼ é€’</p>
<ul>
<li>åŸå§‹çš„æ•°æ®ä¼ é€’æ–¹å¼ï¼š</li>
</ul>
<p>â€‹	æ•°æ®ä¼ è¾“æ–¹å¼ä¸ºåŒæ­¥ä¼ è¾“ã€ä½œä¸ºè°ƒç”¨æ–¹å¿…é¡»ç­‰å¾…è¢«è°ƒç”¨æ–¹æ‰§è¡Œå®Œæ¯•ä»¥åï¼Œæ‰å¯ä»¥ç»§ç»­ä¼ é€’æ¶ˆæ¯ã€‘ï¼ŒåŒæ­¥ä¼ è¾“å­˜åœ¨çš„å¼Šç«¯ï¼š<strong>ä¼ è¾“æ•ˆç‡è¾ƒä½</strong>ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/fe5597106ce041f456bdc068384ce642.png" alt=""></p>
<ul>
<li>
<p>åŸºäºMQå®ç°æ¶ˆæ¯çš„ä¼ è¾“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>æ•°æ®çš„ä¼ è¾“æ–¹å¼å±äºå¼‚æ­¥ä¼ è¾“ã€ä½œä¸ºè°ƒç”¨æ–¹æ³•ä¸ç”¨ç­‰å¾…è¢«è°ƒç”¨æ–¹æ‰§è¡Œå®Œæ¯•å°±å¯ä»¥æ¥ç»­ä¼ é€’æ¶ˆæ¯ã€‘ï¼Œæ•°æ®ä¼ è¾“çš„æ¶ˆæ¯è¾ƒé«˜ã€‚<br>
<img src="http://120.26.79.238:9000/blog/img/48ba16c53c56d8c7a4e007eeb808bc88.png" alt=""></p>
</li>
</ul>
<h3 id="æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯">æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯</h3>
<p>ä¸»è¦çš„ä½œç”¨ï¼š</p>
<p><strong>[1]ç³»ç»Ÿè§£è€¦</strong></p>
<p><strong>[2]æµé‡æ¶ˆé”‹</strong></p>
<p><strong>[3]æ•°æ®åˆ†å‘</strong></p>
<h4 id="ç³»ç»Ÿè§£è€¦">ç³»ç»Ÿè§£è€¦</h4>
<p>ç³»ç»Ÿçš„è€¦åˆæ€§è¶Šé«˜ï¼Œ<strong>å®¹é”™æ€§</strong>ã€æ˜¯æŒ‡<a href="https://baike.baidu.com/item/%E7%B3%BB%E7%BB%9F/479832">ç³»ç»Ÿ</a>åœ¨éƒ¨åˆ†ç»„ä»¶ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰å‘ç”Ÿæ•…éšœæ—¶ä»èƒ½æ­£å¸¸è¿ä½œçš„èƒ½åŠ›ã€‘å°±è¶Šä½</p>
<p>å¦‚ä¸‹ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/7868449995fae7881f2672c63876d93c.png" alt=""></p>
<p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä»¥åï¼Œæ•´ä¸ªä¸‹å•æ“ä½œçš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/165b6acc3cda5a1005a436e0048e44f4.png" alt=""></p>
<p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦åˆï¼Œç³»ç»Ÿçš„è€¦åˆæ€§å°±ä¼šé™ä½äº†ï¼Œå®¹é”™æ€§å°±æé«˜äº†ã€‚æ¯”å¦‚ç‰©æµç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œéœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½æ¥ä¿®å¤ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œç‰©æµç³»ç»Ÿè¦å¤„ç†çš„æ•°æ®è¢«ç¼“å­˜</p>
<p>åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”¨æˆ·çš„ä¸‹å•æ“ä½œæ­£å¸¸å®Œæˆã€‚å½“ç‰©æµç³»ç»Ÿå›å¤åï¼Œè¡¥å……å¤„ç†å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•æ¶ˆæ¯å³å¯ï¼Œç»ˆç«¯ç³»ç»Ÿæ„ŸçŸ¥ä¸åˆ°ç‰©æµç³»ç»Ÿå‘ç”Ÿè¿‡å‡ åˆ†é’Ÿæ•…éšœã€‚</p>
<h4 id="æµé‡æ¶ˆé”‹">æµé‡æ¶ˆé”‹</h4>
<p>æµé‡æ¶ˆé”‹ï¼šæ¶ˆé™¤ç³»ç»Ÿä¸­çš„é«˜å³°å€¼æµé‡(æµé‡å¯ä»¥ç†è§£ä¸ºå°±æ˜¯è¯·æ±‚):å‰Šå³°å¡«è°·</p>
<p>å‡è®¾ç”¨æˆ·æ¯ç§’éœ€è¦å‘é€5kä¸ªè¯·æ±‚ï¼Œè€Œæˆ‘ä»¬çš„Aç³»ç»Ÿæ¯ç§’åªèƒ½å¤„ç†2Kä¸ªè¯·æ±‚ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¤§é‡çš„ä¸‹å•è¯·æ±‚å¤±è´¥ã€‚è€Œä¸”ç”±äºå®é™…è¯·æ±‚çš„æ•°é‡è¿œè¿œè¶…è¿‡ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œ</p>
<p>æ­¤æ—¶ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´ç³»ç»Ÿå®•æœºã€‚</p>
<p>ç”¨æˆ·æ¯ç§’å‘é€5kä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†ä¸‹å•è¯·æ±‚æ•°æ®å­˜å‚¨åˆ°MQä¸­ï¼Œæ­¤æ—¶åœ¨MQä¸­å°±ç¼“å­˜äº†å¾ˆå¤šçš„ä¸‹å•è¯·æ±‚æ•°æ®ï¼Œè€ŒAç³»ç»Ÿæ ¹æ®è‡ªå·±çš„å¤„ç†èƒ½åŠ›ä»MQä¸­è·å–æ•°æ®è¿›è¡Œ</p>
<p>ä¸‹å•æ“ä½œï¼Œæœ‰äº†MQçš„ç¼“å­˜å±‚ä»¥åï¼Œå°±å¯ä»¥ä¿è¯æ¯ä¸€ä¸ªç”¨æˆ·çš„ä¸‹å•è¯·æ±‚å¯ä»¥å¾—åˆ°æ­£å¸¸çš„å¤„ç†ï¼Œå¹¶ä¸”è¿™æ ·å¯ä»¥å¤§å¤§æåˆ°ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<h4 id="æ•°æ®åˆ†å‘">æ•°æ®åˆ†å‘</h4>
<p>å‡è®¾Aç³»ç»Ÿè¿›è¡Œäº†æŸä¸€ä¸ªä¸šåŠ¡æ“ä½œä»¥åï¼Œéœ€è¦å°†è¿™ä¸ªä¸šåŠ¡æ“ä½œç»“æœé€šçŸ¥ç»™å…¶ä»–çš„ç³»ç»Ÿï¼ŒåŸå§‹çš„æ¶æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/5fb3b19ac11b587efc2412658c74e6df.png" alt=""></p>
<p>æ­¤æ—¶Bç³»ç»Ÿã€Cç³»ç»Ÿã€Dç³»ç»Ÿå°±éœ€è¦æä¾›å¯¹åº”çš„æ¥å£ï¼Œç„¶åè®©Aç³»ç»Ÿè¿›è¡Œè°ƒç”¨ã€‚å¦‚æœæ­¤æ—¶ä¸éœ€è¦é€šçŸ¥Dç³»ç»Ÿäº†ï¼Œé‚£ä¹ˆå°±éœ€è¦æ›´æ”¹Aç³»ç»Ÿçš„ä»£ç ï¼Œå°†è°ƒç”¨Dç³»ç»Ÿçš„ä»£ç åˆ é™¤</p>
<p>æ‰ã€‚å¹¶ä¸”å¦‚æ­¤æ—¶é¡¹ç›®ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ç³»ç»ŸEï¼ŒAç³»ç»Ÿä¹Ÿéœ€è¦å°†å¤„ç†ç»“æ„é€šçŸ¥ç»™Eç³»ç»Ÿï¼Œé‚£ä¹ˆåŒæ—¶ä¹Ÿéœ€è¦æ›´æ”¹Aç³»ç»Ÿçš„ä»£ç ã€‚è¿™æ ·å°±ä¸åˆ©äºåæœŸçš„ç»´æŠ¤ã€‚</p>
<p>ä½¿ç”¨MQæ”¹è¿›ä»¥åçš„æ¶æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/8845dbb5a4f0228e9ee80f311d97b587.png" alt=""></p>
<p>Aç³»ç»Ÿéœ€è¦å°†ä¸šåŠ¡æ“ä½œç»“æœé€šçŸ¥ç»™å…¶ä»–çš„ç³»ç»Ÿæ—¶ï¼ŒAç³»ç»Ÿåªéœ€è¦å°†ç»“æ„å‘é€åˆ°MQä¸­ã€‚å…¶ä»–çš„ç³»ç»Ÿåªéœ€è¦ä»MQä¸­è·å–ç»“æœå³å¯ï¼Œå¦‚æœä¸éœ€è¦ç»“æœäº†ï¼Œæ­¤æ—¶åªéœ€è¦å–æ¶ˆ</p>
<p>ä»MQä¸­è·å–ç»“æœçš„æ“ä½œå³å¯ã€‚å¹¶ä¸”å¦‚æœæ–°å¢äº†ä¸€ä¸ªç³»ç»Ÿéœ€è¦è·å–ç»“æœï¼Œåªéœ€è¦ä»MQä¸­è·å–ç»“æœæ•°æ®å°±å¯ä»¥äº†ï¼ŒAç³»ç»Ÿçš„ä»£ç ä¸éœ€è¦è¿›è¡Œæ”¹åŠ¨ã€‚è¿™æ ·å°±å¤§å¤§çš„æé«˜äº†</p>
<p>ç³»ç»Ÿçš„ç»´æŠ¤æ€§ã€‚</p>
<h2 id="MQçš„ä¼˜ç¼ºç‚¹">MQçš„ä¼˜ç¼ºç‚¹</h2>
<p>ä¼˜ç‚¹ï¼š</p>
<p>1ã€åº”ç”¨è§£è€¦æé«˜äº†ç³»ç»Ÿçš„å®¹é”™æ€§</p>
<p>2ã€å¼‚æ­¥é€šè®¯æé«˜äº†ç³»ç»Ÿçš„å“åº”é€Ÿåº¦</p>
<p>3ã€æµé‡æ¶ˆé”‹æé«˜äº†ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›</p>
<p>ç¼ºç‚¹ï¼š</p>
<p>1ã€ç³»ç»Ÿå¯ç”¨æ€§é™ä½ï¼šç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œç³»ç»Ÿç¨³å®šæ€§è¶Šå·®ã€‚ä¸€æ—¦MQå®•æœºï¼Œå°±ä¼šå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚</p>
<p>2ã€ç³»ç»Ÿå¤æ‚åº¦æé«˜ï¼šMQçš„åŠ å…¥å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</p>
<h3 id="MQçš„é€‰æ‹©ä¾æ®æ˜¯ä»€ä¹ˆ">MQçš„é€‰æ‹©ä¾æ®æ˜¯ä»€ä¹ˆ?</h3>
<p>è°ƒç”¨æ–¹æ˜¯å¦éœ€è¦è·å–åˆ°è¢«è°ƒç”¨æ–¹çš„æ‰§è¡Œç»“æœï¼Œå¦‚æœéœ€è¦è·å–åˆ°ç»“æœï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨åŒæ­¥é€šè®¯ï¼Œå¦‚æœä¸éœ€è¦å°±å¯ä»¥ä½¿ç”¨å¼‚æ­¥é€šè®¯ã€‚</p>
<h2 id="Rabbitmqç®€ä»‹">Rabbitmqç®€ä»‹</h2>
<p>RabbitMQæ˜¯ç”±erlangã€äºŒéƒç¥ã€‘è¯­è¨€å¼€å‘ï¼ŒåŸºäºAMQPï¼ˆAdvanced Message Queue Protocol é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰åè®®å®ç°çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒæ˜¯ä¸€ç§åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡æ–¹</p>
<p>æ³•ï¼Œæ¶ˆæ¯é˜Ÿåˆ—åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘ä¸­åº”ç”¨éå¸¸å¹¿æ³›ã€‚</p>
<p>RabbitMQå®˜æ–¹åœ°å€ï¼š<a href="http://www.rabbitmq.com/">http://www.rabbitmq.com/</a></p>
<p>RabbitMQå¸¸è§çš„æ¶ˆæ¯æ¨¡å‹ï¼š<a href="https://www.rabbitmq.com/getstarted.html">https://www.rabbitmq.com/getstarted.html</a></p>
<p><img src="http://120.26.79.238:9000/blog/img/14f8cabcbf5d82a15aa6f8afdf96ec6d.png" alt=""></p>
<p>RabbitMQæä¾›äº†<strong>7ç§æ¨¡å¼</strong>ï¼šç®€å•æ¨¡å¼ï¼Œworkæ¨¡å¼ ï¼ŒPublish/Subscribeå‘å¸ƒä¸è®¢é˜…æ¨¡å¼ï¼ŒRoutingè·¯ç”±æ¨¡å¼ï¼ŒTopicsä¸»é¢˜æ¨¡å¼ï¼ŒRPCè¿œç¨‹è°ƒç”¨æ¨¡å¼(è¿œç¨‹è°ƒç”¨)ï¼Œç”Ÿäº§è€…</p>
<p>ç¡®è®¤ã€‚</p>
<h2 id="å¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—äº§å“">å¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—äº§å“</h2>
<p>1ã€ActiveMQ</p>
<p>2ã€Rabbitmq</p>
<p>3ã€RocketMQ</p>
<p>4ã€Kafka</p>
<p>å¸¸è§ç‰¹æ€§æ¯”å¯¹ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/eb529511edab3809605f48c830d56c28.png" alt=""></p>
<h2 id="Rabbitmqç¯å¢ƒæ­å»º">Rabbitmqç¯å¢ƒæ­å»º</h2>
<h3 id="éƒ¨ç½²Rabbitmq">éƒ¨ç½²Rabbitmq</h3>
<ul>
<li>
<p>ä½¿ç”¨dockeréƒ¨ç½²</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‹‰å–rabbitmqçš„é•œåƒ</span></span><br><span class="line">docker pull rabbitmq:3.8-management</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºå®¹å™¨</span></span><br><span class="line">docker run -d --name rabbit01 -e RABBITMQ_DEFAULT_USER=admin \</span><br><span class="line">-e RABBITMQ_DEFAULT_PASS=admin \</span><br><span class="line">-p 15672:15672 -p 5672:5672 \</span><br><span class="line">--hostname rabbit01 --restart=always \</span><br><span class="line">-v rabbit01_data:/var/lib/rabbitmq \</span><br><span class="line">-v rabbit01_conf:/etc/rabbitmq \</span><br><span class="line">rabbitmq:3.8-management</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è®¿é—®åœ°å€ï¼š<a href="http://xn--ip-im8ckcv93fffgt74d:15672">http://è™šæ‹Ÿæœºipåœ°å€:15672</a></p>
</li>
<li>
<p>ç”¨æˆ·åå’Œå¯†ç ï¼šadmin/admin</p>
</li>
</ul>
<h3 id="æ¶æ„ä»‹ç»">æ¶æ„ä»‹ç»</h3>
<p>Rabbitmqçš„æ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/d0597cfc562e019bc52b57d2fc200423.png" alt=""></p>
<p><strong>Broker</strong>ï¼šæ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Serverå°±æ˜¯ Message Broker</p>
<p><strong>Virtual host</strong>:å‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ AMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ç»œä¸­çš„ namespace æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª</p>
<p>RabbitMQ server æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªvhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ vhost åˆ›å»º exchangeï¼queue ç­‰</p>
<p><strong>Connection</strong>ï¼špublisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥</p>
<p><strong>Channel</strong>ï¼šå¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP Connectionçš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection</p>
<p>å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthreadåˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼ŒAMQP method åŒ…å«äº†channel id å¸®åŠ©å®¢æˆ·ç«¯å’Œmessage broker</p>
<p>è¯†åˆ« channelï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„ Connection æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€</p>
<p><strong>Exchange</strong>ï¼šmessage åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘æ¶ˆæ¯åˆ°queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point)ï¼Œ</p>
<p>topic (publish-subscribe) and fanout (multicast)</p>
<p><strong>Queue</strong>ï¼šå­˜å‚¨æ¶ˆæ¯çš„å®¹å™¨ï¼Œæ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œï¼Œç­‰å¾… consumer å–èµ°</p>
<p><strong>Binding</strong>ï¼šexchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyã€‚Binding ä¿¡æ¯è¢«ä¿å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ®</p>
<h3 id="ç®¡ç†ç•Œé¢ä½¿ç”¨">ç®¡ç†ç•Œé¢ä½¿ç”¨</h3>
<p>å„ä¸ªé€‰é¡¹å¡çš„è¯´æ˜ï¼š</p>
<p>1ã€overviewï¼šæ¦‚è§ˆ</p>
<p>2ã€connectionsï¼šæ— è®ºç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…ï¼Œéƒ½éœ€è¦ä¸RabbitMQå»ºç«‹è¿æ¥åæ‰å¯ä»¥å®Œæˆæ¶ˆæ¯çš„ç”Ÿäº§å’Œæ¶ˆè´¹ï¼Œåœ¨è¿™é‡Œå¯ä»¥æŸ¥çœ‹è¿æ¥æƒ…å†µ</p>
<p>3ã€channelsï¼šé€šé“ï¼Œå»ºç«‹è¿æ¥åï¼Œä¼šå½¢æˆé€šé“ï¼Œæ¶ˆæ¯çš„æŠ•é€’è·å–ä¾èµ–é€šé“ã€‚</p>
<p>4ã€Exchangesï¼šäº¤æ¢æœºï¼Œç”¨æ¥å®ç°æ¶ˆæ¯çš„è·¯ç”±</p>
<p>5ã€Queuesï¼šé˜Ÿåˆ—ï¼Œå³æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹ï¼Œæ¶ˆè´¹åè¢«ç§»é™¤é˜Ÿåˆ—</p>
<p>Rabbitmqå¸¸è§ç«¯å£å·ï¼š</p>
<p>5672ï¼šRabbitMQçš„ç¼–ç¨‹è¯­è¨€å®¢æˆ·ç«¯è¿æ¥ç«¯å£</p>
<p>15672ï¼šRabbitMQç®¡ç†ç•Œé¢ç«¯å£</p>
<h3 id="ç”¨æˆ·ç®¡ç†">ç”¨æˆ·ç®¡ç†</h3>
<p>å¸¸è§çš„è§’è‰²è¯´æ˜ï¼š</p>
<p>1ã€ è¶…çº§ç®¡ç†å‘˜(administrator)ï¼šå¯ç™»å½•ç®¡ç†æ§åˆ¶å°ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥å¯¹ç”¨æˆ·ï¼Œç­–ç•¥(policy)è¿›è¡Œæ“ä½œã€‚</p>
<p>2ã€ ç›‘æ§è€…(monitoring)ï¼šå¯ç™»å½•ç®¡ç†æ§åˆ¶å°ï¼ŒåŒæ—¶å¯ä»¥æŸ¥çœ‹rabbitmqèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯(è¿›ç¨‹æ•°ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œç£ç›˜ä½¿ç”¨æƒ…å†µç­‰)</p>
<p>3ã€ ç­–ç•¥åˆ¶å®šè€…(policymaker)ï¼šå¯ç™»å½•ç®¡ç†æ§åˆ¶å°ï¼Œ åŒæ—¶å¯ä»¥å¯¹policyè¿›è¡Œç®¡ç†ã€‚ä½†æ— æ³•æŸ¥çœ‹èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>4ã€ æ™®é€šç®¡ç†è€…(management)ï¼šä»…å¯ç™»å½•ç®¡ç†æ§åˆ¶å°ï¼Œæ— æ³•çœ‹åˆ°èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•å¯¹ç­–ç•¥è¿›è¡Œç®¡ç†ã€‚</p>
<p>5ã€ å…¶ä»–ï¼šæ— æ³•ç™»å½•ç®¡ç†æ§åˆ¶å°ï¼Œé€šå¸¸å°±æ˜¯æ™®é€šçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚</p>
<h3 id="è™šæ‹Ÿä¸»æœºç®¡ç†">è™šæ‹Ÿä¸»æœºç®¡ç†</h3>
<ul>
<li>åœ¨å“ªä¸ªç”¨æˆ·åˆ›å»ºçš„è™šæ‹Ÿä¸»æœºï¼Œè¿™ä¸ªç”¨æˆ·å°±æ‹¥æœ‰æƒé™ï¼Œè¶…çº§ç®¡ç†å‘˜ä¹Ÿå¯ä»¥è®¾ç½®æƒé™</li>
</ul>
<h3 id="Rabbitmqå…¥é—¨">Rabbitmqå…¥é—¨</h3>
<h4 id="çˆ¶å·¥ç¨‹">çˆ¶å·¥ç¨‹</h4>
<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>1ã€åˆ›å»ºä¸€ä¸ªçˆ¶å·¥ç¨‹ï¼šrabbitmq-parent</p>
<p>2ã€åœ¨pom.xmlæ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring bootå’Œrabbitmqæ•´åˆçš„æ—¶å€™æ‰€éœ€è¦çš„èµ·æ­¥ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring bootå’Œjunitæ•´åˆçš„èµ·æ­¥ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- ç±»ä¼¼äºæŒ‡å®šçˆ¶å·¥ç¨‹ ä¸Šè¿°ç»§æ‰¿äº†çˆ¶å·¥ç¨‹ä¹‹åï¼Œè¿™é‡Œå°±å¯ä»¥ä¸ç”¨è¿™ä¸ªdependencyManagementè¿™ä¸€é¡¹äº†,è¿™ä¸¤é¡¹é€‰æ‹©ä¸€é¡¹å³å¯ã€‚--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Spring Boot Dependencies --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="ç”Ÿäº§è€…">ç”Ÿäº§è€…</h4>
<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>1ã€åœ¨rabbitmq-parentå·¥ç¨‹ä¸‹åˆ›å»ºä¸€ä¸ªå­å·¥ç¨‹rabbitmq-producer</p>
<p>2ã€åˆ›å»ºå¯¹åº”çš„å¯åŠ¨ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// com.atguigu.rabbit.producer;</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ProducerApplication.class , args) ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3ã€åœ¨application.ymlæ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ä¿¡æ¯</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.136</span><span class="number">.145</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure>
<p>4ã€ç¼–å†™æµ‹è¯•ç±»ä½¿ç”¨<strong>RabbitTemplate</strong>å‘é€æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// com.atguigu.rabbit.producer.test;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest(classes = ProducerApplication.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;simple_queue&quot;</span> , <span class="string">&quot;hello rabbitmq...&quot;</span>);		<span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºçš„å°±æ˜¯é˜Ÿåˆ—åç§°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨ç¨‹åºè¿›è¡Œæµ‹è¯•ï¼Œéœ€è¦å…ˆå°†é˜Ÿåˆ—åˆ›å»ºå‡ºæ¥(åˆ›å»ºé˜Ÿåˆ—çš„ä¸‰ç§æ–¹å¼ï¼š1ã€ä½¿ç”¨åå°ç®¡ç†ç³»ç»Ÿ  2ã€ä½¿ç”¨Java Api    3ã€ä½¿ç”¨@RabbitListeneræ³¨è§£)ã€‚</p>
<h4 id="æ¶ˆè´¹è€…å·¥ç¨‹">æ¶ˆè´¹è€…å·¥ç¨‹</h4>
<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>1ã€åœ¨rabbitmq-parentå·¥ç¨‹ä¸‹åˆ›å»ºä¸€ä¸ªå­å·¥ç¨‹rabbitmq-consumer</p>
<p>2ã€åˆ›å»ºå¯¹åº”çš„å¯åŠ¨ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// com.atguigu.rabbit.consumer;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConsumerApplication.class , args) ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3ã€åœ¨application.ymlæ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ä¿¡æ¯</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.136</span><span class="number">.145</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure>
<p>4ã€ç¼–å†™æ¶ˆè´¹è€…ç›‘å¬æ–¹æ³•ï¼Œç›‘å¬æŒ‡å®šçš„é˜Ÿåˆ—è·å–é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// com.atguigu.rabbit.consumer.listener01;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01Listener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple_queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumer01</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] body = message.getBody();</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">        System.out.println(<span class="string">&quot;msg ----&gt; &quot;</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Rabbitmqæ¶ˆæ¯æ¨¡å‹">Rabbitmqæ¶ˆæ¯æ¨¡å‹</h2>
<h3 id="ç®€å•é˜Ÿåˆ—æ¨¡å¼">ç®€å•é˜Ÿåˆ—æ¨¡å¼</h3>
<p>ä¸€ä¸ªç”Ÿäº§è€…ç›´æ¥å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</p>
<p><img src="http://120.26.79.238:9000/blog/img/1ab5749dc0621c719f1347eadf30e4ff.png" alt=""></p>
<h3 id="å·¥ä½œé˜Ÿåˆ—">å·¥ä½œé˜Ÿåˆ—</h3>
<p>ä¸€ä¸ªç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å…±åŒæ¶ˆè´¹ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</p>
<p>**åº”ç”¨åœºæ™¯ï¼š**å¯¹äºä»»åŠ¡è¿‡é‡æˆ–ä»»åŠ¡è¾ƒå¤šæƒ…å†µä½¿ç”¨</p>
<p><img src="http://120.26.79.238:9000/blog/img/01acea803a2212c25ea2af973e6dbf20.png" alt=""></p>
<h2 id="å‘å¸ƒè®¢é˜…æ¨¡å‹">å‘å¸ƒè®¢é˜…æ¨¡å‹</h2>
<ul>
<li>åœ¨ç®€å•é˜Ÿåˆ—æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œåˆå¤šäº†ä¸€ä¸ªè§’è‰²ï¼šäº¤æ¢æœºexchange</li>
<li>ç”Ÿäº§è€…é€šè¿‡å°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢æœºï¼Œç”±äº¤æ¢æœºå°†æ¶ˆæ¯è½¬å‘ç»™é˜Ÿåˆ—</li>
</ul>
<h3 id="äº¤æ¢æœºç±»å‹">äº¤æ¢æœºç±»å‹</h3>
<ol>
<li>Fanotï¼šå¹¿æ’­ï¼Œæ²¡æœ‰binding-keyï¼Œå°†æ¶ˆæ¯è½¬å‘ç»™æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—</li>
<li>Directï¼šè·¯ç”±ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting-keyçš„é˜Ÿåˆ—</li>
<li>topicï¼šä¸»é¢˜ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting pattern ï¼ˆè·¯ç”±è§„åˆ™ï¼‰çš„é˜Ÿåˆ—</li>
</ol>
<p><strong>Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸Exchangeç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p>
<h3 id="Fanout">Fanout</h3>
<p>ç®€ä»‹ï¼šfanoutç±»å‹çš„äº¤æ¢æœºä¼šå°†å°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ä¸ä¹‹ç»‘å®šé˜Ÿåˆ—</p>
<p><img src="http://120.26.79.238:9000/blog/img/e364b37ba6a70a58c8cb7bd3c14b9c79.png" alt=""></p>
<h4 id="é€šè¿‡java-apiåˆ›å»ºexchangeã€queueå’Œç»‘å®šä¿¡æ¯">é€šè¿‡java apiåˆ›å»ºexchangeã€queueå’Œç»‘å®šä¿¡æ¯</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// com.atguigu.rabbit.producer.config;</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitmqFanoutExchangeConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Exchange <span class="title function_">fanoutExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Exchange</span> <span class="variable">fanoutExchange</span> <span class="operator">=</span> ExchangeBuilder.fanoutExchange(<span class="string">&quot;fanout_exchange&quot;</span>).durable(<span class="literal">true</span>).build();</span><br><span class="line">        <span class="keyword">return</span> fanoutExchange ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Queue</span> <span class="variable">queue</span> <span class="operator">=</span> QueueBuilder.durable(<span class="string">&quot;fanout_queue_01&quot;</span>).build();</span><br><span class="line">        <span class="keyword">return</span> queue ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Queue</span> <span class="variable">queue</span> <span class="operator">=</span> QueueBuilder.durable(<span class="string">&quot;fanout_queue_02&quot;</span>).build();</span><br><span class="line">        <span class="keyword">return</span> queue ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®šä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">fanoutQueue01Binding</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Binding</span> <span class="variable">binding</span> <span class="operator">=</span> BindingBuilder.bind(fanoutQueue01()).to(fanoutExchange()).with(<span class="string">&quot;&quot;</span>).noargs();</span><br><span class="line">        <span class="keyword">return</span> binding ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">fanoutQueue02Binding</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Binding</span> <span class="variable">binding</span> <span class="operator">=</span> BindingBuilder.bind(fanoutQueue02()).to(fanoutExchange()).with(<span class="string">&quot;&quot;</span>).noargs();</span><br><span class="line">        <span class="keyword">return</span> binding ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Direct">Direct</h3>
<p>è·¯ç”±æ¨¡å¼ç‰¹ç‚¹ï¼š</p>
<p>1ã€é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šçš„æ—¶å€™éœ€è¦æŒ‡å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªbindingKey(routingKey)</p>
<p>2ã€ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™éœ€è¦æŒ‡å®šä¸€ä¸ªæ¶ˆæ¯çš„routingKey</p>
<p>3ã€äº¤æ¢æœºè·å–åˆ°æ¶ˆæ¯ä»¥åéœ€è¦ä½¿ç”¨æ¶ˆæ¯çš„routingKeyå’ŒbindingKeyæ¯”å¯¹ï¼Œå¦‚æœç›¸ç­‰å°±ä¼šæŠŠæ¶ˆæ¯è½¬å‘ç»™å¯¹åº”çš„é˜Ÿåˆ—</p>
<p><img src="http://120.26.79.238:9000/blog/img/86281c4c3b0304636bacd01c978f2173.png" alt=""></p>
<h3 id="Topic">Topic</h3>
<p>ä¸»é¢˜æ¨¡å¼ç‰¹ç‚¹ï¼š</p>
<p>1ã€é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šçš„æ—¶å€™éœ€è¦æŒ‡å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªbindingKey(routingKey) ï¼Œ <strong>åœ¨bindingKeyå¯ä»¥ä½¿ç”¨é€šé…ç¬¦</strong></p>
<p>2ã€ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™éœ€è¦æŒ‡å®šä¸€ä¸ªæ¶ˆæ¯çš„routingKey</p>
<p>3ã€äº¤æ¢æœºè·å–åˆ°æ¶ˆæ¯ä»¥åéœ€è¦ä½¿ç”¨æ¶ˆæ¯çš„routingKeyå’ŒbindingKeyè§„åˆ™è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœroutingKeyæ»¡è¶³bindingKeyçš„è§„åˆ™å°±ä¼šæŠŠæ¶ˆæ¯è½¬å‘ç»™å¯¹åº”çš„é˜Ÿåˆ—</p>
<p><img src="http://120.26.79.238:9000/blog/img/5ac74b2b60cf06b7d4b2a671af6b384e.png" alt=""></p>
<p>é€šé…ç¬¦ä»‹ç»ï¼š</p>
<p><strong>#</strong>ï¼šåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯</p>
<p>*<strong><strong>ï¼šåŒ¹é…ä¸å¤šä¸å°‘</strong>æ°å¥½1</strong>ä¸ªè¯</p>
<h2 id="RabbitListeneræ³¨è§£">@RabbitListeneræ³¨è§£</h2>
<ul>
<li>ç¬¬ä¸‰ç§è®¾ç½®é˜Ÿåˆ—ï¼Œäº¤æ¢æœºå’Œç»‘å®šå…³ç³»çš„æ–¹å¼</li>
</ul>
<p>RabbitListeneræ³¨è§£ç”¨æ¥å£°æ˜æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼Œå¯ä»¥ç›‘å¬æŒ‡å®šçš„é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºã€é˜Ÿåˆ—å’Œäº¤æ¢æœºç»‘å®šä¿¡æ¯ã€‚</p>
<p>ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// com.atguigu.rabbit.consumer.listener04;</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer02Listener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(value = &quot;direct_queue_02&quot; , durable = &quot;true&quot;) ,</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(value = &quot;direct_exchange&quot; , durable = &quot;true&quot; , type = ExchangeTypes.DIRECT) ,</span></span><br><span class="line"><span class="meta">            key = &#123; &quot;error&quot; , &quot;info&quot;&#125;</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumer01</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] body = message.getBody();</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">        System.out.println(<span class="string">&quot;consumer02Listener....msg ----&gt; &quot;</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ¶ˆæ¯çš„å¯é æ€§ä¿è¯">æ¶ˆæ¯çš„å¯é æ€§ä¿è¯</h2>
<p><strong>æ¦‚è¿°</strong>ï¼šæŒ‡çš„å°±æ˜¯åœ¨æ•´ä¸ªæ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼</p>
<p><img src="http://120.26.79.238:9000/blog/img/67b4c75c443fda45deff151218017432.png" alt=""></p>
<ul>
<li>
<p>æ¶ˆæ¯ä¼ è¾“ä¸‰ä¸ªé˜¶æ®µ</p>
<p>1ã€ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°MQ</p>
<p>2ã€MQæœåŠ¡ç«¯å­˜å‚¨æ¶ˆæ¯</p>
<p>3ã€æ¶ˆè´¹è€…ä»MQä¸­æ¶ˆè´¹æ¶ˆæ¯</p>
</li>
<li>
<p>åœ¨æ•´ä¸ªæ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­å“ªäº›åœ°æ–¹å¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯çš„ä¸¢å¤±å‘¢?</p>
</li>
</ul>
<p>1ã€ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°MQï¼šäº¤æ¢æœºçš„åå­—å†™é”™äº†ã€routingKeyå†™é”™äº†</p>
<p>2ã€MQæœåŠ¡ç«¯å­˜å‚¨æ¶ˆæ¯: MQæœåŠ¡å™¨å®•æœºäº†(é»˜è®¤æƒ…å†µä¸‹æ¶ˆæ¯æ˜¯å­˜å‚¨äºå†…å­˜ä¸­)</p>
<p>3ã€æ¶ˆè´¹è€…ä»MQä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼šæ¶ˆè´¹è€…è·å–åˆ°æ¶ˆæ¯ä»¥åè¿˜æ²¡æœ‰åŠæ—¶å¤„ç†ï¼Œæ¶ˆè´¹è€…æœåŠ¡å®•æœºäº†</p>
<h3 id="æ¶ˆæ¯å¯é æ€§æŠ•é€’">æ¶ˆæ¯å¯é æ€§æŠ•é€’</h3>
<p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™æœ‰ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<p>1ã€ç”Ÿæˆè€…å‘ç”Ÿæ¶ˆæ¯åˆ°exchange</p>
<p>2ã€äº¤æ¢æœºè·å–åˆ°æ¶ˆæ¯ä»¥åæŠŠæ¶ˆæ¯è½¬å‘åˆ°é˜Ÿåˆ—ä¸­</p>
<p>é’ˆå¯¹ä¸Šçš„ä¸¤ä¸ªé˜¶æ®µRabbitmqæä¾›äº†ä¸¤ç§æœºåˆ¶ä¿éšœæ¶ˆæ¯çš„å¯é æ€§æŠ•é€’ï¼š</p>
<p><strong>confirm</strong> <strong>ç¡®è®¤æ¨¡å¼ï¼šå¯ä»¥é€šè¿‡è¯¥æœºåˆ¶ç¡®è®¤æ¶ˆæ¯æ˜¯å¦å¯ä»¥æ­£å¸¸å‘é€åˆ°exchange</strong>ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/430a8675ec6578e5f5789ef7dca5148e.png" alt=""></p>
<p><strong>return</strong> <strong>é€€å›æ¨¡å¼ï¼šå¯ä»¥é€šè¿‡è¯¥æœºåˆ¶ç¡®è®¤æ¶ˆæ¯æ˜¯å¦å¯ä»¥æ­£å¸¸å‘é€åˆ°é˜Ÿåˆ—ä¸­</strong></p>
<p><img src="http://120.26.79.238:9000/blog/img/d2e066c7675f7e7433af1c9516ead9a0.png" alt=""></p>
<h4 id="confirm">confirm</h4>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>1ã€åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span>      <span class="comment"># å¼€å¯ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶</span></span><br></pre></td></tr></table></figure>
<p>2ã€è‡ªå®šä¹‰RabbitTemplateï¼Œå¹¶ä¸ºå…¶ç»‘å®šç¡®è®¤æœºåˆ¶çš„å›è°ƒå‡½æ•°ï¼Œè®©ç”Ÿäº§è€…å¯ä»¥æ„ŸçŸ¥åˆ°æ¶ˆæ¯æ˜¯å¦æ­£å¸¸æŠ•é€’ç»™äº†äº¤æ¢æœº</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// com.atguigu.rabbit.producer.config;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitTemplateConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RabbitTemplate <span class="title function_">rabbitTemplate</span><span class="params">(ConnectionFactory connectionFactory)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºRabbitTemplateå¯¹è±¡</span></span><br><span class="line">        <span class="type">RabbitTemplate</span> <span class="variable">rabbitTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RabbitTemplate</span>(connectionFactory) ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»‘å®šç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶å›è°ƒå‡½æ•°</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="keyword">new</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(ack) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ¶ˆæ¯æ­£å¸¸å‘ç»™äº¤æ¢æœºäº†...&quot;</span>);</span><br><span class="line">                    <span class="comment">// ä¿®æ”¹æ•°æ®åº“ä¸­æ¶ˆæ¯çš„å‘é€çŠ¶æ€</span></span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">msgId</span> <span class="operator">=</span> correlationData.getId();</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€ç»™äº¤äº’æœºå¤±è´¥äº†...msgId ---&gt; &quot;</span> + msgId);</span><br><span class="line">                    <span class="comment">// æ ¹æ®msgIdä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¶ˆæ¯ï¼Œç„¶åå°è¯•é‡æ–°è¿›è¡Œå‘é€ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªé‡æ–°å‘é€çš„æœ€å¤§æ¬¡æ•°ï¼Œå¦‚æœå®é™…é‡è¯•æ¬¡æ•°è¶…è¿‡äº†æœ€å¤§æ­¤æ—¶å°±ä¸éœ€è¦åœ¨è¿›è¡Œ</span></span><br><span class="line">                    <span class="comment">// é‡æ–°å‘é€ï¼ŒåæœŸé€šè¿‡äººå·¥å¤„ç†</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> rabbitTemplate ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3ã€å‘é€æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨å‘é€æ¶ˆæ¯ä¹‹å‰ï¼Œå°†æ¶ˆæ¯çš„å†…å®¹å†™å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”ä¸ºæ¶ˆæ¯åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„idï¼Œé€šè¿‡CorrelationDataå¯¹è±¡è¿›è¡Œå°è£…</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">msgId</span> <span class="operator">=</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">correlationData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(msgId) ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;direct_exchange2&quot;</span> , <span class="string">&quot;error&quot;</span> , <span class="string">&quot;hello direct exchange....&quot;</span> , correlationData);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="returnæœºåˆ¶">returnæœºåˆ¶</h4>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>1ã€åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç”Ÿäº§è€…å›é€€æœºåˆ¶</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span>                 <span class="comment"># å¼€å¯ç”Ÿäº§è€…å›é€€æœºåˆ¶</span></span><br></pre></td></tr></table></figure>
<p>2ã€è‡ªå®šä¹‰RabbitTemplateï¼Œå¹¶ä¸ºå…¶ç»‘å®šå›é€€æœºåˆ¶çš„å›è°ƒå‡½æ•°ï¼Œè®©ç”Ÿäº§è€…å¯ä»¥æ„ŸçŸ¥åˆ°æ¶ˆæ¯æ˜¯å¦æ­£å¸¸æŠ•é€’ç»™äº†é˜Ÿåˆ—</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç»‘å®šç”Ÿäº§è€…å›é€€æœºåˆ¶å›è°ƒå‡½æ•°</span></span><br><span class="line">rabbitTemplate.setMandatory(<span class="literal">true</span>);  <span class="comment">// è®©rabbitmqå°†å¤±è´¥çš„æ¶ˆæ¯çš„ä¿¡æ¯å†æ¬¡è¿”å›ç»™ç”Ÿäº§è€…</span></span><br><span class="line">rabbitTemplate.setReturnsCallback(<span class="keyword">new</span> <span class="title class_">RabbitTemplate</span>.ReturnsCallback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(ReturnedMessage returnedMessage)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">exchange</span> <span class="operator">=</span> returnedMessage.getExchange();</span><br><span class="line">        <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> returnedMessage.getRoutingKey();</span><br><span class="line">        <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> returnedMessage.getMessage();</span><br><span class="line">        <span class="type">int</span> <span class="variable">replyCode</span> <span class="operator">=</span> returnedMessage.getReplyCode();</span><br><span class="line">        <span class="type">String</span> <span class="variable">replyText</span> <span class="operator">=</span> returnedMessage.getReplyText();</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()) ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">correlationId</span> <span class="operator">=</span> (String)message.getMessageProperties().getHeaders().get(<span class="string">&quot;spring_returned_message_correlation&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;correlationIdï¼š&quot;</span>+correlationId);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯æŠ•é€’ç»™é˜Ÿåˆ—å¤±è´¥äº†ï¼Œ msg ---&gt; &quot;</span> + msg);</span><br><span class="line">        System.out.println(<span class="string">&quot;replyCode ---&gt; &quot;</span> + replyCode);</span><br><span class="line">        System.out.println(<span class="string">&quot;replyText ---&gt; &quot;</span> + replyText);</span><br><span class="line">        System.out.println(<span class="string">&quot;exchange ---&gt; &quot;</span> + exchange);</span><br><span class="line">        System.out.println(<span class="string">&quot;routingKey ---&gt; &quot;</span> + routingKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3ã€å‘é€æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨å‘é€æ¶ˆæ¯ä¹‹å‰ï¼Œå°†æ¶ˆæ¯çš„å†…å®¹å†™å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”ä¸ºæ¶ˆæ¯åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„idï¼Œé€šè¿‡CorrelationDataå¯¹è±¡è¿›è¡Œå°è£…</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">msgId</span> <span class="operator">=</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">correlationData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(msgId) ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;direct_exchange&quot;</span> , <span class="string">&quot;error2&quot;</span> , <span class="string">&quot;hello direct exchange....&quot;</span> , correlationData);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ¶ˆæ¯å¯é æ€§å­˜å‚¨">æ¶ˆæ¯å¯é æ€§å­˜å‚¨</h3>
<p>é’ˆå¯¹MQæœåŠ¡ç«¯å­˜å‚¨æ¶ˆæ¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼Œé‚£ä¹ˆæ­¤æ—¶åªéœ€è¦å¯¹å¦‚ä¸‹çš„å¯¹è±¡è¿›è¡ŒæŒä¹…åŒ–å³å¯ã€‚</p>
<p>1ã€æ¶ˆæ¯å¼€å¯æŒä¹…åŒ–</p>
<p>2ã€é˜Ÿåˆ—å¼€å¯æŒä¹…åŒ–</p>
<p>3ã€äº¤æ¢æœºå¼€å¯æŒä¹…åŒ–</p>
<p>æ³¨æ„ï¼šSpring bootæ•´åˆRabbitMQé»˜è®¤çš„æƒ…å†µä¸‹åˆ›å»ºçš„é˜Ÿåˆ—ä»¥åŠå‘é€çš„æ¶ˆæ¯éƒ½æ˜¯æŒä¹…åŒ–çš„ã€‚</p>
<p>è®¾ç½®æ¶ˆæ¯ä¸ºéæŒä¹…åŒ–æ¶ˆæ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨å‘é€æ¶ˆæ¯ä¹‹å‰ï¼Œå°†æ¶ˆæ¯çš„å†…å®¹å†™å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”ä¸ºæ¶ˆæ¯åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„idï¼Œé€šè¿‡CorrelationDataå¯¹è±¡è¿›è¡Œå°è£…</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">msgId</span> <span class="operator">=</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">correlationData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(msgId) ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ¶ˆæ¯çš„åç½®å¤„ç†å™¨å¯¹è±¡</span></span><br><span class="line">    <span class="type">MessagePostProcessor</span> <span class="variable">messagePostProcessor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessagePostProcessor</span>()&#123;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Message <span class="title function_">postProcessMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> AmqpException &#123;</span><br><span class="line">            <span class="comment">//åœ¨springbootæ•´åˆrabbitmqè¿™é‡Œï¼Œé»˜è®¤å‘é€åˆ°é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å°±æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ã€‚</span></span><br><span class="line">            message.getMessageProperties().setDeliveryMode(MessageDeliveryMode.NON_PERSISTENT);  <span class="comment">// è®¾ç½®è¯¥æ¶ˆæ¯ä¸ºéæŒä¹…åŒ–æ¶ˆæ¯</span></span><br><span class="line">            <span class="keyword">return</span> message;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;direct_exchange&quot;</span> ,</span><br><span class="line">                                  <span class="string">&quot;error&quot;</span> ,</span><br><span class="line">                                  <span class="string">&quot;hello direct exchange....&quot;</span> ,</span><br><span class="line">                                  messagePostProcessor , correlationData );</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ¶ˆæ¯å¯é æ€§æ¶ˆè´¹">æ¶ˆæ¯å¯é æ€§æ¶ˆè´¹</h3>
<p>æ¶ˆè´¹è€…è·å–åˆ°æ¶ˆæ¯ä»¥åéœ€è¦ç»™RabbitMQæœåŠ¡ç«¯è¿›è¡Œåº”ç­”ï¼ŒRabbitMQæ ¹æ®æ¶ˆè´¹è€…çš„åº”ç­”ä¿¡æ¯å†³å®šæ˜¯å¦éœ€è¦å°†æ¶ˆæ¯ä»RabbitMQçš„æœåŠ¡ç«¯åˆ é™¤æ‰ã€‚</p>
<p>åº”ç­”æ¨¡å¼ï¼š</p>
<p>1ã€noneï¼š è¿›è¡Œè‡ªåŠ¨åº”ç­”ï¼Œæ¶ˆè´¹è€…è·å–åˆ°æ¶ˆæ¯ä»¥åç›´æ¥ç»™RabbitMQè¿”å›ackï¼ŒRabbitMQç›´æ¥å°†æ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤æ‰</p>
<p>2ã€manualï¼š æ‰‹åŠ¨åº”ç­”ï¼Œæ¶ˆè´¹è€…å¯ä»¥æ ¹æ®æ¶ˆæ¯æ¶ˆè´¹çš„å®é™…æƒ…å†µç»™RabbitMQè¿›è¡Œåº”ç­”</p>
<p>3ã€auto(é»˜è®¤å€¼)ï¼šç”±Springå®¹å™¨æ¥æ ¹æ®ä¸šåŠ¡çš„æ‰§è¡Œç‰¹ç‚¹è¿›è¡Œå¯¹åº”çš„åº”ç­”ï¼Œå¦‚æœä¸šåŠ¡æ‰§è¡Œæ­£å¸¸ï¼Œè¿”å›ackï¼Œä¸šåŠ¡æ‰§è¡Œå¼‚å¸¸ï¼Œè¿”å›unackã€‚</p>
<h4 id="noneæ¨¡å¼">noneæ¨¡å¼</h4>
<p>åœ¨æ¶ˆè´¹è€…çš„application.ymlæ–‡ä»¶ä¸­ï¼Œè®¾ç½®æ¶ˆæ¯è€…åº”ç­”æ¨¡å¼ä¸ºnoneæ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">none</span></span><br></pre></td></tr></table></figure>
<h4 id="autoæ¨¡å¼-é»˜è®¤æ¨¡å¼">autoæ¨¡å¼(é»˜è®¤æ¨¡å¼)</h4>
<p>åœ¨æ¶ˆè´¹è€…çš„application.ymlæ–‡ä»¶ä¸­ï¼Œè®¾ç½®æ¶ˆæ¯è€…åº”ç­”æ¨¡å¼ä¸ºautoæ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">auto</span>    <span class="comment"># æ›´æ”¹æ¶ˆè´¹è€…åº”ç­”æ¨¡å¼ä¸ºè‡ªåŠ¨æ¨¡å¼</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼š</p>
<p>1ã€æµ‹è¯•é‡è¯•çš„æ—¶å€™ä¸èƒ½é€šè¿‡å¼‚å¸¸çš„è¾“å‡ºæ¬¡æ•°æ¥åˆ¤æ–­æ–¹æ³•è°ƒç”¨äº†å‡ æ¬¡ã€‚</p>
<p>2ã€é‡è¯•æ¬¡æ•°è€—å°½ä»¥åä¼šè°ƒç”¨MessageRecovererä¸­çš„recoveræ–¹æ³•å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†æ‰ã€‚</p>
<ul>
<li>RejectAndDontRequeueRecovererï¼šæ‹’ç»è€Œä¸”ä¸æŠŠæ¶ˆæ¯é‡æ–°æ”¾å…¥é˜Ÿåˆ—ï¼ˆé»˜è®¤ï¼‰</li>
<li>RepublishMessageRecovererï¼šé‡æ–°å‘å¸ƒæ¶ˆæ¯</li>
</ul>
<h4 id="manualæ¨¡å¼">manualæ¨¡å¼</h4>
<p>autoæ¨¡å¼å½“é‡è¯•æ¬¡æ•°è€—å°½ä»¥åï¼Œæ¶ˆæ¯çš„å¤„ç†è¿˜æ˜¯å¤±è´¥ï¼Œç›´æ¥å°†æ¶ˆæ¯ä»RabbitMQæœåŠ¡ç«¯åˆ é™¤æ‰ï¼Œç›¸å½“äºæ¶ˆæ¯ä¸¢å¤±ã€‚é‚£ä¹ˆé’ˆå¯¹è¿™ç§æƒ…å†µæœ€å¥½ä½¿ç”¨manualæ¨¡å¼ã€‚</p>
<p>åœ¨æ¶ˆè´¹è€…çš„application.ymlæ–‡ä»¶ä¸­ï¼Œè®¾ç½®æ¶ˆæ¯è€…åº”ç­”æ¨¡å¼ä¸ºmanualæ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">manual</span>      <span class="comment"># æ›´æ”¹æ¶ˆè´¹è€…åº”ç­”æ¨¡å¼ä¸ºmanualæ¨¡å¼</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01Listener</span> &#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(value = &quot;direct_queue_01&quot; , durable = &quot;true&quot;) ,</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(value = &quot;direct_exchange&quot; , durable = &quot;true&quot; , type = ExchangeTypes.DIRECT) ,</span></span><br><span class="line"><span class="meta">            key = &quot;error&quot;</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumer01</span><span class="params">(Message message , Channel channel)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ¶ˆæ¯ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">deliveryTag</span> <span class="operator">=</span> message.getMessageProperties().getDeliveryTag();     <span class="comment">// æ¶ˆæ¯æ ‡ç­¾ï¼Œæ ‡è¯†æ¶ˆæ¯çš„å”¯ä¸€æ€§</span></span><br><span class="line">        <span class="type">byte</span>[] body = message.getBody();</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">correlationId</span> <span class="operator">=</span> message.getMessageProperties().getCorrelationId();</span><br><span class="line">            System.out.println(<span class="string">&quot;consumer01Listener ...msg ----&gt; &quot;</span> + msg);</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span> ;</span><br><span class="line">            channel.basicAck(deliveryTag , <span class="literal">true</span>);           <span class="comment">// æ­£å¸¸æ¶ˆè´¹è¿”å›åº”ç­”ack</span></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ‹’ç» deliveryTag å¯¹åº”çš„æ¶ˆæ¯</span></span><br><span class="line">                <span class="comment">//ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¡¨ç¤ºå¦åº”ç”¨äºå¤šæ¶ˆæ¯ï¼Œ</span></span><br><span class="line">                <span class="comment">//ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦ requeueï¼Œ</span></span><br><span class="line">                <span class="comment">//ä¸ basicReject åŒºåˆ«å°±æ˜¯åŒæ—¶æ”¯æŒå¤šä¸ªæ¶ˆæ¯ï¼Œå¯ä»¥ æ‹’ç»ç­¾æ”¶ è¯¥æ¶ˆè´¹è€…å…ˆå‰æ¥æ”¶æœª ack çš„æ‰€æœ‰æ¶ˆæ¯ã€‚æ‹’ç»ç­¾æ”¶åçš„æ¶ˆæ¯ä¹Ÿä¼šè¢«è‡ªå·±æ¶ˆè´¹åˆ°ã€‚</span></span><br><span class="line">                channel.basicNack(deliveryTag , <span class="literal">true</span> , <span class="literal">true</span>);      <span class="comment">// éæ­£å¸¸æ¶ˆè´¹è¿”å›åº”ç­”ack</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šä¸šåŠ¡ä»£ç äº§ç”Ÿäº†å¼‚å¸¸ï¼Œæ¶ˆæ¯ä¸ä¼šä»RabbitMQæœåŠ¡ç«¯åˆ é™¤æ‰ï¼Œä½†æ˜¯å‡ºç°äº†æ— é™æ¬¡æ¶ˆè´¹çš„æƒ…å†µã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šè®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°(æ‰‹åŠ¨å®ç°)ã€éœ€è¦é…åˆRedisã€‚</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * è§£å†³æ­»å¾ªç¯ï¼šæŒ‡å®šæœ€å¤§çš„é‡è¯•æ¬¡æ•°</span><br><span class="line"> * æ¶ˆæ¯çš„å®é™…æ¶ˆè´¹æ¬¡æ•°è¯¥æ€ä¹ˆè®¡ç®—ï¼Ÿå€ŸåŠ©äºredis</span><br><span class="line"> * ä¸€æ—¦æ¶ˆæ¯çš„å®é™…æ¶ˆè´¹æ¬¡æ•°  å¤§äº  æŒ‡å®šçš„æœ€å¤§çš„é‡è¯•æ¬¡æ•°ï¼Œé‚£ä¹ˆæ­¤æ—¶éœ€è¦ç»™rabbitmqè¿”å›ack, åœ¨è¿”å›ä¹‹å‰éœ€è¦æŠŠæ¶ˆæ¯å†™å…¥åˆ°æ•°æ®åº“ä¸­ï¼ŒåæœŸäººå·¥å¤„ç†ã€‚</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
<h2 id="æ¶ˆè´¹è€…é™æµ">æ¶ˆè´¹è€…é™æµ</h2>
<p>å…·ä½“å®ç°ï¼šåœ¨æ¶ˆè´¹è€…çš„application.ymlé…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹çš„é…ç½®</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">manual</span>      <span class="comment"># æ›´æ”¹æ¶ˆè´¹è€…åº”ç­”æ¨¡å¼ä¸ºè‡ªåŠ¨æ¨¡å¼</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">10</span>                  <span class="comment"># RabbitmqæœåŠ¡ç«¯ä¸€æ¬¡æŠ•é€’10ä¸ªæ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œå½“10ä¸ªæ¶ˆæ¯åº”ç­”å®Œæ¯•ä»¥ååœ¨æŠ•é€’10ä¸ªæ¶ˆæ¯è¿‡æ¥</span></span><br></pre></td></tr></table></figure>
<h2 id="æ¶ˆæ¯å­˜æ´»æ—¶é—´">æ¶ˆæ¯å­˜æ´»æ—¶é—´</h2>
<p>TTL å…¨ç§° Time To Liveï¼ˆå­˜æ´»æ—¶é—´/è¿‡æœŸæ—¶é—´ï¼‰ã€‚</p>
<p>å½“æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­æ—¶é—´åˆ°è¾¾å­˜æ´»æ—¶é—´åï¼Œè¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚</p>
<p>RabbitMQå¯ä»¥<strong>å¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼Œä¹Ÿå¯ä»¥<strong>å¯¹æ•´ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰è®¾ç½®è¿‡æœŸæ—¶é—´</strong>ã€‚</p>
<p>ç»™æ¶ˆæ¯è®¾ç½®å­˜æ´»æ—¶é—´ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MessagePostProcessor messagePostProcessor=<span class="keyword">new</span> <span class="title class_">MessagePostProcessor</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Message <span class="title function_">postProcessMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> AmqpException &#123;</span><br><span class="line">        message.getMessageProperties().setExpiration(<span class="string">&quot;10000&quot;</span>);  <span class="comment">//å•ä½æ˜¯æ¯«ç§’</span></span><br><span class="line">        message.getMessageProperties().setDeliveryMode(MessageDeliveryMode.NON_PERSISTENT);</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">&quot;fanout_exchange&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;1213&quot;</span>,messagePostProcessor);</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼šMQé»˜è®¤åªä¼šæŠŠé˜Ÿåˆ—é¦–éƒ¨çš„æ¶ˆæ¯è¿›è¡Œæ˜¯å¦è¿‡æœŸéªŒè¯ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯å·²ç»è¿‡æœŸï¼Œä½†æ˜¯ä¸åœ¨é˜Ÿåˆ—é¦–éƒ¨ï¼Œé˜Ÿåˆ—ä¹Ÿä¸ä¼šå°†å…¶ç§»é™¤å‡ºå»ã€‚</strong></p>
<p>ç»™é˜Ÿåˆ—è®¾ç½®æ¶ˆæ¯å­˜å‚¨æ—¶é—´ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">Queue <span class="title function_">ttlQueue01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> QueueBuilder.durable(<span class="string">&quot;ttl_queue01&quot;</span>).</span><br><span class="line">        ttl(<span class="number">10000</span>).    <span class="comment">//é˜Ÿåˆ—æ¶ˆæ¯å­˜æ´»æ—¶é—´</span></span><br><span class="line">        build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queuesToDeclare= @Queue(value = &quot;ttl_queue02&quot;,</span></span><br><span class="line"><span class="meta">                                        arguments = @Argument(name = &quot;x-message-ttl&quot;, value = &quot;10000&quot;, type = &quot;java.lang.Long&quot;)</span></span><br><span class="line"><span class="meta">                                       ))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ttlQueue02</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">    String msg=<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">    System.out.println(<span class="string">&quot;msg = &quot;</span> + msg);</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>
<h2 id="æ­»ä¿¡é˜Ÿåˆ—">æ­»ä¿¡é˜Ÿåˆ—</h2>
<p>æ­»ä¿¡ï¼šæ­»æ‰çš„æ¶ˆæ¯</p>
<p><strong>æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ</strong></p>
<p>1ã€é˜Ÿåˆ—æ¶ˆæ¯æ•°é‡åˆ°è¾¾é™åˆ¶ï¼›æ¯”å¦‚é˜Ÿåˆ—æœ€å¤§åªèƒ½å­˜å‚¨10æ¡æ¶ˆæ¯ï¼Œè€Œå‘äº†11æ¡æ¶ˆæ¯ï¼Œæ ¹æ®å…ˆè¿›å…ˆå‡ºï¼Œæœ€å…ˆå‘çš„æ¶ˆæ¯æˆä¸ºæ­»ä¿¡ã€‚</p>
<p>2ã€æ¶ˆè´¹è€…æ‹’æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼ŒbasicNack/basicRejectï¼Œå¹¶ä¸”ä¸æŠŠæ¶ˆæ¯é‡æ–°æ”¾å…¥åŸç›®æ ‡é˜Ÿåˆ—ï¼Œrequeue=falseï¼›</p>
<p>3ã€åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯å­˜æ´»æ—¶é—´è®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾å­˜æ´»æ—¶é—´æœªè¢«æ¶ˆè´¹ï¼›</p>
<p>æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹Rabbitmqä¼šç›´æ¥å°†æ­»ä¿¡ä¸¢å¼ƒæ‰ï¼Œä½†æ˜¯å¦‚æœåœ¨ç³»ç»Ÿä¸­æä¾›äº†æ­»ä¿¡é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šæŠŠæ¶ˆæ¯æŠ•é€’ç»™æ­»ä¿¡é˜Ÿåˆ—ã€‚</p>
<p>åœ¨å­˜å‚¨æ­»ä¿¡åˆ°æ­»ä¿¡é˜Ÿåˆ—çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨åˆ°æ­»ä¿¡äº¤æ¢æœºï¼š</p>
<p>DeadLetter Exchangeï¼ˆæ­»ä¿¡äº¤æ¢æœºï¼‰ï¼Œè‹±æ–‡ç¼©å†™ï¼šDLX ã€‚å½“æ¶ˆæ¯æˆä¸ºDead messageåï¼Œå¯ä»¥è¢«é‡æ–°å‘é€åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºï¼Œè¿™ä¸ªäº¤æ¢æœºå°±æ˜¯DLXã€‚åæœŸè¿™ä¸ªäº¤æ¢æœº</p>
<p>å°±å¯ä»¥å°†æ¶ˆæ¯æŠ•é€’åˆ°ä¸ä¹‹ç»‘å®šçš„æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/ddfba4c665c00c85222e698362591dc0.png" alt=""></p>
<p>ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Exchange <span class="title function_">dlxExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Exchange</span> <span class="variable">dlx</span> <span class="operator">=</span> ExchangeBuilder.directExchange(<span class="string">&quot;dlx_exchange&quot;</span>).durable(<span class="literal">true</span>).build();</span><br><span class="line">    <span class="keyword">return</span> dlx ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">dlxQueue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Queue</span> <span class="variable">queue</span> <span class="operator">=</span> QueueBuilder.durable(<span class="string">&quot;dlx_queue&quot;</span>).build();</span><br><span class="line">    <span class="keyword">return</span> queue ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—ç»‘å®šä¿¡æ¯</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Binding <span class="title function_">dlxQueueBinding</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Binding</span> <span class="variable">binding</span> <span class="operator">=</span> BindingBuilder.bind(dlxQueue()).to(dlxExchange())</span><br><span class="line">        .with(<span class="string">&quot;dlx&quot;</span>).noargs();</span><br><span class="line">    <span class="keyword">return</span> binding ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜é˜Ÿåˆ—ï¼Œå¹¶ä¸”ç»‘å®šæ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">directQueue01</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Queue</span> <span class="variable">queue</span> <span class="operator">=</span> QueueBuilder.durable(<span class="string">&quot;direct_queue_01&quot;</span>)</span><br><span class="line">        .maxLength(<span class="number">10</span>)</span><br><span class="line">        .deadLetterExchange(<span class="string">&quot;dlx_exchange&quot;</span>)</span><br><span class="line">        .deadLetterRoutingKey(<span class="string">&quot;dlx&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">return</span> queue ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å»¶è¿Ÿé˜Ÿåˆ—">å»¶è¿Ÿé˜Ÿåˆ—</h2>
<p>å»¶è¿Ÿé˜Ÿåˆ—å­˜å‚¨çš„å¯¹è±¡è‚¯å®šæ˜¯å¯¹åº”çš„å»¶æ—¶æ¶ˆæ¯ï¼Œ<strong>æ‰€è°“å»¶æ—¶æ¶ˆæ¯æ˜¯æŒ‡å½“æ¶ˆæ¯è¢«å‘é€ä»¥åï¼Œå¹¶ä¸æƒ³è®©æ¶ˆè´¹è€…ç«‹å³æ‹¿åˆ°æ¶ˆæ¯ï¼Œè€Œæ˜¯ç­‰å¾…æŒ‡å®šæ—¶é—´åï¼Œæ¶ˆè´¹è€…æ‰æ‹¿åˆ°è¿™ä¸ªæ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚</strong></p>
<p>åœºæ™¯ï¼šåœ¨è®¢å•ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç”¨æˆ·ä¸‹å•ä¹‹åé€šå¸¸æœ‰30åˆ†é’Ÿçš„æ—¶é—´è¿›è¡Œæ”¯ä»˜ï¼Œå¦‚æœ30åˆ†é’Ÿä¹‹å†…æ²¡æœ‰æ”¯ä»˜æˆåŠŸï¼Œé‚£ä¹ˆè¿™ä¸ªè®¢å•å°†è¿›è¡Œå–æ¶ˆå¤„ç†ã€‚è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨å»¶æ—¶é˜Ÿåˆ—å°†</p>
<p>è®¢å•ä¿¡æ¯å‘é€åˆ°å»¶æ—¶é˜Ÿåˆ—ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/0351ea53595b135a2a797be3678b9a59.png" alt=""></p>
<p><strong>åœ¨RabbitMQä¸­å¹¶æœªæä¾›å»¶è¿Ÿé˜Ÿåˆ—åŠŸèƒ½</strong>ã€‚ä½†æ˜¯å¯ä»¥ä½¿ç”¨ï¼š<strong>ttl +æ­»ä¿¡é˜Ÿåˆ—</strong> ç»„åˆå®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„æ•ˆæœã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/21234614547b24848bfabec61b87c25d.png" alt=""></p>
<p>å½“ç„¶å»¶è¿Ÿé˜Ÿåˆ—è¿˜æœ‰å…¶ä»–åº”ç”¨åœºæ™¯ï¼š</p>
<p>1.å…¬ä¼—å·æ–‡ç« çš„å»¶è¿Ÿå‘å¸ƒ</p>
<p>2.é‚®ä»¶çš„å»¶è¿Ÿå‘é€</p>
<p>3.è®¢å•è¶…æ—¶30åˆ†é’Ÿæœªæ”¯ä»˜è‡ªåŠ¨å–æ¶ˆè®¢å•</p>
<h2 id="æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜">æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜</h2>
<h3 id="æ¶ˆæ¯ç™¾åˆ†ç™¾æˆåŠŸæŠ•é€’æ¶æ„">æ¶ˆæ¯ç™¾åˆ†ç™¾æˆåŠŸæŠ•é€’æ¶æ„</h3>
<p>é’ˆå¯¹ä¸€äº›ç‰¹æ®Šçš„ä¸šåŠ¡ï¼Œè¦ä¸¥æ ¼ä¿è¯æ¶ˆæ¯èƒ½å¤Ÿè¿›è¡Œæ­£å¸¸ä¼ è¾“ã€‚é‚£ä¹ˆæ­¤æ—¶åœ¨è¿›è¡Œæ¶ˆæ¯æŠ•é€’çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ¶æ„ä¿è¯æ¶ˆæ¯ç™¾åˆ†ç™¾æˆåŠŸæŠ•é€’ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/8f8898b0d20d0463641888af97add27d.png" alt=""></p>
<p>Step 1ï¼š é¦–å…ˆæŠŠæ¶ˆæ¯ä¿¡æ¯(ä¸šåŠ¡æ•°æ®ï¼‰å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œç´§æ¥ç€ï¼Œæˆ‘ä»¬å†æŠŠè¿™ä¸ªæ¶ˆæ¯è®°å½•ä¹Ÿå­˜å‚¨åˆ°ä¸€å¼ æ¶ˆæ¯è®°å½•è¡¨é‡Œï¼ˆæˆ–è€…å¦å¤–ä¸€ä¸ªåŒæºæ•°æ®åº“çš„æ¶ˆæ¯è®°å½•è¡¨ï¼‰ï¼Œå¹¶ä¸”</p>
<p>åœ¨æ¶ˆæ¯æ•°æ®åº“è¡¨ä¸­éœ€è¦æŒ‡å®šä¸€ä¸ªçŠ¶æ€å­—æ®µ<strong>status</strong>æ¥è®°å½•æ¶ˆæ¯çš„æŠ•é€’çŠ¶æ€ã€‚</p>
<p>Step 2ï¼šå‘é€æ¶ˆæ¯åˆ°MQ BrokerèŠ‚ç‚¹ï¼ˆé‡‡ç”¨confirmæ–¹å¼å‘é€ï¼Œä¼šæœ‰å¼‚æ­¥çš„è¿”å›ç»“æœï¼‰</p>
<p>Step 3ã€4ï¼šç”Ÿäº§è€…ç«¯æ¥å—MQ BrokerèŠ‚ç‚¹è¿”å›çš„Confirmç¡®è®¤æ¶ˆæ¯ç»“æœï¼Œç„¶åè¿›è¡Œæ›´æ–°æ¶ˆæ¯è®°å½•è¡¨é‡Œçš„æ¶ˆæ¯çŠ¶æ€ã€‚æ¯”å¦‚é»˜è®¤Status = 0 å½“æ”¶åˆ°æ¶ˆæ¯ç¡®è®¤æˆåŠŸåï¼Œæ›´</p>
<p>æ–°ä¸º1å³å¯ï¼</p>
<p>Step 5ï¼šä½†æ˜¯åœ¨æ¶ˆæ¯ç¡®è®¤è¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½ç”±äºç½‘ç»œé—ªæ–­ã€MQ Brokerç«¯å¼‚å¸¸ç­‰åŸå› å¯¼è‡´ å›é€æ¶ˆæ¯å¤±è´¥æˆ–è€…å¼‚å¸¸ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦å‘é€æ–¹ï¼ˆç”Ÿäº§è€…ï¼‰å¯¹æ¶ˆæ¯è¿›è¡Œå¯é </p>
<p>æ€§æŠ•é€’äº†ï¼Œä¿éšœæ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œ100%çš„æŠ•é€’æˆåŠŸï¼ï¼ˆæœ‰ä¸€ç§æé™æƒ…å†µæ˜¯é—ªæ–­ï¼ŒBrokerè¿”å›çš„æˆåŠŸç¡®è®¤æ¶ˆæ¯ï¼Œä½†æ˜¯ç”Ÿäº§ç«¯ç”±äºç½‘ç»œé—ªæ–­æ²¡æ”¶åˆ°ï¼Œè¿™ä¸ªæ—¶å€™é‡æ–°æŠ•é€’å¯èƒ½</p>
<p>ä¼šé€ æˆæ¶ˆæ¯é‡å¤ï¼Œéœ€è¦æ¶ˆè´¹ç«¯å»åšå¹‚ç­‰å¤„ç†ï¼‰æ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œï¼ˆæ¯”å¦‚æ¯5åˆ†é’Ÿæ‹‰å–ä¸€ä¸‹å¤„äºä¸­é—´çŠ¶æ€çš„æ¶ˆæ¯ï¼Œå½“ç„¶è¿™ä¸ªæ¶ˆæ¯å¯ä»¥è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œæ¯”</p>
<p>å¦‚è¶…è¿‡1åˆ†é’Ÿ Status = 0 ï¼Œä¹Ÿå°±è¯´æ˜äº†1åˆ†é’Ÿè¿™ä¸ªæ—¶é—´çª—å£å†…ï¼Œæˆ‘ä»¬çš„æ¶ˆæ¯æ²¡æœ‰è¢«ç¡®è®¤ï¼Œé‚£ä¹ˆä¼šè¢«å®šæ—¶ä»»åŠ¡æ‹‰å–å‡ºæ¥ï¼‰</p>
<p>Step 6ï¼šæ¥ä¸‹æ¥æˆ‘ä»¬æŠŠä¸­é—´çŠ¶æ€çš„æ¶ˆæ¯è¿›è¡Œé‡æ–°æŠ•é€’ <strong>retry send</strong>ï¼Œç»§ç»­å‘é€æ¶ˆæ¯åˆ°MQ ï¼Œå½“ç„¶ä¹Ÿå¯èƒ½æœ‰å¤šç§åŸå› å¯¼è‡´å‘é€å¤±è´¥</p>
<p>Step 7ï¼šæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è®¾ç½®æœ€å¤§åŠªåŠ›å°è¯•æ¬¡æ•°ï¼Œæ¯”å¦‚æŠ•é€’äº†3æ¬¡ï¼Œè¿˜æ˜¯å¤±è´¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†æœ€ç»ˆçŠ¶æ€è®¾ç½®ä¸ºStatus = 2 ï¼Œæœ€å äº¤ç”±äººå·¥è§£å†³å¤„ç†æ­¤ç±»é—®é¢˜ï¼ˆæˆ–è€…æŠŠ</p>
<p>æ¶ˆæ¯è½¬å‚¨åˆ°å¤±è´¥è¡¨ä¸­ï¼‰ã€‚</p>
<p><strong>æƒ…å†µä¸€</strong>ï¼šæŠ•é€’è¿‡ç¨‹ä¸­äº§ç”Ÿäº†ç½‘ç»œæŠ–åŠ¨ä¸ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±(å› ä¸ºæ¶ˆæ¯å·²ç»å…¥åº“)</p>
<p><strong>æƒ…å†µäºŒ</strong>ï¼šconfirmå›æ‰§çš„æ—¶å€™äº§ç”Ÿäº†ç½‘ç»œæŠ–åŠ¨ä¸ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±(å› ä¸ºæ¶ˆæ¯å·²ç»å…¥åº“)</p>
<blockquote>
<p>å…·ä½“æ€è·¯ï¼šå¦‚æœæƒ³å®ç°æ¶ˆæ¯çš„ç™¾åˆ†ç™¾æŠ•é€’:</p>
<ol>
<li>å°±éœ€è§£å†³åœ¨æŠ•é€’è¿‡ç¨‹ä¸­å¦‚æœæ¶ˆæ¯ä¸¢å¤±ï¼Œè¿™æ—¶å°±éœ€è¦åœ¨å‘é€æ¶ˆæ¯çš„ä¸€ç«¯å°†æ¶ˆæ¯æŒä¹…åŒ–ä¿å­˜ï¼Œè®°å½•çŠ¶æ€ï¼Œåªæœ‰æ¶ˆæ¯æˆåŠŸæ‰§è¡Œä¹‹åæ‰§è¡Œå›è°ƒæ—¶æ”¹å˜çŠ¶æ€ï¼Œä»£è¡¨æ¶ˆæ¯æ˜¯å¦å·²ç»è¢«æ¶ˆè´¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å¯ä»¥é‡‡ç”¨å®šæ—¶ä»»åŠ¡å»æ‰§è¡Œé‚£äº›çŠ¶æ€ä¸ºæœªè¢«æ¶ˆåŒ–çš„æ¶ˆæ¯</li>
<li>å¦‚æœåœ¨æ‰§è¡Œå›è°ƒæ—¶ä¸¢å¤±ï¼Œè¯´æ˜æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹ï¼Œä½†æ˜¯çŠ¶æ€æœªæˆåŠŸæ”¹å˜ï¼Œæ­¤æ—¶å°±å¯èƒ½å‘ç”Ÿæ¶ˆæ¯ çš„é‡å¤æ¶ˆè´¹</li>
</ol>
</blockquote>
<p>æ•°æ®åº“è¡¨è®¾è®¡ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `broker_message_log`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `broker_message_log` (</span><br><span class="line">  `message_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯å”¯ä¸€ID&#x27;</span>,</span><br><span class="line">  `message` <span class="type">varchar</span>(<span class="number">4000</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯å†…å®¹&#x27;</span>,</span><br><span class="line">  `try_count` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;é‡è¯•æ¬¡æ•°&#x27;</span>,</span><br><span class="line">  `status` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯æŠ•é€’çŠ¶æ€ 0æŠ•é€’ä¸­,1æŠ•é€’æˆåŠŸ,2æŠ•é€’å¤±è´¥&#x27;</span>,</span><br><span class="line">  `next_retry` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00ï¼š00ï¼š00&#x27;</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¸‹ä¸€æ¬¡é‡è¯•æ—¶é—´&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00ï¼š00ï¼š00&#x27;</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00ï¼š00ï¼š00&#x27;</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`message_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for t_order</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `t_order`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_order` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `message_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2018091102</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>
<h3 id="æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜-v2">æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜</h3>
<p>é‡‡ç”¨ä¸Šè¿°æ¶æ„å®ç°æ¶ˆæ¯çš„æŠ•é€’ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå‡ºç°æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/3ae48ef943494a8aa938995e3b2d8ccd.png" alt=""></p>
<p>MQä¸­å‡ºç°äº†é‡å¤æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå¯¼è‡´é‡å¤æ¶ˆè´¹é—®é¢˜ã€‚åœ¨æœ‰ä¸€äº›ç‰¹æ®Šçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæ˜¯ä¸å…è®¸å‡ºç°é‡å¤æ¶ˆæ¯çš„ï¼Œæ¯”å¦‚æ‰£å‡åº“å­˜ã€‚</p>
<h4 id="å¹‚ç­‰æ€§å¤„ç†">å¹‚ç­‰æ€§å¤„ç†</h4>
<p>**å¹‚ç­‰æ€§æŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºå¯¹äºèµ„æºæœ¬èº«åº”è¯¥å…·æœ‰åŒæ ·çš„ç»“æœã€‚**ä¹Ÿå°±æ˜¯è¯´,å…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œå¯¹èµ„æºæœ¬èº«æ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒã€‚</p>
<p>åœ¨MQä¸­æŒ‡,æ¶ˆè´¹å¤šæ¡ç›¸åŒçš„æ¶ˆæ¯,å¾—åˆ°ä¸æ¶ˆè´¹è¯¥æ¶ˆæ¯ä¸€æ¬¡ç›¸åŒçš„ç»“æœã€‚</p>
<p>æ¶ˆæ¯å¹‚ç­‰æ€§ä¿éšœ ï¼š<strong>æ•°æ®åº“å”¯ä¸€å­—æ®µ</strong></p>
<p><img src="http://120.26.79.238:9000/blog/img/57d9c0ecf7179c42dc8c44d5710756e4.png" alt=""></p>
<blockquote>
<p>å…·ä½“æ€è·¯ï¼š ä¸ºäº†å®ç°æ¶ˆæ¯çš„ç™¾åˆ†ç™¾æˆåŠŸæŠ•é€’ï¼Œå°±å¯èƒ½ä¼šå‘ç”Ÿæ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹ï¼Œ</p>
<p>è§£å†³æ€è·¯: å¹‚ç­‰æ€§å¤„ç†,å…·ä½“å®ç°å°±æ˜¯åœ¨æ¶ˆæ¯çš„æ¶ˆè´¹æ–¹ï¼Œå°†æ‰€æœ‰æ¶ˆè´¹çš„æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–è®°å½•ï¼Œæ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½æœ‰å®ƒçš„å”¯ä¸€çš„idï¼Œå½“æœ‰é‡å¤çš„æ¶ˆæ¯ä¼ é€’è¿‡æ¥æ—¶ï¼Œå…ˆå»æŸ¥æ‰¾ï¼Œå¦‚æœå­˜åœ¨ç›¸åŒidï¼Œå°±ä¸è¿›è¡Œæ¶ˆè´¹ã€‚</p>
</blockquote>
<h2 id="æ¶ˆæ¯çš„é‡å‘">æ¶ˆæ¯çš„é‡å‘</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.spzx.common.rabbit.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.spzx.common.rabbit.domain.CorrelationRetryData;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.connection.CorrelationData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.event.ApplicationReadyEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.spzx.common.rabbit.Constants.MqConstants.RABBIT_MQ_KEY;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/10/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConfig</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;ApplicationReadyEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ApplicationReadyEvent event)</span> &#123;</span><br><span class="line">        setConfirm();</span><br><span class="line">        setReturn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setConfirm</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.rabbitTemplate.setConfirmCallback(((correlationData, ack, cause) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (ack) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœº&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                log.error(<span class="string">&quot;æ¶ˆæ¯æ²¡æœ‰å‘é€åˆ°äº¤æ¢æœº:&#123;&#125;&quot;</span>,cause);</span><br><span class="line">                retrySend(correlationData);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setReturn</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.rabbitTemplate.setReturnsCallback(returned -&gt; &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ¶ˆæ¯æ²¡æœ‰å‘é€åˆ°é˜Ÿåˆ—:&#123;&#125;&quot;</span>,returned);</span><br><span class="line">            <span class="type">String</span> <span class="variable">retryDataId</span> <span class="operator">=</span> returned.getMessage().getMessageProperties().getHeader(<span class="string">&quot;spring_returned_message_correlation&quot;</span>);</span><br><span class="line">            <span class="type">CorrelationRetryData</span> <span class="variable">retryData</span> <span class="operator">=</span> (CorrelationRetryData) redisTemplate.opsForValue().get(RABBIT_MQ_KEY+retryDataId);</span><br><span class="line">            <span class="keyword">if</span> (retryData.isDelay()) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;å»¶è¿Ÿæ¶ˆæ¯&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            retrySend(retryData);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">retrySend</span><span class="params">(CorrelationData correlationData)</span>&#123;</span><br><span class="line">        CorrelationRetryData retryData= (CorrelationRetryData) correlationData;</span><br><span class="line">        <span class="type">int</span> <span class="variable">retryCount</span> <span class="operator">=</span> retryData.getRetryCount();</span><br><span class="line">        <span class="type">String</span> <span class="variable">exchange</span> <span class="operator">=</span> retryData.getExchange();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">message</span> <span class="operator">=</span> retryData.getMessage();</span><br><span class="line">        <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> retryData.getRoutingKey();</span><br><span class="line">        <span class="type">int</span> <span class="variable">delayTime</span> <span class="operator">=</span> retryData.getDelayTime();</span><br><span class="line">        <span class="type">String</span> <span class="variable">retryDataId</span> <span class="operator">=</span> retryData.getId();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (retryCount &gt;=<span class="number">3</span>) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;ç®¡ç†å‘˜ä»‹å…¥:&#123;&#125;&quot;</span>,retryData);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(retryData.isDelay())&#123;</span><br><span class="line">            rabbitTemplate.convertAndSend(exchange,routingKey,message,message1 -&gt; &#123;</span><br><span class="line">                message1.getMessageProperties().setDelay((<span class="type">int</span>) (delayTime*<span class="number">1000</span>));</span><br><span class="line">                <span class="keyword">return</span> message1;</span><br><span class="line">            &#125;,retryData);</span><br><span class="line">            redisTemplate.opsForValue().set(RABBIT_MQ_KEY+retryDataId,retryData,<span class="number">10</span>, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        retryData.setRetryCount(++retryCount);</span><br><span class="line">        rabbitTemplate.convertAndSend(exchange,routingKey,message,retryData);</span><br><span class="line">        redisTemplate.opsForValue().set(RABBIT_MQ_KEY+retryDataId,retryData,<span class="number">10</span>, TimeUnit.MINUTES);</span><br><span class="line">        log.info(<span class="string">&quot;é‡å‘,ç¬¬&#123;&#125;æ¬¡&quot;</span>,retryCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Python3åˆå§‹åŒ–å·¥ä½œç©ºé—´</title>
    <url>/2026/01/27/Python3%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4/</url>
    <content><![CDATA[<h1>Python3åˆå§‹åŒ–å·¥ä½œç©ºé—´</h1>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">python3 -m venv venv</span><br><span class="line"></span><br><span class="line"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line"># Linux/Mac:</span><br><span class="line">source venv/bin/activate</span><br><span class="line"># Windows:</span><br><span class="line">venv\Scripts\activate</span><br><span class="line"></span><br><span class="line"># å®‰è£…ä¾èµ–</span><br><span class="line">pip install requests pandas numpy  # ç¤ºä¾‹åŒ…</span><br><span class="line">pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Redisson</title>
    <url>/2025/09/15/Redisson/</url>
    <content><![CDATA[<h1>Redissonå®ç°</h1>
<h2 id="1-å¯¼å…¥ä¾èµ–">1.å¯¼å…¥ä¾èµ–</h2>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- redisson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-é…ç½®ç±»">2. é…ç½®ç±»</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;spring.data.redis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">timeout</span> <span class="operator">=</span> <span class="number">3000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">ADDRESS_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;redis://&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªåŠ¨è£…é…</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    RedissonClient <span class="title function_">redissonSingle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(host))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;host is  empty&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//  redis://192.168.6.133:6379</span></span><br><span class="line">        <span class="type">SingleServerConfig</span> <span class="variable">serverConfig</span> <span class="operator">=</span> config.useSingleServer()</span><br><span class="line">                .setAddress(ADDRESS_PREFIX + <span class="built_in">this</span>.host + <span class="string">&quot;:&quot;</span> + port)</span><br><span class="line">                .setTimeout(<span class="built_in">this</span>.timeout);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(<span class="built_in">this</span>.password)) &#123;</span><br><span class="line">            serverConfig.setPassword(<span class="built_in">this</span>.password);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Redisson.create(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-é”ä½¿ç”¨">3. é”ä½¿ç”¨</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getAlbumInfoById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//............</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºé”</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;:lock&quot;</span>;</span><br><span class="line">    <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(lockKey);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">ifAbsent</span> <span class="operator">=</span> lock.tryLock(<span class="number">3</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">    <span class="keyword">if</span>(ifAbsent) &#123; <span class="comment">//åŠ é”æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//..............</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//è§£é”ï¼Œé‡Šæ”¾é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-å¸ƒéš†è¿‡æ»¤å™¨çš„ä½¿ç”¨">4. å¸ƒéš†è¿‡æ»¤å™¨çš„ä½¿ç”¨</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨</span></span><br><span class="line">      RBloomFilter&lt;Object&gt; bloomFilter = redissonClient.getBloomFilter(<span class="string">&quot;sku:bloom:filter&quot;</span>);</span><br><span class="line">      <span class="comment">//è®¾ç½®æ•°æ®è§„æ¨¡ è¯¯åˆ¤ç‡ é¢„è®¡ç»Ÿè®¡å…ƒç´ æ•°é‡ä¸º100000ï¼ŒæœŸæœ›è¯¯å·®ç‡ä¸º0.01</span></span><br><span class="line">      bloomFilter.tryInit(<span class="number">100000</span>, <span class="number">0.01</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//æµ‹è¯•ä½¿ç”¨ï¼Œå¿«é€Ÿè‡ªåŠ¨åŠ å…¥</span></span><br><span class="line">      List&lt;ProductSku&gt; productSkuList = productSkuMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">      productSkuList.forEach(item -&gt; &#123;</span><br><span class="line">          bloomFilter.add(item.getId());</span><br><span class="line">      &#125;);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		----------------------------------------------------------------------------------------------------------</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//è¿œç¨‹è°ƒç”¨å•†å“å¾®æœåŠ¡æ¥å£ä¹‹å‰ æå‰çŸ¥é“ç”¨æˆ·è®¿é—®å•†å“SKUIDæ˜¯å¦å­˜åœ¨ä¸å¸ƒéš†è¿‡æ»¤å™¨</span></span><br><span class="line">  RBloomFilter&lt;Object&gt; bloomFilter = redissonClient.getBloomFilter(<span class="string">&quot;sku:bloom:filter&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!bloomFilter.contains(skuId)) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;ç”¨æˆ·æŸ¥è¯¢å•†å“skuä¸å­˜åœ¨ï¼š&#123;&#125;&quot;</span>, skuId);</span><br><span class="line">      <span class="comment">//æŸ¥è¯¢æ•°æ®ä¸å­˜åœ¨ç›´æ¥è¿”å›ç©ºå¯¹è±¡</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;ç”¨æˆ·æŸ¥è¯¢å•†å“skuä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>ResultåŒ…è£…</title>
    <url>/2025/09/15/Result%E5%8C%85%E8%A3%85/</url>
    <content><![CDATA[<h2 id="ResultåŒ…è£…">ResultåŒ…è£…</h2>
<h3 id="Result-java">Result.java</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.orange.blog.common.base;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> online.orange.blog.common.constants.ResponseCode;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;();</span><br><span class="line">        result.setCode(ResponseCode.SUCCESS);</span><br><span class="line">        result.setMsg(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">        result.setData(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result&lt;Void&gt; <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">error</span><span class="params">(String code, String message)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;();</span><br><span class="line">        result.setCode(code);</span><br><span class="line">        result.setMsg(message);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">error</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> error(ResponseCode.FAIL, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Constant-java">Constant.java</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> zorange.online.blogserver.common;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ç”¨äºå­˜æ”¾å¸¸é‡</span></span><br><span class="line"><span class="comment"> * å¸¸é‡æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Constants</span> &#123;</span><br><span class="line">    <span class="comment">//æ“ä½œæˆåŠŸ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">CODE_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;200&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MSG_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;æ“ä½œæˆåŠŸ&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç³»ç»Ÿé”™è¯¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">CODE_ERROR</span> <span class="operator">=</span> <span class="string">&quot;500&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MSG_ERROR</span> <span class="operator">=</span> <span class="string">&quot;ç³»ç»Ÿé”™è¯¯&quot;</span>;</span><br><span class="line">    <span class="comment">//å‚æ•°é”™è¯¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">CODE_PARAM_ERROR</span> <span class="operator">=</span> <span class="string">&quot;400&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MSG_PARAM_ERROR</span> <span class="operator">=</span> <span class="string">&quot;å‚æ•°é”™è¯¯&quot;</span>;</span><br><span class="line">    <span class="comment">//å…¶ä»–ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">CODE_OTHER_ERROR</span> <span class="operator">=</span> <span class="string">&quot;501&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MSG_OTHER_ERROR</span> <span class="operator">=</span> <span class="string">&quot;å…¶ä»–ä¸šåŠ¡å¼‚å¸¸&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">CODE_NOT_LOGIN</span> <span class="operator">=</span> <span class="string">&quot;401&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MSG_NOT_LOGIN</span> <span class="operator">=</span> <span class="string">&quot;æƒé™ä¸è¶³&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String DICT_TYPE_ICON= <span class="string">&quot;icon&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Sentinel</title>
    <url>/2025/09/15/Sentinel/</url>
    <content><![CDATA[<h1>Sentinel</h1>
<h2 id="æœåŠ¡é›ªå´©">æœåŠ¡é›ªå´©</h2>
<p>æ¦‚è¿°ï¼šåœ¨å¾®æœåŠ¡ç³»ç»Ÿæ¶æ„ä¸­ï¼ŒæœåŠ¡é—´è°ƒç”¨å…³ç³»é”™ç»¼å¤æ‚ï¼Œä¸€ä¸ªå¾®æœåŠ¡å¾€å¾€ä¾èµ–äºå¤šä¸ªå…¶å®ƒå¾®æœåŠ¡ã€‚ä¸€ä¸ªæœåŠ¡çš„ä¸å¯ç”¨å¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„ä¸å¯ç”¨çš„ç°è±¡å°±è¢«ç§°ä¹‹ä¸ºé›ªå´©æ•ˆåº”ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/47ec9b7d45b743de84822380f7348e7d.png" alt="image.png"></p>
<h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>
<h4 id="è¶…æ—¶å¤„ç†">è¶…æ—¶å¤„ç†</h4>
<p>è¶…æ—¶å¤„ç†ï¼šè®¾å®šè¶…æ—¶æ—¶é—´ï¼Œè¯·æ±‚è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å“åº”å°±è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šæ— ä¼‘æ­¢ç­‰å¾…</p>
<h4 id="éš”ç¦»å¤„ç†">éš”ç¦»å¤„ç†</h4>
<p>éš”ç¦»å¤„ç†ï¼šå°†é”™è¯¯éš”ç¦»åœ¨å¯æ§çš„èŒƒå›´ä¹‹å†…ï¼Œä¸è¦è®©å…¶å½±å“åˆ°å…¶ä»–çš„ç¨‹åºçš„è¿è¡Œã€‚</p>
<h4 id="ç†”æ–­å¤„ç†">ç†”æ–­å¤„ç†</h4>
<p>ç†”æ–­å¤„ç†ï¼šç”±<strong>æ–­è·¯å™¨</strong>ç»Ÿè®¡ä¸šåŠ¡æ‰§è¡Œçš„å¼‚å¸¸æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼š<strong>ç†”æ–­</strong>è¯¥ä¸šåŠ¡ï¼Œæ‹¦æˆªè®¿é—®è¯¥ä¸šåŠ¡çš„ä¸€åˆ‡è¯·æ±‚ã€‚</p>
<h4 id="æµé‡æ§åˆ¶">æµé‡æ§åˆ¶</h4>
<p>æµé‡æ§åˆ¶ï¼šé™åˆ¶ä¸šåŠ¡è®¿é—®çš„QPS(æ¯ç§’çš„è¯·æ±‚æ•°)ï¼Œé¿å…æœåŠ¡å› æµé‡çš„çªå¢è€Œæ•…éšœã€‚</p>
<h2 id="æ•´åˆsentinel">æ•´åˆsentinel</h2>
<p>æˆ‘ä»¬åœ¨spzx-cloud-userä¸­æ•´åˆsentinelï¼Œå¹¶è¿æ¥sentinelçš„æ§åˆ¶å°ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1ã€å¼•å…¥sentinelä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--sentinel--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2ã€é…ç½®æ§åˆ¶å°</p>
<p>ä¿®æ”¹application.yamlæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢å†…å®¹</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span>  <span class="comment"># é…ç½®sentinelæ§åˆ¶å°åœ°å€</span></span><br></pre></td></tr></table></figure>
<p>3ã€è®¿é—®spzx-cloud-userçš„ä»»æ„æ¥å£</p>
<p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®<a href="http://localhost:10100/api/user/findUserByUserId/1%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%89%8D%E8%83%BD%E8%A7%A6%E5%8F%91sentinel%E7%9A%84%E7%9B%91%E6%8E%A7%E3%80%82%E7%84%B6%E5%90%8E%E5%86%8D%E8%AE%BF%E9%97%AEsentinel%E7%9A%84%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%95%88%E6%9E%9C%EF%BC%9A">http://localhost:10100/api/user/findUserByUserId/1ï¼Œè¿™æ ·æ‰èƒ½è§¦å‘sentinelçš„ç›‘æ§ã€‚ç„¶åå†è®¿é—®sentinelçš„æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ•ˆæœï¼š</a></p>
<h2 id="æµæ§æ¨¡å¼">æµæ§æ¨¡å¼</h2>
<h3 id="æ§æ¨¡å¼ç®€ä»‹">æ§æ¨¡å¼ç®€ä»‹</h3>
<p>åœ¨æ·»åŠ é™æµè§„åˆ™æ—¶ï¼Œç‚¹å‡»é«˜çº§é€‰é¡¹ï¼Œå¯ä»¥é€‰æ‹©ä¸‰ç§<strong>æµæ§æ¨¡å¼</strong>ï¼š</p>
<p>1ã€ç›´æ¥ï¼šç»Ÿè®¡å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶å¯¹å½“å‰èµ„æºç›´æ¥é™æµï¼Œä¹Ÿæ˜¯é»˜è®¤çš„æ¨¡å¼</p>
<p>2ã€å…³è”ï¼šç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµ</p>
<p>3ã€é“¾è·¯ï¼šç»Ÿè®¡ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹æŒ‡å®šé“¾è·¯é™æµ</p>
<h4 id="å…³è”æ¨¡å¼">å…³è”æ¨¡å¼</h4>
<p>å…³è”æ¨¡å¼ï¼šç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµ</p>
<p><strong>è¯­æ³•è¯´æ˜</strong>ï¼šå¯¹/api/user/updateUserByIdèµ„æºçš„è¯·æ±‚è¿›è¡Œç»Ÿè®¡ï¼Œå½“è®¿é—®æµé‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±å¯¹/api/user/findUserByUserId/{userId}è¿›è¡Œé™æµï¼Œé¿å…å½±å“/api/user/updateUserByIdèµ„æºã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ï¼šæ¯”å¦‚ç”¨æˆ·æ”¯ä»˜æ—¶éœ€è¦ä¿®æ”¹è®¢å•çŠ¶æ€ï¼ŒåŒæ—¶ç”¨æˆ·è¦æŸ¥è¯¢è®¢å•ã€‚æŸ¥è¯¢å’Œä¿®æ”¹æ“ä½œä¼šäº‰æŠ¢æ•°æ®åº“é”ï¼Œäº§ç”Ÿç«äº‰ã€‚ä¸šåŠ¡éœ€æ±‚æ˜¯ä¼˜å…ˆæ”¯ä»˜å’Œæ›´æ–°è®¢å•çš„ä¸šåŠ¡ï¼Œå› æ­¤å½“ä¿®æ”¹è®¢å•ä¸šåŠ¡è§¦å‘é˜ˆå€¼æ—¶ï¼Œéœ€è¦å¯¹æŸ¥è¯¢è®¢å•ä¸šåŠ¡é™æµã€‚</p>
<h5 id="å…³è”æµæ§æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ï¼š">å…³è”æµæ§æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ï¼š</h5>
<p>1ã€ä¸¤ä¸ªæœ‰ç«äº‰å…³ç³»çš„èµ„æº</p>
<p>2ã€ä¸€ä¸ªä¼˜å…ˆçº§è¾ƒé«˜ï¼Œä¸€ä¸ªä¼˜å…ˆçº§è¾ƒä½</p>
<p>å¯¹é«˜ä¼˜å…ˆçº§çš„èµ„æºçš„æµé‡è¿›è¡Œç»Ÿè®¡ï¼Œå½“è¶…è¿‡é˜ˆå€¼å¯¹ä½ä¼˜å…ˆçº§çš„èµ„æºè¿›è¡Œé™æµã€‚</p>
<h4 id="é“¾è·¯æ¨¡å¼">é“¾è·¯æ¨¡å¼</h4>
<p>é“¾è·¯æ¨¡å¼ï¼šåªé’ˆå¯¹ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚åšç»Ÿè®¡ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼Œå¦‚æœè¶…è¿‡é˜ˆå€¼å¯¹ä»è¯¥é“¾è·¯è¯·æ±‚è¿›è¡Œé™æµã€‚</p>
<p>é…ç½®æ–¹å¼ï¼š</p>
<p>1ã€/api/user/save --&gt; users</p>
<p>2ã€/api/user/query --&gt; users</p>
<h5 id="å®é™…åœºæ™¯">å®é™…åœºæ™¯</h5>
<p>å½“å¤šä¸ªcantollerè®¿é—®åŒä¸€ä¸ªèµ„æºæ—¶ï¼ˆè‡ªå®šä¹‰åç§°ï¼Œåœ¨serviceä¸Šï¼‰ï¼Œå®ç°å¯¹å…¶ä¸­æŸäº›è¯·æ±‚è·¯å¾„åšæµæ§ï¼Œ</p>
<ol>
<li>
<p>åœ¨éœ€è¦è¿›è¡Œæµæ§çš„èµ„æºä¸Šæ ‡è®°èµ„æºåç§°</p>
<p>é€šè¿‡**@SentinelResource**æ ‡è®°UserServiceä¸­çš„queryUsersæ–¹æ³•ä¸ºä¸€ä¸ªsentinelç›‘æ§çš„èµ„æº(é»˜è®¤æƒ…å†µä¸‹ï¼Œsentinelåªç›‘æ§controlleræ–¹æ³•)</p>
</li>
<li>
<p>æ›´æ”¹application.ymlæ–‡ä»¶ä¸­çš„sentinelé…ç½®</p>
<p>é“¾è·¯æ¨¡å¼ä¸­ï¼Œæ˜¯å¯¹ä¸åŒæ¥æºçš„ä¸¤ä¸ªé“¾è·¯åšç›‘æ§ã€‚ä½†æ˜¯sentinelé»˜è®¤ä¼šç»™è¿›å…¥spring mvcçš„æ‰€æœ‰è¯·æ±‚è®¾ç½®åŒä¸€ä¸ªrootèµ„æºï¼Œä¼šå¯¼è‡´é“¾è·¯æ¨¡å¼å¤±æ•ˆã€‚å› æ­¤éœ€è¦å…³é—­è¿™ç§èµ„æºæ•´åˆã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">web-context-unify:</span> <span class="literal">false</span> <span class="comment"># å…³é—­contextæ•´åˆ</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¯¹èµ„æºè¿›è¡Œæµæ§ï¼Œæ·»åŠ æµæ§è§„åˆ™</p>
</li>
</ol>
<h3 id="æµæ§æ•ˆæœ">æµæ§æ•ˆæœ</h3>
<p>æµæ§æ•ˆæœæ˜¯æŒ‡è¯·æ±‚è¾¾åˆ°æµæ§é˜ˆå€¼æ—¶åº”è¯¥é‡‡å–çš„æªæ–½ï¼ŒåŒ…æ‹¬ä¸‰ç§ï¼š</p>
<p>1ã€å¿«é€Ÿå¤±è´¥ï¼šè¾¾åˆ°é˜ˆå€¼åï¼Œæ–°çš„è¯·æ±‚ä¼šè¢«ç«‹å³æ‹’ç»å¹¶æŠ›å‡ºFlowExceptionå¼‚å¸¸ï¼Œæ˜¯é»˜è®¤çš„å¤„ç†æ–¹å¼</p>
<p>2ã€warm upï¼šé¢„çƒ­æ¨¡å¼ï¼Œå¯¹è¶…å‡ºé˜ˆå€¼çš„è¯·æ±‚åŒæ ·æ˜¯æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œä½†è¿™ç§æ¨¡å¼é˜ˆå€¼ä¼šåŠ¨æ€å˜åŒ–ï¼Œä»ä¸€ä¸ªè¾ƒå°å€¼é€æ¸å¢åŠ åˆ°æœ€å¤§é˜ˆå€¼</p>
<p>3ã€æ’é˜Ÿç­‰å¾…ï¼šè®©æ‰€æœ‰çš„è¯·æ±‚æŒ‰ç…§å…ˆåæ¬¡åºè¿›å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­è¿›è¡Œæ’é˜Ÿï¼Œå½“æŸä¸€ä¸ªè¯·æ±‚æœ€å¤§çš„é¢„æœŸç­‰å¾…æ—¶é—´è¶…è¿‡äº†æ‰€è®¾å®šçš„è¶…æ—¶æ—¶é—´æ—¶åŒæ ·æ˜¯æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸</p>
<h4 id="warm-up">warm up</h4>
<p>é˜ˆå€¼ä¸€èˆ¬æ˜¯ä¸€ä¸ªå¾®æœåŠ¡èƒ½æ‰¿æ‹…çš„æœ€å¤§QPSï¼Œä½†æ˜¯ä¸€ä¸ªæœåŠ¡åˆšåˆšå¯åŠ¨æ—¶ï¼Œä¸€åˆ‡èµ„æºå°šæœªåˆå§‹åŒ–ï¼ˆ<strong>å†·å¯åŠ¨</strong>ï¼‰ï¼Œå¦‚æœç›´æ¥å°†QPSè·‘åˆ°æœ€å¤§å€¼ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡ç¬é—´å®•æœºã€‚</p>
<p>warm upä¹Ÿå«<strong>é¢„çƒ­æ¨¡å¼</strong>ï¼Œæ˜¯åº”å¯¹æœåŠ¡å†·å¯åŠ¨çš„ä¸€ç§æ–¹æ¡ˆã€‚<strong>é˜ˆå€¼ä¼šåŠ¨æ€å˜åŒ–</strong>ï¼Œä»ä¸€ä¸ªè¾ƒå°å€¼é€æ¸å¢åŠ åˆ°æœ€å¤§é˜ˆå€¼ã€‚</p>
<p><strong>å·¥ä½œç‰¹ç‚¹</strong>ï¼šè¯·æ±‚é˜ˆå€¼åˆå§‹å€¼æ˜¯ maxThreshold / coldFactor, æŒç»­æŒ‡å®šæ—¶é•¿(é¢„çƒ­æ—¶é—´)åï¼Œé€æ¸æé«˜åˆ°maxThresholdå€¼ï¼Œè€ŒcoldFactorçš„é»˜è®¤å€¼æ˜¯3ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/78d8e6e08ce44c6bbb4195be6a188b3e.png" alt="image.png"></p>
<h4 id="æ’é˜Ÿç­‰å¾…">æ’é˜Ÿç­‰å¾…</h4>
<p><strong>æ’é˜Ÿç­‰å¾…</strong>ï¼šè®©æ‰€æœ‰çš„è¯·æ±‚æŒ‰ç…§å…ˆåæ¬¡åºè¿›å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­è¿›è¡Œæ’é˜Ÿï¼Œå½“æŸä¸€ä¸ªè¯·æ±‚æœ€å¤§çš„é¢„æœŸç­‰å¾…æ—¶é—´è¶…è¿‡äº†æ‰€è®¾å®šçš„è¶…æ—¶æ—¶é—´æ—¶åŒæ ·æ˜¯æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸</p>
<p>ä¾‹å¦‚ï¼šQPS = 5ï¼Œæ„å‘³ç€æ¯200mså¤„ç†ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„è¯·æ±‚ï¼›timeout = 2000ï¼Œæ„å‘³ç€<strong>é¢„æœŸç­‰å¾…æ—¶é•¿</strong>è¶…è¿‡2000msçš„è¯·æ±‚ä¼šè¢«æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>é‚£ä»€ä¹ˆå«åšé¢„æœŸç­‰å¾…æ—¶é•¿å‘¢ï¼Ÿ</p>
<p>æ¯”å¦‚ç°åœ¨ä¸€ä¸‹å­æ¥äº†12 ä¸ªè¯·æ±‚ï¼Œå› ä¸ºæ¯200msæ‰§è¡Œä¸€ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆï¼š</p>
<p>1ã€ç¬¬6ä¸ªè¯·æ±‚çš„<strong>é¢„æœŸç­‰å¾…æ—¶é•¿</strong> =  200 * ï¼ˆ6 - 1ï¼‰ = 1000ms</p>
<p>2ã€ç¬¬12ä¸ªè¯·æ±‚çš„é¢„æœŸç­‰å¾…æ—¶é•¿ = 200 * ï¼ˆ12-1ï¼‰ = 2200ms</p>
<h3 id="çƒ­ç‚¹å‚æ•°é™æµ">çƒ­ç‚¹å‚æ•°é™æµ</h3>
<h4 id="é…ç½®ä»‹ç»">é…ç½®ä»‹ç»</h4>
<p>ä¹‹å‰çš„é™æµæ˜¯ç»Ÿè®¡è®¿é—®æŸä¸ªèµ„æºçš„æ‰€æœ‰è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡QPSé˜ˆå€¼ã€‚è€Œçƒ­ç‚¹å‚æ•°é™æµæ˜¯<strong>åˆ†åˆ«ç»Ÿè®¡å‚æ•°å€¼ç›¸åŒçš„è¯·æ±‚</strong>ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡QPSé˜ˆå€¼ã€‚</p>
<blockquote>
<p>å¯¹åŒä¸€ä¸ªæ¥å£ï¼Œä¸åŒçš„å‚æ•°è¿›è¡Œé™æµ</p>
</blockquote>
<p>å®ç°æ­¥éª¤ï¼š</p>
<p>1ã€æ ‡è®°èµ„æº</p>
<p>ç»™UserControllerä¸­çš„/api/user/findUserByUserId/{userId}èµ„æºæ·»åŠ æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SentinelResource(&quot;hot&quot;)</span>  <span class="comment">// å£°æ˜èµ„æºåç§°</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/findUserByUserId/&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findUserByUserId</span><span class="params">(<span class="meta">@PathVariable(value = &quot;userId&quot;)</span> Long userId ,</span></span><br><span class="line"><span class="params">                             <span class="meta">@RequestHeader(name = &quot;Truth&quot; , required = false)</span>String header)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;UserController...findUserByUserIdæ–¹æ³•æ‰§è¡Œäº†... ,header: &#123;&#125; , dateformat: &#123;&#125; &quot;</span> , header , patternProperties.getDateformat());</span><br><span class="line">    <span class="keyword">return</span> userService.findUserByUserId(userId) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ã€è®¾ç½®çƒ­ç‚¹å‚æ•°é™æµè§„åˆ™</p>
<p>å¯ä»¥ç»™èµ„æºè®¾ç½®é»˜è®¤çš„è§„åˆ™ï¼Œä¹Ÿå¯ä»¥å¯¹ç‰¹æ®Šå‚æ•°è®¾ç½®å¯¹åº”çš„è§„åˆ™</p>
<h3 id="æœåŠ¡é™çº§">æœåŠ¡é™çº§</h3>
<p>éš”ç¦»å¤„ç†ï¼šå°†é”™è¯¯éš”ç¦»åœ¨å¯æ§çš„èŒƒå›´ä¹‹å†…ï¼Œä¸è¦è®©å…¶å½±å“åˆ°å…¶ä»–çš„ç¨‹åºçš„è¿è¡Œã€‚</p>
<h4 id="æ¡ˆä¾‹æ¼”ç¤º">æ¡ˆä¾‹æ¼”ç¤º</h4>
<p>ä¸ºäº†è®©æµ‹è¯•æ•ˆæœæ›´åŠ æ˜æ˜¾ä¸€ç‚¹ï¼Œå¯ä»¥è®©è®¿é—®/api/user/findUserByUserId/{userId}æ¥å£çš„çº¿ç¨‹å‡ºå¼‚å¸¸ï¼Œç„¶åç”¨jemeterç»™spzx-cloud-orderæœåŠ¡ä¸­çš„è°ƒç”¨ç”¨æˆ·å¾®æœåŠ¡çš„æ¥å£å‘é€è¯·æ±‚ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/findUserByUserId/&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findUserByUserId</span><span class="params">(<span class="meta">@PathVariable(value = &quot;userId&quot;)</span> Long userId ,</span></span><br><span class="line"><span class="params">                             <span class="meta">@RequestHeader(name = &quot;Truth&quot; , required = false)</span>String header)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;UserController...findUserByUserIdæ–¹æ³•æ‰§è¡Œäº†... ,header: &#123;&#125; , dateformat: &#123;&#125; &quot;</span> , header , patternProperties.getDateformat());</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> userService.findUserByUserId(userId) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¼šå‘ç°æŠ¥é”™ï¼Œä¸Šè¿°è¯·æ±‚å¤±è´¥ä»¥åï¼Œç›´æ¥è¿”å›è¿”å›500çš„é”™è¯¯çŠ¶æ€ç ç»™ç”¨æˆ·,è€Œè¿™ä¸ªé”™è¯¯è¯·æ±‚å¹¶ä¸æ˜¯ç”±äºç”¨æˆ·è®¿é—®æŸ¥è¯¢è®¢å•ä¿¡æ¯æŠ¥é”™å¯¼è‡´çš„ï¼Œè€Œæ˜¯ç”±äºæ ¹æ®è®¢å•æŸ¥è¯¢ç”¨æˆ·æ—¶æŠ¥é”™çš„ã€‚å› æ­¤ç›´æ¥ç»™ç”¨æˆ·è¿”å›500çš„é”™è¯¯çŠ¶æ€ç å…¶å®ä¸å¤ªå‹å¥½ï¼Œå‹å¥½çš„åšæ³•å½“è¿œç¨‹è°ƒç”¨å¤±è´¥ä»¥åï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤çš„ç”¨æˆ·ä¿¡æ¯ç»™å‰ç«¯ï¼Œè¿™ç§å¤‡ç”¨æ–¹æ¡ˆå°±æ˜¯æˆ‘ä»¬çš„é™çº§æ–¹æ¡ˆã€‚æœåŠ¡é™çº§,å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å®ç°æ­¥éª¤ï¼š</p>
<p>1ã€åœ¨spzx-cloud-orderå¾®æœåŠ¡ä¸­æ·»åŠ sentinelçš„ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--sentinel--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.å¹¶spzx-cloud-orderå¾®æœåŠ¡çš„application.ymlæ–‡ä»¶ä¸­</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¾®æœåŠ¡æ•´åˆsentinel</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br></pre></td></tr></table></figure>
<p>å®ç°æ­¥éª¤ï¼š</p>
<p>1ã€åœ¨spzx-cloud-orderæ¨¡å—ä¸­å®šä¹‰ä¸€ä¸ªç±»è®©å…¶å®ç°<strong>UserFeignClient</strong>æ¥å£ï¼Œé‡å†™queryByIdæ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ç¼–å†™é™çº§é€»è¾‘</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  com.atguigu.spzx.cloud.feign.fallback;</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserFeignClientFallback</span> <span class="keyword">implements</span> <span class="title class_">UserFeignClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;UserFeignClientFallback...queryById...æ–¹æ³•æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ã€åœ¨UserFeignClientæ¥å£ä¸­æ³¨å†Œé…ç½®è¯¥é™çº§ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;spzx-cloud-user&quot;, fallback = UserFeignClientFallback.class)</span>		</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserFeignClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/api/user/findUserByUserId/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> User <span class="title function_">queryById</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> Long userId)</span> ;	<span class="comment">// æ ¹æ®userIdæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ¥å£æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3ã€æŠŠè¯¥é™çº§ç±»çº³å…¥åˆ°springå®¹å™¨ä¸­</p>
<p>æ–¹æ¡ˆä¸€ï¼šåœ¨spzx-cloud-orderçš„å¯åŠ¨ç±»ä¸Šé€šè¿‡@Importæ³¨è§£è¿›è¡Œå¯¼å…¥</p>
<p>æ–¹æ¡ˆäºŒï¼šä½¿ç”¨Spring Boot3çš„è‡ªåŠ¨åŒ–é…ç½®åŸç†å®Œæˆ,SPIæœºåˆ¶ã€‚</p>
<p>å³ï¼šåœ¨resourcesç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªMETA-INF/springæ–‡ä»¶å¤¹ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªorg.springframework.boot.autoconfigure.AutoConfiguration.importsæ–‡ä»¶ï¼Œæ–‡ä»¶çš„ä¸­çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">com.atguigu.spzx.feign.order.fallback.UserFeignClientFallback</span><br></pre></td></tr></table></figure>
<p>æ–¹æ¡ˆä¸‰ï¼šç›´æ¥åœ¨UserFeignClientFallbackç±»ä¸ŠåŠ @Componentæ³¨è§£ã€‚</p>
<p>4ã€åœ¨spzx-cloud-orderå¾®æœåŠ¡çš„application.ymlæ–‡ä»¶ä¸­</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># feignæ•´åˆsentinel:ç¬¬å››æ­¥</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>4ã€é‡å¯æœåŠ¡ï¼Œé‡æ–°é…ç½®éš”ç¦»è§„åˆ™ï¼Œå¹¶è¿›è¡Œæµ‹è¯•</p>
<h3 id="ç†”æ–­å¤„ç†-v2">ç†”æ–­å¤„ç†</h3>
<h4 id="åŸç†">åŸç†</h4>
<p>ç†”æ–­é™çº§æ˜¯è§£å†³é›ªå´©é—®é¢˜çš„é‡è¦æ‰‹æ®µã€‚å…¶æ€è·¯æ˜¯ç”±<strong>æ–­è·¯å™¨</strong>ç»Ÿè®¡æœåŠ¡è°ƒç”¨çš„å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°ã€æ…¢è¯·æ±‚æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼š<strong>ç†”æ–­</strong>è¯¥æœåŠ¡ã€‚å³æ‹¦æˆªè®¿</p>
<p>é—®è¯¥æœåŠ¡çš„ä¸€åˆ‡è¯·æ±‚ï¼›è€Œå½“æœåŠ¡æ¢å¤æ—¶ï¼Œæ–­è·¯å™¨ä¼šæ”¾è¡Œè®¿é—®è¯¥æœåŠ¡çš„è¯·æ±‚ã€‚</p>
<p>æ–­è·¯å™¨ï¼ˆç†”æ–­å™¨ï¼‰æ§åˆ¶ç†”æ–­å’Œæ”¾è¡Œæ˜¯é€šè¿‡çŠ¶æ€æœºæ¥å®Œæˆçš„ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/c98cf25d1dee4f6c911c21597d9d38e2.png" alt="image.png"></p>
<p>çŠ¶æ€æœºåŒ…æ‹¬ä¸‰ä¸ªçŠ¶æ€ï¼š</p>
<p>1ã€closedï¼šå…³é—­çŠ¶æ€ï¼Œæ–­è·¯å™¨æ”¾è¡Œæ‰€æœ‰è¯·æ±‚ï¼Œå¹¶å¼€å§‹ç»Ÿè®¡å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°ã€æ…¢è¯·æ±‚æ¯”ä¾‹ã€‚è¶…è¿‡é˜ˆå€¼åˆ™åˆ‡æ¢åˆ°opençŠ¶æ€</p>
<p>2ã€openï¼šæ‰“å¼€çŠ¶æ€ï¼ŒæœåŠ¡è°ƒç”¨è¢«<strong>ç†”æ–­</strong>ï¼Œè®¿é—®è¢«ç†”æ–­æœåŠ¡çš„è¯·æ±‚ä¼šè¢«æ‹’ç»ï¼Œå¿«é€Ÿå¤±è´¥ï¼Œç›´æ¥èµ°é™çº§é€»è¾‘ã€‚OpençŠ¶æ€5ç§’åä¼šè¿›å…¥half-opençŠ¶æ€</p>
<p>3ã€half-openï¼šåŠå¼€çŠ¶æ€ï¼Œæ”¾è¡Œä¸€æ¬¡è¯·æ±‚ï¼Œæ ¹æ®æ‰§è¡Œç»“æœæ¥åˆ¤æ–­æ¥ä¸‹æ¥çš„æ“ä½œã€‚</p>
<p>â‘  è¯·æ±‚æˆåŠŸï¼šåˆ™åˆ‡æ¢åˆ°closedçŠ¶æ€</p>
<p>â‘¡ è¯·æ±‚å¤±è´¥ï¼šåˆ™åˆ‡æ¢åˆ°opençŠ¶æ€</p>
<p>æ–­è·¯å™¨ç†”æ–­åˆ¤æ–­ç­–ç•¥æœ‰ä¸‰ç§ï¼šæ…¢è°ƒç”¨ã€å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°</p>
<h4 id="æ…¢è°ƒç”¨æ¯”ä¾‹">æ…¢è°ƒç”¨æ¯”ä¾‹</h4>
<p>æ…¢è°ƒç”¨**ï¼šä¸šåŠ¡çš„å“åº”æ—¶é•¿ï¼ˆRTï¼‰å¤§äºæŒ‡å®šæ—¶é•¿çš„è¯·æ±‚è®¤å®šä¸ºæ…¢è°ƒç”¨è¯·æ±‚ã€‚sentinelä¼šç»Ÿè®¡æŒ‡å®šæ—¶é—´å†…ï¼Œè¯·æ±‚æ•°é‡è¶…è¿‡è®¾å®šçš„æœ€å°æ•°é‡çš„è¯·æ±‚å¹¶ä¸”æ…¢è°ƒ</p>
<p>ç”¨æ¯”ä¾‹çš„æ¯”ä¾‹ã€‚</p>
<p>å¦‚æœæ…¢è°ƒç”¨æ¯”ä¾‹å¤§äºè®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚</p>
<h4 id="å¼‚å¸¸æ¯”ä¾‹å’Œå¼‚å¸¸æ•°">å¼‚å¸¸æ¯”ä¾‹å’Œå¼‚å¸¸æ•°</h4>
<p><strong>å¼‚å¸¸æ¯”ä¾‹æˆ–å¼‚å¸¸æ•°</strong>ï¼šç»Ÿè®¡æŒ‡å®šæ—¶é—´å†…çš„è°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨æ¬¡æ•°è¶…è¿‡æŒ‡å®šè¯·æ±‚æ•°ï¼Œå¹¶ä¸”å‡ºç°å¼‚å¸¸çš„æ¯”ä¾‹è¾¾åˆ°è®¾å®šçš„æ¯”ä¾‹é˜ˆå€¼ï¼ˆæˆ–è¶…è¿‡æŒ‡å®šå¼‚å¸¸æ•°ï¼‰ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚</p>
<h3 id="è‡ªå®šä¹‰sentinelå¼‚å¸¸ç»“æœ">è‡ªå®šä¹‰sentinelå¼‚å¸¸ç»“æœ</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘ç”Ÿé™æµã€é™çº§ã€æˆæƒæ‹¦æˆªæ—¶ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸åˆ°è°ƒç”¨æ–¹ã€‚å¦‚æœè¦è‡ªå®šä¹‰å¼‚å¸¸æ—¶çš„è¿”å›ç»“æœï¼Œéœ€è¦å®ç°BlockExceptionHandler æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlockExceptionHandler</span> &#123;</span><br><span class="line">  <span class="comment">//å¤„ç†è¯·æ±‚è¢«é™æµã€é™çº§ã€æˆæƒæ‹¦æˆªæ—¶æŠ›å‡ºçš„å¼‚å¸¸ï¼šBlockException</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest var1, HttpServletResponse var2, BlockException var3)</span> <span class="keyword">throws</span> Exception; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œ BlockException åŒ…å«å¾ˆå¤šä¸ªå­ç±»ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„åœºæ™¯ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/9964b748a4e644f5880e4afbf11d5ba2.png" alt="image.png"></p>
<p>æˆ‘ä»¬åœ¨ <strong>ç”¨æˆ·å¾®æœåŠ¡</strong> ä¸­å®šä¹‰ç±»ï¼Œå®ç° BlockExceptionHandler æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.cloud.user.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.BlockExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.authority.AuthorityException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.degrade.DegradeException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.flow.FlowException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.flow.param.ParamFlowException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.system.SystemBlockException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰é…ç½®é™æµé™çº§é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBlockExceptionHandler</span> <span class="keyword">implements</span> <span class="title class_">BlockExceptionHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, BlockException e)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ResultObject</span> <span class="variable">resultObject</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//æ ¹æ®é™æµé™çº§çš„ç­–ç•¥è§„åˆ™ï¼Œä¸åŒçš„å¼‚å¸¸è¿”å›ä¸åŒçš„æç¤ºè¯­ï¼Œ</span></span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> FlowException) &#123;</span><br><span class="line">            resultObject = ResultObject.builder().code(<span class="number">100</span>).message(<span class="string">&quot;æ¥å£é™æµäº†&quot;</span>).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> DegradeException)&#123;</span><br><span class="line">            resultObject = ResultObject.builder().code(<span class="number">101</span>).message(<span class="string">&quot;æœåŠ¡é™çº§äº†&quot;</span>).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ParamFlowException)&#123;</span><br><span class="line">            resultObject = ResultObject.builder().code(<span class="number">102</span>).message(<span class="string">&quot;çƒ­ç‚¹å‚æ•°é™æµäº†&quot;</span>).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> SystemBlockException)&#123;</span><br><span class="line">            resultObject = ResultObject.builder().code(<span class="number">103</span>).message(<span class="string">&quot;è§¦å‘ç³»ç»Ÿä¿æŠ¤è§„åˆ™äº†&quot;</span>).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> AuthorityException)&#123;</span><br><span class="line">            resultObject = ResultObject.builder().code(<span class="number">104</span>).message(<span class="string">&quot;æˆæƒè§„åˆ™ä¸é€šè¿‡&quot;</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        response.setStatus(HttpStatus.INTERNAL_SERVER_ERROR.value());</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        response.setContentType(MediaType.APPLICATION_JSON_VALUE);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValue(response.getWriter(),resultObject);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//å¦‚æœéœ€è¦è·³è½¬åˆ°æŒ‡å®šé¡µé¢ä½¿ç”¨å¦‚ä¸‹å¤„ç†ï¼š</span></span><br><span class="line">        <span class="comment">//request.getRequestDispatcher(&quot;/index.jsp&quot;).forward(request,response);</span></span><br><span class="line">        <span class="comment">//è·³è½¬åˆ°ç½‘ç«™</span></span><br><span class="line">        <span class="comment">//response.sendRedirect(&quot;https://blog.csdn.net/weixin_44985880&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨ï¼šåœ¨ä¸Šé¢çš„è‡ªå®šä¹‰ç±»ä¸­ï¼Œå¦‚æœä¸éœ€è¦è¿”å›è‡ªå®šä¹‰çš„å“åº”ç»“æœï¼Œè€Œæ˜¯è·³è½¬åˆ°å¯¹åº”é¡µé¢ï¼Œå¯ä»¥å°†è¿”å›ç»“æœå¤„ç†æ¢æˆæ–¹æ³•ä¸­æœ€åçš„ä¸¤ç§å¤„ç†æ–¹æ³•å³å¯ã€‚</strong></p>
<h2 id="è§„åˆ™æŒä¹…åŒ–">è§„åˆ™æŒä¹…åŒ–</h2>
<h3 id="è§„åˆ™æŒä¹…åŒ–æ¦‚è¿°">è§„åˆ™æŒä¹…åŒ–æ¦‚è¿°</h3>
<p>é»˜è®¤æƒ…å†µä¸‹sentinelæ²¡æœ‰å¯¹è§„åˆ™è¿›è¡ŒæŒä¹…åŒ–ï¼Œè®©å¯¹æœåŠ¡è¿›è¡Œé‡å¯ä»¥åï¼ŒSentinelè§„åˆ™å°†æ¶ˆå¤±ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦å°†é…ç½®è§„åˆ™è¿›è¡ŒæŒä¹…åŒ–</p>
<p>æŒä¹…åŒ–æ€æƒ³ï¼š<strong>å°†é™æµé…ç½®è§„åˆ™æŒä¹…åŒ–è¿›Nacosä¿å­˜</strong>ï¼Œåªè¦åˆ·æ–°spzx-cloud-orderæŸä¸ªreståœ°å€ï¼Œsentinelæ§åˆ¶å°çš„æµæ§è§„åˆ™å°±èƒ½çœ‹åˆ°ï¼Œåªè¦Nacosé‡Œé¢çš„é…ç½®ä¸åˆ é™¤ï¼Œé’ˆå¯¹spzx-cloud-orderä¸ŠSentinelä¸Šçš„æµæ§è§„åˆ™æŒç»­æœ‰æ•ˆ</p>
<h3 id="Nacosæ·»åŠ è§„åˆ™é…ç½®">Nacosæ·»åŠ è§„åˆ™é…ç½®</h3>
<p>åœ¨nacosé…ç½®ä¸­å¿ƒä¸­æ·»åŠ è§„åˆ™é…ç½®</p>
<p>è§„åˆ™é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="attr">&quot;resource&quot;:</span> <span class="string">&quot;/testA&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;limitApp&quot;:</span> <span class="string">&quot;default&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;grade&quot;:</span> <span class="number">1</span>,</span><br><span class="line">         <span class="attr">&quot;count&quot;:</span> <span class="number">1</span>,</span><br><span class="line">         <span class="attr">&quot;strategy&quot;:</span> <span class="number">0</span>,</span><br><span class="line">         <span class="attr">&quot;controlBehavior&quot;:</span> <span class="number">0</span>,</span><br><span class="line">         <span class="attr">&quot;clusterMode&quot;:</span> <span class="literal">false</span> </span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è§„åˆ™è¯´æ˜ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/94c3ccf37e2441b5b46504f038a31923.png" alt="image.png"></p>
<h3 id="è¯»å–nacosè§„åˆ™é…ç½®">è¯»å–nacosè§„åˆ™é…ç½®</h3>
<p>å¾®æœåŠ¡å¯ä»¥ä»nacosé…ç½®ä¸­å¿ƒè¯»å–è§„åˆ™é…ç½®ä¿¡æ¯ç„¶åè¿›è¡Œä½¿ç”¨ã€‚</p>
<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>1ã€åœ¨spzx-cloud-orderå¾®æœåŠ¡ä¸­çš„pom.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2ã€åœ¨spzx-cloud-orderå¾®æœåŠ¡çš„application.ymlæ–‡ä»¶æ·»åŠ å¦‚ä¸‹é…ç½®</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é…ç½®æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">ds1:</span></span><br><span class="line">          <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">serverAddr:</span> <span class="number">192.168</span><span class="number">.136</span><span class="number">.142</span><span class="string">:8848</span></span><br><span class="line">            <span class="attr">dataId:</span> <span class="string">sentinel-rules</span></span><br><span class="line">            <span class="attr">groupId:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">            <span class="attr">dataType:</span> <span class="string">json</span></span><br><span class="line">            <span class="attr">ruleType:</span> <span class="string">flow</span>  <span class="comment"># è¿˜å¯ä»¥æ˜¯ï¼šdegradeã€authorityã€param-flow,system</span></span><br></pre></td></tr></table></figure>
<p>3ã€é‡å¯spzx-cloud-orderå¾®æœåŠ¡ï¼Œè®¿é—®ä»»æ„ä¸€ä¸ªæ¥å£ï¼Œæ­¤æ—¶å°±å¯ä»¥åœ¨sentinelçš„æ§åˆ¶å°çœ‹åˆ°å¯¹åº”çš„æµæ§è§„åˆ™äº†</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>ShardingSphere</title>
    <url>/2025/09/15/ShardingSphere/</url>
    <content><![CDATA[<h1>é«˜æ€§èƒ½æ¶æ„æ¨¡å¼</h1>
<ul>
<li>
<p>æ€§èƒ½æ•°æ®åº“é›†ç¾¤çš„æ–¹å¼æ˜¯:</p>
<ul>
<li>è¯»å†™åˆ†ç¦»</li>
<li>æ•°æ®åº“åˆ†ç‰‡</li>
</ul>
</li>
</ul>
<h2 id="è¯»å†™åˆ†ç¦»æ¶æ„">è¯»å†™åˆ†ç¦»æ¶æ„</h2>
<ul>
<li><strong>è¯»å†™åˆ†ç¦»åŸç†</strong>: è¯»å†™åˆ†ç¦»çš„åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®åº“è¯»å†™æ“ä½œåˆ†æ•£åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä¸‹é¢æ˜¯å…¶åŸºæœ¬æ¶æ„å›¾ï¼š<br>
<img src="http://120.26.79.238:9000/blog/img/5c55180dd754470ba283c0df1470d846.png" alt="image.png"></li>
<li>è¯»å†™åˆ†ç¦»çš„åŸºæœ¬å®ç°ï¼š
<ul>
<li>ä¸»åº“è´Ÿè´£å¤„ç†äº‹åŠ¡æ€§çš„å¢åˆ æ”¹æ“ä½œï¼Œä»åº“è´Ÿè´£å¤„ç†æŸ¥è¯¢æ“ä½œï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„é¿å…ç”±æ•°æ®æ›´æ–°å¯¼è‡´çš„è¡Œé”ï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿçš„æŸ¥è¯¢æ€§èƒ½å¾—åˆ°æå¤§çš„æ”¹å–„ã€‚</li>
<li>è¯»å†™åˆ†ç¦»æ˜¯æ ¹æ® SQL è¯­ä¹‰çš„åˆ†æï¼Œå°†è¯»æ“ä½œå’Œå†™æ“ä½œåˆ†åˆ«è·¯ç”±è‡³ä¸»åº“ä¸ä»åº“ã€‚</li>
<li>é€šè¿‡ä¸€ä¸»å¤šä»çš„é…ç½®æ–¹å¼ï¼Œå¯ä»¥å°†æŸ¥è¯¢è¯·æ±‚å‡åŒ€çš„åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®å‰¯æœ¬ï¼Œèƒ½å¤Ÿè¿›ä¸€æ­¥çš„æå‡ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚</li>
<li>ä½¿ç”¨å¤šä¸»å¤šä»çš„æ–¹å¼ï¼Œä¸ä½†èƒ½å¤Ÿæå‡ç³»ç»Ÿçš„ååé‡ï¼Œè¿˜èƒ½å¤Ÿæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œå¯ä»¥è¾¾åˆ°åœ¨ä»»ä½•ä¸€ä¸ªæ•°æ®åº“å®•æœºï¼Œç”šè‡³ç£ç›˜ç‰©ç†æŸåçš„æƒ…å†µä¸‹ä»ç„¶ä¸å½±å“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚</li>
</ul>
</li>
</ul>
<h3 id="CAP-ç†è®º">CAP ç†è®º</h3>
<ul>
<li>CAP å®šç†ï¼ˆCAP theoremï¼‰åˆè¢«ç§°ä½œå¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s theoremï¼‰ï¼Œæ˜¯åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„è®¡ç®—æœºç§‘å­¦å®¶åŸƒé‡Œå…‹Â·å¸ƒé²å°”ï¼ˆEric Brewerï¼‰åœ¨ 2000 å¹´çš„ ACM PODC ä¸Šæå‡ºçš„ä¸€ä¸ªçŒœæƒ³ã€‚å¯¹äºè®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¶æ„å¸ˆæ¥è¯´ï¼ŒCAP æ˜¯å¿…é¡»æŒæ¡çš„ç†è®ºã€‚</li>
<li>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå½“æ¶‰åŠè¯»å†™æ“ä½œæ—¶ï¼Œåªèƒ½ä¿è¯ä¸€è‡´æ€§ï¼ˆConsistenceï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition Toleranceï¼‰ä¸‰è€…ä¸­çš„ä¸¤ä¸ªï¼Œå¦å¤–ä¸€ä¸ªå¿…é¡»è¢«ç‰ºç‰²ã€‚
<ul>
<li>C ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šå¯¹æŸä¸ªæŒ‡å®šçš„å®¢æˆ·ç«¯æ¥è¯´ï¼Œè¯»æ“ä½œä¿è¯èƒ½å¤Ÿè¿”å›æœ€æ–°çš„å†™æ“ä½œç»“æœ</li>
<li>A å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼šéæ•…éšœçš„èŠ‚ç‚¹åœ¨åˆç†çš„æ—¶é—´å†…è¿”å›åˆç†çš„å“åº”ï¼ˆä¸æ˜¯é”™è¯¯å’Œè¶…æ—¶çš„å“åº”ï¼‰</li>
<li>P åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition Toleranceï¼‰ï¼šå½“å‡ºç°ç½‘ç»œåˆ†åŒºåï¼ˆå¯èƒ½æ˜¯ä¸¢åŒ…ï¼Œä¹Ÿå¯èƒ½æ˜¯è¿æ¥ä¸­æ–­ï¼Œè¿˜å¯èƒ½æ˜¯æ‹¥å¡ï¼‰ï¼Œç³»ç»Ÿèƒ½å¤Ÿç»§ç»­â€œå±¥è¡ŒèŒè´£â€</li>
</ul>
</li>
</ul>
<h3 id="CAPç‰¹ç‚¹">CAPç‰¹ç‚¹</h3>
<ul>
<li>åœ¨å®é™…è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç³»ç»Ÿä¸å¯èƒ½åªå¤„ç†ä¸€ç§æ•°æ®ï¼Œè€Œæ˜¯åŒ…å«å¤šç§ç±»å‹çš„æ•°æ®ï¼Œæœ‰çš„æ•°æ®å¿…é¡»é€‰æ‹© CPï¼Œæœ‰çš„æ•°æ®å¿…é¡»é€‰æ‹© APï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¸Šä¸å¯èƒ½é€‰æ‹© CA æ¶æ„ã€‚</li>
<li>CP: åœ¨åˆ†å¸ƒå¼æ•°æ®åº“ä¸­ , ä¸ºäº†ä¿æŒ<code>ä¸€è‡´æ€§</code>,  å½“ä¸€ä¸ªèŠ‚ç‚¹æ›´æ–°äº†æ•°æ®ä¹‹å, å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹è¿˜æ²¡æ¥å¾—åŠæ›´æ–°,ä½†æ˜¯æ­¤æ—¶æœ‰æœåŠ¡è®¿é—®, è¯¥æœåŠ¡å¿…é¡»è¿”å›é”™è¯¯ç›¸å…³ä¿¡æ¯, ä½†æ˜¯å´è¿èƒŒäº† å¯ç”¨æ€§. å› æ­¤,åªèƒ½æ»¡è¶³ CP</li>
<li>AP: ä¸ºäº†ä¿æŒ<code>å¯ç”¨æ€§</code>, å³ä½¿èŠ‚ç‚¹è¿˜æ²¡æ›´æ–°, å½“æœ‰æœåŠ¡è®¿é—®æ—¶, æœåŠ¡ä¼šè¿”å›ä¸€ä¸ª <code>åˆç†</code>çš„ç»“æœ, ä½†æ˜¯è¿™ä¸ªç»“æœå¯èƒ½ä¸æ˜¯ <code>æ­£ç¡®</code>,è¿™å°±ä¸æ»¡è¶³<code>ä¸€è‡´æ€§</code>.</li>
</ul>
<p><strong>ä¸€è‡´æ€§</strong>:  CAP ç†è®ºä¸­çš„ C åœ¨å®è·µä¸­æ˜¯ä¸å¯èƒ½å®Œç¾å®ç°çš„ï¼Œåœ¨æ•°æ®å¤åˆ¶çš„è¿‡ç¨‹ä¸­ï¼ŒèŠ‚ç‚¹N1 å’ŒèŠ‚ç‚¹ N2 çš„æ•°æ®å¹¶ä¸ä¸€è‡´ï¼ˆå¼ºä¸€è‡´æ€§ï¼‰ã€‚å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†åº”ç”¨å¯ä»¥é‡‡ç”¨é€‚åˆçš„æ–¹å¼è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œå³ä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚</li>
<li>è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰ï¼šå…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè€Œè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ã€‚è¿™é‡Œçš„ä¸­é—´çŠ¶æ€å°±æ˜¯ CAP ç†è®ºä¸­çš„æ•°æ®ä¸ä¸€è‡´ã€‚</li>
<li>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰ï¼šç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚</li>
</ul>
<h2 id="æ•°æ®åº“åˆ†ç‰‡æ¶æ„">æ•°æ®åº“åˆ†ç‰‡æ¶æ„</h2>
<p><strong>è¯»å†™åˆ†ç¦»çš„é—®é¢˜</strong>ï¼š</p>
<p>è¯»å†™åˆ†ç¦»åˆ†æ•£äº†æ•°æ®åº“è¯»å†™æ“ä½œçš„å‹åŠ›ï¼Œä½†æ²¡æœ‰åˆ†æ•£å­˜å‚¨å‹åŠ›ï¼Œä¸ºäº†æ»¡è¶³ä¸šåŠ¡æ•°æ®å­˜å‚¨çš„éœ€æ±‚ï¼Œå°±éœ€è¦å°†å­˜å‚¨åˆ†æ•£åˆ°å¤šå°æ•°æ®åº“æœåŠ¡å™¨ä¸Šã€‚</p>
<p><strong>æ•°æ®åˆ†ç‰‡</strong>ï¼š</p>
<p>å°†å­˜æ”¾åœ¨å•ä¸€æ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£åœ°å­˜æ”¾è‡³å¤šä¸ªæ•°æ®åº“æˆ–è¡¨ä¸­ï¼Œä»¥è¾¾åˆ°æå‡æ€§èƒ½ç“¶é¢ˆä»¥åŠå¯ç”¨æ€§çš„æ•ˆæœã€‚ æ•°æ®åˆ†ç‰‡çš„æœ‰æ•ˆæ‰‹æ®µæ˜¯å¯¹å…³ç³»å‹æ•°æ®åº“è¿›è¡Œåˆ†åº“å’Œåˆ†è¡¨ã€‚æ•°æ®åˆ†ç‰‡çš„æ‹†åˆ†æ–¹å¼åˆåˆ†ä¸º<strong>å‚ç›´åˆ†ç‰‡</strong>å’Œ<strong>æ°´å¹³åˆ†ç‰‡</strong>ã€‚</p>
<h3 id="å‚ç›´åˆ†ç‰‡">å‚ç›´åˆ†ç‰‡</h3>
<h4 id="å‚ç›´åˆ†åº“">å‚ç›´åˆ†åº“</h4>
<ul>
<li>å°†ä¸åŒçš„è¡¨å­˜å‚¨åœ¨ä¸åŒçš„æ•°æ®åº“ä¸­</li>
<li>æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†çš„æ–¹å¼ç§°ä¸ºå‚ç›´åˆ†ç‰‡ï¼Œåˆç§°ä¸ºçºµå‘æ‹†åˆ†ï¼Œå®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ä¸“åº“ä¸“ç”¨ã€‚ åœ¨æ‹†åˆ†ä¹‹å‰ï¼Œä¸€ä¸ªæ•°æ®åº“ç”±å¤šä¸ªæ•°æ®è¡¨æ„æˆï¼Œæ¯ä¸ªè¡¨å¯¹åº”ç€ä¸åŒçš„ä¸šåŠ¡ã€‚è€Œæ‹†åˆ†ä¹‹åï¼Œåˆ™æ˜¯æŒ‰ç…§ä¸šåŠ¡å°†è¡¨è¿›è¡Œå½’ç±»ï¼Œåˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œä»è€Œå°†å‹åŠ›åˆ†æ•£è‡³ä¸åŒçš„æ•°æ®åº“ã€‚</li>
<li>å‚ç›´æ‹†åˆ†å¯ä»¥ç¼“è§£æ•°æ®é‡å’Œè®¿é—®é‡å¸¦æ¥çš„é—®é¢˜ï¼Œä½†æ— æ³•æ ¹æ²»ã€‚å¦‚æœå‚ç›´æ‹†åˆ†ä¹‹åï¼Œè¡¨ä¸­çš„æ•°æ®é‡ä¾ç„¶è¶…è¿‡å•èŠ‚ç‚¹æ‰€èƒ½æ‰¿è½½çš„é˜ˆå€¼ï¼Œåˆ™éœ€è¦æ°´å¹³åˆ†ç‰‡æ¥è¿›ä¸€æ­¥å¤„ç†ã€‚</li>
</ul>
<h4 id="å‚ç›´åˆ†è¡¨ï¼š">å‚ç›´åˆ†è¡¨ï¼š</h4>
<p><code>å‚ç›´åˆ†è¡¨é€‚åˆå°†è¡¨ä¸­æŸäº›ä¸å¸¸ç”¨çš„åˆ—ï¼Œæˆ–è€…æ˜¯å äº†å¤§é‡ç©ºé—´çš„åˆ—æ‹†åˆ†å‡ºå»ã€‚</code></p>
<ul>
<li>æ‹†åˆ†ä¸€ä¸ªè¡¨ä¸­çš„å¸¸ç”¨å­—æ®µå’Œ ä¸å¸¸ç”¨å­—æ®µ, è¿™æ ·åœ¨æŸ¥æ‰¾æ—¶, å°±åªç”¨æŸ¥æ‰¾å¸¸ç”¨çš„å­—æ®µ,å¦‚æœéœ€è¦å…¶ä»–ä¸å¸¸ç”¨çš„, åˆ™å¯ä»¥åœ¨å¦å¤–ä¸€å¼ è¡¨ä¸­æŸ¥æ‰¾.</li>
</ul>
<h3 id="æ°´å¹³åˆ†ç‰‡">æ°´å¹³åˆ†ç‰‡</h3>
<p>æ°´å¹³åˆ†ç‰‡åˆç§°ä¸ºæ¨ªå‘æ‹†åˆ†ã€‚ ç›¸å¯¹äºå‚ç›´åˆ†ç‰‡ï¼Œå®ƒä¸å†å°†æ•°æ®æ ¹æ®ä¸šåŠ¡é€»è¾‘åˆ†ç±»ï¼Œè€Œæ˜¯é€šè¿‡æŸä¸ªå­—æ®µï¼ˆæˆ–æŸå‡ ä¸ªå­—æ®µï¼‰ï¼Œæ ¹æ®æŸç§è§„åˆ™å°†æ•°æ®åˆ†æ•£è‡³å¤šä¸ªåº“æˆ–è¡¨ä¸­ï¼Œæ¯ä¸ªåˆ†ç‰‡ä»…åŒ…å«æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚ ä¾‹å¦‚ï¼šæ ¹æ®ä¸»é”®åˆ†ç‰‡ï¼Œå¶æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 0 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¥‡æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 1 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œ</p>
<ul>
<li>
<p>å•è¡¨è¿›è¡Œåˆ‡åˆ†åï¼Œæ˜¯å¦å°†å¤šä¸ªè¡¨åˆ†æ•£åœ¨ä¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œå¯ä»¥æ ¹æ®å®é™…çš„åˆ‡åˆ†æ•ˆæœæ¥ç¡®å®šã€‚</p>
</li>
<li>
<p>æ°´å¹³åˆ†è¡¨ï¼šå•è¡¨åˆ‡åˆ†ä¸ºå¤šè¡¨åï¼Œæ–°çš„è¡¨å³ä½¿åœ¨åŒä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œä¹Ÿå¯èƒ½å¸¦æ¥å¯è§‚çš„æ€§èƒ½æå‡ï¼Œå¦‚æœæ€§èƒ½èƒ½å¤Ÿæ»¡è¶³ä¸šåŠ¡è¦æ±‚ï¼Œå¯ä»¥ä¸æ‹†åˆ†åˆ°å¤šå°æ•°æ®åº“æœåŠ¡å™¨ï¼Œæ¯•ç«Ÿä¸šåŠ¡åˆ†åº“ä¹Ÿä¼šå¼•å…¥å¾ˆå¤šå¤æ‚æ€§ï¼›</p>
</li>
<li>
<p>æ°´å¹³åˆ†åº“ï¼šå¦‚æœå•è¡¨æ‹†åˆ†ä¸ºå¤šè¡¨åï¼Œå•å°æœåŠ¡å™¨ä¾ç„¶æ— æ³•æ»¡è¶³æ€§èƒ½è¦æ±‚ï¼Œé‚£å°±éœ€è¦å°†å¤šä¸ªè¡¨åˆ†æ•£åœ¨ä¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ä¸­ã€‚</p>
</li>
</ul>
<blockquote>
<p>é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œï¼š<br>
ã€æ¨èã€‘å•è¡¨è¡Œæ•°è¶…è¿‡ 500 ä¸‡è¡Œæˆ–è€…å•è¡¨å®¹é‡è¶…è¿‡ 2GBï¼Œæ‰æ¨èè¿›è¡Œåˆ†åº“åˆ†è¡¨ã€‚<br>
è¯´æ˜ï¼šå¦‚æœé¢„è®¡ä¸‰å¹´åçš„æ•°æ®é‡æ ¹æœ¬è¾¾ä¸åˆ°è¿™ä¸ªçº§åˆ«ï¼Œè¯·ä¸è¦åœ¨åˆ›å»ºè¡¨æ—¶å°±åˆ†åº“åˆ†è¡¨ã€‚</p>
</blockquote>
<h1>è§£å†³æ–¹æ¡ˆ</h1>
<h2 id="ç¨‹åºä»£ç å°è£…">ç¨‹åºä»£ç å°è£…</h2>
<p>ç¨‹åºä»£ç å°è£…æŒ‡åœ¨ä»£ç ä¸­æŠ½è±¡ä¸€ä¸ªæ•°æ®è®¿é—®å±‚ï¼ˆæˆ–ä¸­é—´å±‚å°è£…ï¼‰ï¼Œå®ç°è¯»å†™æ“ä½œåˆ†ç¦»å’Œæ•°æ®åº“æœåŠ¡å™¨è¿æ¥çš„ç®¡ç†ã€‚</p>
<p>å…¶åŸºæœ¬æ¶æ„æ˜¯ï¼šä»¥è¯»å†™åˆ†ç¦»ä¸ºä¾‹<br>
<img src="http://120.26.79.238:9000/blog/img/d628ef662dd54e1f80385800f594f9ba.png" alt="image.png"></p>
<h2 id="ä¸­é—´ä»¶å°è£…">ä¸­é—´ä»¶å°è£…</h2>
<p>ä¸­é—´ä»¶å°è£…æŒ‡çš„æ˜¯ç‹¬ç«‹ä¸€å¥—ç³»ç»Ÿå‡ºæ¥ï¼Œå®ç°è¯»å†™æ“ä½œåˆ†ç¦»å’Œæ•°æ®åº“æœåŠ¡å™¨è¿æ¥çš„ç®¡ç†ã€‚å¯¹äºä¸šåŠ¡æœåŠ¡å™¨æ¥è¯´ï¼Œè®¿é—®ä¸­é—´ä»¶å’Œè®¿é—®æ•°æ®åº“æ²¡æœ‰åŒºåˆ«ï¼Œåœ¨ä¸šåŠ¡æœåŠ¡å™¨çœ‹æ¥ï¼Œä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ã€‚</p>
<p>åŸºæœ¬æ¶æ„æ˜¯ï¼šä»¥è¯»å†™åˆ†ç¦»ä¸ºä¾‹</p>
<p><img src="http://120.26.79.238:9000/blog/img/9183594276f6454fa4f70387b7d06341.png" alt="image.png"></p>
<h2 id="å¸¸ç”¨è§£å†³æ–¹æ¡ˆ">å¸¸ç”¨è§£å†³æ–¹æ¡ˆ</h2>
<ul>
<li>
<p>Apache ShardingSphere</p>
<ul>
<li>ç¨‹åºä»£ç å°è£…ï¼šShardingSphere-JDBC</li>
<li>ä¸­é—´ä»¶å°è£…ï¼šShardingSphere-Proxy</li>
</ul>
<p>å®˜ç½‘ï¼š<a href="https://shardingsphere.apache.org/index_zh.html">https://shardingsphere.apache.org/index_zh.html</a><br>
æ–‡æ¡£ï¼š<a href="https://shardingsphere.apache.org/document/5.4.0/cn/overview/">https://shardingsphere.apache.org/document/5.4.0/cn/overview/</a></p>
</li>
<li>
<p>MyCatï¼šæ•°æ®åº“ä¸­é—´ä»¶</p>
</li>
</ul>
<h1>MySQLä¸»ä»åŒæ­¥</h1>
<h2 id="MySQLä¸»ä»åŒæ­¥åŸç†">MySQLä¸»ä»åŒæ­¥åŸç†</h2>
<p><img src="http://120.26.79.238:9000/blog/img/d6fda58abba1499db3feb43c9717be84.png" alt="image.png"></p>
<p><strong>åŸºæœ¬åŸç†</strong>ï¼š</p>
<p>slaveä¼šä»masterè¯»å–binlogæ¥è¿›è¡Œæ•°æ®åŒæ­¥</p>
<p><strong>å…·ä½“æ­¥éª¤ï¼š</strong></p>
<ul>
<li>step1ï¼šmasterå°†æ•°æ®æ”¹å˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinary logï¼‰ä¸­ã€‚</li>
<li>step2ï¼š å½“slaveä¸Šæ‰§è¡Œ start slave å‘½ä»¤ä¹‹åï¼Œslaveä¼šåˆ›å»ºä¸€ä¸ª IO çº¿ç¨‹ç”¨æ¥è¿æ¥masterï¼Œè¯·æ±‚masterä¸­çš„binlogã€‚</li>
<li>step3ï¼šå½“slaveè¿æ¥masteræ—¶ï¼Œmasterä¼šåˆ›å»ºä¸€ä¸ª log dump çº¿ç¨‹ï¼Œç”¨äºå‘é€ binlog çš„å†…å®¹ã€‚åœ¨è¯»å– binlog çš„å†…å®¹çš„æ“ä½œä¸­ï¼Œä¼šå¯¹ä¸»èŠ‚ç‚¹ä¸Šçš„ binlog åŠ é”ï¼Œå½“è¯»å–å®Œæˆå¹¶å‘é€ç»™ä»æœåŠ¡å™¨åè§£é”ã€‚</li>
<li>step4ï¼šIO çº¿ç¨‹æ¥æ”¶ä¸»èŠ‚ç‚¹ binlog dump è¿›ç¨‹å‘æ¥çš„æ›´æ–°ä¹‹åï¼Œä¿å­˜åˆ° ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰ ä¸­ã€‚</li>
<li>step5ï¼šslaveçš„SQLçº¿ç¨‹ï¼Œè¯»å–relay logæ—¥å¿—ï¼Œå¹¶è§£ææˆå…·ä½“æ“ä½œï¼Œä»è€Œå®ç°ä¸»ä»æ“ä½œä¸€è‡´ï¼Œæœ€ç»ˆæ•°æ®ä¸€è‡´ã€‚</li>
</ul>
<h2 id="ä¸€ä¸»å¤šä»é…ç½®">ä¸€ä¸»å¤šä»é…ç½®</h2>
<ul>
<li><strong>mysql å®ç°ä¸»ä»å¤åˆ¶</strong></li>
</ul>
<h3 id="å‡†å¤‡ä¸»æœåŠ¡å™¨">å‡†å¤‡ä¸»æœåŠ¡å™¨</h3>
<h4 id="1-å¼€å¯binlogæ—¥å¿—">1. å¼€å¯binlogæ—¥å¿—</h4>
<ul>
<li>binlog: åœ¨ä¸»èŠ‚ç‚¹ä¸­,å¿…é¡»å¼€å¯,  é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼€å¯çš„</li>
<li>ç”¨äºå‘é€å¢åˆ æ”¹çš„sqlè®°å½•ç»™ä»èŠ‚ç‚¹è¿›è¡Œ<strong>å¢é‡å¤åˆ¶</strong>.</li>
<li>é…ç½®æ–‡ä»¶è®¾ç½®</li>
</ul>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment"># æœåŠ¡å™¨å”¯ä¸€idï¼Œé»˜è®¤å€¼1</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"># è®¾ç½®æ—¥å¿—æ ¼å¼ï¼Œé»˜è®¤å€¼ROW</span></span><br><span class="line"><span class="attr">binlog_format</span>=<span class="string">STATEMENT</span></span><br><span class="line"><span class="comment"># äºŒè¿›åˆ¶æ—¥å¿—åï¼Œé»˜è®¤binlog</span></span><br><span class="line"><span class="comment"># log-bin=binlog</span></span><br><span class="line"><span class="comment"># è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“ï¼Œé»˜è®¤å¤åˆ¶å…¨éƒ¨æ•°æ®åº“</span></span><br><span class="line"><span class="comment">#binlog-do-db=mytestdb1</span></span><br><span class="line"><span class="comment">#binlog-do-db=mytestdb2</span></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸éœ€è¦å¤åˆ¶çš„æ•°æ®åº“</span></span><br><span class="line"><span class="comment">#binlog-ignore-db=mytestdb3</span></span><br><span class="line"><span class="comment">#binlog-ignore-db=mytestdb4</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>binlogæ ¼å¼è¯´æ˜ï¼š</p>
</li>
<li>
<p>binlog_format=STATEMENTï¼šæ—¥å¿—è®°å½•çš„æ˜¯ä¸»æœºæ•°æ®åº“çš„å†™æŒ‡ä»¤ï¼Œæ€§èƒ½é«˜ï¼Œä½†æ˜¯now()ä¹‹ç±»çš„å‡½æ•°ä»¥åŠè·å–ç³»ç»Ÿå‚æ•°çš„æ“ä½œä¼šå‡ºç°ä¸»ä»æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ã€‚</p>
</li>
<li>
<p>binlog_format=ROWï¼ˆé»˜è®¤ï¼‰ï¼šæ—¥å¿—è®°å½•çš„æ˜¯ä¸»æœºæ•°æ®åº“çš„å†™åçš„æ•°æ®ï¼Œæ‰¹é‡æ“ä½œæ—¶æ€§èƒ½è¾ƒå·®ï¼Œè§£å†³now()æˆ–è€…  user()æˆ–è€…  @@hostname ç­‰æ“ä½œåœ¨ä¸»ä»æœºå™¨ä¸Šä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
</li>
<li>
<p>binlog_format=MIXEDï¼šæ˜¯ä»¥ä¸Šä¸¤ç§levelçš„æ··åˆä½¿ç”¨ï¼Œæœ‰å‡½æ•°ç”¨ROWï¼Œæ²¡å‡½æ•°ç”¨STATEMENT</p>
</li>
</ul>
<h5 id="binlog-ignore-dbå’Œbinlog-do-dbçš„ä¼˜å…ˆçº§é—®é¢˜ï¼š">binlog-ignore-dbå’Œbinlog-do-dbçš„ä¼˜å…ˆçº§é—®é¢˜ï¼š</h5>
<p><img src="http://120.26.79.238:9000/blog/img/ceccb614a5ec432d87d8924110cef2b2.png" alt="image.png"></p>
<h4 id="2-åœ¨ä¸»æœºä¸­åˆ›å»ºsalveç”¨æˆ·">2. åœ¨ä¸»æœºä¸­åˆ›å»ºsalveç”¨æˆ·</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºslaveç”¨æˆ·</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;atguigu_slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- è®¾ç½®å¯†ç </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;atguigu_slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="comment">-- æˆäºˆå¤åˆ¶æƒé™</span></span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;atguigu_slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- åˆ·æ–°æƒé™</span></span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<ul>
<li>ç”¨æˆ·ä»æœºè¿›è¡Œå¢é‡å¤åˆ¶çš„ç”¨æˆ·</li>
</ul>
<h4 id="3-ä¸»æœºä¸­æŸ¥è¯¢masterçŠ¶æ€">3. ä¸»æœºä¸­æŸ¥è¯¢masterçŠ¶æ€</h4>
<p>æ‰§è¡Œå®Œæ­¤æ­¥éª¤åä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MYSQLï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–</p>
<p><code>  SHOW MASTER STATUS;</code></p>
<p>è®°ä¸‹Fileå’ŒPositionçš„å€¼ã€‚æ‰§è¡Œå®Œæ­¤æ­¥éª¤åä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MYSQLï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–ã€‚<br>
<img src="http://120.26.79.238:9000/blog/img/11992bd177f44247bb8eeff392e05efa.png" alt="image.png"></p>
<h3 id="å‡†å¤‡ä»æœåŠ¡å™¨">å‡†å¤‡ä»æœåŠ¡å™¨</h3>
<h4 id="1-ç¼–å†™é…ç½®æ–‡ä»¶">1. ç¼–å†™é…ç½®æ–‡ä»¶</h4>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment"># æœåŠ¡å™¨å”¯ä¸€idï¼Œæ¯å°æœåŠ¡å™¨çš„idå¿…é¡»ä¸åŒï¼Œå¦‚æœé…ç½®å…¶ä»–ä»æœºï¼Œæ³¨æ„ä¿®æ”¹id</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">2</span></span><br><span class="line"><span class="comment"># ä¸­ç»§æ—¥å¿—åï¼Œé»˜è®¤xxxxxxxxxxxx-relay-bin</span></span><br><span class="line"><span class="comment">#relay-log=relay-bin</span></span><br></pre></td></tr></table></figure>
<h4 id="é…ç½®ä¸»ä»å…³ç³»">é…ç½®ä¸»ä»å…³ç³»</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span> MASTER_HOST<span class="operator">=</span><span class="string">&#x27;192.168.100.101&#x27;</span>,     # ä¸»æœºçš„ip</span><br><span class="line">MASTER_USER<span class="operator">=</span><span class="string">&#x27;atguigu_slave&#x27;</span>,MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>, MASTER_PORT<span class="operator">=</span><span class="number">3306</span>,   # ä¸»æœºçš„è´¦å·å’Œç«¯å£å·</span><br><span class="line">MASTER_LOG_FILE<span class="operator">=</span><span class="string">&#x27;binlog.000003&#x27;</span>,MASTER_LOG_POS<span class="operator">=</span><span class="number">1357</span>;        # log_file çš„æ–‡ä»¶å        logçš„èµ·å§‹ä½ç½®</span><br></pre></td></tr></table></figure>
<h3 id="å¯åŠ¨ä¸»ä»åŒæ­¥">å¯åŠ¨ä¸»ä»åŒæ­¥</h3>
<p>åˆ†åˆ«åœ¨ä¸¤å°ä»æœºä¸Šå¯åŠ¨ä»æœºçš„å¤åˆ¶åŠŸèƒ½ï¼Œæ‰§è¡ŒSQLï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">START SLAVE;</span><br><span class="line">-- æŸ¥çœ‹çŠ¶æ€ï¼ˆä¸éœ€è¦åˆ†å·ï¼‰</span><br><span class="line">SHOW SLAVE STATUS\G</span><br></pre></td></tr></table></figure>
<p>ä¸¤ä¸ªå…³é”®è¿›ç¨‹ï¼šä¸‹é¢ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Yesï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸï¼<br>
<img src="http://120.26.79.238:9000/blog/img/a9ab421ee8b74fe6b92e6ed87fdba0da.png" alt="image.png"></p>
<h1>ShardingSphere-JDBCè¯»å†™åˆ†ç¦»</h1>
<h2 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h2>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å…¼å®¹jdk17å’Œspring boot3--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.yaml<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>snakeyaml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.jaxb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-runtime<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®shardingsphere">é…ç½®shardingsphere</h2>
<h3 id="application-yml">application.yml</h3>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é…ç½® DataSource Driver</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.apache.shardingsphere.driver.ShardingSphereDriver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:shardingsphere:classpath:shardingsphere.yaml</span></span><br></pre></td></tr></table></figure>
<h3 id="shardingsphere-yaml">shardingsphere.yaml</h3>
<p>æ¨¡å¼é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mode:</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Standalone</span></span><br><span class="line"><span class="attr">repository:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">JDBC</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ•°æ®æºé…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dataSources:</span></span><br><span class="line"><span class="attr">write_ds:</span></span><br><span class="line">  <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">  <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://192.168.100.101:3306/db_user</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">read_ds_0:</span></span><br><span class="line">  <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">  <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://192.168.100.101:3307/db_user</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">read_ds_1:</span></span><br><span class="line">  <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">  <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://192.168.100.101:3308/db_user</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¯»å†™åˆ†ç¦»é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!READWRITE_SPLITTING</span></span><br><span class="line">  <span class="attr">dataSources:</span></span><br><span class="line">    <span class="attr">readwrite_ds:</span></span><br><span class="line">      <span class="attr">writeDataSourceName:</span> <span class="string">write_ds</span></span><br><span class="line">      <span class="attr">readDataSourceNames:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">read_ds_0</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">read_ds_1</span></span><br><span class="line">      <span class="attr">transactionalReadQueryStrategy:</span> <span class="string">PRIMARY</span> <span class="comment"># äº‹åŠ¡å†…è¯»è¯·æ±‚çš„è·¯ç”±ç­–ç•¥ï¼Œå¯é€‰å€¼ï¼šPRIMARYï¼ˆè·¯ç”±è‡³ä¸»åº“ï¼‰ã€FIXEDï¼ˆåŒä¸€äº‹åŠ¡å†…è·¯ç”±è‡³å›ºå®šæ•°æ®æºï¼‰ã€DYNAMICï¼ˆåŒä¸€äº‹åŠ¡å†…è·¯ç”±è‡³éå›ºå®šæ•°æ®æºï¼‰ã€‚é»˜è®¤å€¼ï¼šDYNAMIC</span></span><br><span class="line">      <span class="attr">loadBalancerName:</span> <span class="string">random</span></span><br><span class="line">  <span class="attr">loadBalancers:</span></span><br><span class="line">    <span class="attr">random:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">RANDOM</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¯»å†™åˆ†ç¦»é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!READWRITE_SPLITTING</span></span><br><span class="line">  <span class="attr">dataSources:</span></span><br><span class="line">    <span class="attr">readwrite_ds:</span></span><br><span class="line">      <span class="attr">writeDataSourceName:</span> <span class="string">write_ds</span></span><br><span class="line">      <span class="attr">readDataSourceNames:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">read_ds_0</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">read_ds_1</span></span><br><span class="line">      <span class="attr">transactionalReadQueryStrategy:</span> <span class="string">PRIMARY</span> <span class="comment"># äº‹åŠ¡å†…è¯»è¯·æ±‚çš„è·¯ç”±ç­–ç•¥ï¼Œå¯é€‰å€¼ï¼šPRIMARYï¼ˆè·¯ç”±è‡³ä¸»åº“ï¼‰ã€FIXEDï¼ˆåŒä¸€äº‹åŠ¡å†…è·¯ç”±è‡³å›ºå®šæ•°æ®æºï¼‰ã€DYNAMICï¼ˆåŒä¸€äº‹åŠ¡å†…è·¯ç”±è‡³éå›ºå®šæ•°æ®æºï¼‰ã€‚é»˜è®¤å€¼ï¼šDYNAMIC</span></span><br><span class="line">      <span class="attr">loadBalancerName:</span> <span class="string">random</span></span><br><span class="line">  <span class="attr">loadBalancers:</span></span><br><span class="line">    <span class="attr">random:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">RANDOM</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºsqlï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">props:</span></span><br><span class="line"><span class="attr">sql-show:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è´Ÿè½½å‡è¡¡ç®—æ³•é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!READWRITE_SPLITTING</span></span><br><span class="line">  <span class="attr">loadBalancers:</span></span><br><span class="line">    <span class="attr">random:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">RANDOM</span></span><br><span class="line">    <span class="attr">round_robin:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">ROUND_ROBIN</span></span><br><span class="line">    <span class="attr">weight:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">WEIGHT</span></span><br><span class="line">      <span class="attr">props:</span></span><br><span class="line">        <span class="attr">read_ds_0:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">read_ds_1:</span> <span class="number">2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="äº‹åŠ¡æµ‹è¯•">äº‹åŠ¡æµ‹è¯•</h3>
<p>transactionalReadQueryStrategy: PRIMARY</p>
<p>äº‹åŠ¡å†…è¯»è¯·æ±‚çš„è·¯ç”±ç­–ç•¥ï¼Œå¯é€‰å€¼ï¼š</p>
<p>PRIMARYï¼ˆè·¯ç”±è‡³ä¸»åº“ï¼‰</p>
<p>FIXEDï¼ˆåŒä¸€äº‹åŠ¡å†…è·¯ç”±è‡³å›ºå®šæ•°æ®æºï¼‰</p>
<p>DYNAMICï¼ˆåŒä¸€äº‹åŠ¡å†…è·¯ç”±è‡³éå›ºå®šæ•°æ®æºï¼‰ã€‚é»˜è®¤å€¼ï¼šDYNAMIC</p>
<h1>ShardingSphere-JDBCå‚ç›´åˆ†ç‰‡</h1>
<ul>
<li>å‚ç›´åˆ†åº“   :  å°†ä¸åŒçš„è¡¨å­˜å‚¨åœ¨ä¸åŒçš„æ•°æ®åº“ä¸­</li>
<li>å‚ç›´åˆ†è¡¨   : ä¸€å¼ è¡¨åˆ†ä¸ºå¤šå¼ è¡¨,ç»“æ„ä¸åŒ.</li>
</ul>
<h2 id="å‚ç›´åˆ†ç‰‡çš„é…ç½®">å‚ç›´åˆ†ç‰‡çš„é…ç½®</h2>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¨¡å¼é…ç½®</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">mode:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Standalone</span></span><br><span class="line">      <span class="attr">repository:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">JDBC</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®æºé…ç½®ï¼š</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">dataSources:</span></span><br><span class="line">      <span class="attr">user_ds:</span></span><br><span class="line">        <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">        <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://192.168.100.101:3301/db_user</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">order_ds_0:</span></span><br><span class="line">        <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">        <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://192.168.100.101:3310/db_order</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">order_ds_1:</span></span><br><span class="line">        <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">        <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://192.168.100.101:3311/db_order</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ä¸€ä¸ªorderåˆ†ç‰‡èŠ‚ç‚¹ï¼š</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="type">!SHARDING</span></span><br><span class="line">        <span class="attr">tables:</span></span><br><span class="line">          <span class="attr">t_user:</span></span><br><span class="line">            <span class="attr">actualDataNodes:</span> <span class="string">user_ds.t_user</span></span><br><span class="line">          <span class="attr">t_order:</span></span><br><span class="line">            <span class="attr">actualDataNodes:</span> <span class="string">order_ds_0.t_order0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºsqlï¼š</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">sql-show:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹Orderå®ä½“ç±»çš„ä¸»é”®ç­–ç•¥ï¼š</span></span><br><span class="line"></span><br><span class="line">    <span class="string">//@TableId(type</span> <span class="string">=</span> <span class="string">IdType.AUTO)//ä¾èµ–æ•°æ®åº“çš„ä¸»é”®è‡ªå¢ç­–ç•¥</span></span><br><span class="line">    <span class="string">@TableId(type</span> <span class="string">=</span> <span class="string">IdType.ASSIGN_ID)//åˆ†å¸ƒå¼id</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>ShardingSphere-JDBCæ°´å¹³åˆ†ç‰‡</h1>
<ul>
<li>
<p>æ°´å¹³åˆ†åº“:</p>
<ul>
<li>å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸­:<br>
æ°´å¹³åˆ†åº“æ˜¯æŒ‡å°†åŒä¸€ä¸ªæ•°æ®åº“çš„è¡¨ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™ï¼ˆæ¯”å¦‚æ ¹æ®ç”¨æˆ·IDæˆ–åœ°ç†åŒºåŸŸï¼‰åˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“å®ä¾‹ä¸Šã€‚æ¯ä¸ªæ•°æ®åº“å®ä¾‹å­˜å‚¨ç›¸åŒçš„è¡¨ç»“æ„ï¼Œä½†è¡¨ä¸­çš„æ•°æ®ä¸åŒã€‚è¿™æ ·å¯ä»¥å‡å°‘å•ä¸ªæ•°æ®åº“å®ä¾‹çš„å‹åŠ›ï¼Œå¢åŠ ç³»ç»Ÿçš„ååé‡ã€‚</li>
</ul>
</li>
<li>
<p>æ°´å¹³åˆ†è¡¨:</p>
<ul>
<li>ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ä¸­:<br>
æ°´å¹³åˆ†è¡¨æ˜¯æŒ‡å°†åŒä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™åˆ’åˆ†æˆå¤šä¸ªç‰©ç†è¡¨ï¼Œä½†è¿™äº›è¡¨åˆ†å¸ƒåœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œé€»è¾‘ä¸Šä¾ç„¶æ˜¯ä¸€ä¸ªè¡¨ã€‚æ°´å¹³åˆ†è¡¨çš„ç›®çš„æ˜¯å‡å°‘å•è¡¨çš„æ•°æ®é‡ï¼Œé™ä½æ•°æ®åº“æ“ä½œçš„è´Ÿæ‹…ã€‚</li>
</ul>
<h3 id="æ°´å¹³åˆ†åº“é…ç½®æ–‡ä»¶">æ°´å¹³åˆ†åº“é…ç½®æ–‡ä»¶</h3>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ¨¡å¼</span></span><br><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">JDBC</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®æº</span></span><br><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_order_01:</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://192.168.1.129:3340/db_order_01</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">ds_order_02:</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://192.168.1.129:3341/db_order_01</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_order:</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_order_0$&#123;1..2&#125;.t_order_01</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">userid_inline</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span></span><br><span class="line">      <span class="attr">userid_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_order_0$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">+1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sql è¯­å¥è¾“å‡º</span></span><br><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="æ°´å¹³åˆ†è¡¨é…ç½®æ–‡ä»¶">æ°´å¹³åˆ†è¡¨é…ç½®æ–‡ä»¶</h3>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line">  <span class="comment">#æ¨¡å¼</span></span><br><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">JDBC</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®æº</span></span><br><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_order_01:</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://192.168.1.129:3340/db_order_01</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">ds_order_02:</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://192.168.1.129:3341/db_order_01</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_order:</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_order_0$&#123;1..2&#125;.t_order_0$&#123;1..2&#125;</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span>    <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">userid_inline</span></span><br><span class="line">        <span class="attr">tableStrategy:</span>       <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">orderid_inline</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span></span><br><span class="line">      <span class="attr">orderid_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_order_0$&#123;id</span> <span class="string">%</span> <span class="number">2</span> <span class="string">+</span> <span class="number">1</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">userid_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_order_0$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">+1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sql è¯­å¥è¾“å‡º</span></span><br><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>å¤šè¡¨å…³è”</h1>
<p>åœ¨server-order0ã€server-order1æœåŠ¡å™¨ä¸­åˆ†åˆ«åˆ›å»ºä¸¤å¼ è®¢å•è¯¦æƒ…è¡¨t_order_item0ã€t_order_item1</p>
<p>æˆ‘ä»¬å¸Œæœ›åŒä¸€ä¸ªç”¨æˆ·çš„è®¢å•è¡¨å’Œè®¢å•è¯¦æƒ…è¡¨ä¸­çš„æ•°æ®éƒ½åœ¨åŒä¸€ä¸ªæ•°æ®æºä¸­ï¼Œé¿å…è·¨åº“å…³è”ï¼Œå› æ­¤è¿™ä¸¤å¼ è¡¨æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„åˆ†ç‰‡ç­–ç•¥ã€‚</p>
<p>é‚£ä¹ˆåœ¨t_order_itemä¸­æˆ‘ä»¬ä¹Ÿéœ€è¦åˆ›å»ºorder_idå’Œuser_idè¿™ä¸¤ä¸ªåˆ†ç‰‡é”®</p>
<ul>
<li>å½“ä¸¤ä¸ªè¡¨å­˜åœ¨å…³è”,è¿›è¡Œåˆ†åº“åˆ†è¡¨æ—¶,æœ‰å…³è”çš„æ•°æ®éœ€è¦åœ¨åŒä¸€ä¸ªæ•°æ®åº“çš„è¡¨ä¸­,</li>
<li>å› æ­¤,å½“å¯¹å…¶ä¸­ä¸€ä¸ªè¡¨è¿›è¡Œåˆ†åº“åˆ†è¡¨æ—¶, å¦å¤–ä¸€ä¸ªè¡¨ä¹Ÿéœ€è¦æœ‰ç›¸åŒçš„åˆ†åº“åˆ†è¡¨åˆ—,ä¸”æœ‰ç›¸åŒçš„åˆ†åº“åˆ†è¡¨ç­–ç•¥</li>
</ul>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Spring Boot é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„æ–¹æ³•</title>
    <url>/2025/09/15/Spring%20Boot%20%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8%E6%97%B6%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8C%E7%9A%84%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="Spring-Boot-é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„æ–¹æ³•">Spring Boot é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„æ–¹æ³•</h2>
<p>åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œæœ‰æ—¶éœ€è¦åœ¨é¡¹ç›®å¯åŠ¨æ—¶æ‰§è¡Œç‰¹å®šçš„æ–¹æ³•ï¼Œæ¯”å¦‚æå‰åŠ è½½æ•°æ®åˆ°ç¼“å­˜ã€æ£€æŸ¥è¿è¡Œç¯å¢ƒã€æ£€æŸ¥æˆæƒä¿¡æ¯ç­‰ã€‚ä»¥ä¸‹æ˜¯å…«ç§å®ç°æ–¹å¼ï¼ŒæŒ‰ç…§æ‰§è¡Œé¡ºåºä»‹ç»ã€‚</p>
<h3 id="1-å®ç°-ServletContextListener-æ¥å£">1. å®ç° ServletContextListener æ¥å£</h3>
<p>é€šè¿‡å®ç° <code>ServletContextListener</code> æ¥å£çš„ <code>contextInitialized</code> æ–¹æ³•ï¼Œå¯ä»¥åœ¨ Web åº”ç”¨ç¨‹åºåˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletContextListenerImpl</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ é™æ€ä»£ç å—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ ServletContextListener çš„ contextInitialized æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-é™æ€ä»£ç å—æ–¹å¼">2. é™æ€ä»£ç å—æ–¹å¼</h3>
<p>å°†è¦æ‰§è¡Œçš„æ–¹æ³•æ‰€åœ¨çš„ç±»äº¤ç»™ Spring å®¹å™¨æ‰«æï¼Œå¹¶åœ¨ç±»ä¸­æ·»åŠ é™æ€ä»£ç å—ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticBlockTest</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ é™æ€ä»£ç å—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-PostConstruct-æ³¨è§£æ–¹å¼">3. @PostConstruct æ³¨è§£æ–¹å¼</h3>
<p>ä½¿ç”¨ <code>@PostConstruct</code> æ³¨è§£ï¼Œå¯ä»¥åœ¨ Spring å®¹å™¨åˆå§‹åŒ–å®Œ Bean åè‡ªåŠ¨æ‰§è¡ŒæŒ‡å®šæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PostConstructTest</span> &#123;</span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postConstruct</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ @PostConstruct æ³¨è§£æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-å®ç°-ServletContextAware-æ¥å£">4. å®ç° ServletContextAware æ¥å£</h3>
<p>é€šè¿‡å®ç° <code>ServletContextAware</code> æ¥å£çš„ <code>setServletContext</code> æ–¹æ³•ï¼Œåœ¨æ™®é€š Bean å±æ€§å¡«å……åä½†åœ¨åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.ServletContextAware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletContextAwareImpl</span> <span class="keyword">implements</span> <span class="title class_">ServletContextAware</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setServletContext</span><span class="params">(ServletContext servletContext)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ ServletContextAware çš„ setServletContext æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-EventListener-æ–¹å¼">5. @EventListener æ–¹å¼</h3>
<p>é€šè¿‡ <code>@EventListener</code> æ³¨è§£ï¼Œç›‘å¬åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡åˆ·æ–°äº‹ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.ContextRefreshedEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.EventListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventListenerTest</span> &#123;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ContextRefreshedEvent event)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ @EventListener æ³¨è§£æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-å®ç°-ApplicationRunner-æ¥å£">6. å®ç° ApplicationRunner æ¥å£</h3>
<p>å®ç° <code>ApplicationRunner</code> æ¥å£çš„ <code>run</code> æ–¹æ³•ï¼Œå¯ä»¥åœ¨ Spring Boot åº”ç”¨å¯åŠ¨åæ‰§è¡Œç‰¹å®šé€»è¾‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationArguments;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationRunnerImpl</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ ApplicationRunner çš„ run æ–¹æ³•&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; optionNames = args.getOptionNames();</span><br><span class="line">        <span class="keyword">for</span> (String optionName : optionNames) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;è¿™æ˜¯ä¼ è¿‡æ¥çš„å‚æ•°[&#123;&#125;]&quot;</span>, optionName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-å®ç°-CommandLineRunner-æ¥å£">7. å®ç° CommandLineRunner æ¥å£</h3>
<p>å®ç° <code>CommandLineRunner</code> æ¥å£çš„ <code>run</code> æ–¹æ³•ï¼Œå¯ä»¥åœ¨åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œå‘½ä»¤è¡Œå‚æ•°çš„å¤„ç†é€»è¾‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandLineRunnerImpl</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ CommandLineRunner çš„ run æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-å®ç°-SpringApplicationListener-æ¥å£">8. å®ç° SpringApplicationListener æ¥å£</h3>
<p>é€šè¿‡å®ç° <code>ApplicationListener</code> æ¥å£ï¼Œä½ å¯ä»¥ç›‘å¬ç‰¹å®šçš„äº‹ä»¶ï¼Œå¦‚ <code>ApplicationEnvironmentPreparedEvent</code>ã€‚åœ¨ Spring Boot ä¸­ï¼Œé€šå¸¸åœ¨ <code>META-INF/spring.factories</code> æ–‡ä»¶ä¸­é…ç½®ç›‘å¬å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.event.ApplicationEnvironmentPreparedEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationListener;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringApplicationListenerImpl</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;ApplicationEnvironmentPreparedEvent&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ApplicationEnvironmentPreparedEvent event)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ SpringApplicationListener çš„ onApplicationEvent æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="META-INF-spring-factories-é…ç½®"><code>META-INF/spring.factories</code> é…ç½®</h3>
<p>åœ¨ <code>src/main/resources/META-INF/spring.factories</code> æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.springframework.context.ApplicationListener=\</span><br><span class="line">com.example.SpringApplicationListenerImpl</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œé¡ºåº">æ‰§è¡Œé¡ºåº</h3>
<p>ä»¥ä¸Šå‡ ç§æ–¹æ³•çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p>
<ol>
<li>é™æ€ä»£ç å—</li>
<li>ServletContextListener çš„ contextInitialized</li>
<li>ServletContextAware çš„ setServletContext</li>
<li>@PostConstruct æ³¨è§£çš„æ–¹æ³•</li>
<li>@EventListener ç›‘å¬çš„äº‹ä»¶</li>
<li>SpringApplicationListener çš„ onApplicationEvent æ–¹æ³•</li>
<li>ApplicationRunner çš„ run æ–¹æ³•</li>
<li>CommandLineRunner çš„ run æ–¹æ³•</li>
</ol>
<h3 id="æ‰§è¡Œé˜¶æ®µè¯´æ˜">æ‰§è¡Œé˜¶æ®µè¯´æ˜</h3>
<ul>
<li>
<p><strong>é™æ€ä»£ç å—</strong></p>
<ul>
<li><strong>é˜¶æ®µ</strong>ï¼šç±»åŠ è½½é˜¶æ®µ</li>
<li><strong>è¯´æ˜</strong>ï¼šåœ¨ç±»è¢«åŠ è½½åˆ° JVM ä¸­æ—¶ï¼Œé™æ€ä»£ç å—ä¼šè¢«æ‰§è¡Œï¼Œé€‚ç”¨äºä¸€äº›åˆå§‹åŒ–é€»è¾‘ã€‚</li>
</ul>
</li>
<li>
<p><strong>ServletContextListener çš„ contextInitialized æ–¹æ³•</strong></p>
<ul>
<li><strong>é˜¶æ®µ</strong>ï¼šWeb åº”ç”¨åˆå§‹åŒ–é˜¶æ®µ</li>
<li><strong>è¯´æ˜</strong>ï¼šåœ¨åˆå§‹åŒ– Web åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•è¿‡æ»¤å™¨æˆ– Servlet ä¹‹å‰ï¼Œ<code>contextInitialized</code> æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>ServletContextAware çš„ setServletContext æ–¹æ³•</strong></p>
<ul>
<li><strong>é˜¶æ®µ</strong>ï¼šBean å±æ€§å¡«å……å</li>
<li><strong>è¯´æ˜</strong>ï¼šåœ¨å¡«å……æ™®é€š Bean å±æ€§ä¹‹åï¼Œä½†åœ¨åˆå§‹åŒ–ä¹‹å‰ï¼Œ<code>setServletContext</code> æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>@PostConstruct æ³¨è§£çš„æ–¹æ³•</strong></p>
<ul>
<li><strong>é˜¶æ®µ</strong>ï¼šBean åˆå§‹åŒ–é˜¶æ®µ</li>
<li><strong>è¯´æ˜</strong>ï¼šåœ¨ Bean å®Œæˆå±æ€§å¡«å……åï¼Œ<code>@PostConstruct</code> æ³¨è§£çš„æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œä»»ä½•å¿…è¦çš„åˆå§‹åŒ–é€»è¾‘ã€‚</li>
</ul>
</li>
<li>
<p><strong>@EventListener ç›‘å¬çš„ ContextRefreshedEvent äº‹ä»¶</strong></p>
<ul>
<li><strong>é˜¶æ®µ</strong>ï¼šåº”ç”¨ä¸Šä¸‹æ–‡åˆ·æ–°é˜¶æ®µ</li>
<li><strong>è¯´æ˜</strong>ï¼šåœ¨åº”ç”¨ä¸Šä¸‹æ–‡è¢«åˆ·æ–°æ—¶ï¼Œæ ‡è¯†åº”ç”¨å·²å®Œå…¨åˆå§‹åŒ–ï¼Œæ­¤æ—¶ <code>@EventListener</code> æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>SpringApplicationListener çš„ onApplicationEvent æ–¹æ³•</strong></p>
<ul>
<li><strong>é˜¶æ®µ</strong>ï¼šç¯å¢ƒå‡†å¤‡é˜¶æ®µ</li>
<li><strong>è¯´æ˜</strong>ï¼šåœ¨åº”ç”¨ç¨‹åºç¯å¢ƒå‡†å¤‡é˜¶æ®µï¼Œå¯ä»¥ç”¨äºæ‰§è¡Œä¸ç¯å¢ƒç›¸å…³çš„åˆå§‹åŒ–é€»è¾‘ã€‚</li>
</ul>
</li>
<li>
<p><strong>ApplicationRunner çš„ run æ–¹æ³•</strong></p>
<ul>
<li><strong>é˜¶æ®µ</strong>ï¼šåº”ç”¨å¯åŠ¨å</li>
<li><strong>è¯´æ˜</strong>ï¼šåœ¨ Spring Boot åº”ç”¨å¯åŠ¨å¹¶å®Œæˆåˆå§‹åŒ–åï¼Œ<code>run</code> æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œé€‚åˆæ‰§è¡Œä¸åº”ç”¨å‚æ•°ç›¸å…³çš„é€»è¾‘ã€‚</li>
</ul>
</li>
<li>
<p><strong>CommandLineRunner çš„ run æ–¹æ³•</strong></p>
<ul>
<li><strong>é˜¶æ®µ</strong>ï¼šåº”ç”¨å¯åŠ¨å</li>
<li><strong>è¯´æ˜</strong>ï¼šä¸ <code>ApplicationRunner</code> ç±»ä¼¼ï¼Œ<code>run</code> æ–¹æ³•ä¼šåœ¨åº”ç”¨å¯åŠ¨åè¢«è°ƒç”¨ï¼Œé€šå¸¸ç”¨äºå¤„ç†å‘½ä»¤è¡Œå‚æ•°ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h2 id="å¯ä»¥æ³¨å…¥Beançš„æ–¹æ³•">å¯ä»¥æ³¨å…¥Beançš„æ–¹æ³•</h2>
<p>@PostConstruct æ³¨è§£æ–¹å¼ï¼šåœ¨ @PostConstruct æ³¨è§£çš„æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥æ³¨å…¥å…¶ä»– Beanï¼Œå¹¶åœ¨è¯¥æ–¹æ³•ä¸­è®¿é—®å®ƒä»¬ã€‚</p>
<p>å®ç° ServletContextAware æ¥å£ï¼šé€šè¿‡å®ç° ServletContextAware æ¥å£ï¼Œä½ å¯ä»¥è·å–åˆ° ServletContextï¼Œå¹¶åœ¨ setServletContext æ–¹æ³•ä¸­ä½¿ç”¨å…¶ä»– Beanï¼ˆéœ€è¦é€šè¿‡ä¾èµ–æ³¨å…¥ï¼‰ã€‚</p>
<p>@EventListener æ–¹å¼ï¼šåœ¨è¢« @EventListener æ³¨è§£çš„æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥æ³¨å…¥å…¶ä»– Beanã€‚</p>
<p>å®ç° ApplicationRunner æ¥å£ï¼šåœ¨ ApplicationRunner çš„ run æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥æ³¨å…¥å…¶ä»– Beanï¼Œå¹¶åœ¨è¯¥æ–¹æ³•ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>å®ç° CommandLineRunner æ¥å£ï¼šåŒæ ·åœ°ï¼Œåœ¨ CommandLineRunner çš„ run æ–¹æ³•ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥æ³¨å…¥å…¶ä»– Beanã€‚</p>
<p>ä¸èƒ½è·å–åˆ° Bean çš„æ–¹æ³•ï¼š</p>
<p>ServletContextListener çš„ contextInitialized æ–¹æ³•ï¼šå› ä¸ºåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä½ é€šå¸¸ä¸èƒ½ç›´æ¥æ³¨å…¥ Spring ç®¡ç†çš„ Beanï¼Œé™¤éé€šè¿‡å…¶ä»–æ–¹å¼è·å–åˆ° ApplicationContextã€‚<br>
é™æ€ä»£ç å—æ–¹å¼ï¼šé™æ€ä»£ç å—æ˜¯åœ¨ç±»åŠ è½½é˜¶æ®µæ‰§è¡Œçš„ï¼Œæ— æ³•ç›´æ¥è®¿é—® Spring å®¹å™¨ä¸­çš„ Beanã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Spring Clould</title>
    <url>/2025/09/15/Spring%20Clould/</url>
    <content><![CDATA[<h1>ç³»ç»Ÿæ¶æ„æ¼”è¿›</h1>
<h2 id="å•ä½“æ¶æ„">å•ä½“æ¶æ„</h2>
<p><strong>å•ä½“æ¶æ„å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</strong></p>
<p>1ã€ç®€å•ï¼šå•ä½“æ¶æ„æ¨¡å¼ç›¸å¯¹äºå…¶ä»–å¤æ‚çš„æ¶æ„æ¥è¯´ï¼Œå…¶ç»“æ„ç®€å•æ˜“ç”¨ï¼Œä¾¿äºæ–°æ‰‹å­¦ä¹ å’Œåº”ç”¨ã€‚</p>
<p>2ã€æ˜“äºç»´æŠ¤ï¼šç”±äºæ•´ä¸ªåº”ç”¨ç¨‹åºéƒ½åœ¨ä¸€ä¸ªä»£ç åº“ä¸­ï¼Œå› æ­¤å¾ˆå®¹æ˜“å¯¹å…¶è¿›è¡Œç»´æŠ¤å’Œæ›´æ–°ã€‚</p>
<p>3ã€æ˜“äºéƒ¨ç½²ï¼šå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥åœ¨ä»»ä½•æ”¯æŒè¿è¡Œè¯¥è¯­è¨€çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶ä¸”éƒ¨ç½²ä¹Ÿç›¸å¯¹è½»æ¾ã€‚</p>
<p><strong>ç„¶è€Œï¼Œå•ä½“æ¶æ„ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼š</strong></p>
<p>1ã€æ‰©å±•æ€§å·®ï¼šå•ä½“åº”ç”¨ç¨‹åºæ‰€æœ‰åŠŸèƒ½éƒ½åœ¨ä¸€ä¸ªç¨‹åºä¸­å®ç°ï¼Œå› æ­¤æ‰©å±•åŠŸèƒ½æ—¶éœ€è¦æ–°å¢æˆ–ä¿®æ”¹æºä»£ç ï¼Œå¹¶é‡æ–°éƒ¨ç½²æ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šå’Œé•¿æ—¶é—´åœæœºã€‚</p>
<p>2ã€å¯é æ€§ä½ï¼šç”±äºå•ä½“åº”ç”¨ç¨‹åºé›†æˆäº†æ‰€æœ‰çš„é€»è¾‘å’Œç»„ä»¶ï¼Œå› æ­¤å¦‚æœå…¶ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç»„ä»¶å‡ºç°æ•…éšœï¼Œåˆ™å¯èƒ½å¯¼è‡´ä»æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚</p>
<p>3ã€é£é™©é«˜ï¼šå•ä½“åº”ç”¨ç¨‹åºä¸­çš„é”™è¯¯å¾€å¾€æ¯”è¾ƒéš¾ä»¥è°ƒè¯•ï¼Œå› ä¸ºä»£ç å¤æ‚åº¦é«˜ä¸”è€¦åˆåº¦å¼ºã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œå•ä½“æ¶æ„é€‚ç”¨äºå°å‹ã€ç®€å•çš„è½¯ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯å¯¹äºå¤§å‹ã€å¤æ‚çš„ç³»ç»Ÿæ¥è¯´ï¼Œå•ä½“æ¶æ„é¢ä¸´è¯¸å¤šæŒ‘æˆ˜ï¼Œéœ€è¦é‡‡ç”¨å…¶ä»–æ›´åŠ çµæ´»å’Œå¯æ‰©å±•çš„æ¶æ„æ¨¡å¼ã€‚</p>
<h2 id="åˆ†å¸ƒå¼æ¶æ„">åˆ†å¸ƒå¼æ¶æ„</h2>
<p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„</strong>æ˜¯æŒ‡å°†ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿåˆ†å‰²æˆå¤šä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œå¹¶ä¸”è¿™äº›æœåŠ¡å¯ä»¥åœ¨ä¸åŒçš„è®¡ç®—æœºæˆ–æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå¹¶é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚</p>
<p><strong>å¾®æœåŠ¡ç³»ç»Ÿæ¶æ„</strong>ï¼šæœ¬è´¨ä¸Šä¹Ÿå±äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ï¼Œåœ¨å¾®æœåŠ¡ç³»ç»Ÿæ¶æ„ä¸­ï¼Œæ›´åŠ é‡è§†çš„æ˜¯æœåŠ¡æ‹†åˆ†ç²’åº¦ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/534159a0f89449029e583af24ccbe402.png" alt="image.png"></p>
<h3 id="å¾®æœåŠ¡æ¶æ„çš„ç‰¹ç‚¹ï¼š">å¾®æœåŠ¡æ¶æ„çš„ç‰¹ç‚¹ï¼š</h3>
<p>1ã€å•ä¸€èŒè´£ï¼šå¾®æœåŠ¡æ‹†åˆ†ç²’åº¦æ›´å°ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½å¯¹åº”å”¯ä¸€çš„ä¸šåŠ¡èƒ½åŠ›ï¼Œåšåˆ°å•ä¸€èŒè´£</p>
<p>2ã€è‡ªæ²»ï¼šå›¢é˜Ÿç‹¬ç«‹ã€æŠ€æœ¯ç‹¬ç«‹ã€æ•°æ®ç‹¬ç«‹ï¼Œç‹¬ç«‹éƒ¨ç½²å’Œäº¤ä»˜</p>
<p>3ã€é¢å‘æœåŠ¡ï¼šæœåŠ¡æä¾›ç»Ÿä¸€æ ‡å‡†çš„æ¥å£ï¼Œä¸è¯­è¨€å’ŒæŠ€æœ¯æ— å…³</p>
<h4 id="å¾®æœåŠ¡ï¼š">å¾®æœåŠ¡ï¼š</h4>
<p>1.æ¯ä¸ªå¾®æœåŠ¡è´Ÿè½½ä¸€é¡¹ä¸šåŠ¡ã€ç‹¬ç«‹ç«¯å£å·ã€è¿›ç¨‹id(pid):æœåŠ¡çš„ä¸“ä¸šåŒ–ã€ç²¾ç»†åŒ–ç®¡ç†</p>
<p>2.æ¯ä¸ªå¾®æœåŠ¡è¯­è¨€ç‹¬ç«‹ã€æŠ€æœ¯ç‹¬ç«‹ã€æ•°æ®ç‹¬ç«‹</p>
<p><strong>å¾®æœåŠ¡ç³»ç»Ÿæ¶æ„çš„ä¼˜ç‚¹ï¼š</strong></p>
<p>1ã€å¯æ‰©å±•æ€§å¥½ï¼šç”±äºç³»ç»Ÿä¸­çš„ä¸åŒç»„ä»¶å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œæ‰©å±•å’Œå‡çº§ï¼Œä»è€Œæé«˜äº†æ•´ä¸ªç³»ç»Ÿçš„æ‰©å±•æ€§å’Œå¯é æ€§ã€‚</p>
<p>2ã€å®¹é”™æ€§é«˜ï¼šç”±äºç³»ç»Ÿä¸­çš„ç»„ä»¶å¯ä»¥åœ¨ä¸åŒçš„è®¡ç®—æœºæˆ–æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå› æ­¤å³ä½¿æŸäº›èŠ‚ç‚¹å‡ºç°æ•…éšœä¹Ÿä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œã€‚</p>
<p>3ã€é«˜æ•ˆæ€§å¼ºï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥å°†è´Ÿè½½å’Œä»»åŠ¡åˆ†é…åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›å’Œå¤„ç†é€Ÿåº¦ã€‚</p>
<p>4ã€çµæ´»æ€§å¼ºï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å’Œåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå¹¶ä¸”å¯ä»¥åˆ©ç”¨å„ç§äº‘è®¡ç®—æŠ€æœ¯ï¼Œå¦‚Dockerã€Kubernetesç­‰ã€‚</p>
<p><strong>å¾®æœåŠ¡ç³»ç»Ÿæ¶æ„çš„å­˜åœ¨çš„é—®é¢˜ï¼š</strong></p>
<p>1ã€å¾®æœåŠ¡çš„ç®¡ç†ï¼šè¿™äº›å¾®æœåŠ¡å¦‚æœæ²¡æœ‰è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ï¼Œé‚£ä¹ˆç»´æŠ¤æ€§å°±ä¼šæå·®ã€‚</p>
<p>2ã€æœåŠ¡é—´çš„é€šè®¯ï¼šå¾®æœåŠ¡ä¹‹é—´è‚¯å®šæ˜¯éœ€è¦è¿›è¡Œé€šè®¯ï¼Œæ¯”å¦‚è´­ç‰©è½¦å¾®æœåŠ¡éœ€è¦è®¿é—®å•†å“å¾®æœåŠ¡ã€‚</p>
<p>3ã€å‰ç«¯è®¿é—®é—®é¢˜ï¼šç”±äºæ¯ä¸€ä¸ªå¾®æœåŠ¡éƒ½æ˜¯éƒ¨ç½²åœ¨ç‹¬ç«‹çš„ä¸€å°æœåŠ¡å™¨çš„ï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡éƒ½å­˜åœ¨ä¸€ä¸ªå¯¹åº”çš„ç«¯å£å·ï¼Œå‰ç«¯åœ¨è®¿é—®æŒ‡å®šå¾®æœåŠ¡çš„æ—¶å€™è‚¯å®šéœ€è¦æŒ‡å®šå¾®æœåŠ¡çš„ipåœ°å€å’Œç«¯å£å·ï¼Œéš¾é“éœ€è¦åœ¨å‰ç«¯ç»´æŠ¤æ¯ä¸€ä¸ªå¾®æœåŠ¡çš„ipåœ°å€å’Œç«¯å£å·?</p>
<p>4ã€é…ç½®æ–‡ä»¶ç®¡ç†ï¼šå½“æ„å»ºæœåŠ¡é›†ç¾¤çš„æ—¶å€™ï¼Œå¦‚æœæ¯ä¸€ä¸ªå¾®æœåŠ¡çš„é…ç½®æ–‡ä»¶è¿˜æ˜¯å’Œå¾®æœåŠ¡è¿›è¡Œç»‘å®šï¼Œé‚£ä¹ˆç»´æŠ¤æ€§å°±æå·®ã€‚</p>
<p>5ã€å¾®æœåŠ¡çš„æ•…éšœæ’æŸ¥ã€è°ƒç”¨é“¾è·¯ï¼šå¾®æœåŠ¡è¿½è¸ªæŠ€æœ¯</p>
<h2 id="åˆ†å¸ƒå¼å’Œé›†ç¾¤">åˆ†å¸ƒå¼å’Œé›†ç¾¤</h2>
<p>åˆ†å¸ƒå¼ï¼šç”±å¤šå°æœåŠ¡å™¨æ„æˆçš„ç½‘ç»œç¯å¢ƒï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ¯ä¸€å°æœåŠ¡å™¨çš„åŠŸèƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>é›†ç¾¤ï¼š   ç”±å¤šå°æœåŠ¡å™¨æ„æˆçš„ç½‘ç»œç¯å¢ƒï¼Œåœ¨é›†ç¾¤ç¯å¢ƒä¸‹æ¯ä¸€å°æœåŠ¡å™¨çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>åˆ†å¸ƒå¼ç¯å¢ƒä¸­æ¯ä¸€å°æœåŠ¡å™¨éƒ½å¯ä»¥åšé›†ç¾¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/f6fb573ca2a8430e938436ff026345c7.png" alt="image.png"></p>
<p>å®é™…å¼€å‘ä¸­ï¼šåˆ†å¸ƒå¼+é›†ç¾¤</p>
<p>â€‹                        å¾®æœåŠ¡+é›†ç¾¤</p>
<p>é’ˆå¯¹ä¸Šè¿°å¾®æœåŠ¡æ¶æ„æ²»ç†çš„é—®é¢˜ï¼Œæœ‰ä¸€å¥—å¾®æœåŠ¡æ²»ç†è§„èŒƒï¼é’ˆå¯¹å¾®æœåŠ¡æ²»ç†è§„èŒƒï¼Œæœ‰å¥½å¤šç§å®ç°ã€‚æœ€è‘—åçš„ä¸¤ç§å®ç°ï¼š</p>
<p>SpringCloud Netflix(SCN): OpenFeignã€LoadBalancerã€Gateway</p>
<p>SpringCloudAlibaba(SCA): Nacosã€sentinel</p>
<p>å¾®æœåŠ¡æŠ€æœ¯æ ˆï¼šå¾®æœåŠ¡ç›¸å…³æŠ€æœ¯çš„ç»Ÿç§°</p>
<p>â€‹    å¾®æœåŠ¡å¼€å‘æŠ€æœ¯ï¼šSpringBoot</p>
<p>â€‹    å¾®æœåŠ¡æ²»ç†ã€ä¿æŠ¤æŠ€æœ¯: SCN+SCA: SpringCloudåº•å±‚â€“&gt;-SpringBoot3.xâ€”&gt;Spring6.xï¼ˆSpringMVCï¼‰â€”&gt;JDK17</p>
<p>â€‹    å¾®æœåŠ¡éƒ¨ç½²æŠ€æœ¯:Docker+K8s</p>
<h1>Spring Cloud Alibaba æ¦‚è¿°</h1>
<h2 id="Spring-Cloud-ç®€ä»‹">Spring Cloud ç®€ä»‹</h2>
<p>1ã€Spring Cloud æ˜¯ä¸€ç³»åˆ—<strong>æ¡†æ¶</strong>çš„æœ‰åº<strong>é›†åˆ</strong>ã€‚åœ¨Spring Cloudè¿™ä¸ªé¡¹ç›®ä¸­åŒ…å«äº†å¾ˆå¤šçš„ç»„ä»¶ã€å­æ¡†æ¶ã€‘ï¼Œæ¯ä¸€ä¸ªç»„ä»¶éƒ½æ˜¯ç”¨æ¥è§£å†³é—®é¢˜ç³»ç»Ÿæ¶æ„ä¸­æ‰€é‡åˆ°çš„é—®é¢˜ï¼Œå› æ­¤Spring Cloudå¯ä»¥çœ‹åšæ˜¯ä¸€å¥—å¾®æœåŠ¡çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>2ã€Spring Cloudä¸­å¸¸è§çš„ç»„ä»¶ï¼šEureka(æœåŠ¡æ³¨å†Œä¸­å¿ƒ)ã€Openfeign(æœåŠ¡è¿œç¨‹è°ƒç”¨)ã€Gateway(æœåŠ¡ç½‘å…³)ã€Spring Cloud Config(ç»Ÿä¸€é…ç½®ä¸­å¿ƒ)ç­‰ã€‚</p>
<p>3ã€Spring Cloudé¡¹ç›®å®˜æ–¹ç½‘å€ï¼š<a href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a></p>
<p>4ã€Spring Cloudä¾èµ–äºSpring Bootï¼Œå¹¶ä¸”æœ‰ç‰ˆæœ¬çš„å…¼å®¹å…³ç³»</p>
<h2 id="Spring-Cloud-Alibabaç®€ä»‹">Spring Cloud Alibabaç®€ä»‹</h2>
<p>Spring Cloud Alibabaæ˜¯é˜¿é‡Œé’ˆå¯¹å¾®æœåŠ¡ç³»ç»Ÿæ¶æ„æ‰€å­˜åœ¨çš„é—®é¢˜ç»™å‡ºäº†ä¸€å¥—è§£å†³æ–¹æ¡ˆï¼Œè¯¥é¡¹ç›®åŒ…å«äº†å¾®æœåŠ¡ç³»ç»Ÿæ¶æ„å¿…é¡»çš„ä¸€äº›ç»„ä»¶ã€‚</p>
<p>å¸¸è§çš„ç»„ä»¶å¯ä»¥å‚çœ‹å®˜ç½‘åœ°å€ï¼š<a href="https://spring-cloud-alibaba-group.github.io/github-pages/2021/en-us/index.html">https://spring-cloud-alibaba-group.github.io/github-pages/2021/en-us/index.html</a></p>
<p>æ³¨æ„ï¼š</p>
<p>1ã€Spring Cloud Alibabaä¸­æ‰€æä¾›çš„ç»„ä»¶æ˜¯éµå¾ªSpring Cloudè§„èŒƒçš„ï¼Œä¸¤å¥—æŠ€æœ¯æ‰€æä¾›çš„ç»„ä»¶æ˜¯å¯ä»¥æ­é…ä½¿ç”¨çš„ã€‚</p>
<p>2ã€åœ¨ç°åœ¨ä¼ä¸šå¼€å‘ä¸­å¾€å¾€æ˜¯ä¸¤å¥—æŠ€æœ¯ç»„ä»¶æ­é…è¿›è¡Œä½¿ç”¨ï¼šNacos(æœåŠ¡æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒ)ã€Openfeign(è¿œç¨‹è°ƒç”¨)ã€LoadBalancer(å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨)ã€Gateway(æœåŠ¡ç½‘å…³)ã€Sentinel(æœåŠ¡ä¿æŠ¤ç»„ä»¶)ç­‰ã€‚</p>
<h1>å¾®æœåŠ¡ç¯å¢ƒå‡†å¤‡</h1>
<h2 id="è¿‡ç¨‹è¯´æ˜">è¿‡ç¨‹è¯´æ˜</h2>
<p>åœ¨åˆ›å»ºå¾®æœåŠ¡å·¥ç¨‹çš„æ—¶å€™éƒ½éœ€è¦å…ˆæä¾›ä¸€ä¸ªçˆ¶å·¥ç¨‹ï¼Œä½¿ç”¨çˆ¶å·¥ç¨‹æ¥ç®¡ç†å¤šä¸ªå¾®æœåŠ¡æ‰€éœ€è¦çš„ä¾èµ–ã€‚æˆ‘ä»¬çš„å¾®æœåŠ¡ç³»ç»Ÿç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/f6641d07bcd14683b3aeaefc40422279.png" alt="image.png"></p>
<h2 id="æœåŠ¡çš„è¿œç¨‹è°ƒç”¨">æœåŠ¡çš„è¿œç¨‹è°ƒç”¨</h2>
<p>éœ€æ±‚ï¼šåœ¨æŸ¥è¯¢è®¢å•æ—¶å€™éœ€è¦å°†è®¢å•æ‰€å±ç”¨æˆ·çš„ä¿¡æ¯ä¹Ÿä¸€å¹¶æŸ¥è¯¢å‡ºæ¥ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/6ef20cee90334495941ae5931f3b2c76.png" alt="image.png"></p>
<h3 id="ä¼ ç»Ÿè°ƒç”¨">ä¼ ç»Ÿè°ƒç”¨</h3>
<p>è¦å®Œæˆä¸Šè¿°çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨orderå¾®æœåŠ¡ä¸­å‘userå¾®æœåŠ¡å‘èµ·ä¸€ä¸ªhttpçš„è¯·æ±‚ï¼Œè°ƒç”¨</p>
<p><a href="http://localhost:10100/api/user/findUserByUserId/%7BuserId%7D%E8%BF%99%E4%B8%AA%E6%8E%A5%E5%8F%A3%E3%80%82">http://localhost:10100/api/user/findUserByUserId/{userId}è¿™ä¸ªæ¥å£ã€‚</a></p>
<h3 id="RestTemplate">RestTemplate</h3>
<p>åœ¨orderå¾®æœåŠ¡çš„Springå®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ª<strong>RestTemplate</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// com.atguigu.spzx.cloud.order.config;</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>() ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span>          <span class="comment">// æ³¨å…¥RestTemplateè¿œç¨‹è°ƒç”¨å·¥å…·</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">findOrderByOrderId</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•æ•°æ®</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findOrderByOrderId(orderId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘èµ·è¿œç¨‹è°ƒç”¨</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(<span class="string">&quot;http://localhost:10100/api/user/findUserByUserId/&quot;</span> + order.getUserId(), User.class);</span><br><span class="line">        order.setUser(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›è®¢å•æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é—®é¢˜è¯´æ˜">é—®é¢˜è¯´æ˜</h3>
<p>1ã€ç»´æŠ¤æ€§å·®ï¼šæœåŠ¡æä¾›æ–¹çš„ipåœ°å€å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆæ­¤æ—¶æœåŠ¡çš„æ¶ˆè´¹æ–¹å°±éœ€è¦æ›´æ”¹ä»£ç </p>
<p>2ã€ç¼ºå°‘è´Ÿè½½å‡è¡¡æœºåˆ¶ï¼šè´Ÿè½½å‡è¡¡å°±æ˜¯è´Ÿè½½ã€è¯·æ±‚ã€‘é€šè¿‡å¤šå°æœåŠ¡å™¨è¿›è¡Œå¤„ç†</p>
<h1>Nacosæ³¨å†Œä¸­å¿ƒ</h1>
<h2 id="æ³¨å†Œä¸­å¿ƒç®€ä»‹">æ³¨å†Œä¸­å¿ƒç®€ä»‹</h2>
<p>é€šè¿‡æ³¨å†Œä¸­å¿ƒå¯ä»¥å¯¹æœåŠ¡æä¾›æ–¹å’ŒæœåŠ¡æ¶ˆè´¹æ–¹è¿›è¡Œè§£è€¦ã€‚å…·ä½“çš„å·¥ä½œæ¨¡å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/27ff36fe1ab94d5c800c7ecc0ebabe13.png" alt="image.png"></p>
<p>å·¥ä½œæµç¨‹è¯´æ˜ï¼š</p>
<p>1ã€æœåŠ¡æä¾›æ–¹åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æœåŠ¡çš„è¯¦æƒ…ä¿¡æ¯(ipã€ç«¯å£å·ç­‰)ã€‚åœ¨æ³¨å†Œä¸­å¿ƒä¸­ä¼šç»´æŠ¤ä¸€å¼ æœåŠ¡æ¸…å•ï¼Œä¿å­˜è¿™äº›æ³¨å†Œä¿¡æ¯ï¼Œæ³¨å†Œä¸­å¿ƒéœ€è¦ä»¥å¿ƒè·³çš„æ–¹å¼å»ç›‘æµ‹æ¸…å•ä¸­çš„æœåŠ¡æ˜¯å¦å¯ç”¨ï¼Œå¦‚æœä¸å¯ç”¨ï¼Œéœ€è¦åœ¨æœåŠ¡æ¸…å•ä¸­å‰”é™¤ä¸å¯ç”¨çš„æœåŠ¡ã€‚</p>
<p>2ã€æœåŠ¡æ¶ˆè´¹æ–¹å‘æœåŠ¡æ³¨å†Œä¸­å¿ƒå’¨è¯¢æœåŠ¡ï¼Œå¹¶è·å–æ‰€æœ‰æœåŠ¡çš„å®ä¾‹æ¸…å•ï¼Œç„¶åæŒ‰ç…§æŒ‡å®šçš„è´Ÿè½½å‡è¡¡ç®—æ³•ä»æœåŠ¡æ¸…å•ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹è¿›è¡Œè®¿é—®ã€‚</p>
<h2 id="Nacos">Nacos</h2>
<p>Nacosæ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/6c0a39c5bc464d3bbf8744e8e0e70035.png" alt="image.png"></p>
<ol>
<li>
<p>Nacos Serverï¼šæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå®ƒæ˜¯æœåŠ¡ï¼Œå…¶å®ä¾‹åŠå…ƒæ•°æ®çš„æ•°æ®åº“ã€‚æœåŠ¡å®ä¾‹åœ¨å¯åŠ¨æ—¶æ³¨å†Œåˆ°æœåŠ¡æ³¨å†Œè¡¨ï¼Œå¹¶åœ¨å…³é—­æ—¶æ³¨é”€ã€‚æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯èƒ½ä¼šè°ƒç”¨æœåŠ¡å®ä¾‹çš„å¥åº·æ£€æŸ¥ API æ¥éªŒè¯å®ƒæ˜¯å¦èƒ½å¤Ÿå¤„ç†è¯·æ±‚ã€‚Nacos Serveréœ€è¦ç‹¬ç«‹çš„éƒ¨ç½²ã€‚</p>
</li>
<li>
<p>Nacos Client: Nacos Clientè´Ÿè´£å’ŒNacos Serverè¿›è¡Œé€šè®¯å®ŒæˆæœåŠ¡çš„æ³¨å†Œå’ŒæœåŠ¡çš„å‘ç°ã€‚</p>
</li>
<li>
<p>Nacos Consoleï¼šæ˜¯Nacosçš„æ§åˆ¶æ¨¡å—ï¼ŒNacosæä¾›äº†å¯è§†åŒ–çš„åå°ç®¡ç†ç³»ç»Ÿï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„å®ç°æœåŠ¡ç®¡ç†æ“ä½œã€‚</p>
</li>
</ol>
<p><img src="http://120.26.79.238:9000/blog/img/8c0d2c0ab6884cd3a4ced31c0151ae46.png" alt="image.png"></p>
<p>Nacosçš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p>
<p>1ã€é«˜å¯ç”¨æ€§ï¼šNacosæ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œé€šè¿‡é€‰ä¸¾ç®—æ³•å®ç°äº†é«˜å¯ç”¨å’Œæ•…éšœè½¬ç§»èƒ½åŠ›ï¼Œåœ¨èŠ‚ç‚¹å®•æœºæˆ–ç½‘ç»œå¼‚å¸¸æƒ…å†µä¸‹ä»èƒ½ä¿è¯æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€‚</p>
<p>2ã€åŠ¨æ€æ‰©å±•æ€§ï¼šNacoså¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œå¿«é€Ÿæ‰©å±•å’Œç¼©å®¹ï¼Œæ”¯æŒé›†ç¾¤ã€å¤šæ•°æ®ä¸­å¿ƒã€åœ°åŸŸæ„ŸçŸ¥ç­‰ç‰¹æ€§ã€‚</p>
<p>3ã€å®Œå¤‡çš„åŠŸèƒ½æ”¯æŒï¼šNacosæ”¯æŒæœåŠ¡æ³¨å†Œä¸å‘ç°ã€é…ç½®ç®¡ç†ã€æµé‡ç®¡ç†ã€DNSè§£æã€å­˜å‚¨KVå¯¹ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”æä¾›äº†Webç•Œé¢å’ŒRESTful APIç­‰å¤šç§æ–¹å¼æ¥ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚</p>
<p>4ã€æ˜“äºé›†æˆï¼šNacosæä¾›äº†å¤šç§è¯­è¨€å’Œæ¡†æ¶çš„é›†æˆæ–¹æ¡ˆï¼Œå¹¶ä¸”æ”¯æŒSpring Cloudç­‰æµè¡Œçš„å¾®æœåŠ¡æ¡†æ¶ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼ŒNacosæ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨ã€æ˜“äºä½¿ç”¨å’Œé«˜å¯ç”¨çš„åˆ†å¸ƒå¼æœåŠ¡æ²»ç†å¹³å°ï¼Œå¯ä»¥ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›é«˜æ•ˆã€ç¨³å®šçš„è¿è¡Œç¯å¢ƒã€‚</p>
<h2 id="å¾®æœåŠ¡é›†æˆnaocs">å¾®æœåŠ¡é›†æˆnaocs</h2>
<p>éœ€æ±‚ï¼šå°†ä¸¤ä¸ªå¾®æœåŠ¡(userã€order)æ³¨å†Œåˆ°nacosä¸­</p>
<p>å®ç°æ­¥éª¤ï¼š</p>
<p>1ã€åœ¨ä¸¤ä¸ªå­å·¥ç¨‹ä¸­å¼•å…¥å¦‚ä¸‹ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2ã€åœ¨application.ymlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># é…ç½®nacosæ³¨å†Œä¸­å¿ƒçš„åœ°å€</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">spzx-cloud-user</span>   <span class="comment"># æ¯ä¸€ä¸ªæœåŠ¡æ³¨å†Œåˆ°nacosæ³¨å†Œä¸­å¿ƒéƒ½éœ€è¦æä¾›ä¸€ä¸ªæœåŠ¡åç§°,orderå¾®æœåŠ¡æ³¨å†Œçš„æ—¶å€™éœ€è¦æ›´æ”¹å¾®æœåŠ¡åç§°</span></span><br></pre></td></tr></table></figure>
<p>3ã€å¯åŠ¨ä¸¤ä¸ªå¾®æœåŠ¡ï¼šå°±å¯ä»¥åœ¨nacosçš„åå°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œçœ‹åˆ°å¦‚ä¸‹çš„æ³¨å†Œä¿¡æ¯ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/0fb1ecafc81c4aa7b912a71cc33c0a55.png" alt="image.png"></p>
<h2 id="æ›´æ”¹è¿œç¨‹è°ƒç”¨">æ›´æ”¹è¿œç¨‹è°ƒç”¨</h2>
<p>å½“æˆ‘ä»¬æŠŠå¾®æœåŠ¡éƒ½æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä»¥åï¼Œé‚£ä¹ˆæ­¤æ—¶å°±å¯ä»¥æ ¹æ®æœåŠ¡çš„åç§°ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡çš„ipåœ°å€å’Œç«¯å£å·äº†ï¼Œè¿›è€Œå°±å¯ä»¥æ›´æ”¹è¿œç¨‹è°ƒç”¨ä»£ç ï¼</p>
<p>ä½¿ç”¨Spring Cloudä¸­æ‰€æä¾›çš„ä¸€ä¸ªç»„ä»¶ï¼š<strong>spring-cloud-loadbalancer</strong></p>
<p>ä½¿ç”¨æ­¥éª¤ï¼š</p>
<p>1ã€åœ¨orderå¾®æœåŠ¡ä¸­æ·»åŠ ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring cloud æ‰€æä¾›çš„è´Ÿè½½å‡è¡¡å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2ã€åœ¨å£°æ˜RestTemplateçš„æ–¹æ³•ä¸Šæ·»åŠ **@LoadBalanced**æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span>       <span class="comment">// è®©RestTemplateå…·æœ‰è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼šè½®è¯¢</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>() ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3ã€æ›´æ”¹è¿œç¨‹è°ƒç”¨ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡æä¾›æ–¹çš„æœåŠ¡ipåœ°å€å’Œç«¯å£å·å¯ä»¥ä½¿ç”¨æœåŠ¡æä¾›æ–¹çš„æœåŠ¡åç§°è¿›è¡Œæ›¿æ¢</span></span><br><span class="line">restTemplate.getForObject(<span class="string">&quot;http://spzx-cloud-user/api/user/findUserByUserId/&quot;</span> + order.getUserId(), User.class);</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šé»˜è®¤ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡ç®—æ³•å°±æ˜¯è½®è¯¢ã€ä¾æ¬¡è°ƒç”¨å¯¹åº”æœåŠ¡ã€‘</p>
<h2 id="é«˜çº§ç‰¹æ€§">é«˜çº§ç‰¹æ€§</h2>
<h3 id="æœåŠ¡é›†ç¾¤">æœåŠ¡é›†ç¾¤</h3>
<p>ä¸ºäº†ä¿è¯æ¯ä¸€ä¸ªæœåŠ¡çš„é«˜å¯ç”¨ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦å»æ„å»ºæœåŠ¡é›†ç¾¤ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯è¯´æŠŠæ‰€æœ‰çš„æœåŠ¡éƒ½éƒ¨ç½²åœ¨ä¸€ä¸ªæœºæˆ¿é‡Œã€‚è€Œæ˜¯å°†å¤šä¸ªæœåŠ¡åˆ†æ•£çš„éƒ¨ç½²åˆ°ä¸åŒçš„æœºæˆ¿ä¸­ï¼Œæ¯ä¸€ä¸ªæœºæˆ¿çš„æœåŠ¡å¯ä»¥çœ‹åšæˆæ˜¯ä¸€ä¸ªé›†ç¾¤</p>
<p>å¾®æœåŠ¡äº’ç›¸è®¿é—®æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½è®¿é—®åŒé›†ç¾¤å®ä¾‹ï¼Œå› ä¸ºæœ¬åœ°è®¿é—®é€Ÿåº¦æ›´å¿«ã€‚å½“æœ¬é›†ç¾¤å†…ä¸å¯ç”¨æ—¶ï¼Œæ‰è®¿é—®å…¶å®ƒé›†ç¾¤ã€‚ä¾‹å¦‚ï¼šä¸Šæµ·æœºæˆ¿å†…çš„orderå¾®æœåŠ¡åº”è¯¥ä¼˜å…ˆè®¿é—®åŒæœºæˆ¿çš„userå¾®æœåŠ¡ã€‚</p>
<h4 id="é›†ç¾¤é…ç½®">é›†ç¾¤é…ç½®</h4>
<p>æ·»åŠ æ‰€å±é›†ç¾¤å</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">SH</span>		<span class="comment"># é…ç½®æœåŠ¡æ‰€å±é›†ç¾¤</span></span><br></pre></td></tr></table></figure>
<h4 id="é›†ç¾¤è®¿é—®">é›†ç¾¤è®¿é—®</h4>
<p>åœ¨åŒä¸€ä¸ªé›†ç¾¤çš„å¾®æœåŠ¡ï¼Œä¼˜å…ˆè®¿é—®åŒä¸€ä¸ªé›†ç¾¤çš„å¾®æœåŠ¡ï¼Œé™¤ééƒ½ä¸å¯ç”¨</p>
<p>é…ç½®å¾®æœåŠ¡æ‰€å±é›†ç¾¤</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">SH</span>		<span class="comment"># é…ç½®æœåŠ¡æ‰€å±é›†ç¾¤</span></span><br></pre></td></tr></table></figure>
<p>å¼€å¯é›†ç¾¤è®¿é—®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># é…ç½®nacosæ³¨å†Œä¸­å¿ƒçš„åœ°å€</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">loadbalancer:</span></span><br><span class="line">      <span class="attr">nacos:</span>    <span class="comment"># é›†æˆnacosçš„è´Ÿè½½å‡è¡¡ç®—æ³•</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="æƒé‡é…ç½®">æƒé‡é…ç½®</h3>
<p>æƒé‡ä¿®æ”¹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">weight:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœæƒé‡ä¿®æ”¹ä¸º0ï¼Œåˆ™è¯¥å®ä¾‹æ°¸è¿œä¸ä¼šè¢«è®¿é—®</p>
<h2 id="ç¯å¢ƒéš”ç¦»">ç¯å¢ƒéš”ç¦»</h2>
<p>åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå­˜åœ¨å¾ˆå¤šä¸ªè½¯ä»¶ç¯å¢ƒï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒã€‚</p>
<p>nacosä¹Ÿæ˜¯æ”¯æŒå¤šç¯å¢ƒéš”ç¦»é…ç½®çš„ï¼Œåœ¨nacosæ˜¯é€šè¿‡<strong>namespace</strong>æ¥å®ç°å¤šç¯å¢ƒçš„éš”ç¦»ã€‚</p>
<p>å®Œæ•´çš„æœåŠ¡æ³¨å†Œæ•°æ®å­˜å‚¨ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/8ede372313bc42b6b5851905ad770ec9.png" alt="image.png"></p>
<blockquote>
<p>Groupï¼šç»„ï¼Œé€šå¸¸æ¥è¡¨ç¤ºä¸åŒçš„é¡¹ç›®ï¼Œä¸åŒç»„ä¹‹é—´ä¹Ÿå­˜åœ¨éš”ç¦»æ€§çš„</p>
</blockquote>
<h3 id="é…ç½®åç§°ç©ºé—´">é…ç½®åç§°ç©ºé—´</h3>
<ol>
<li>åœ¨nacosé¡µé¢åˆ›å»ºä¸åŒçš„åç§°ç©ºé—´</li>
<li>å¤åˆ¶åç§°ç©ºé—´id</li>
</ol>
<p>ç»™å¾®æœåŠ¡æ·»åŠ åç§°ç©ºé—´çš„é…ç½®ï¼Œæ¥æŒ‡å®šè¯¥å¾®æœåŠ¡æ‰€å±ç¯å¢ƒã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># é…ç½®nacosæ³¨å†Œä¸­å¿ƒçš„åœ°å€</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">4a88035e-acf3-45a9-924f-2421acbff67a</span>  <span class="comment"># é…ç½®æœåŠ¡å®ä¾‹æ‰€å±åç§°ç©ºé—´</span></span><br></pre></td></tr></table></figure>
<p>æœ€ä½³å®è·µï¼š</p>
<p>1.å‘½åç©ºé—´è¡¨ç¤ºä¸åŒçš„ç¯å¢ƒï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒ</p>
<p>2.åŒä¸€ä¸ªé¡¹ç›®åˆ†é…åŒä¸€ä¸ªgroup</p>
<p>3.åŒä¸€ä¸ªåç§°ç©ºé—´ä¸‹çš„åŒä¸€ä¸ªgroupä¸­çš„å¾®æœåŠ¡å¯ä»¥è¿›è¡Œè¿œç¨‹é€šä¿¡ã€‚</p>
<h2 id="å®ä¾‹ç±»å‹">å®ä¾‹ç±»å‹</h2>
<p>Nacosä¸­çš„æœåŠ¡å®ä¾‹å­˜åœ¨ä¸¤ç§ç±»å‹ï¼š</p>
<p>1ã€ä¸´æ—¶å®ä¾‹ï¼šå¦‚æœå®ä¾‹å®•æœºè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œä¼šä»æœåŠ¡åˆ—è¡¨å‰”é™¤ï¼Œå¹¶ä¸”å®ä¾‹ä¼šå®šæ—¶ä¸ŠæŠ¥è‡ªèº«çš„å¥åº·çŠ¶æ€ç»™Nacosæ³¨å†Œä¸­å¿ƒï¼Œé»˜è®¤çš„ç±»å‹ã€‚</p>
<p>2ã€éä¸´æ—¶å®ä¾‹(æ°¸ä¹…å®ä¾‹)ï¼šå¦‚æœå®ä¾‹å®•æœºï¼Œä¸ä¼šä»æœåŠ¡åˆ—è¡¨å‰”é™¤ï¼ŒNacosæ³¨å†Œä¸­å¿ƒä¼šä¸»åŠ¨è¯¢é—®å®ä¾‹çš„å¥åº·çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥å«æ°¸ä¹…å®ä¾‹ã€‚</p>
<p>é…ç½®ä¸€ä¸ªæœåŠ¡å®ä¾‹ä¸ºæ°¸ä¹…å®ä¾‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">ephemeral:</span> <span class="literal">false</span>  <span class="comment"># é…ç½®è¯¥å®ä¾‹ä¸ºéä¸´æ—¶å®ä¾‹</span></span><br></pre></td></tr></table></figure>
<h1>LoadBalancer</h1>
<p>Spring Cloud LoadBalanceræ˜¯Spring Cloudä¸­è´Ÿè´£å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„æ¨¡å—ï¼Œå…¶ä¸»è¦åŸç†æ˜¯é€šè¿‡é€‰æ‹©åˆé€‚çš„æœåŠ¡å®ä¾‹æ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<p>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼šå°±æ˜¯è´Ÿè½½å‡è¡¡ç®—æ³•ç”±å®¢æˆ·ç«¯æä¾›</p>
<p>é»˜è®¤çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šRoundRobinLoadBalancer (è½®è¯¢)</p>
<h2 id="æ›´æ”¹è´Ÿè½½å‡è¡¡ç®—æ³•">æ›´æ”¹è´Ÿè½½å‡è¡¡ç®—æ³•</h2>
<p>1ã€åœ¨Springå®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomLoadBalancerConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> environment: ç”¨äºè·å–ç¯å¢ƒå±æ€§é…ç½®ï¼Œå…¶ä¸­LoadBalancerClientFactory.PROPERTY_NAMEè¡¨ç¤ºè¯¥è´Ÿè½½å‡è¡¡å™¨è¦åº”ç”¨çš„æœåŠ¡åç§°ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loadBalancerClientFactory: æ˜¯Spring Cloudä¸­ç”¨äºåˆ›å»ºè´Ÿè½½å‡è¡¡å™¨çš„å·¥å‚ç±»ï¼Œé€šè¿‡getLazyProvideræ–¹æ³•è·å–ServiceInstanceListSupplierå¯¹è±¡ï¼Œä»¥æä¾›å¯ç”¨çš„æœåŠ¡åˆ—è¡¨ã€‚</span></span><br><span class="line"><span class="comment">     * ServiceInstanceListSupplierï¼šç”¨äºæä¾›ServiceInstanceåˆ—è¡¨çš„æ¥å£ï¼Œå¯ä»¥ä»DiscoveryClientæˆ–è€…å…¶ä»–æ³¨å†Œä¸­å¿ƒä¸­è·å–å¯ç”¨çš„æœåŠ¡å®ä¾‹åˆ—è¡¨ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ReactorLoadBalancer&lt;ServiceInstance&gt; <span class="title function_">randomLoadBalancer</span><span class="params">(Environment environment, LoadBalancerClientFactory loadBalancerClientFactory)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomLoadBalancer</span>(loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2ã€é…ç½®è´Ÿè½½å‡è¡¡ç®—æ³•çš„ä½¿ç”¨è€…</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@LoadBalancerClients(value = &#123;</span></span><br><span class="line"><span class="meta">        @LoadBalancerClient(name = &quot;spzx-cloud-user&quot; , configuration = CustomLoadBalancerConfiguration.class)// å°†è´Ÿè½½å‡è¡¡ç®—æ³•åº”ç”¨åˆ°æŒ‡å®šçš„æœåŠ¡æä¾›æ–¹ä¸­</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span>       <span class="comment">// è®©RestTemplateå…·æœ‰è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>() ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>OpenFeignç»„ä»¶</h1>
<p>æ¦‚è¿°ï¼šfeignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„httpå®¢æˆ·ç«¯ï¼Œå®˜æ–¹åœ°å€ï¼š<a href="https://github.com/OpenFeign/feign%E5%85%B6%E4%BD%9C%E7%94%A8%E5%B0%B1%E6%98%AF%E5%B8%AE%E5%8A%A9%E6%88%91%E4%BB%AC%E4%BC%98%E9%9B%85%E7%9A%84%E5%AE%9E%E7%8E%B0http%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8F%91%E9%80%81%E3%80%82%E6%9B%BF%E6%8D%A2Resttemplate">https://github.com/OpenFeign/feignå…¶ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬ä¼˜é›…çš„å®ç°httpè¯·æ±‚çš„å‘é€ã€‚æ›¿æ¢Resttemplate</a></p>
<p><strong>ä½¿ç”¨OpenFeignè¿œç¨‹è°ƒç”¨çš„å››æ­¥</strong>ï¼š</p>
<p>1.å¯¼å…¥OpenFeignä¾èµ–</p>
<p>2.åœ¨ä¸»å¯åŠ¨ç±»ä¸ŠåŠ @EnableFeignclients,ä¸»è¦ä½œç”¨ï¼šç”¨æ¥æ‰«æ@FeignClient</p>
<p>3.è‡ªå®šä¹‰FeignClientæ¥å£</p>
<p>â€‹      3.1.æ¥å£ä¸Šæ ‡è®°@FeignClient(value=â€œè¢«è°ƒç”¨æ–¹åœ¨æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡åâ€)</p>
<p>â€‹      3.2 æ–¹æ³•è¦å’Œè¢«è°ƒç”¨æ–¹controllerå±‚æ–¹æ³•ä¿æŒå®Œå…¨ä¸€è‡´ã€‚è¯·æ±‚æ–¹å¼ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å‚æ•°[ä¸ªæ•°ã€é¡ºåºã€ç±»å‹]ã€è¿”å›å€¼ç±»å‹</p>
<p>4.åœ¨è¿œç¨‹è°ƒç”¨çš„åœ°æ–¹ç›´æ¥æ³¨å…¥è‡ªå®šä¹‰FeignClientæ¥å£çš„ä»£ç†ç±»å¯¹è±¡ã€‚</p>
<p><strong>æ‹“å±•</strong>ï¼šOpenFeignæœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼š</p>
<p>1.OpenFeignåœ¨è¿œç¨‹è°ƒç”¨æ—¶ï¼Œæœ€å¥½å¸¦ç€@RequestParamã€@PathVariableçš„valueå±æ€§å€¼</p>
<p>2.OpenFeignåœ¨è¿œç¨‹è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ é€’æ˜¯jsonæ•°æ®ã€‚</p>
<p>3.ç»™å¾®æœåŠ¡Aå‘é€çš„è¯·æ±‚æ–¹å¼å¹¶ä¸å½±å“å¾®æœåŠ¡Aä½¿ç”¨OpenFeignè¿œç¨‹è°ƒç”¨å¾®æœåŠ¡Bçš„è¯·æ±‚æ–¹å¼</p>
<h2 id="OpenFeignå…¥é—¨">OpenFeignå…¥é—¨</h2>
<p>OpenFeignçš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1ã€æˆ‘ä»¬åœ¨spzx-cloud-orderæœåŠ¡çš„pomæ–‡ä»¶ä¸­å¼•å…¥OpenFeignçš„ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åŠ å…¥OpenFeignçš„ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2ã€åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ **@EnableFeignClients**å¼€å¯OpenFeignçš„åŠŸèƒ½æ”¯æŒ</p>
<p>3ã€ç¼–å†™OpenFeignçš„å®¢æˆ·ç«¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;spzx-cloud-user&quot;)</span>		<span class="comment">// å£°æ˜å½“å‰æ¥å£æ˜¯ä¸€ä¸ªè®¿é—®user-serviceçš„feignçš„å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserFeignClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/api/user/findUserByUserId/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> User <span class="title function_">queryById</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> Long userId)</span> ;	<span class="comment">// æ ¹æ®userIdæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ¥å£æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå®¢æˆ·ç«¯ä¸»è¦æ˜¯åŸºäºSpringMVCçš„æ³¨è§£æ¥å£°æ˜è¿œç¨‹è°ƒç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p>
<p>â‘  è¯·æ±‚æ–¹å¼ï¼šGET</p>
<p>â‘¡ è¯·æ±‚è·¯å¾„ï¼š/api/user/findUserByUserId/{userId}</p>
<p>â‘¢ è¯·æ±‚å‚æ•°ï¼šLong userId</p>
<p>â‘£ è¿”å›å€¼ç±»å‹ï¼šUser</p>
<p>è¿™æ ·ï¼ŒFeignå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘é€httpè¯·æ±‚ï¼Œæ— éœ€è‡ªå·±ä½¿ç”¨RestTemplateæ¥å‘é€äº†ã€‚</p>
<p>4ã€ä¿®æ”¹OrderServiceä¸­çš„è¿œç¨‹è°ƒç”¨ä»£ç ï¼Œä½¿ç”¨Feignå®¢æˆ·ç«¯ä»£æ›¿RestTemplateï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserFeignClient userFeignClient ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">findOrderByOrderId</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findOrderByOrderId(orderId);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// è¿œç¨‹è°ƒç”¨</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userFeignClient.queryById(order.getUserId());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        <span class="keyword">return</span> order ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="OpenFeignè‡ªå®šä¹‰é…ç½®">OpenFeignè‡ªå®šä¹‰é…ç½®</h2>
<h3 id="æ—¥å¿—é…ç½®">æ—¥å¿—é…ç½®</h3>
<p>OpenFeignå¯ä»¥æ”¯æŒå¾ˆå¤šçš„è‡ªå®šä¹‰é…ç½®ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>ä½œç”¨</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>feign.Logger.Level</strong></td>
<td>ä¿®æ”¹æ—¥å¿—çº§åˆ«</td>
<td>åŒ…å«å››ç§ä¸åŒçš„çº§åˆ«ï¼šNONEã€BASICã€HEADERSã€FULL</td>
</tr>
<tr>
<td>feign.codec.Decoder</td>
<td>å“åº”ç»“æœçš„è§£æå™¨</td>
<td>httpè¿œç¨‹è°ƒç”¨çš„ç»“æœåšè§£æï¼Œä¾‹å¦‚è§£æjsonå­—ç¬¦ä¸²ä¸ºjavaå¯¹è±¡</td>
</tr>
<tr>
<td>feign.codec.Encoder</td>
<td>è¯·æ±‚å‚æ•°ç¼–ç </td>
<td>å°†è¯·æ±‚å‚æ•°ç¼–ç ï¼Œä¾¿äºé€šè¿‡httpè¯·æ±‚å‘é€</td>
</tr>
<tr>
<td>feign.Contract</td>
<td>æ”¯æŒçš„æ³¨è§£æ ¼å¼</td>
<td>é»˜è®¤æ˜¯SpringMVCçš„æ³¨è§£</td>
</tr>
<tr>
<td>feign.Retryer</td>
<td>å¤±è´¥é‡è¯•æœºåˆ¶</td>
<td>è¯·æ±‚å¤±è´¥çš„é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨Ribbonçš„é‡è¯•</td>
</tr>
</tbody>
</table>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼å°±èƒ½æ»¡è¶³æˆ‘ä»¬ä½¿ç”¨ï¼Œå¦‚æœè¦è‡ªå®šä¹‰æ—¶ï¼Œåªéœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„@Beanè¦†ç›–é»˜è®¤Beanå³å¯ã€‚</p>
<p>æŸ¥çœ‹OpenFeignçš„è¿œç¨‹é€šä¿¡æ—¥å¿—ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼šæŠŠæ—¥å¿—çº§åˆ«è°ƒèŠ‚ä¸ºdebug: debug&lt;info&lt;waring&lt;error</p>
<p>ç¬¬äºŒæ­¥ï¼šç»™OpenFeignçš„æ—¥å¿—çº§åˆ«</p>
<p>ä¸‹é¢ä»¥æ—¥å¿—ä¸ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•è‡ªå®šä¹‰é…ç½®ï¼Œæ”¯æŒä¸¤ç§æ–¹å¼çš„é…ç½®ï¼š</p>
<blockquote>
<h5 id="åŸºäºé…ç½®æ–‡ä»¶çš„æ–¹å¼">åŸºäºé…ç½®æ–‡ä»¶çš„æ–¹å¼</h5>
</blockquote>
<p>åŸºäºé…ç½®æ–‡ä»¶ä¿®æ”¹feignçš„æ—¥å¿—çº§åˆ«å¯ä»¥é’ˆå¯¹å•ä¸ªæœåŠ¡ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†feignåŒ…ä¸‹äº§ç”Ÿçš„æ—¥å¿—çš„çº§åˆ«è®¾ç½®ä¸ºdebug</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.atguigu.spzx.cloud.order.feign:</span> <span class="string">debug</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># openfeignæ—¥å¿—çº§åˆ«é…ç½®</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">openfeign:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">config:</span> </span><br><span class="line">          <span class="attr">spzx-cloud-user:</span>  </span><br><span class="line">            <span class="attr">loggerLevel:</span> <span class="string">full</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥é’ˆå¯¹æ‰€æœ‰æœåŠ¡ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†feignåŒ…ä¸‹äº§ç”Ÿçš„æ—¥å¿—çš„çº§åˆ«è®¾ç½®ä¸ºdebug</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.atguigu.spzx.cloud.order.feign:</span> <span class="string">debug</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># openfeignæ—¥å¿—çº§åˆ«é…ç½®</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">openfeign:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">config:</span> </span><br><span class="line">          <span class="attr">default:</span>  <span class="comment"># è¿™é‡Œç”¨defaultå°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span></span><br><span class="line">            <span class="attr">loggerLevel:</span> <span class="string">full</span></span><br></pre></td></tr></table></figure>
<p>è€Œæ—¥å¿—çš„çº§åˆ«åˆ†ä¸ºå››ç§ï¼š</p>
<p>â‘  NONEï¼šä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚</p>
<p>â‘¡ BASICï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼ŒURLä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´</p>
<p>â‘¢ HEADERSï¼šåœ¨BASICçš„åŸºç¡€ä¸Šï¼Œé¢å¤–è®°å½•äº†è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</p>
<p>â‘£ FULLï¼šè®°å½•æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„æ˜ç»†ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€è¯·æ±‚ä½“ã€å…ƒæ•°æ®ã€‚</p>
<h3 id="è¶…æ—¶é…ç½®">è¶…æ—¶é…ç½®</h3>
<p><strong>è¶…æ—¶æœºåˆ¶æ¦‚è¿°</strong>ï¼šFeign çš„è¶…æ—¶æœºåˆ¶æ˜¯æŒ‡åœ¨ä½¿ç”¨ Feign è¿›è¡ŒæœåŠ¡é—´çš„ HTTP è°ƒç”¨æ—¶ï¼Œè®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚å½“è¯·æ±‚è¶…è¿‡è®¾å®šçš„è¶…æ—¶æ—¶é—´åï¼ŒFeign å°†ä¼šä¸­æ–­è¯¥è¯·æ±‚å¹¶æŠ›å‡ºç›¸åº”çš„å¼‚å¸¸ã€‚</p>
<p><strong>è¶…æ—¶æœºåˆ¶çš„æ„ä¹‰</strong>ï¼š</p>
<p>1ã€é˜²æ­¢é•¿æ—¶é—´ç­‰å¾…ï¼šé€šè¿‡è®¾ç½®é€‚å½“çš„è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥é¿å…å®¢æˆ·ç«¯åœ¨è¯·æ±‚æœåŠ¡æ—¶é•¿æ—¶é—´ç­‰å¾…å“åº”è€Œå¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚å¦‚æœæ²¡æœ‰è¶…æ—¶æœºåˆ¶ï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¼šä¸€ç›´ç­‰å¾…ï¼Œä»è€Œå½±å“æ•´ä¸ªç³»ç»Ÿçš„ååé‡å’Œå“åº”æ—¶é—´ã€‚</p>
<p>2ã€é¿å…èµ„æºæµªè´¹ï¼šè¶…æ—¶æœºåˆ¶å¯ä»¥å¸®åŠ©åŠæ—¶é‡Šæ”¾å ç”¨çš„èµ„æºï¼Œä¾‹å¦‚è¿æ¥ã€çº¿ç¨‹ç­‰ã€‚å¦‚æœè¯·æ±‚ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€è€Œä¸è¶…æ—¶ï¼Œå°†å¯¼è‡´èµ„æºçš„æµªè´¹å’Œç³»ç»Ÿçš„è´Ÿè½½å¢åŠ ã€‚</p>
<p>3ã€ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼šè¶…æ—¶æœºåˆ¶å¯ä»¥é˜²æ­¢ç”¨æˆ·é•¿æ—¶é—´ç­‰å¾…æ— å“åº”çš„æƒ…å†µå‘ç”Ÿï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚å½“è¯·æ±‚è¶…æ—¶æ—¶ï¼Œå¯ä»¥åŠæ—¶ç»™å‡ºé”™è¯¯æç¤ºæˆ–è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œä»¥æé†’ç”¨æˆ·æˆ–é‡‡å–å…¶ä»–æªæ–½ã€‚</p>
<p>è¶…æ—¶æ—¶é—´è¶Šé•¿ï¼Œèµ„æºæµªè´¹çš„æ—¶é—´å°±è¶Šé•¿ï¼Œç³»ç»Ÿçš„ç¨³å®šæ€§å°±è¶Šå·®ï¼Œå› æ­¤éœ€è¦è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒä¸ºåˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œè®¾ç½®é˜²æ­¢å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    openfeign:</span><br><span class="line">      client:</span><br><span class="line">        config:</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            loggerLevel: full	</span><br><span class="line">            read-timeout: <span class="number">2000</span>			# è¯»å–æ•°æ®çš„è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º2s</span><br><span class="line">            connect-timeout: <span class="number">2000</span>		# å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º2s</span><br></pre></td></tr></table></figure>
<h3 id="é‡è¯•é…ç½®">é‡è¯•é…ç½®</h3>
<p>feignä¸€æ—¦è¯·æ±‚è¶…æ—¶äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šç›´æ¥æŠ›å‡º<strong>SocketTimeoutException</strong>: Read timed outçš„å¼‚å¸¸ã€‚è¯·æ±‚è¶…æ—¶çš„åŸå› æœ‰å¾ˆå¤šç§ï¼Œå¦‚ç½‘ç»œæŠ–åŠ¨ã€æœåŠ¡ä¸å¯ç”¨ç­‰ã€‚å¦‚æœç”±äºç½‘ç»œæš‚æ—¶ä¸å¯ç”¨å¯¼è‡´è§¦å‘äº†è¶…æ—¶æœºåˆ¶ï¼Œé‚£ä¹ˆæ­¤æ—¶ç›´æ¥è¿”å›å¼‚å¸¸ä¿¡æ¯å°±å¹¶ä¸æ˜¯ç‰¹åˆ«çš„åˆç†ï¼Œå°¤å…¶é’ˆå¯¹æŸ¥è¯¢è¯·æ±‚ï¼Œè‚¯å®šå¸Œæœ›å¾—åˆ°ä¸€ä¸ªç»“æœã€‚åˆç†çš„åšæ³•ï¼š<strong>è§¦å‘è¶…æ—¶ä»¥åï¼Œè®©feignè¿›è¡Œé‡è¯•</strong>ã€‚</p>
<p>å…·ä½“æ­¥éª¤ï¼š</p>
<p>1ã€è‡ªå®šä¹‰é‡è¯•å™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignClientRetryer</span> <span class="keyword">implements</span> <span class="title class_">Retryer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸¤ä¸ªæˆå‘˜å˜é‡æ¥å†³å®šé‡è¯•æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> <span class="number">3</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">continueOrPropagate</span><span class="params">(RetryableException e)</span> &#123;     <span class="comment">// æ˜¯å¦éœ€è¦è¿›è¡Œé‡è¯•å–å†³äºè¯¥æ–¹æ³•æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸é‡è¯•ç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span>(start &gt;= end) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e) ;</span><br><span class="line">        &#125;</span><br><span class="line">        start++ ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Retryer <span class="title function_">clone</span><span class="params">()</span> &#123;    <span class="comment">// æ¡†æ¶åº•å±‚è°ƒç”¨è¯¥æ–¹æ³•å¾—åˆ°ä¸€ä¸ªé‡è¯•å™¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FeignClientRetryer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ã€é…ç½®é‡è¯•å™¨</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">openfeign:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">          <span class="attr">default:</span></span><br><span class="line">            <span class="attr">loggerLevel:</span> <span class="string">full</span></span><br><span class="line">            <span class="attr">read-timeout:</span> <span class="number">2000</span></span><br><span class="line">            <span class="attr">connect-timeout:</span> <span class="number">2000</span></span><br><span class="line">            <span class="attr">retryer:</span> <span class="string">com.atguigu.spzx.cloud.order.feign.FeignClientRetryer</span>		<span class="comment"># é…ç½®è‡ªå®šä¹‰é‡è¯•å™¨</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Spring Framework</title>
    <url>/2025/09/15/Spring%20Framework/</url>
    <content><![CDATA[<h2 id="Spring-Frameworkç®€ä»‹">Spring Frameworkç®€ä»‹</h2>
<h3 id="1-Spring-å’Œ-SpringFramework">1. Spring å’Œ SpringFramework</h3>
<p><a href="https://spring.io/projects">https://spring.io/projects</a></p>
<p><strong>å¹¿ä¹‰çš„ Springï¼šSpring æŠ€æœ¯æ ˆ</strong>ï¼ˆå…¨å®¶æ¡¶ï¼‰</p>
<p>å¹¿ä¹‰ä¸Šçš„ Spring æ³›æŒ‡ä»¥ Spring Framework ä¸ºæ ¸å¿ƒçš„ Spring æŠ€æœ¯æ ˆã€‚</p>
<p>ç»è¿‡åå¤šå¹´çš„å‘å±•ï¼ŒSpring å·²ç»ä¸å†æ˜¯ä¸€ä¸ªå•çº¯çš„åº”ç”¨æ¡†æ¶ï¼Œè€Œæ˜¯é€æ¸å‘å±•æˆä¸ºä¸€ä¸ªç”±å¤šä¸ªä¸åŒå­é¡¹ç›®ï¼ˆæ¨¡å—ï¼‰ç»„æˆçš„æˆç†ŸæŠ€æœ¯ï¼Œä¾‹å¦‚ Spring Frameworkã€Spring MVCã€SpringBootã€Spring Cloudã€Spring Dataã€Spring Security ç­‰ï¼Œå…¶ä¸­ Spring Framework æ˜¯å…¶ä»–å­é¡¹ç›®çš„åŸºç¡€ã€‚</p>
<p>è¿™äº›å­é¡¹ç›®æ¶µç›–äº†ä»ä¼ä¸šçº§åº”ç”¨å¼€å‘åˆ°äº‘è®¡ç®—ç­‰å„æ–¹é¢çš„å†…å®¹ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜è§£å†³è½¯ä»¶å‘å±•è¿‡ç¨‹ä¸­ä¸æ–­äº§ç”Ÿçš„å„ç§å®é™…é—®é¢˜ï¼Œç»™å¼€å‘äººå‘˜å¸¦æ¥äº†æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚</p>
<p><strong>ç‹­ä¹‰çš„ Springï¼šSpring Framework</strong></p>
<p>ç‹­ä¹‰çš„ Spring ç‰¹æŒ‡ Spring Frameworkï¼Œé€šå¸¸æˆ‘ä»¬å°†å®ƒç§°ä¸º Spring æ¡†æ¶ã€‚</p>
<p>Spring æ¡†æ¶æ˜¯ä¸€ä¸ªåˆ†å±‚çš„ã€é¢å‘åˆ‡é¢çš„ Java åº”ç”¨ç¨‹åºçš„ä¸€ç«™å¼è½»é‡çº§è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜¯ Spring æŠ€æœ¯æ ˆçš„æ ¸å¿ƒå’ŒåŸºç¡€ï¼Œæ˜¯ä¸ºäº†è§£å†³ä¼ä¸šçº§åº”ç”¨å¼€å‘çš„å¤æ‚æ€§è€Œåˆ›å»ºçš„ã€‚</p>
<p>Spring æœ‰ä¸¤ä¸ªæœ€æ ¸å¿ƒæ¨¡å—ï¼š IoC å’Œ AOPã€‚</p>
<p><strong>IoC</strong>ï¼šInverse of Control çš„ç®€å†™ï¼Œè¯‘ä¸ºâ€œæ§åˆ¶åè½¬â€ï¼ŒæŒ‡æŠŠåˆ›å»ºå¯¹è±¡è¿‡ç¨‹äº¤ç»™ Spring è¿›è¡Œç®¡ç†ã€‚</p>
<p><strong>AOP</strong>ï¼šAspect Oriented Programming çš„ç®€å†™ï¼Œè¯‘ä¸ºâ€œé¢å‘åˆ‡é¢ç¼–ç¨‹â€ã€‚AOP ç”¨æ¥å°è£…å¤šä¸ªç±»çš„å…¬å…±è¡Œä¸ºï¼Œå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘å°è£…èµ·æ¥ï¼Œå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ã€‚å¦å¤–ï¼ŒAOP è¿˜è§£å†³ä¸€äº›ç³»ç»Ÿå±‚é¢ä¸Šçš„é—®é¢˜ï¼Œæ¯”å¦‚æ—¥å¿—ã€äº‹åŠ¡ã€æƒé™ç­‰ã€‚</p>
<p><strong>ç†è§£ï¼š</strong></p>
<p>Springç±»ä¼¼äºè…¾è®¯å…¬å¸</p>
<p>SpringFrameworkç±»ä¼¼äºè…¾è®¯çš„å‘å®¶äº§å“QQ</p>
<p>ä¸ºäº†ç§°å‘¼æ–¹ä¾¿ï¼Œæˆ‘ä»¬åé¢ä¼šå°†SpringFrameworkç®€ç§°ä¸ºSpring!!!</p>
<h3 id="2-SpringFrameworkä¸»è¦åŠŸèƒ½æ¨¡å—">2. SpringFrameworkä¸»è¦åŠŸèƒ½æ¨¡å—</h3>
<table>
<thead>
<tr>
<th>åŠŸèƒ½æ¨¡å—</th>
<th>åŠŸèƒ½ä»‹ç»</th>
</tr>
</thead>
<tbody>
<tr>
<td>Core Container</td>
<td>æ ¸å¿ƒå®¹å™¨ï¼Œåœ¨ Spring ç¯å¢ƒä¸‹ä½¿ç”¨ä»»ä½•åŠŸèƒ½éƒ½å¿…é¡»åŸºäº IOC å®¹å™¨ã€‚</td>
</tr>
<tr>
<td>AOP&amp;Aspects</td>
<td>é¢å‘åˆ‡é¢ç¼–ç¨‹</td>
</tr>
<tr>
<td>Testing</td>
<td>æä¾›äº†å¯¹ junit æˆ– TestNG æµ‹è¯•æ¡†æ¶çš„æ•´åˆã€‚</td>
</tr>
<tr>
<td>Data Access/Integration</td>
<td>æä¾›äº†å¯¹æ•°æ®è®¿é—®/é›†æˆçš„åŠŸèƒ½ã€‚</td>
</tr>
<tr>
<td>Spring MVC</td>
<td>æä¾›äº†é¢å‘Webåº”ç”¨ç¨‹åºçš„é›†æˆåŠŸèƒ½ã€‚</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>1.4 ç»„ä»¶äº¤ç»™Springç®¡ç†ä¼˜åŠ¿</strong>!</p>
<ol>
<li>é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼šSpring IoCå®¹å™¨é€šè¿‡ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œå°†ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»å‰Šå¼±ï¼Œå‡å°‘äº†ç¨‹åºç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œä½¿å¾—ç»„ä»¶æ›´åŠ æ¾æ•£åœ°è€¦åˆã€‚</li>
<li>æé«˜äº†ä»£ç çš„å¯é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼šå°†ç»„ä»¶çš„å®ä¾‹åŒ–è¿‡ç¨‹ã€ä¾èµ–å…³ç³»çš„ç®¡ç†ç­‰åŠŸèƒ½äº¤ç»™Spring IoCå®¹å™¨å¤„ç†ï¼Œä½¿å¾—ç»„ä»¶ä»£ç æ›´åŠ æ¨¡å—åŒ–ã€å¯é‡ç”¨ã€æ›´æ˜“äºç»´æŠ¤ã€‚</li>
<li>æ–¹ä¾¿äº†é…ç½®å’Œç®¡ç†ï¼šSpring IoCå®¹å™¨é€šè¿‡XMLæ–‡ä»¶æˆ–è€…æ³¨è§£ï¼Œè½»æ¾çš„å¯¹ç»„ä»¶è¿›è¡Œé…ç½®å’Œç®¡ç†ï¼Œä½¿å¾—ç»„ä»¶çš„åˆ‡æ¢ã€æ›¿æ¢ç­‰æ“ä½œæ›´åŠ çš„æ–¹ä¾¿å’Œå¿«æ·ã€‚</li>
<li>æ”¯æŒçµæ´»çš„é…ç½®å’Œæ‰©å±•ï¼šSpring IoCå®¹å™¨æ”¯æŒåŠ¨æ€é…ç½®å’Œçµæ´»æ‰©å±•ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€è¦æ·»åŠ è‡ªå®šä¹‰çš„Beanï¼Œå¹¶ä¸”æ”¯æŒå„ç§ä¸åŒçš„é…ç½®æ–¹å¼ï¼Œä½¿å¾—å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´åŠ çµæ´»åœ°å®šåˆ¶é…ç½®ã€‚</li>
<li>äº¤ç»™Springç®¡ç†çš„å¯¹è±¡ï¼ˆç»„ä»¶ï¼‰ï¼Œæ–¹å¯äº«å—Springæ¡†æ¶çš„å…¶ä»–åŠŸèƒ½ï¼ˆAOP,å£°æ˜äº‹åŠ¡ç®¡ç†ï¼‰ç­‰</li>
</ol>
</li>
</ul>
<p><strong>ApplicationContextå®¹å™¨å®ç°ç±»</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>ç±»å‹å</th>
<th>ç®€ä»‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>ClassPathXmlApplicationContext</td>
<td>é€šè¿‡è¯»å–ç±»è·¯å¾„ä¸‹çš„ XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡</td>
</tr>
<tr>
<td>FileSystemXmlApplicationContext</td>
<td>é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è¯»å– XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡</td>
</tr>
<tr>
<td>ConfigurableApplicationContext</td>
<td>ApplicationContext çš„å­æ¥å£ï¼ŒåŒ…å«ä¸€äº›æ‰©å±•æ–¹æ³• refresh() å’Œ close() ï¼Œè®© ApplicationContext å…·æœ‰å¯åŠ¨ã€å…³é—­å’Œåˆ·æ–°ä¸Šä¸‹æ–‡çš„èƒ½åŠ›ã€‚</td>
</tr>
<tr>
<td>WebApplicationContext</td>
<td>ä¸“é—¨ä¸º Web åº”ç”¨å‡†å¤‡ï¼ŒåŸºäº Web ç¯å¢ƒåˆ›å»º IOC å®¹å™¨å¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡å¼•å…¥å­˜å…¥ ServletContext åŸŸä¸­ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="SpringIoCå®¹å™¨ç®¡ç†é…ç½®æ–¹å¼">SpringIoCå®¹å™¨ç®¡ç†é…ç½®æ–¹å¼</h3>
<p>Spring IoC å®¹å™¨ä½¿ç”¨ä¸€ç§å½¢å¼çš„é…ç½®å…ƒæ•°æ®ã€‚æ­¤é…ç½®å…ƒæ•°æ®è¡¨ç¤ºæ‚¨ä½œä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¦‚ä½•å‘Šè¯‰ Spring å®¹å™¨å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ã€‚</p>
<p>Springæ¡†æ¶æä¾›äº†å¤šç§é…ç½®æ–¹å¼ï¼šXMLé…ç½®æ–¹å¼ã€æ³¨è§£æ–¹å¼å’ŒJavaé…ç½®ç±»æ–¹å¼</p>
<ol>
<li>XMLé…ç½®æ–¹å¼ï¼šæ˜¯Springæ¡†æ¶æœ€æ—©çš„é…ç½®æ–¹å¼ä¹‹ä¸€ï¼Œé€šè¿‡åœ¨XMLæ–‡ä»¶ä¸­å®šä¹‰BeanåŠå…¶ä¾èµ–å…³ç³»ã€Beançš„ä½œç”¨åŸŸç­‰ä¿¡æ¯ï¼Œè®©Spring IoCå®¹å™¨æ¥ç®¡ç†Beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚è¯¥æ–¹å¼ä»Springæ¡†æ¶çš„ç¬¬ä¸€ç‰ˆå¼€å§‹æä¾›æ”¯æŒã€‚</li>
<li>æ³¨è§£æ–¹å¼ï¼šä»Spring 2.5ç‰ˆæœ¬å¼€å§‹æä¾›æ”¯æŒï¼Œå¯ä»¥é€šè¿‡åœ¨Beanç±»ä¸Šä½¿ç”¨æ³¨è§£æ¥ä»£æ›¿XMLé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚é€šè¿‡åœ¨Beanç±»ä¸ŠåŠ ä¸Šç›¸åº”çš„æ³¨è§£ï¼ˆå¦‚@Component, @Service, @Autowiredç­‰ï¼‰ï¼Œå°†Beanæ³¨å†Œåˆ°Spring IoCå®¹å™¨ä¸­ï¼Œè¿™æ ·Spring IoCå®¹å™¨å°±å¯ä»¥ç®¡ç†è¿™äº›Beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>Javaé…ç½®ç±»æ–¹å¼ï¼šä»Spring 3.0ç‰ˆæœ¬å¼€å§‹æä¾›æ”¯æŒï¼Œé€šè¿‡Javaç±»æ¥å®šä¹‰Beanã€Beanä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œé…ç½®ä¿¡æ¯ï¼Œä»è€Œä»£æ›¿XMLé…ç½®æ–‡ä»¶çš„æ–¹å¼ã€‚Javaé…ç½®ç±»æ˜¯ä¸€ç§ä½¿ç”¨Javaç¼–å†™é…ç½®ä¿¡æ¯çš„æ–¹å¼ï¼Œé€šè¿‡@Configurationã€@Beanç­‰æ³¨è§£æ¥å®ç°Beanå’Œä¾èµ–å…³ç³»çš„é…ç½®ã€‚<br>
é…ç½®æ–¹å¼çš„ä½¿ç”¨åœºæ™¯ä¸åŒï¼ŒSSMæœŸé—´ï¼Œæˆ‘ä»¬ä½¿ç”¨XML+æ³¨è§£æ–¹å¼ä¸ºä¸»ã€‚SpringBootæœŸé—´ï¼Œæˆ‘ä»¬ä½¿ç”¨é…ç½®ç±»+æ³¨è§£æ–¹å¼ä¸ºä¸»ï¼</li>
</ol>
<h3 id="3-Spring-IoC-DIæ¦‚å¿µæ€»ç»“">3. Spring IoC / DIæ¦‚å¿µæ€»ç»“</h3>
<ul>
<li>
<p><strong>IoCï¼ˆInversion of Controlï¼‰æ¦‚å¿µ</strong></p>
<p>IoC ä¸»è¦æ˜¯é’ˆå¯¹å¯¹è±¡çš„åˆ›å»ºå’Œè°ƒç”¨æ§åˆ¶è€Œè¨€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¸å†æ˜¯åº”ç”¨ç¨‹åºç›´æ¥åˆ›å»ºè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯ç”± IoC å®¹å™¨æ¥åˆ›å»ºå’Œç®¡ç†ï¼Œå³æ§åˆ¶æƒç”±åº”ç”¨ç¨‹åºè½¬ç§»åˆ° IoC å®¹å™¨ä¸­ï¼Œä¹Ÿå°±æ˜¯â€œåè½¬â€äº†æ§åˆ¶æƒã€‚è¿™ç§æ–¹å¼åŸºæœ¬ä¸Šæ˜¯é€šè¿‡ä¾èµ–æŸ¥æ‰¾çš„æ–¹å¼æ¥å®ç°çš„ï¼Œå³ IoC å®¹å™¨ç»´æŠ¤ç€æ„æˆåº”ç”¨ç¨‹åºçš„å¯¹è±¡ï¼Œå¹¶è´Ÿè´£åˆ›å»ºè¿™äº›å¯¹è±¡ã€‚</p>
</li>
<li>
<p><strong>DI (Dependency Injection)æ¦‚å¿µ</strong></p>
<p>DI æ˜¯æŒ‡åœ¨ç»„ä»¶ä¹‹é—´ä¼ é€’ä¾èµ–å…³ç³»çš„è¿‡ç¨‹ä¸­ï¼Œå°†ä¾èµ–å…³ç³»åœ¨å®¹å™¨å†…éƒ¨è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±ä¸å¿…åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ç¡¬ç¼–ç å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå®ç°äº†å¯¹è±¡ä¹‹é—´çš„è§£è€¦åˆã€‚åœ¨ Spring ä¸­ï¼ŒDI æ˜¯é€šè¿‡ XML é…ç½®æ–‡ä»¶æˆ–æ³¨è§£çš„æ–¹å¼å®ç°çš„ã€‚å®ƒæä¾›äº†ä¸‰ç§å½¢å¼çš„ä¾èµ–æ³¨å…¥ï¼šæ„é€ å‡½æ•°æ³¨å…¥ã€Setter æ–¹æ³•æ³¨å…¥å’Œæ¥å£æ³¨å…¥ã€‚</p>
</li>
</ul>
<blockquote>
<p>SPIæœºåˆ¶</p>
</blockquote>
<p><img src="http://120.26.79.238:9000/blog/img/cf640b6856eb43bd89a48d28de7b64b0.png" alt="Clip_2024-10-08_08-29-27.png"></p>
<p>``</p>
<h2 id="XMlé…ç½®">XMlé…ç½®</h2>
<p>æ¥å£æ³¨å…¥ï¼šéœ€è¦æ³¨å…¥çš„ä¾èµ–å¯¹è±¡ä¸ºä¸€ä¸ªæ¥å£ï¼Œiocè‡ªåŠ¨ä¸ºä¾èµ–æ³¨å…¥å®ç°ç±»ã€‚</p>
<p>åå°„è·å–å¯¹è±¡ï¼š</p>
<ol>
<li>
<p>æ ¹æ®æ„é€ æ–¹æ³•çš„newInstance()</p>
</li>
<li>
<p>æ ¹æ®å­—èŠ‚ç å¯¹è±¡çš„newInstance()</p>
</li>
</ol>
<h3 id="FactoryBean">FactoryBean</h3>
<blockquote>
<p>ç”Ÿäº§ä¸€ç§beanï¼Œå¯ä»¥å¯¹beanè¿›è¡Œå¤„ç†ã€‚</p>
<p><code>BeanFactory</code>æ˜¯spring IOCçš„æ ¹æ¥å£</p>
</blockquote>
<p>FactoryBeanä¸æ™®é€šå·¥å‚çš„åŒºåˆ«ï¼š</p>
<ol>
<li>FactorBeanå·¥å‚ï¼šiocå¯ç›´æ¥è·å¾—å·¥å‚æä¾›çš„bean</li>
<li>æ™®é€šå·¥å‚ï¼šiocéœ€è¦å…ˆè·å–å·¥å‚å¯¹è±¡ï¼Œæ‰èƒ½è·å–å·¥å‚æä¾›çš„bean</li>
</ol>
<h3 id="beançš„ä½œç”¨åŸŸ">beançš„ä½œç”¨åŸŸ</h3>
<p>scopeï¼šsingLeton|prototype|session|request</p>
<p>å•ä¾‹ï¼šæ¯æ¬¡éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹</p>
<p>å¤šä¾‹ï¼šæ¯æ¬¡éƒ½æ˜¯ä¸åŒçš„</p>
<h3 id="beançš„ç”Ÿå‘½å‘¨æœŸ">beançš„ç”Ÿå‘½å‘¨æœŸ</h3>
<ol>
<li>åˆ›å»ºå¯¹è±¡ï¼ˆé»˜è®¤ä½¿ç”¨æ— å‚æ„é€ ï¼‰</li>
<li>ä¾èµ–æ³¨å…¥</li>
<li>åˆå§‹åŒ–ï¼ˆä½¿ç”¨init-method=â€œâ€,æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•)</li>
<li>ä½¿ç”¨</li>
<li>é”€æ¯ï¼ˆä½¿ç”¨destory-method=â€œâ€,æŒ‡å®šé”€æ¯æ–¹æ³•)   iocå®¹å™¨å…³é—­æ—¶æ‰§è¡Œbeançš„é”€æ¯    ioc.close()</li>
</ol>
<h3 id="beançš„ä½œç”¨åŸŸå¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“">beançš„ä½œç”¨åŸŸå¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“</h3>
<p>å•ä¾‹ï¼šåœ¨åˆå§‹åŒ–iocæ—¶å°±å·²ç»åˆå§‹åŒ–äº†</p>
<p>å¤šä¾‹ï¼šåªæœ‰åœ¨è·å–beanå¯¹è±¡æ—¶æ‰åˆå§‹åŒ–ï¼Œä¸”é”€æ¯ä¸è¢«iocç®¡ç†ã€‚</p>
<h3 id="beançš„åç½®å¤„ç†å™¨">beançš„åç½®å¤„ç†å™¨</h3>
<ol>
<li>
<p>æœ¬è´¨ï¼šå®ç°äº†<code>BeanPostProcessor</code>çš„ç±»</p>
</li>
<li>
<p>åœ¨bean<code>åˆå§‹åŒ–</code>å‰ååŠ ä¸Šä¸¤ä¸ªé¢å¤–çš„æ­¥éª¤</p>
</li>
<li>
<p>å¿…é¡»é…ç½®åˆ°iocå®¹å™¨ä¸­ï¼Œbeançš„åç½®å¤„ç†å™¨ä¼šä½œç”¨äºæ‰€æœ‰ç»„ä»¶</p>
</li>
</ol>
<h2 id="æ³¨è§£é…ç½®">æ³¨è§£é…ç½®</h2>
<p>@Component   @Server @Controller @Resource</p>
<p>åœ¨xmlä¸­é…ç½®æ‰«æçš„ä¸»åŒ…ï¼š&lt;context:component-scan base-package=â€œonline.zorange.a_scanâ€/&gt;</p>
<p>è·å–æ‰€æœ‰åŠ ä¸Šæ³¨è§£çš„ç»„ä»¶</p>
<p>é…ç½®é¡¹æ‰«æï¼Œä¸xmlä¸€æ ·&lt;context:property-placeholder location=â€œapplication.propertiesâ€/&gt;</p>
<p>å±æ€§æ³¨è§£ï¼šValue(â€œ${jdbc.password}â€)</p>
<h2 id="javaé…ç½®ç±»">javaé…ç½®ç±»</h2>
<ol>
<li>
<p>åœ¨é…ç½®ç±»ä¸ŠåŠ @Configuration,æ ‡æ³¨é…ç½®ç±»</p>
<p>æ‰«æåŒ…é…ç½®æ³¨è§£ï¼›@ComponentScan(basePackages = {â€œonline.zorange.define_componentsâ€})</p>
<p>æ‰«æé…ç½®é¡¹æ³¨è§£ï¼š@PropertySource(â€œclasspath:jdbc.propertiesâ€)</p>
</li>
<li>
<p>åœ¨iocè·å–æ—¶é‡‡ç”¨AnnotationConfigApplicationContext(é…ç½®ç±».class);</p>
</li>
<li>
<p>æ³¨è§£é…ç½®å’Œjavaé…ç½®ç±»çš„beanNameçš„åŒºåˆ«</p>
<table>
<thead>
<tr>
<th>æ³¨è§£é…ç½®</th>
<th>Javaé…ç½®ç±»</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç±»åçš„é¦–å­—æ¯å°å†™</td>
<td>æ–¹æ³•å</td>
</tr>
</tbody>
</table>
</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Spring MVC</title>
    <url>/2025/09/15/Spring%20MVC/</url>
    <content><![CDATA[<h2 id="Spring-MVC">Spring MVC</h2>
<blockquote>
<p>Spring MVCæ˜¯æ§åˆ¶å±‚æ¡†æ¶</p>
</blockquote>
<p>è¡¨è¿°å±‚ï¼šæ§åˆ¶å±‚å’Œè§†å›¾ui</p>
<p>æœåŠ¡å±‚</p>
<p>æŒä¹…åŒ–å±‚</p>
<p>åŸºäºServelet APIæ„å»ºçš„åŸå§‹Webæ¡†æ¶</p>
<h4 id="ä½¿ç”¨spring-MVC-æ­¥éª¤">ä½¿ç”¨spring MVC æ­¥éª¤</h4>
<ol>
<li>
<p><strong>é…ç½®å‰ç«¯æ§åˆ¶å™¨</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- DispatcherServletçš„å…¨ç±»å --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">     <span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">   <span class="comment">&lt;!--é»˜è®¤Spring MVCçš„é…ç½®æ–‡ä»¶é…ç½®</span></span><br><span class="line"><span class="comment">	ä½ç½®ï¼šWEB-INFOä¸‹</span></span><br><span class="line"><span class="comment">	åç§°ï¼šDispatcherServletçš„name-servelet.</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- é€šè¿‡åˆå§‹åŒ–å‚æ•°æŒ‡å®šSpringMVCé…ç½®æ–‡ä»¶ä½ç½® --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- å¦‚æœä¸è®°å¾—contextConfigLocationé…ç½®é¡¹çš„åç§°ï¼Œå¯ä»¥åˆ°DispatcherServletçš„çˆ¶ç±»FrameworkServletä¸­æŸ¥æ‰¾ --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- ä½¿ç”¨classpath:è¯´æ˜è¿™ä¸ªè·¯å¾„ä»ç±»è·¯å¾„çš„æ ¹ç›®å½•å¼€å§‹æ‰æŸ¥æ‰¾ --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   <span class="comment">&lt;!-- ä½œä¸ºæ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ï¼Œåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æœ‰å¤§é‡çš„åˆå§‹åŒ–æ“ä½œè¦åšï¼Œè¿™äº›æ“ä½œæ”¾åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æ‰æ‰§è¡Œéå¸¸ä¸æ°å½“ --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- æˆ‘ä»¬åº”è¯¥å°†DispatcherServletè®¾ç½®ä¸ºéšWebåº”ç”¨ä¸€èµ·å¯åŠ¨ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"> <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"> <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--å°†jspè¯·æ±‚äº¤ç»™jspserveltå¤„ç†ï¼Œå› ä¸ºDispatchServeletä¸èƒ½å¤„ç†jsp--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- å¯¹DispatcherServletæ¥è¯´ï¼Œurl-patternæœ‰ä¸¤ç§æ–¹å¼é…ç½® --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- æ–¹å¼ä¸€ï¼šé…ç½®â€œ/â€ï¼Œè¡¨ç¤ºåŒ¹é…æ•´ä¸ªWebåº”ç”¨èŒƒå›´å†…æ‰€æœ‰è¯·æ±‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç¡¬æ€§è§„å®šï¼šä¸èƒ½å†™æˆâ€œ/*â€ã€‚</span></span><br><span class="line"><span class="comment">     åªæœ‰è¿™ä¸€ä¸ªåœ°æ–¹æœ‰è¿™ä¸ªç‰¹æ®Šè¦æ±‚ï¼Œä»¥åæˆ‘ä»¬å†é…ç½®Filterè¿˜æ˜¯å¯ä»¥æ­£å¸¸å†™â€œ/*â€ã€‚ --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- æ–¹å¼äºŒï¼šé…ç½®â€œ*.æ‰©å±•åâ€ï¼Œè¡¨ç¤ºåŒ¹é…æ•´ä¸ªWebåº”ç”¨èŒƒå›´å†…éƒ¨åˆ†è¯·æ±‚ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>spring mvcçš„é…ç½®æ–‡ä»¶</p>
<p>â€‹	é»˜è®¤ä½ç½®ï¼šWEB-INFOä¸‹</p>
<p>â€‹	åç§°ï¼šDispatchServeletçš„nameï¼›</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servelet-name</span>&gt;</span>name<span class="tag">&lt;/<span class="name">servelet-name</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½®spring mvcçš„iocå®¹å™¨</p>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰«æbean</p>
</li>
<li>
<p>æ³¨è§£</p>
<ol>
<li>é…ç½®è·¯å¾„ï¼š@RequestMapping(â€œ/userâ€)</li>
<li>å°†è¿”å›å€¼ä»¥è¿”å›ä½“çš„æ–¹å¼è¿”å› @ResponseBody</li>
</ol>
</li>
</ol>
<h4 id="è®¿é—®è·¯å¾„è®¾ç½®">è®¿é—®è·¯å¾„è®¾ç½®</h4>
<ol>
<li>æ”¯æŒanté£æ ¼çš„è·¯å¾„</li>
</ol>
<p>â€‹		<code>ï¼Ÿ</code>ï¼šè¡¨ç¤ºä»»æ„å•ä¸ªå­—ç¬¦ <code>&quot;/a?a&quot;,</code>é™¤äº†<code>ï¼Ÿ</code>å’Œ<code>/</code></p>
<p>â€‹        <code>*</code>ï¼šè¡¨ç¤ºä»»æ„ä¸ªæ•°çš„å­—ç¬¦,é™¤äº†<code>?</code>å’Œ<code>/</code></p>
<p>â€‹		<code>**</code>:è¡¨ç¤ºä»»æ„å±‚æ•°çš„ä»»æ„ç›®å½•ï¼Œ<code>/** </code> ,ä¸èƒ½æœ‰å…¶ä»–å­—ç¬¦ å¦‚<code>/a**a</code></p>
<p>@RequestMapping</p>
<ol>
<li>
<p>å±æ€§</p>
<p>method=RequestMethod[]   å¯ä»¥åŒ¹é…å¤šä¸ªæ–¹æ³•ï¼Œé»˜è®¤å…¨éƒ¨éƒ½å¯ä»¥åŒ¹é…</p>
</li>
</ol>
<p>@RestController</p>
<p>é»˜è®¤ä¸ºæ¯ä¸ªæ–¹æ³•åŠ ä¸Š@ResponseBodyæ³¨è§£ï¼Œå°†è¿”å›å€¼ä½œä¸ºè¿”å›ä½“è¿”å›</p>
<h2 id="æ¥æ”¶å‚æ•°">æ¥æ”¶å‚æ•°</h2>
<p>è‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢ï¼šè‹¥æ— æ³•è½¬æ¢æŠ¥400.</p>
<ol>
<li>
<p><strong>RequestParam å‚æ•°</strong>ï¼šlocalhost:8080/login?<code>username=&quot;zsw&quot;&amp;password=&quot;123&quot;</code></p>
<p>æ¥æ”¶æ—¶å¯ä»¥ä½¿ç”¨@RequestParamæ³¨è§£æ¥æ”¶ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨æ³¨è§£ï¼Œä½†æ˜¯å½¢å‚åè¦ä¸paramåä¸€è‡´ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username, </span></span><br><span class="line"><span class="params">                  <span class="meta">@RequestParam</span> String password)</span></span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>å¦‚æœæœ‰å¤šä¸ªåŒåçš„å‚æ•°</p>
<p>localhost:8080/login?<code>hobby=å”±&amp;hobby=è·³</code></p>
<ol>
<li>æ•°ç»„</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String [] hobby)</span> <span class="comment">//[å”±,è·³]</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>å­—ç¬¦ä¸²</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String  hobby)</span>  <span class="comment">//å”±,è·³</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>listé›†åˆè·å–ï¼Œå¿…é¡»ä½¿ç”¨æ³¨è§£</li>
</ol>
</li>
</ol>
</li>
<li>
<p><strong>è·¯å¾„ä¸­çš„å‚æ•°</strong>ï¼šlocalhost:8080/book/1/3</p>
<p>è¿™ä¸ªå‚æ•°éœ€è¦ä½¿ç”¨æ³¨è§£@PathVariableæ¥æ¥æ”¶ã€‚</p>
<p>å°†å‚æ•°æ”¾å…¥è¯·æ±‚åŸŸä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(/book/&#123;id&#125;/&#123;uid&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">book</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id,</span></span><br><span class="line"><span class="params">                 <span class="meta">@PathVariable(&quot;uid&quot;)</span> Integer uid)</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>è¯·æ±‚ä½“ä¸­çš„å‚æ•°</strong><code>jsonæ ¼å¼</code></p>
<ol>
<li>å¼€å¯mvcçš„æ³¨è§£é©±åŠ¨</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>æ³¨è§£ï¼š@RequestBody</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(/data)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">data</span><span class="params">(<span class="meta">@RequestBody(&quot;data&quot;)</span> Data data)</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="è·å–Cookieæ•°æ®">è·å–Cookieæ•°æ®</h2>
<ol>
<li>
<p>è·å–HttServeletRequestå¯¹è±¡å’ŒHttpServeletResponse,ç›´æ¥åœ¨å½¢å‚ç±»åå£°æ˜</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cookie</span><span class="params">(HttpServeletRequest req</span></span><br><span class="line"><span class="params">                  HttpServeletResponse resp</span></span><br><span class="line"><span class="params">                  HttpSeeion session</span></span><br><span class="line"><span class="params">                  <span class="meta">@CookieValue(value=&quot;JSESSIONID&quot; ,required=&quot;false&quot;)</span>  </span></span><br><span class="line"><span class="params">                   //åˆå§‹åŒ–ä¸€ä¸ªcookieï¼Œå“åº”cookieï¼Œç¬¬ä¸€æ¬¡æ—¶</span></span><br><span class="line"><span class="params">                   String JSESSIONID)</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>@CookieValue(value=&quot;JSESSIONID&quot; ,required=&quot;false&quot;) String JSESSION</code></p>
<p>ç¬¬ä¸€æ¬¡è·å–æ—¶å¯èƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥å°†requiredè®¾ç½®ä¸ºfalseï¼Œ</p>
</li>
<li>
<p><code>@RequestHeader(&quot;user-agent&quot;)</code></p>
<p>è·å–è¯·æ±‚å¤´ä¸­çš„æ•°æ®ã€‚</p>
<table>
<thead>
<tr>
<th>Controller method argument æ§åˆ¶å™¨æ–¹æ³•å‚æ•°</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jakarta.servlet.ServletRequest</code>, <code>jakarta.servlet.ServletResponse</code></td>
<td>è¯·æ±‚/å“åº”å¯¹è±¡</td>
</tr>
<tr>
<td><code>jakarta.servlet.http.HttpSession</code></td>
<td>å¼ºåˆ¶å­˜åœ¨ä¼šè¯ã€‚å› æ­¤ï¼Œè¿™æ ·çš„å‚æ•°æ°¸è¿œä¸ä¼šä¸º <code>null</code> ã€‚</td>
</tr>
<tr>
<td><code>java.io.InputStream</code>, <code>java.io.Reader</code></td>
<td>ç”¨äºè®¿é—®ç”± Servlet API å…¬å¼€çš„åŸå§‹è¯·æ±‚æ­£æ–‡ã€‚</td>
</tr>
<tr>
<td><code>java.io.OutputStream</code>, <code>java.io.Writer</code></td>
<td>ç”¨äºè®¿é—®ç”± Servlet API å…¬å¼€çš„åŸå§‹å“åº”æ­£æ–‡ã€‚</td>
</tr>
<tr>
<td><code>@PathVariable</code></td>
<td>æ¥æ”¶è·¯å¾„å‚æ•°æ³¨è§£</td>
</tr>
<tr>
<td><code>@RequestParam</code></td>
<td>ç”¨äºè®¿é—® Servlet è¯·æ±‚å‚æ•°ï¼ŒåŒ…æ‹¬å¤šéƒ¨åˆ†æ–‡ä»¶ã€‚å‚æ•°å€¼å°†è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚</td>
</tr>
<tr>
<td><code>@RequestHeader</code></td>
<td>ç”¨äºè®¿é—®è¯·æ±‚æ ‡å¤´ã€‚æ ‡å¤´å€¼å°†è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚</td>
</tr>
<tr>
<td><code>@CookieValue</code></td>
<td>ç”¨äºè®¿é—®Cookieã€‚Cookie å€¼å°†è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚</td>
</tr>
<tr>
<td><code>@RequestBody</code></td>
<td>ç”¨äºè®¿é—® HTTP è¯·æ±‚æ­£æ–‡ã€‚æ­£æ–‡å†…å®¹é€šè¿‡ä½¿ç”¨ <code>HttpMessageConverter</code> å®ç°è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚</td>
</tr>
<tr>
<td><code>java.util.Map</code>, <code>org.springframework.ui.Model</code>, <code>org.springframework.ui.ModelMap</code></td>
<td>å…±äº«åŸŸå¯¹è±¡ï¼Œå¹¶åœ¨è§†å›¾å‘ˆç°è¿‡ç¨‹ä¸­å‘æ¨¡æ¿å…¬å¼€ã€‚</td>
</tr>
<tr>
<td><code>Errors</code>, <code>BindingResult</code></td>
<td>éªŒè¯å’Œæ•°æ®ç»‘å®šä¸­çš„é”™è¯¯ä¿¡æ¯è·å–å¯¹è±¡ï¼</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h2 id="åŸŸå¯¹è±¡çš„ä½¿ç”¨">åŸŸå¯¹è±¡çš„ä½¿ç”¨</h2>
<h3 id="è¯·æ±‚åŸŸ">è¯·æ±‚åŸŸ</h3>
<ol>
<li>
<p>è¯·æ±‚åŸŸ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(HttpServeletRequest req)</span>&#123;</span><br><span class="line">    req.settAribute(<span class="string">&quot;item&quot;</span>,object)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ModelAndView</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    ModelAndView mv=<span class="keyword">new</span> <span class="title class_">ModelAndView</span>()</span><br><span class="line">    mv.addObject(<span class="string">&quot;item&quot;</span>,object)  <span class="comment">//æ”¾å…¥è¯·æ±‚åŸŸ</span></span><br><span class="line">    <span class="comment">// è®¾ç½®é€»è¾‘è§†å›¾</span></span><br><span class="line">    mv.setViewName(<span class="string">&quot;index&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> mv  <span class="comment">//éœ€è¦è¿”å›ModeAndViewå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Model</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">test</span><span class="params">(</span></span><br><span class="line"><span class="params">    Model model</span></span><br><span class="line"><span class="params">)</span>&#123;</span><br><span class="line">    model.addArttibute(<span class="string">&quot;item&quot;</span>,object)  <span class="comment">//æ”¾å…¥è¯·æ±‚åŸŸ</span></span><br><span class="line">    <span class="comment">// è®¾ç½®é€»è¾‘è§†å›¾</span></span><br><span class="line">    mv.setViewName(<span class="string">&quot;index&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>  <span class="comment">//éœ€è¦è¿”å›ModeAndViewå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Map</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">test</span><span class="params">(</span></span><br><span class="line"><span class="params">    Map&lt;String,String&gt; map</span></span><br><span class="line"><span class="params">)</span>&#123;</span><br><span class="line">    map.put(<span class="string">&quot;item&quot;</span>,Object);  <span class="comment">//æ”¾å…¥è¯·æ±‚åŸŸ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ModelMap</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">test</span><span class="params">(</span></span><br><span class="line"><span class="params">    ModelMap modeMap </span></span><br><span class="line"><span class="params">)</span>&#123;</span><br><span class="line">    modeMap.addArttribute(<span class="string">&quot;item&quot;</span>,object) <span class="comment">//æ”¾å…¥è¯·æ±‚åŸŸ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>modelã€mapã€ModelMapä¸‰ä¸ªå¯¹è±¡å±äºåŒä¸€ä¸ªç±»</p>
<h3 id="ä¼šè¯åŸŸ">ä¼šè¯åŸŸ</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/attr/session&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testAttrSession</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//ç›´æ¥å¯¹sessionå¯¹è±¡æ“ä½œ,å³å¯¹ä¼šè¯èŒƒå›´æ“ä½œ!</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åº”ç”¨åŸŸ">åº”ç”¨åŸŸ</h3>
<p>è§£é‡Šï¼šspringmvcä¼šåœ¨åˆå§‹åŒ–å®¹å™¨çš„æ—¶å€™ï¼Œè®²servletContextå¯¹è±¡å­˜å‚¨åˆ°iocå®¹å™¨ä¸­ï¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ServletContext servletContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/attr/application&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">attrApplication</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    servletContext.setAttribute(<span class="string">&quot;appScopeMsg&quot;</span>, <span class="string">&quot;i am hungry...&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="spring-MVC-è·³è½¬æ§åˆ¶">spring MVC è·³è½¬æ§åˆ¶</h2>
<ol>
<li>
<p><strong>è§†å›¾è§£æå™¨</strong></p>
<p>spring mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®åŠ¨æ€é¡µé¢è¯­è¨€jspçš„è§†å›¾è§£æå™¨,å¿«é€ŸæŸ¥æ‰¾jsp--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span><span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		ç‰©ç†è·¯å¾„</span></span><br><span class="line"><span class="comment">		å‰ç¼€ï¼š/WEB-INF/views/</span></span><br><span class="line"><span class="comment">		åç¼€ï¼š.jsp</span></span><br><span class="line"><span class="comment">		èµ„æºè·¯å¾„:å‰ç¼€+é€»è¾‘è·¯å¾„+åç¼€</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è®¾ç½®<strong>è½¬å‘</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">// /WEB-INF/views/xxx.jsp</span></span><br><span class="line"><span class="comment">// index:/WEB-INF/views/index.jsp</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">goIndex</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// /xxx.jsp</span></span><br><span class="line"><span class="comment">// test:/test.jsp</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forword:/test.jsp&quot;</span>;  <span class="comment">//è½¬å‘ï¼Œæœ‰å‰ç¼€forwordï¼Œä¸ä¼šè¢«è§†å›¾è§£æå™¨è§£æ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿”å›çš„indexè¢«è§†å›¾è§£æå™¨è§£æï¼Œè¿”å›index.jsp.å®Œæˆè½¬å‘ã€‚</p>
</li>
<li>
<p><strong>é‡å®šå‘</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/redirect-demo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">redirectDemo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// é‡å®šå‘åˆ° /demo è·¯å¾„ </span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/demo&quot;</span>;   <span class="comment">//é‡å®šå‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="è¿”å›Jsonæ•°æ®">è¿”å›Jsonæ•°æ®</h2>
<ol>
<li>
<p>å¯¼å…¥ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.15.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ·»åŠ mvcæ³¨è§£é©±åŠ¨</p>
<p>mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨æ³¨è§£ResponseBody</p>
<p>ç›´æ¥è¿”å›å¯¹è±¡ã€‚</p>
</li>
</ol>
<h2 id="è¿”å›é™æ€èµ„æºå¤„ç†">è¿”å›é™æ€èµ„æºå¤„ç†</h2>
<h3 id="åŸå› ï¼š">åŸå› ï¼š</h3>
<ol>
<li>
<p>åœ¨tomcatä¸­ï¼Œé™æ€èµ„æºç”±DefaultServletèµ„æºå¤„ç†ï¼Œjspèµ„æºç”±JSPServeletå¤„ç†ï¼Œurl=â€œ/*â€</p>
</li>
<li>
<p>ä½†æ˜¯åœ¨spring mvcä¸­ï¼Œé…ç½®äº†DispatcherServelet,ä¸”url=&quot;/&quot;è¿™ä»£è¡¨é™æ€èµ„æºç”±DispatcherServeletå¤„ç†ï¼Œä½†æ˜¯å®ƒå¤„ç†ä¸äº†é™æ€èµ„æºã€‚åªèƒ½å¤„ç†spring mvcè¯·æ±‚ã€‚</p>
</li>
</ol>
<h3 id="å¤„ç†ï¼š">å¤„ç†ï¼š</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--è®¾ç½®DefaultServletå¤„ç†é™æ€èµ„æº--&gt;</span>  ä½†æ˜¯spring mvcè¯·æ±‚ä¸èƒ½è®¿é—®</span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servelet-handler</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…ˆè¢«DispatcherServeletå¤„ç†ã€‚è‹¥æœªæ‰¾åˆ°ï¼Œåˆ™ç”±DefaultServeletå¤„ç†ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servelet-handler</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="RESTFul-é£æ ¼è®¾è®¡">RESTFul é£æ ¼è®¾è®¡</h2>
<ol>
<li>ä¸€ä¸ªURIä»£è¡¨ä¸€ç§èµ„æº</li>
<li>GETï¼šè·å–ã€POSTï¼šæ–°å»ºã€PUT:æ›´æ–°ã€DELETEï¼šåˆ é™¤</li>
<li>èµ„æºè¡¨ç¤ºå½¢å¼æ˜¯XMLæˆ–JSON</li>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´æ˜¯æ— çŠ¶æ€çš„ï¼Œ</li>
</ol>
<p>@CrossOrigin  è§£å†³è·¨åŸŸé—®é¢˜</p>
<h2 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h2>
<p>å£°æ˜å¼å¼‚å¸¸å¤„ç†</p>
<p>æ§åˆ¶å±‚é€šçŸ¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@ControllerAdvice</span><br><span class="line">@RestControllerAdvice</span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šå¤„ç†çš„å¼‚å¸¸ç±»å‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@ExceptionHandler(ServiceException.class)</span><br></pre></td></tr></table></figure>
<h2 id="æ‹¦æˆªå™¨">æ‹¦æˆªå™¨</h2>
<p><strong>å®ç°HandlerInterceptoræ¥å£</strong>;</p>
<blockquote>
<p>==æ‹¦æˆª==æµè§ˆå™¨å‘é€åˆ°æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œä¼šåœ¨æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œ,åœ¨DispatcherServeletå’ŒControllerä¹‹é—´æ‹¦æˆªã€‚</p>
<p>==è¿‡æ»¤å™¨==æ˜¯åœ¨DispatcherServeltä¹‹å‰æ‰§è¡Œã€‚</p>
</blockquote>
<p>preHandle() åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¹‹å‰æ‰§è¡Œ</p>
<p>postHandle() åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¹‹åæ‰§è¡Œ</p>
<p>afterCompletion();åœ¨æ¸²æŸ“è§†å›¾å®Œæ¯•ä¹‹åæ‰§è¡Œ</p>
<ol>
<li>ç¼–å†™Myinterceptor.java</li>
</ol>
<p>â€‹		å®ç°HandleInterceptorçš„æ–¹æ³•ã€‚</p>
<ol start="2">
<li>mvc.xmlé…ç½®æ–‡ä»¶</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é»˜è®¤æ‹¦æˆªæ‰€æœ‰è¯·æ±‚--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;online.zorange.config.Myinterceptor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é»˜è®¤æ‹¦æˆªæ‰€æœ‰è¯·æ±‚--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;myInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        /* ä¸€å±‚è·¯å¾„</span></span><br><span class="line"><span class="comment">        /** å¤šå±‚</span></span><br><span class="line"><span class="comment">        --&gt;</span> </span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--æ‹¦æˆªè·¯å¾„--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ’é™¤è·¯å¾„--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;myInterceptor&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>
<p>å¤šä¸ªæ‹¦æˆªå™¨æ‰§è¡Œé¡ºåº</p>
<p>preHandle() æ–¹æ³•ï¼šSpringMVC ä¼šæŠŠæ‰€æœ‰æ‹¦æˆªå™¨æ”¶é›†åˆ°ä¸€èµ·ï¼Œç„¶åæŒ‰ç…§é…ç½®é¡ºåºè°ƒç”¨å„ä¸ª preHandle() æ–¹æ³•ã€‚</p>
<p>postHandle() æ–¹æ³•ï¼šSpringMVC ä¼šæŠŠæ‰€æœ‰æ‹¦æˆªå™¨æ”¶é›†åˆ°ä¸€èµ·ï¼Œç„¶åæŒ‰ç…§é…ç½®ç›¸åçš„é¡ºåºè°ƒç”¨å„ä¸ª postHandle() æ–¹æ³•ã€‚</p>
<p>afterCompletion() æ–¹æ³•ï¼šSpringMVC ä¼šæŠŠæ‰€æœ‰æ‹¦æˆªå™¨æ”¶é›†åˆ°ä¸€èµ·ï¼Œç„¶åæŒ‰ç…§é…ç½®ç›¸åçš„é¡ºåºè°ƒç”¨å„ä¸ª afterCompletion() æ–¹æ³•ã€‚</p>
</li>
</ol>
<h2 id="å‚æ•°æ ¡éªŒ">å‚æ•°æ ¡éªŒ</h2>
<ol>
<li>
<p>ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ ¡éªŒæ³¨è§£ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.platform<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.jakartaee-web-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">&lt;!-- æ ¡éªŒæ³¨è§£å®ç°--&gt;</span>        </span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator-annotation-processor --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator-annotation-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åº”ç”¨æ³¨è§£</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">| æ³¨è§£ | è§„åˆ™ |</span><br><span class="line">| ---- | ---- |</span><br><span class="line"> | @Null                      | æ ‡æ³¨å€¼å¿…é¡»ä¸º null               |</span><br><span class="line"> | @NotNull                   | æ ‡æ³¨å€¼ä¸å¯ä¸º null               |</span><br><span class="line"> | @AssertTrue                | æ ‡æ³¨å€¼å¿…é¡»ä¸º true               |</span><br><span class="line"> | @AssertFalse               | æ ‡æ³¨å€¼å¿…é¡»ä¸º false              |</span><br><span class="line"> | @Min(value)                | æ ‡æ³¨å€¼å¿…é¡»å¤§äºæˆ–ç­‰äº value          |</span><br><span class="line"> | @Max(value)                | æ ‡æ³¨å€¼å¿…é¡»å°äºæˆ–ç­‰äº value          |</span><br><span class="line"> | @DecimalMin(value)         | æ ‡æ³¨å€¼å¿…é¡»å¤§äºæˆ–ç­‰äº value          |</span><br><span class="line"> | @DecimalMax(value)         | æ ‡æ³¨å€¼å¿…é¡»å°äºæˆ–ç­‰äº value          |</span><br><span class="line"> | @Size(max,min)             | æ ‡æ³¨å€¼å¤§å°å¿…é¡»åœ¨ max å’Œ min é™å®šçš„èŒƒå›´å†… |</span><br><span class="line"> | @Digits(integer,fratction) | æ ‡æ³¨å€¼å€¼å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¸”å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†…   |</span><br><span class="line"> | @Past                      | æ ‡æ³¨å€¼åªèƒ½ç”¨äºæ—¥æœŸå‹ï¼Œä¸”å¿…é¡»æ˜¯è¿‡å»çš„æ—¥æœŸ      |</span><br><span class="line"> | @Future                    | æ ‡æ³¨å€¼åªèƒ½ç”¨äºæ—¥æœŸå‹ï¼Œä¸”å¿…é¡»æ˜¯å°†æ¥çš„æ—¥æœŸ      |</span><br><span class="line"> | @Pattern(value)            | æ ‡æ³¨å€¼å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼           |</span><br><span class="line"> JSR 303 åªæ˜¯ä¸€å¥—æ ‡å‡†ï¼Œéœ€è¦æä¾›å…¶å®ç°æ‰å¯ä»¥ä½¿ç”¨ã€‚Hibernate Validator æ˜¯ JSR 303 çš„ä¸€ä¸ªå‚è€ƒå®ç°ï¼Œé™¤æ”¯æŒæ‰€æœ‰æ ‡å‡†çš„æ ¡éªŒæ³¨è§£å¤–ï¼Œå®ƒè¿˜æ”¯æŒä»¥ä¸‹çš„æ‰©å±•æ³¨è§£ï¼š</span><br><span class="line"> | æ³¨è§£        | è§„åˆ™                   |</span><br><span class="line"> | --------- | -------------------- |</span><br><span class="line"> | @Email    | æ ‡æ³¨å€¼å¿…é¡»æ˜¯æ ¼å¼æ­£ç¡®çš„ Email åœ°å€ |</span><br><span class="line"> | @Length   | æ ‡æ³¨å€¼å­—ç¬¦ä¸²å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…    |</span><br><span class="line"> | @NotEmpty | æ ‡æ³¨å€¼å­—ç¬¦ä¸²ä¸èƒ½æ˜¯ç©ºå­—ç¬¦ä¸²        |</span><br><span class="line"> | @Range    | æ ‡æ³¨å€¼å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…         |</span><br></pre></td></tr></table></figure>
   <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jakarta.validation.constraints.Email;</span><br><span class="line"><span class="keyword">import</span> jakarta.validation.constraints.Min;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Length;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * projectName: com.atguigu.pojo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">//age   1 &lt;=  age &lt; = 150</span></span><br><span class="line">    <span class="meta">@Min(10)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//name 3 &lt;= name.length &lt;= 6</span></span><br><span class="line">    <span class="meta">@Length(min = 3,max = 10)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//email é‚®ç®±æ ¼å¼</span></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>
<p>handleræ ‡è®°å’Œç»‘å®šé”™è¯¯æ”¶é›†</p>
<ol>
<li>
<p><strong>@Validatedè¿›è¡Œæ ¡éªŒ</strong></p>
</li>
<li>
<p>BindingResultï¼Œ<strong>æ¥æ”¶æ ¡éªŒç»“æœ</strong></p>
<p>a. åœ¨å®ä½“ç±»å‚æ•°å’Œ BindingResult ==ä¹‹é—´ä¸èƒ½æœ‰ä»»ä½•å…¶ä»–å‚æ•°,== BindingResultå¯ä»¥æ¥å—é”™è¯¯ä¿¡æ¯,é¿å…ä¿¡æ¯æŠ›å‡º!</p>
<p>b. result.hasErrors()  åˆ¤æ–­æ ¡éªŒæ˜¯å¦æœ‰é”™è¯¯ï¼Œæœ‰ä¸ºtrueï¼Œæ— ï¼šfalseï¼›</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Validated</span> ä»£è¡¨åº”ç”¨æ ¡éªŒæ³¨è§£! å¿…é¡»æ·»åŠ !</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">save</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> User user,</span></span><br><span class="line"><span class="params">                       //åœ¨å®ä½“ç±»å‚æ•°å’Œ BindingResult ä¹‹é—´ä¸èƒ½æœ‰ä»»ä½•å…¶ä»–å‚æ•°, BindingResultå¯ä»¥æ¥å—é”™è¯¯ä¿¡æ¯,é¿å…ä¿¡æ¯æŠ›å‡º!</span></span><br><span class="line"><span class="params">                       BindingResult result)</span>&#123;</span><br><span class="line">       <span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰ä¿¡æ¯ç»‘å®šé”™è¯¯! æœ‰å¯ä»¥è‡ªè¡Œå¤„ç†!</span></span><br><span class="line">        <span class="keyword">if</span> (result.hasErrors())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;é”™è¯¯&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">errorMsg</span> <span class="operator">=</span> result.getFieldError().toString();</span><br><span class="line">            <span class="keyword">return</span> errorMsg;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ²¡æœ‰,æ­£å¸¸å¤„ç†ä¸šåŠ¡å³å¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£å¸¸&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>æ˜“æ··æ€»ç»“</strong></p>
<p>@NotNullã€@NotEmptyã€@NotBlank éƒ½æ˜¯ç”¨äºåœ¨æ•°æ®æ ¡éªŒä¸­æ£€æŸ¥å­—æ®µå€¼æ˜¯å¦ä¸ºç©ºçš„æ³¨è§£ï¼Œä½†æ˜¯å®ƒä»¬çš„ç”¨æ³•å’Œæ ¡éªŒè§„åˆ™æœ‰æ‰€ä¸åŒã€‚</p>
<ol>
<li>
<p>@NotNull  </p>
<p>@NotNull æ³¨è§£æ˜¯ JSR 303 è§„èŒƒä¸­å®šä¹‰çš„æ³¨è§£ï¼Œå½“è¢«æ ‡æ³¨çš„å­—æ®µå€¼ä¸º null æ—¶ï¼Œä¼šè®¤ä¸ºæ ¡éªŒå¤±è´¥è€ŒæŠ›å‡ºå¼‚å¸¸ã€‚è¯¥æ³¨è§£ä¸èƒ½ç”¨äºå­—ç¬¦ä¸²ç±»å‹çš„æ ¡éªŒï¼Œè‹¥è¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ ¡éªŒï¼Œåº”è¯¥ä½¿ç”¨ @NotBlank æˆ– @NotEmpty æ³¨è§£ã€‚</p>
</li>
<li>
<p>@NotEmpty  </p>
<p>@NotEmpty æ³¨è§£åŒæ ·æ˜¯ JSR 303 è§„èŒƒä¸­å®šä¹‰çš„æ³¨è§£ï¼Œå¯¹äº CharSequenceã€Collectionã€Map æˆ–è€…æ•°ç»„å¯¹è±¡ç±»å‹çš„å±æ€§è¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒæ—¶ä¼šæ£€æŸ¥è¯¥å±æ€§æ˜¯å¦ä¸º Null æˆ–è€… size()==0ï¼Œå¦‚æœæ˜¯çš„è¯å°±ä¼šæ ¡éªŒå¤±è´¥ã€‚ä½†æ˜¯å¯¹äºå…¶ä»–ç±»å‹çš„å±æ€§ï¼Œè¯¥æ³¨è§£æ— æ•ˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯åªæ ¡éªŒç©ºæ ¼å‰åçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²ä¸­é—´åªæœ‰ç©ºæ ¼ï¼Œä¸ä¼šè¢«è®¤ä¸ºæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œæ ¡éªŒä¸ä¼šå¤±è´¥ã€‚</p>
</li>
<li>
<p>@NotBlank  </p>
<p>@NotBlank æ³¨è§£æ˜¯ Hibernate Validator é™„åŠ çš„æ³¨è§£ï¼Œå¯¹äºå­—ç¬¦ä¸²ç±»å‹çš„å±æ€§è¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒæ—¶ä¼šæ£€æŸ¥è¯¥å±æ€§æ˜¯å¦ä¸º Null æˆ– â€œâ€ æˆ–è€…åªåŒ…å«ç©ºæ ¼ï¼Œå¦‚æœæ˜¯çš„è¯å°±ä¼šæ ¡éªŒå¤±è´¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ@NotBlank æ³¨è§£åªèƒ½ç”¨äºå­—ç¬¦ä¸²ç±»å‹çš„æ ¡éªŒã€‚<br>
æ€»ä¹‹ï¼Œè¿™ä¸‰ç§æ³¨è§£éƒ½æ˜¯ç”¨äºæ ¡éªŒå­—æ®µå€¼æ˜¯å¦ä¸ºç©ºçš„æ³¨è§£ï¼Œä½†æ˜¯å…¶æ ¡éªŒè§„åˆ™å’Œç”¨æ³•æœ‰æ‰€ä¸åŒã€‚åœ¨è¿›è¡Œæ•°æ®æ ¡éªŒæ—¶ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©åˆé€‚çš„æ³¨è§£è¿›è¡Œæ ¡éªŒã€‚</p>
</li>
</ol>
</li>
</ol>
<h2 id="æ–‡ä»¶ä¸Šä¼ ">æ–‡ä»¶ä¸Šä¼ </h2>
<ol>
<li>
<p>å¯¼å…¥ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Formè¡¨å•</p>
<ol>
<li>ä¸Šä¼ æ–¹å¼å¿…é¡»æ˜¯post</li>
<li>è¯·æ±‚ä½“çš„ç¼–ç æ–¹å¼å¿…é¡»æ˜¯ multipart/form-dataï¼ˆé€šè¿‡ form æ ‡ç­¾çš„ enctype å±æ€§è®¾ç½®ï¼‰</li>
<li>ä½¿ç”¨inputï¼Œè®¾ç½®typeä¸ºfileï¼Œç”Ÿæˆæ–‡ä»¶ä¸Šä¼ æ¡†</li>
</ol>
</li>
<li>
<p>åœ¨spring mvcé…ç½®ä¸­é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ–‡ä»¶ä¸Šä¼ è§£æå™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.support.StandardServletMultipartResolver&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åœ¨<code>web.xml</code>ä¸­é…ç½®æ–‡ä»¶ä¸Šä¼ çš„é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>yourAppServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">multipart-config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å®šä¹‰æ–‡ä»¶ä¸Šä¼ æ—¶æ‰€éœ€çš„æœ€å¤§å€¼ï¼Œå•ä½ä¸ºå­—èŠ‚ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">max-file-size</span>&gt;</span>10485760<span class="tag">&lt;/<span class="name">max-file-size</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å®šä¹‰å•ä¸ªä¸Šä¼ æ–‡ä»¶çš„æœ€å¤§å€¼ï¼Œå•ä½ä¸ºå­—èŠ‚ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">max-request-size</span>&gt;</span>20971520<span class="tag">&lt;/<span class="name">max-request-size</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å®šä¹‰å†…å­˜ä¸­å­˜å‚¨æ–‡ä»¶çš„æœ€å¤§å€¼ï¼Œè¶…è¿‡æ­¤å¤§å°çš„æ–‡ä»¶ä¼šå†™å…¥åˆ°ç¡¬ç›˜ä¸­ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file-size-threshold</span>&gt;</span>5242880<span class="tag">&lt;/<span class="name">file-size-threshold</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">multipart-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åœ¨æ§åˆ¶å™¨ä¸­è·å–æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MutipartFile file)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    file.getName();    <span class="comment">// è¡¨å•é¡¹çš„name</span></span><br><span class="line">    file.getOrginalFileName();   <span class="comment">//æ–‡ä»¶çš„åå­—</span></span><br><span class="line">    </span><br><span class="line">    file.transferTo(<span class="string">&quot;path&quot;</span>/ File);  <span class="comment">// ä¸Šä¼ æ–‡ä»¶ ServeletContext.getRelpath  //webåº”ç”¨çš„éƒ¨ç½²è·¯å¾„</span></span><br><span class="line">    <span class="comment">// File.separator  æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æ–‡ä»¶åˆ†éš”ç¬¦</span></span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadImg</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶ç±»å‹</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> FileUtil.extName(originalFilename);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯ä¸æ˜¯å›¾ç‰‡</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;jpg&quot;</span>.equals(type) &amp;&amp; !<span class="string">&quot;png&quot;</span>.equals(type) &amp;&amp; !<span class="string">&quot;jpeg&quot;</span>.equals(type) &amp;&amp; !<span class="string">&quot;gif&quot;</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(Constants.CODE_NOT_LOGIN,<span class="string">&quot;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶å¤§å°</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> file.getSize();</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶çš„çˆ¶ç›®å½•</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">upLoadParentFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadImg);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­çˆ¶ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (!upLoadParentFile.exists()) &#123;</span><br><span class="line">            upLoadParentFile.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªæ–‡ä»¶çš„å”¯ä¸€çš„ä¸€ä¸ªæ ‡è¯†ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> IdUtil.fastSimpleUUID();</span><br><span class="line">        <span class="comment">//æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç +æ–‡ä»¶çš„åç¼€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">FileUuid</span> <span class="operator">=</span> uuid + <span class="string">&quot;.&quot;</span> + type;</span><br><span class="line">        <span class="comment">//å®é™…ä¸Šä¼ æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">upLoadImg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadImg + FileUuid);</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶çš„md5,ç”¨äºåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">md5</span> <span class="operator">=</span> SecureUtil.md5(file.getInputStream());</span><br><span class="line">        <span class="comment">//æ–‡ä»¶çš„è®¿é—®è·¯å¾„</span></span><br><span class="line">        String Url;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨,å¦‚æœå­˜åœ¨,åˆ™ç›´æ¥è¿”å›æ–‡ä»¶çš„è®¿é—®è·¯å¾„</span></span><br><span class="line">        QueryWrapper&lt;Files&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;md5&quot;</span>, md5);</span><br><span class="line">        List&lt;Files&gt; filesList =<span class="built_in">this</span>.list(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (filesList.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">//å°†æ–‡ä»¶å†™å…¥åˆ°æŒ‡å®šçš„è·¯å¾„</span></span><br><span class="line">            file.transferTo(upLoadImg);</span><br><span class="line">            <span class="comment">//æ–‡ä»¶çš„è®¿é—®è·¯å¾„</span></span><br><span class="line">            Url = serverIp + <span class="string">&quot;/files/download/&quot;</span> + FileUuid;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>   filesList.get(<span class="number">0</span>).getUrl();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å°†æ–‡ä»¶ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line">        <span class="type">Files</span> <span class="variable">saveFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Files</span>();</span><br><span class="line">        saveFile.setName(originalFilename);</span><br><span class="line">        saveFile.setType(type);</span><br><span class="line">        saveFile.setSize(size / <span class="number">1024</span>);</span><br><span class="line">        saveFile.setUrl(Url);</span><br><span class="line">        saveFile.setMd5(md5);</span><br><span class="line">        <span class="built_in">this</span>.save(saveFile);</span><br><span class="line">        <span class="keyword">return</span> Url;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="æ–‡ä»¶ä¸‹è½½">æ–‡ä»¶ä¸‹è½½</h2>
<p>å®Œæ•´çš„æŠ¥æ–‡ä¿¡æ¯</p>
<p><code>ResponseEntity </code></p>
<p><code>ReqestEntity</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> ResponseEntity&lt;å“åº”ä½“çš„ç±»å‹ <span class="type">byte</span>[]&gt;()&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è·å–æ–‡ä»¶çš„å­—èŠ‚æ•°ç»„ã€‚å“åº”ä½“</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    * æ–°å»ºå“åº”å¤´ï¼Œnew HttpHeaders()</span></span><br><span class="line"><span class="comment">    * å°†å“åº”å¤´ï¼šè®¾ç½®ä¸º(&quot;Content-Disposition&quot;,&quot;attachment;filename=a.png&quot;)</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    * åˆ›å»ºResponseEntityå¯¹è±¡ new ResponseEntity(byte[],å“åº”å¤´,HttpStatus.ok)</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    * è¿”å›</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">download</span><span class="params">(String fileUuid, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(fileUuid);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">        String url= serverIp + <span class="string">&quot;/files/download/&quot;</span> + fileUuid;</span><br><span class="line">        QueryWrapper&lt;Files&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;url&quot;</span>, url);</span><br><span class="line">        <span class="type">Files</span> <span class="variable">one</span> <span class="operator">=</span> <span class="built_in">this</span>.getOne(queryWrapper);</span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> FileUtil.extName(fileUuid);</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">        String filePath;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;jpg&quot;</span>.equals(type) || <span class="string">&quot;png&quot;</span>.equals(type) || <span class="string">&quot;jpeg&quot;</span>.equals(type) || <span class="string">&quot;gif&quot;</span>.equals(type)) &#123;</span><br><span class="line">            filePath = uploadImg + fileUuid;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            filePath = uploadArticle + fileUuid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);</span><br><span class="line">       <span class="comment">// å½“ä¸ºå›¾ç‰‡æ—¶</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;jpg&quot;</span>.equals(type) || <span class="string">&quot;png&quot;</span>.equals(type) || <span class="string">&quot;jpeg&quot;</span>.equals(type) || <span class="string">&quot;gif&quot;</span>.equals(type)) &#123;</span><br><span class="line">            response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¾ç½®å“åº”å†…å®¹ç±»å‹ä¸ºäºŒè¿›åˆ¶æµï¼Œä»¥ä¾¿ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line">            response.setContentType(<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">            <span class="comment">// è®¾ç½®å“åº”å¤´ï¼ŒæŒ‡å®šä¸‹è½½æ—¶çš„æ–‡ä»¶åï¼Œå¹¶ä½¿ç”¨UTF-8ç¼–ç æ–‡ä»¶åä»¥æ”¯æŒä¸­æ–‡æ–‡ä»¶å</span></span><br><span class="line">            response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(one.getName(), StandardCharsets.UTF_8));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶è¾“å…¥æµ</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> FileUtil.getInputStream(file);</span><br><span class="line">        <span class="comment">//è·å–è¾“å‡ºæµ</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="comment">//å°†æ–‡ä»¶å†™å…¥åˆ°è¾“å‡ºæµ</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="keyword">while</span> ((len = inputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            outputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å…³é—­æµ</span></span><br><span class="line">        inputStream.close();</span><br><span class="line">        outputStream.close();</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Spring-MVC-æ‰§è¡Œæµç¨‹">Spring MVC æ‰§è¡Œæµç¨‹</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">æµè§ˆå™¨å‘é€è¯·æ±‚ï¼šå®¢æˆ·ç«¯é€šè¿‡HTTPè¯·æ±‚å‘æœåŠ¡å™¨å‘èµ·è®¿é—®ã€‚</span><br><span class="line">DispatcherServletæ¥æ”¶è¯·æ±‚ï¼šSpring MVCçš„æ ¸å¿ƒç»„ä»¶DispatcherServletæ•è·åˆ°è¯·æ±‚ã€‚</span><br><span class="line">HandlerMappingå¯»æ‰¾å¤„ç†å™¨ï¼šDispatcherServletå§”æ‰˜ç»™HandlerMappingæ¥å†³å®šåº”è¯¥ç”±å“ªä¸ªæ§åˆ¶å™¨ï¼ˆHandlerï¼‰å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚</span><br><span class="line">å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å¤„ç†å™¨ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªç©ºçš„ç»“æœï¼Œæ­¤æ—¶å¯èƒ½ä¼šæ ¹æ®é…ç½®èµ°å‘é»˜è®¤çš„servletæˆ–å…¶ä»–é”™è¯¯å¤„ç†æœºåˆ¶ã€‚</span><br><span class="line">HandlerAdapteré€‚é…å¤„ç†å™¨ï¼šå¦‚æœæ‰¾åˆ°åˆé€‚çš„å¤„ç†å™¨ï¼ŒHandlerMappingå°†è¿”å›åŒ…å«å¤„ç†å™¨åŠå…¶é€‚é…å™¨çš„ä¿¡æ¯ã€‚DispatcherServletå†é€‰æ‹©ä¸€ä¸ªHandlerAdapteræ¥è°ƒç”¨å¤„ç†å™¨æ–¹æ³•ã€‚</span><br><span class="line">æ‹¦æˆªå™¨ï¼ˆå¯é€‰ï¼‰ï¼šåœ¨è°ƒç”¨å¤„ç†å™¨æ–¹æ³•ä¹‹å‰ï¼Œå¦‚æœæœ‰é…ç½®æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ï¼Œåˆ™é¦–å…ˆæ‰§è¡Œæ‹¦æˆªå™¨çš„preHandle()æ–¹æ³•ã€‚</span><br><span class="line">è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•ï¼šé€šè¿‡HandlerAdapterè°ƒç”¨å…·ä½“çš„æ§åˆ¶å™¨æ–¹æ³•ã€‚</span><br><span class="line">æ¨¡å‹æ•°æ®å¡«å……ï¼šæ§åˆ¶å™¨æ–¹æ³•å¤„ç†å®Œåï¼Œé€šå¸¸ä¼šè¿”å›ä¸€ä¸ªModelAndViewå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«è§†å›¾åç§°ä»¥åŠæ¨¡å‹æ•°æ®ã€‚</span><br><span class="line">æ‹¦æˆªå™¨ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœé…ç½®äº†æ‹¦æˆªå™¨ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œæ‹¦æˆªå™¨çš„postHandle()æ–¹æ³•ã€‚</span><br><span class="line">è§†å›¾è§£æï¼šè§†å›¾åç§°è¢«ä¼ é€’ç»™ViewResolverè¿›è¡Œè§£æï¼Œå¾—åˆ°å®é™…çš„è§†å›¾å¯¹è±¡ã€‚</span><br><span class="line">æ¸²æŸ“è§†å›¾ï¼šè§†å›¾å¯¹è±¡è´Ÿè´£æ¸²æŸ“é¡µé¢ï¼ŒåŒæ—¶ä½¿ç”¨æ¨¡å‹æ•°æ®å¡«å……é¡µé¢å†…å®¹ã€‚</span><br><span class="line">æ‹¦æˆªå™¨ï¼ˆå¯é€‰ï¼‰ï¼šæœ€åï¼Œå¦‚æœé…ç½®äº†æ‹¦æˆªå™¨ï¼Œæ‰§è¡Œæ‹¦æˆªå™¨çš„afterCompletion()æ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure>
<p>==Spring MVCæ¡†æ¶ä¸­çš„è¯·æ±‚å¤„ç†æµç¨‹==:</p>
<p>æµè§ˆå™¨å‘é€è¯·æ±‚-&gt;DispatcherServeletæ¥æ”¶è¯·æ±‚-&gt;HandlerMappingé€šè¿‡æ§åˆ¶å™¨æ˜ å°„å™¨æŸ¥æ‰¾æ§åˆ¶å™¨ï¼Œ-&gt;1. è‹¥æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„æ§åˆ¶å™¨ï¼Œ-&gt;1.1 å¦‚æœé…ç½®äº†é»˜è®¤çš„serveletï¼Œé€šè¿‡é»˜è®¤çš„serveletæ¥å¤„ç†è¯·æ±‚ï¼Œ-&gt;1.2  å¦‚æœæ²¡æœ‰é…ç½®é»˜è®¤çš„serveletï¼Œåˆ™è¿”å›404-&gt; 2. æ‰¾åˆ°äº†å¯¹åº”çš„æ§åˆ¶å™¨-&gt; å°†æ§åˆ¶å™¨æ·»åŠ åˆ°å¤„ç†å™¨è°ƒç”¨é“¾ä¸­-&gt;é€šè¿‡æ§åˆ¶å™¨æ˜ å°„å™¨å¾—åˆ°å¤„ç†å™¨é€‚é…å™¨HandlerAdapter-&gt;è°ƒç”¨æ‹¦æˆªå™¨çš„preHandleræ–¹æ³•-&gt;é€šè¿‡å¤„ç†å™¨é€‚é…å™¨è°ƒå¯¹åº”çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªModelAndViewå¯¹è±¡ï¼ŒåŒ…å«è§†å›¾åç§°åŠæ¨¡å‹æ•°æ®ï¼Œ-&gt;  æ‹¦æˆªå™¨è°ƒç”¨Posthandleræ–¹æ³•ã€‚-&gt;  è°ƒç”¨è§†å›¾è§£æå’Œè§†å›¾æ¸²æŸ“-&gt;è°ƒç”¨æ‹¦æˆªå™¨çš„afterCompletionæ–¹æ³•ã€‚</p>
<hr>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot+vueå­¦ä¹ </title>
    <url>/2023/09/07/SpringBoot-vue%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="Application-yml-é…ç½®">Application.yml é…ç½®</h2>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8181</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">421232</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span> <span class="comment">#calsspathä»£è¡¨resourcesç›®å½•</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">online.zorange.springboot.entity</span></span><br></pre></td></tr></table></figure>
<h2 id="sql-è¯­å¥å†™çš„ä½ç½®">sql è¯­å¥å†™çš„ä½ç½®</h2>
<ol>
<li>
<h4 id="æ³¨è§£">æ³¨è§£</h4>
</li>
</ol>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012100115.png" alt="image-20260121012100115"></p>
<ol start="2">
<li>mybatis çš„ xml æ–‡ä»¶é‡Œé¢</li>
</ol>
<p><img src="D:/OrangeZSW.github.io/source/_posts/Img_Typora/SpringBoot-vue%E5%AD%A6%E4%B9%A0/image-20231001103944233.png" alt=""></p>
<h2 id="è·¨åŸŸé—®é¢˜">è·¨åŸŸé—®é¢˜</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.CorsFilter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfig</span> &#123;</span><br><span class="line">    <span class="comment">//å½“å‰è·¨åŸŸæœ€å¤§æœ‰æ•ˆæ—¶é•¿ã€‚è¿™é‡Œé»˜è®¤1å¤©</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">MAX_AGE</span> <span class="operator">=</span> <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsFilter <span class="title function_">corsFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–corsé…ç½®å¯¹è±¡</span></span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        <span class="comment">//é…ç½®è·¨åŸŸè§„åˆ™</span></span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">corsConfiguration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…è®¸æºå¸¦cookie</span></span><br><span class="line">        corsConfiguration.addAllowedOriginPattern(<span class="string">&quot;http://localhost:8080&quot;</span>);</span><br><span class="line">        <span class="comment">//å…è®¸æ‰€æœ‰è¯·æ±‚å¤´</span></span><br><span class="line">        corsConfiguration.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//å…è®¸æ‰€æœ‰è¯·æ±‚æ–¹æ³•	</span></span><br><span class="line">        corsConfiguration.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//é…ç½®è·¨åŸŸè¯·æ±‚çš„åŸŸå</span></span><br><span class="line">        corsConfiguration.setMaxAge(MAX_AGE);</span><br><span class="line">        <span class="comment">//æ·»åŠ æ˜ å°„è·¯å¾„ï¼Œæ‹¦æˆªä¸€åˆ‡è¯·æ±‚</span></span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, corsConfiguration);</span><br><span class="line">        <span class="comment">//è¿”å›corsFilterå®ä¾‹ï¼Œå‚æ•°ï¼šcorsé…ç½®æºå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsFilter</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="å¿½ç•¥æŸä¸ªå­—æ®µï¼Œä¸å±•ç¤ºç»™å‰ç«¯">å¿½ç•¥æŸä¸ªå­—æ®µï¼Œä¸å±•ç¤ºç»™å‰ç«¯</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonIgnore</span></span><br><span class="line"><span class="keyword">private</span> String password;</span><br></pre></td></tr></table></figure>
<h2 id="Mybatis-plus-å®ä½“ç±»çš„æ³¨è§£">Mybatis plus å®ä½“ç±»çš„æ³¨è§£</h2>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012151145.png" alt="image-20260121012151145"></p>
<h2 id="åç«¯åˆ†é¡µï¼ˆUserController-javaï¼‰">åç«¯åˆ†é¡µï¼ˆUserController.javaï¼‰</h2>
<h3 id="ä½¿ç”¨-Mybatis-Plus">ä½¿ç”¨ Mybatis-Plus</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨mybatis-plusçš„åˆ†é¡µæ’ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;User&gt; <span class="title function_">findByPage</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> Integer pageNum,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> Integer pageSize,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;&quot;)</span> String userName,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;&quot;)</span> String email,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;&quot;)</span> String address)</span>&#123;</span><br><span class="line">        IPage&lt;User&gt; page= <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper=<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.like(<span class="string">&quot;username&quot;</span>,userName);</span><br><span class="line">        <span class="comment">//è¿™é‡Œç”¨andæ˜¯å› ä¸ºå¦‚æœç›´æ¥ç”¨likeï¼Œå¯èƒ½æ¡†æ¶æ‹¼æ¥sqlæ—¶æ²¡æœ‰åŠ ä¸Šandï¼Œå¯¼è‡´æŸ¥è¯¢ç»“æœä¸æ­£ç¡®ï¼Œä½†æ˜¯mybatis-plusçš„wrapperå¯¹è±¡æä¾›äº†andæ–¹æ³•ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</span></span><br><span class="line"><span class="comment">//        wrapper.and(w-&gt;w.like(&quot;email&quot;,email));</span></span><br><span class="line">        wrapper.like(<span class="string">&quot;email&quot;</span>,email);</span><br><span class="line">        wrapper.like(<span class="string">&quot;address&quot;</span>,address);</span><br><span class="line">        <span class="keyword">return</span> userService.page(page,wrapper);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Mapper-interface">Mapper.interface</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> * ä¸ä½¿ç”¨mybatis-plusçš„åˆ†é¡µæ’ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//æ¥å£è·¯å¾„ä¸º/user/page?pageNum=1&amp;pageSize=10</span></span><br><span class="line"><span class="comment">//@RequestParamæ³¨è§£ç”¨äºè·å–è¯·æ±‚å‚æ•°çš„å€¼,å³å°†urlä¸­çš„pageNumå’ŒpageSizeçš„å€¼ä¼ é€’ç»™è¿™ä¸¤ä¸ªå‚æ•°ã€‚</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">findByPage</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam</span> Integer pageNum,</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam</span> Integer pageSize,</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam</span> String userName,</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam</span> String email,</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam</span> String address)</span>&#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢æ€»æ¡æ•°</span></span><br><span class="line">    Integer total=userMapper.selectTotal(userName,email,address);</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢ç¬¬å‡ é¡µï¼Œæ¯é¡µå‡ æ¡æ•°æ®</span></span><br><span class="line">    pageNum=(pageNum-<span class="number">1</span>)*pageSize;</span><br><span class="line">    List&lt;User&gt; data=userMapper.selectPage(pageNum,pageSize,userName,email,address);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†æ•°æ®å°è£…æˆmap</span></span><br><span class="line">    Map&lt;String, Object&gt; res=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    res.put(<span class="string">&quot;data&quot;</span>,data);</span><br><span class="line">    res.put(<span class="string">&quot;total&quot;</span>,total);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="mybatisPlus-é…ç½®">mybatisPlus é…ç½®</h2>
<h3 id="pom-xml-ä¾èµ–">pom.xml ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--        mybatis-plusä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="mybatisPlusConfig-java">mybatisPlusConfig.java</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;online.zorange.springboot.mapper&quot;)</span><span class="comment">//æ‰«æmapperæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ åˆ†é¡µæ’ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));<span class="comment">//å¦‚æœé…ç½®å¤šä¸ªæ’ä»¶,åˆ‡è®°åˆ†é¡µæœ€åæ·»åŠ </span></span><br><span class="line">        <span class="comment">//interceptor.addInnerInterceptor(new PaginationInnerInterceptor()); å¦‚æœæœ‰å¤šæ•°æ®æºå¯ä»¥ä¸é…å…·ä½“ç±»å‹ å¦åˆ™éƒ½å»ºè®®é…ä¸Šå…·ä½“çš„DbType</span></span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="axios">axios</h2>
<h3 id="1-npm-i-axios-S">1. (npm i axios -S)</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm i axios -S</span><br></pre></td></tr></table></figure>
<h4 id="å°è£…ä»£ç ">å°è£…ä»£ç </h4>
<p>src/utils/request.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> request = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&quot;/api&quot;</span>, <span class="comment">// æ³¨æ„ï¼ï¼ è¿™é‡Œæ˜¯å…¨å±€ç»Ÿä¸€åŠ ä¸Šäº† &#x27;/api&#x27; å‰ç¼€ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰æ¥å£éƒ½ä¼šåŠ ä¸Š&#x27;/api&#x27;å‰ç¼€åœ¨ï¼Œé¡µé¢é‡Œé¢å†™æ¥å£çš„æ—¶å€™å°±ä¸è¦åŠ  &#x27;/api&#x27;äº†ï¼Œå¦åˆ™ä¼šå‡ºç°2ä¸ª&#x27;/api&#x27;ï¼Œç±»ä¼¼ &#x27;/api/api/user&#x27;è¿™æ ·çš„æŠ¥é”™ï¼Œåˆ‡è®°ï¼ï¼ï¼</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// request æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">// å¯ä»¥è‡ªè¯·æ±‚å‘é€å‰å¯¹è¯·æ±‚åšä¸€äº›å¤„ç†</span></span><br><span class="line"><span class="comment">// æ¯”å¦‚ç»Ÿä¸€åŠ tokenï¼Œå¯¹è¯·æ±‚å‚æ•°ç»Ÿä¸€åŠ å¯†</span></span><br><span class="line">request.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">headers</span>[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&quot;application/json;charset=utf-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// config.headers[&#x27;token&#x27;] = user.token;  // è®¾ç½®è¯·æ±‚å¤´</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// response æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">// å¯ä»¥åœ¨æ¥å£å“åº”åç»Ÿä¸€å¤„ç†ç»“æœ</span></span><br><span class="line">request.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> res = response.<span class="property">data</span>;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯è¿”å›çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (response.<span class="property">config</span>.<span class="property">responseType</span> === <span class="string">&quot;blob&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…¼å®¹æœåŠ¡ç«¯è¿”å›çš„å­—ç¬¦ä¸²æ•°æ®</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> res === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      res = res ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res) : res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err&quot;</span> + error); <span class="comment">// for debug</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></table></figure>
<h4 id="main-js">main.js</h4>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012245012.png" alt="image-20260121012245012"></p>
<p>ä½¿ç”¨ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012256527.png" alt="image-20260121012256527"></p>
<h3 id="2-vue-add-axios">2. vue add axios</h3>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vue add axios</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012315388.png" alt="image-20260121012315388"></p>
<p>è¿”å›çš„æ•°æ®ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012323039.png" alt="image-20260121012323039"></p>
<h2 id="è·¯ç”±">è·¯ç”±</h2>
<h3 id="å­è·¯ç”±">å­è·¯ç”±</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">children: [ &#123; å­è·¯ç”±ä¸€ &#125;, &#123; å­è·¯ç”±äºŒ &#125; ]</span><br></pre></td></tr></table></figure>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012340651.png" alt="image-20260121012340651"></p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª components.vue</li>
<li>å°†éœ€è¦çš„ç»„ä»¶å¤åˆ¶è¿‡æ¥</li>
<li>å®šä¹‰è‡ªå®šä¹‰çš„å€¼</li>
</ol>
<p><img src="D:/OrangeZSW.github.io/source/_posts/Img_Typora/SpringBoot-vue%E5%AD%A6%E4%B9%A0/image-20231009191648584.png" alt=""></p>
<ol start="4">
<li>å¯¼å…¥ components</li>
</ol>
<p><img src="D:/OrangeZSW.github.io/source/_posts/Img_Typora/SpringBoot-vue%E5%AD%A6%E4%B9%A0/image-20231009191925407.png" alt=""></p>
<ol start="5">
<li>å¼•ç”¨+ä¼ å€¼</li>
</ol>
<p><img src="D:/OrangeZSW.github.io/source/_posts/Img_Typora/SpringBoot-vue%E5%AD%A6%E4%B9%A0/image-20231009192355327.png" alt=""></p>
<h2 id="Excel-å¯¼å‡º">Excel å¯¼å‡º</h2>
<p><a href="https://loolly_admin.oschina.io/hutool-site/docs/#/poi/Excel%E7%94%9F%E6%88%90-ExcelWriter">hutool</a></p>
<h3 id="å®‰è£…ä¾èµ–">å®‰è£…ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--        hutoolä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="åˆ«å">åˆ«å</h3>
<p>åœ¨å¯¼å…¥å’Œå¯¼å‡ºæ—¶ï¼Œä½¿ç”¨åˆ«åï¼Œ</p>
<p>åœ¨<code>entity</code>å¯¹è±¡åŠ ä¸ª<code>hutool</code>çš„<code>Alias</code>æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.annotation.Alias;</span><br><span class="line"></span><br><span class="line"><span class="comment">//hu-toolçš„æ³¨è§£,è§£å†³å¯¼å…¥æ—¶å­—æ®µä¸ºä¸­æ–‡æ—¶è¯†åˆ«ä¸äº†çš„é—®é¢˜</span></span><br><span class="line">      <span class="meta">@Alias(&quot;ç”¨æˆ·å&quot;)</span></span><br><span class="line">      <span class="meta">@ApiModelProperty(&quot;ç”¨æˆ·å&quot;)</span></span><br><span class="line">      <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Alias(&quot;å¯†ç &quot;)</span></span><br><span class="line">      <span class="meta">@ApiModelProperty(&quot;å¯†ç &quot;)</span></span><br><span class="line">      <span class="keyword">private</span> String password;</span><br></pre></td></tr></table></figure>
<p>ç”¨äº†æ³¨è§£ä¹‹åä¸‹é¢ä»£ç é‡Œé¢èµ·åˆ«åå°±å¯ä»¥å»æ‰äº†ã€‚</p>
<h3 id="å¯¼å‡º">å¯¼å‡º</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">//å¯¼å‡ºexcel</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">//        ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ‰€æœ‰çš„æ•°æ®</span></span><br><span class="line">          List&lt;User&gt; list = userService.list();</span><br><span class="line"><span class="comment">//        å¯¼å‡º    1.åˆ›å»ºwriterå¯¹è±¡    2.è®¾ç½®excelè¡¨å¤´    3.å†™å‡ºæ•°æ®</span></span><br><span class="line">        <span class="type">ExcelWriter</span> <span class="variable">writer</span> <span class="operator">=</span> ExcelUtil.getWriter(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        åˆ«åï¼Œä¹Ÿå¯ä»¥ç”¨æ³¨è§£æ¥è®¾ç½®</span></span><br><span class="line">        writer.addHeaderAlias(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;ç¼–å·&quot;</span>);</span><br><span class="line">        writer.addHeaderAlias(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;ç”¨æˆ·å&quot;</span>);</span><br><span class="line">        writer.addHeaderAlias(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;å¯†ç &quot;</span>);</span><br><span class="line">        writer.addHeaderAlias(<span class="string">&quot;nickname&quot;</span>,<span class="string">&quot;æ˜µç§°&quot;</span>);</span><br><span class="line">        writer.addHeaderAlias(<span class="string">&quot;email&quot;</span>,<span class="string">&quot;é‚®ç®±&quot;</span>);</span><br><span class="line">        writer.addHeaderAlias(<span class="string">&quot;phone&quot;</span>,<span class="string">&quot;ç”µè¯&quot;</span>);</span><br><span class="line">        writer.addHeaderAlias(<span class="string">&quot;address&quot;</span>,<span class="string">&quot;åœ°å€&quot;</span>);</span><br><span class="line">        writer.addHeaderAlias(<span class="string">&quot;creatTime&quot;</span>,<span class="string">&quot;åˆ›å»ºæ—¶é—´&quot;</span>);</span><br><span class="line"><span class="comment">//        å°†listå¯¹è±¡å†™å‡ºåˆ°writerä¸­</span></span><br><span class="line">        writer.write(list);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®æµè§ˆå™¨å“åº”æ ¼å¼</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/vnd.ms-excel;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="comment">//        è®¾ç½®å“åº”å¤´ä¿¡æ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> URLEncoder.encode(<span class="string">&quot;ç”¨æˆ·åˆ—è¡¨&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="comment">//        è®¾ç½®å“åº”å¤´</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span>+fileName+<span class="string">&quot;.xls&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        å°†writerä¸­çš„æ•°æ®å†™å‡ºåˆ°æµè§ˆå™¨</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        writer.flush(out,<span class="literal">true</span>);</span><br><span class="line">        out.close();</span><br><span class="line">        writer.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¯¼å…¥">å¯¼å…¥</h3>
<p>åç«¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¯¼å…¥excel</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/import&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">importUser</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//è·å–ä¸Šä¼ çš„æ–‡ä»¶æµ</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> file.getInputStream();</span><br><span class="line">    <span class="comment">//è¯»å–excel</span></span><br><span class="line">    <span class="type">ExcelReader</span> <span class="variable">reader</span> <span class="operator">=</span> ExcelUtil.getReader(in);</span><br><span class="line">    <span class="comment">//è¯»å–ç¬¬äºŒè¡Œå¼€å§‹çš„æ•°æ®</span></span><br><span class="line">    List&lt;User&gt; list = reader.readAll(User.class);</span><br><span class="line">    <span class="comment">//æ‰¹é‡ä¿å­˜åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line">    System.out.println(list);</span><br><span class="line">    <span class="keyword">return</span> userService.saveBatch(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‰ç«¯</p>
<p>element çš„ç»„ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-upload</span><br><span class="line">  action=&quot;http://localhost:8181/user/import&quot;</span><br><span class="line">  style=&quot;display: inline-block&quot;</span><br><span class="line">  :show-file-list=&quot;false&quot;</span><br><span class="line">  :accept=&quot;xlsx&quot;</span><br><span class="line">  :on-success=&quot;handleExcelSuccess&quot;</span><br><span class="line">&gt;</span><br><span class="line">        &lt;el-button style=&quot;margin: 5px&quot; type=&quot;primary&quot; &gt;å¯¼å…¥&lt;i class=&quot;el-icon-download&quot;&gt;&lt;/i&gt;&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-upload&gt;</span><br></pre></td></tr></table></figure>
<h2 id="æ—¥å¿—æ‰“å°ï¼š">æ—¥å¿—æ‰“å°ï¼š</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Slf4jæ³¨è§£æ˜¯lombokæä¾›çš„ï¼Œç”¨äºæ‰“å°æ—¥å¿—</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br></pre></td></tr></table></figure>
<h2 id="Spring-Boot-å±‚">Spring Boot å±‚</h2>
<p><img src="D:/OrangeZSW.github.io/source/_posts/Img_Typora/SpringBoot-vue%E5%AD%A6%E4%B9%A0/image-20231017151940841.png" alt=""></p>
<p>common ç»Ÿä¸€åŒ…è£…</p>
<p>config è¿‡æ»¤å±‚</p>
<p>controller æ§åˆ¶</p>
<p>entity å®ä½“ç±»</p>
<pre><code>	Dao æ•°æ®åŒ…è£…ç±»
</code></pre>
<p>exception è‡ªå®šä¹‰å¼‚å¸¸</p>
<p>mapper æ¥å£</p>
<p>service æœåŠ¡</p>
<p>utils å·¥å…·</p>
<h3 id="common-ç»Ÿä¸€åŒ…è£…">common ç»Ÿä¸€åŒ…è£…</h3>
<p><code>constants.java</code></p>
<p>å®šä¹‰å¸¸é‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.common;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ç”¨äºå­˜æ”¾å¸¸é‡</span></span><br><span class="line"><span class="comment"> * å¸¸é‡æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Constants</span> &#123;</span><br><span class="line">    <span class="comment">//æ“ä½œæˆåŠŸ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">CODE_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;200&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MSG_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;æ“ä½œæˆåŠŸ&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç³»ç»Ÿé”™è¯¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">CODE_ERROR</span> <span class="operator">=</span> <span class="string">&quot;500&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MSG_ERROR</span> <span class="operator">=</span> <span class="string">&quot;ç³»ç»Ÿé”™è¯¯&quot;</span>;</span><br><span class="line">    <span class="comment">//å‚æ•°é”™è¯¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">CODE_PARAM_ERROR</span> <span class="operator">=</span> <span class="string">&quot;400&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MSG_PARAM_ERROR</span> <span class="operator">=</span> <span class="string">&quot;å‚æ•°é”™è¯¯&quot;</span>;</span><br><span class="line">    <span class="comment">//å…¶ä»–ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">CODE_OTHER_ERROR</span> <span class="operator">=</span> <span class="string">&quot;501&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MSG_OTHER_ERROR</span> <span class="operator">=</span> <span class="string">&quot;å…¶ä»–ä¸šåŠ¡å¼‚å¸¸&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">CODE_NOT_LOGIN</span> <span class="operator">=</span> <span class="string">&quot;401&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MSG_NOT_LOGIN</span> <span class="operator">=</span> <span class="string">&quot;æƒé™ä¸è¶³&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Result.java</code></p>
<p>æ¥å£ï¼Œç»Ÿä¸€è¿”å›åŒ…è£…ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* æ¥å£ï¼Œç»Ÿä¸€è¿”å›åŒ…è£…ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">//æ— å‚æ„é€ </span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">//æœ‰å‚æ„é€ </span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="comment">//æ³›å‹ï¼Œå¯ä»¥æ˜¯ä»»æ„ç±»å‹</span></span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line">    <span class="comment">//æˆåŠŸçš„æ–¹æ³•ï¼Œæ²¡æœ‰è¿”å›æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(Constants.CODE_SUCCESS,Constants.MSG_SUCCESS,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æˆåŠŸçš„æ–¹æ³•ï¼Œæœ‰è¿”å›æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">(Object data)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(Constants.CODE_SUCCESS,Constants.MSG_SUCCESS,data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¤±è´¥çš„æ–¹æ³•ï¼Œæ²¡æœ‰è¿”å›æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(Constants.CODE_ERROR,Constants.MSG_ERROR,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¤±è´¥çš„æ–¹æ³•ï¼Œæœ‰è¿”å›çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(Constants.CODE_ERROR,msg,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¤±è´¥çš„æ–¹æ³•ï¼Œæœ‰è‡ªå®šä¹‰çš„é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">(String code,String msg)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(code,msg,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="exception-è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†">exception è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</h3>
<p><code>GlobalExceptionHandler.java</code></p>
<p>å…¨å±€å¼‚å¸¸å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.common.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†ServiceExceptionå¼‚å¸¸,å¦‚æœæŠ›å‡ºServiceExceptionå¼‚å¸¸ï¼Œå°±ä¼šè¢«è¯¥æ–¹æ³•æ•è·ï¼Œç„¶åè¿è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * ç»§æ‰¿äº†RuntimeExceptionï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨æ–¹æ³•ä¸ŠæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> e ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> Result</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ServiceException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">handle</span><span class="params">(ServiceException e)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(e.getCode(),e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>ServiceException.java</code></p>
<p>è‡ªå®šä¹‰æœåŠ¡ç±»å¼‚å¸¸å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String code;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">(String code, String msg)</span>&#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•</span></span><br><span class="line">        <span class="built_in">super</span>(msg);</span><br><span class="line">        <span class="built_in">this</span>.code=code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="JWTç™»å½•">JWTç™»å½•</h2>
<h3 id="ä¾èµ–">ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--        jwtä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="ç”Ÿæˆtoken">ç”Ÿæˆtoken</h3>
<p>utils.tokenUtil.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.JWT;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.algorithms.Algorithm;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆtoken</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">genToken</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JWT.create().withAudience(String.valueOf(user.getId()))   <span class="comment">//å°†user idä¿å­˜åœ¨tokené‡Œé¢ï¼Œä½œä¸ºè½½è·</span></span><br><span class="line">                .withExpiresAt(DateUtil.offsetHour(<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="number">2</span>))  <span class="comment">//2å°æ—¶tokenå¤±æ•ˆ</span></span><br><span class="line">                .sign(Algorithm.HMAC256(user.getPassword()));  <span class="comment">//å°†password  ä½œä¸ºtokenå¯†é’¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="å‰ç«¯æ”¾å¼€è¯·æ±‚å¤´">å‰ç«¯æ”¾å¼€è¯·æ±‚å¤´</h3>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user=<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;user&quot;</span>) ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;user&quot;</span>)) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(user)&#123;</span><br><span class="line">    config.<span class="property">headers</span>[<span class="string">&#x27;token&#x27;</span>] = user.<span class="property">token</span>;  <span class="comment">// è®¾ç½®è¯·æ±‚å¤´</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºæ‹¦æˆªå™¨">åˆ›å»ºæ‹¦æˆªå™¨</h3>
<p><code>config.interceptor.JWTinterceptor.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.config.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.JWT;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.JWTVerifier;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.algorithms.Algorithm;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.exceptions.JWTDecodeException;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.exceptions.JWTVerificationException;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.common.Constants;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.entity.User;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.exception.ServiceException;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        String token= request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="comment">//å¦‚æœä¸æ˜¯æ˜ å°„åˆ°æ–¹æ³•å°±ç›´æ¥é€šè¿‡</span></span><br><span class="line">        <span class="keyword">if</span>(!(handler <span class="keyword">instanceof</span> HandlerMethod))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ‰§è¡Œè®¤è¯</span></span><br><span class="line">        <span class="keyword">if</span>(token.equals(<span class="string">&quot;&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span>  <span class="keyword">new</span> <span class="title class_">ServiceException</span>(Constants.CODE_NOT_LOGIN,<span class="string">&quot;æ— token&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è·å–tokenä¸­çš„ç”¨æˆ·id</span></span><br><span class="line">        String userId;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            userId=JWT.decode(token).getAudience().get(<span class="number">0</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JWTDecodeException j)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(Constants.CODE_NOT_LOGIN,<span class="string">&quot;tokenéªŒè¯å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//éªŒè¯</span></span><br><span class="line">        User user=userService.getById(userId);</span><br><span class="line">        <span class="keyword">if</span>(user==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span>  <span class="keyword">new</span> <span class="title class_">ServiceException</span>(Constants.CODE_NOT_LOGIN,<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°ç™»å½•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//éªŒè¯token,ç”¨æˆ·å¯†ç åŠ ç­¾</span></span><br><span class="line">        JWTVerifier jwtVerifier=JWT.require(Algorithm.HMAC256(user.getPassword())).build();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            jwtVerifier.verify(token);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JWTVerificationException j)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(Constants.CODE_NOT_LOGIN,<span class="string">&quot;tokenéªŒè¯å¤±è´¥,è¯·é‡æ–°ç™»å½•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> HandlerInterceptor.<span class="built_in">super</span>.preHandle(request, response, handler);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="æ³¨å†Œæ‹¦æˆªå™¨">æ³¨å†Œæ‹¦æˆªå™¨</h3>
<p><code>config.interceptorCongif.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.config.interceptor.JwtInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">interceptorConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        WebMvcConfigurer.<span class="built_in">super</span>.addInterceptors(registry);</span><br><span class="line">        registry.addInterceptor(jwtInterceptor())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)  <span class="comment">//æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œé€šè¿‡åˆ¤æ–­tokenæ˜¯å¦åˆæ³•æ¥ç¡®å®šæ˜¯å¦ç™»å½•</span></span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/user/login&quot;</span>,<span class="string">&quot;user/register&quot;</span>,<span class="string">&quot;**/export&quot;</span>,<span class="string">&quot;**/import&quot;</span>); <span class="comment">//æ”¾å¼€ç™»å½•ï¼Œæ³¨å†Œï¼Œå¯¼å…¥ï¼Œå¯¼å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ³¨å†Œå¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JwtInterceptor <span class="title function_">jwtInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JwtInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="æ–‡ä»¶æ“ä½œ">æ–‡ä»¶æ“ä½œ</h2>
<h3 id="åˆ›å»ºæ•°æ®åº“è¡¨">åˆ›å»ºæ•°æ®åº“è¡¨</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `file` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ–‡ä»¶åç§°&#x27;</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ–‡ä»¶ç±»å‹&#x27;</span>,</span><br><span class="line">  `size` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ–‡ä»¶å¤§å°&#x27;</span>,</span><br><span class="line">  `url` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é“¾æ¥&#x27;</span>,</span><br><span class="line">  `is_delete` tinyint(<span class="number">1</span>) unsigned zerofill <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27; æ˜¯å¦åˆ é™¤&#x27;</span>,</span><br><span class="line">  `enable` tinyint(<span class="number">1</span>) unsigned zerofill <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;æ˜¯å¦ç¦ç”¨&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ–‡ä»¶md5&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">16</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>
<h3 id="å®ä½“ç±»entityå±‚">å®ä½“ç±»entityå±‚</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">File</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;,type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> Long size;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> is_delete;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> enable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–‡ä»¶controllerå±‚">æ–‡ä»¶controllerå±‚</h3>
<p><code>controller.FileController.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.common.Result;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.service.IFileService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æ–‡ä»¶ä¸Šä¼ ç›¸å…³æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IFileService fileService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file å‰ç«¯ä¼ é€’è¿‡æ¥çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam</span> MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> fileService.upload(file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line"><span class="comment">      @return String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/download/&#123;fileUuid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">download</span><span class="params">(<span class="meta">@PathVariable</span> String fileUuid, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> fileService.download(fileUuid, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…ˆä¿å­˜åœ¨ç£ç›˜é‡Œé¢</p>
<p><img src="D:/OrangeZSW.github.io/source/_posts/Img_Typora/SpringBoot-vue%E5%AD%A6%E4%B9%A0/image-20231024170047504.png" alt=""></p>
<h3 id="æ–‡ä»¶Sreviceå±‚">æ–‡ä»¶Sreviceå±‚</h3>
<p><code>FileServiceImpl.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.IdUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.crypto.SecureUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.common.Result;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.entity.Files;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.mapper.FileMapper;</span><br><span class="line"><span class="keyword">import</span> online.zorange.springboot.service.IFileService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;FileMapper, Files&gt; <span class="keyword">implements</span> <span class="title class_">IFileService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;files.upload.path&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String uploadPath;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     <span class="doctag">@return</span> String æ–‡ä»¶çš„è®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="comment">     <span class="doctag">@throws</span> IOException IOå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶åç¼€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> FileUtil.extName(originalFilename);</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶å¤§å°</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> file.getSize();</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶çš„çˆ¶ç›®å½•</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">upLoadParentFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadPath);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­çˆ¶ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (!upLoadParentFile.exists()) &#123;</span><br><span class="line">            upLoadParentFile.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªæ–‡ä»¶çš„å”¯ä¸€çš„ä¸€ä¸ªæ ‡è¯†ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> IdUtil.fastSimpleUUID();</span><br><span class="line">        <span class="comment">//æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç +æ–‡ä»¶çš„åç¼€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">FileUuid</span> <span class="operator">=</span> uuid + <span class="string">&quot;.&quot;</span> + type;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å®é™…ä¸Šä¼ æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">upLoadFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadPath + FileUuid);</span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶çš„md5,ç”¨äºåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">md5</span> <span class="operator">=</span> SecureUtil.md5(file.getInputStream());</span><br><span class="line">        <span class="comment">//æ–‡ä»¶çš„è®¿é—®è·¯å¾„</span></span><br><span class="line">        String Url;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨,å¦‚æœå­˜åœ¨,åˆ™ç›´æ¥è¿”å›æ–‡ä»¶çš„è®¿é—®è·¯å¾„</span></span><br><span class="line">        <span class="type">Files</span> <span class="variable">one</span> <span class="operator">=</span> getFilesMd5(md5);</span><br><span class="line">        <span class="keyword">if</span> (one != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> one.getUrl();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//å°†æ–‡ä»¶å†™å…¥åˆ°æŒ‡å®šçš„è·¯å¾„</span></span><br><span class="line">            file.transferTo(upLoadFile);</span><br><span class="line">            Url = <span class="string">&quot;http://localhost:8181/file/download/&quot;</span> + FileUuid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å°†æ–‡ä»¶ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line">        <span class="type">Files</span> <span class="variable">saveFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Files</span>();</span><br><span class="line">        saveFile.setName(originalFilename);</span><br><span class="line">        saveFile.setType(type);</span><br><span class="line">        saveFile.setSize(size / <span class="number">1024</span>);</span><br><span class="line">        saveFile.setUrl(Url);</span><br><span class="line">        saveFile.setMd5(md5);</span><br><span class="line">        <span class="built_in">this</span>.save(saveFile);</span><br><span class="line">        <span class="keyword">return</span> Url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line"><span class="comment">        <span class="doctag">@param</span> fileUuid æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç </span></span><br><span class="line"><span class="comment">        <span class="doctag">@param</span> response å“åº”å¯¹è±¡</span></span><br><span class="line"><span class="comment">        <span class="doctag">@return</span> String æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">download</span><span class="params">(String fileUuid, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//æ ¹æ®æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç æŸ¥è¯¢æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadPath + fileUuid);</span><br><span class="line">        <span class="comment">//è®¾ç½®å“åº”å¤´,å‘Šè¯‰æµè§ˆå™¨ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="comment">//å°†æ–‡ä»¶å†™å…¥åˆ°å“åº”æµä¸­</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;content-disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(fileUuid, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="comment">//è®¾ç½®å“åº”ç±»å‹</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">        <span class="comment">//è¯»å–ä¸Šä¼ çš„æ–‡ä»¶,å†™å…¥åˆ°å“åº”æµä¸­</span></span><br><span class="line">        os.write(FileUtil.readBytes(file));</span><br><span class="line">        <span class="comment">//åˆ·æ–°æµ</span></span><br><span class="line">        os.flush();</span><br><span class="line">        <span class="comment">//å…³é—­æµ</span></span><br><span class="line">        os.close();</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;ä¸‹è½½æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    æŸ¥è¯¢æ–‡ä»¶çš„md5</span></span><br><span class="line"><span class="comment">    <span class="doctag">@return</span> Files</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Files <span class="title function_">getFilesMd5</span><span class="params">(String md5)</span>&#123;</span><br><span class="line">        QueryWrapper&lt;Files&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;md5&quot;</span>, md5);</span><br><span class="line">        <span class="type">Files</span> <span class="variable">one</span> <span class="operator">=</span> <span class="built_in">this</span>.getOne(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (one != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> one;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºå¯¹åº”çš„<code>Mapper,Mapper.xml,IServiceï¼ŒServiceImpl</code></p>
<h2 id="element-uiçš„uploadæ·»åŠ header">element-uiçš„uploadæ·»åŠ header</h2>
<ol>
<li>æ·»åŠ ï¼šheaderå±æ€§</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-upload</span><br><span class="line">    class=&quot;avatar-uploader&quot;</span><br><span class="line">    action=&quot;http://localhost:8181/file/upload&quot;</span><br><span class="line">    :headers=&quot;headersO&quot;</span><br><span class="line">    :show-file-list=&quot;false&quot;</span><br><span class="line">    :on-success=&quot;handleAvatarSuccess&quot;&gt;</span><br><span class="line">  &lt;img v-if=&quot;form.avatar&quot; :src=&quot;form.avatar&quot; class=&quot;avatar&quot;&gt;</span><br><span class="line">  &lt;i v-else class=&quot;el-icon-plus avatar-uploader-icon&quot;&gt;&lt;/i&gt;</span><br><span class="line">&lt;/el-upload&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>è®¾ç½®headersO</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">computed</span>:&#123;</span><br><span class="line">  <span class="title function_">headersO</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="variable language_">this</span>.<span class="property">user</span>.<span class="property">token</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">token</span>: token</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="é—®é¢˜ï¼š">é—®é¢˜ï¼š</h2>
<h3 id="mybatis-plus">mybatis-plus</h3>
<h3 id="1">1</h3>
<h4 id="æè¿°ï¼š">æè¿°ï¼š</h4>
<p>æ”¹ç”¨ mybatis-plus ä¹‹åï¼Œæ”¹ç”¨ updateOrSave æˆ–è€… updateById éƒ½ä¼š</p>
<p>æŠ¥é”™ï¼šcan not execute. because can not find cache of TableInfo for entity!</p>
<p>@TableName å’Œ@TableId éƒ½åŠ äº†ä¹Ÿä¸è¡Œ</p>
<h4 id="è§£å†³ï¼š">è§£å†³ï¼š</h4>
<p>é™ä½ springboot çš„ç‰ˆæœ¬</p>
<h3 id="2-request-æœªå®šä¹‰">2 request æœªå®šä¹‰</h3>
<h3 id="æè¿°ï¼š-v2">æè¿°ï¼š</h3>
<p>å®šä¹‰ request.js , ä½¿ç”¨ Vue.prototype.request = request;å¼•å…¥</p>
<p>ä½¿ç”¨ request æŠ¥é”™ï¼šæœªå®šä¹‰<img src="D:/OrangeZSW.github.io/source/_posts/Img_Typora/SpringBoot-vue%E5%AD%A6%E4%B9%A0/image-20231004164521605.png" alt=""></p>
<p>è§£å†³ï¼š</p>
<ol>
<li>import request from â€˜@/utils/request.jsâ€™</li>
<li>ä½¿ç”¨æ—¶åŠ  this<img src="D:/OrangeZSW.github.io/source/_posts/Img_Typora/SpringBoot-vue%E5%AD%A6%E4%B9%A0/image-20231004164721465.png" alt=""></li>
</ol>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Swagger</title>
    <url>/2023/11/01/Swagger/</url>
    <content><![CDATA[<h2 id="âš™ï¸swagger3-é…ç½®">âš™ï¸swagger3 é…ç½®</h2>
<p><a href="https://swagger.io/">swaggerå®˜ç½‘</a></p>
<h3 id="SwaggerConfig-java">SwaggerConfig.java</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.*;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.service.contexts.SecurityContext;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">api</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2).apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.any())</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line"></span><br><span class="line">                .build()</span><br><span class="line">                .securitySchemes(Collections.singletonList(apiKey()))</span><br><span class="line">                .securityContexts(Collections.singletonList(securityContext()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApiKey <span class="title function_">apiKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiKey</span>(<span class="string">&quot;token&quot;</span>, <span class="string">&quot;token&quot;</span>, <span class="string">&quot;header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SecurityContext <span class="title function_">securityContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SecurityContext.builder()</span><br><span class="line">                .securityReferences(Collections.singletonList(<span class="keyword">new</span> <span class="title class_">SecurityReference</span>(<span class="string">&quot;token&quot;</span>, <span class="keyword">new</span> <span class="title class_">AuthorizationScope</span>[<span class="number">0</span>])))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .description(<span class="string">&quot;**é¡¹ç›®ç®¡ç†å¹³å°&quot;</span>)</span><br><span class="line">                .title(<span class="string">&quot;**é¡¹ç›®ç®¡ç†å¹³å°æ¥å£api&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="pom-xml-ä¾èµ–">pom.xml ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è®¿é—®åœ°å€ï¼š<a href="http://localhost:8181/swagger-ui/index.html">http://localhost:8181/swagger-ui/index.html</a></p>
<p>å¦‚æœé…ç½®äº†æ‹¦æˆªå™¨ï¼Œè¦æ”¾å¼€ä»¥ä¸‹è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//swagger2</span><br><span class="line">&quot;/swagger-ui/**&quot;,</span><br><span class="line">&quot;/swagger-resources/**&quot;,</span><br><span class="line">&quot;/swagger-ui.html&quot;,</span><br><span class="line">&quot;/v2/api-docs&quot;,</span><br><span class="line">&quot;/webjars/**&quot;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Swagger</tag>
      </tags>
  </entry>
  <entry>
    <title>acme+nginxè¯ä¹¦ç”³è¯·</title>
    <url>/2024/07/15/acme-nginx%E8%AF%81%E4%B9%A6%E7%94%B3%E8%AF%B7/</url>
    <content><![CDATA[<h1><a href="http://acme.sh">acme.sh</a> ç½‘ç«™ç”³è¯·è¯ä¹¦ï¼ˆnginxï¼‰</h1>
<h2 id="1ï¸âƒ£å®‰è£…-nginx-çœç•¥">1ï¸âƒ£å®‰è£… nginx(çœç•¥)</h2>
<h2 id="2ï¸âƒ£å®‰è£…-acme">2ï¸âƒ£å®‰è£… acme</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl  https://get.acme.sh | sh -s email=zhaoolee@gmail.com</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<blockquote>
<p>â— ç”³è¯·è¯ä¹¦çš„åŸŸååœ¨ç”³è¯·ä¹‹å‰è¦éƒ¨ç½²(è¿™æ ·ä¸ç”¨è¿›è¡Œ dns éªŒè¯),ä¸ç„¶ä¸‹é¢ç”³è¯·è¯ä¹¦å°±ä¸èƒ½æˆåŠŸ</p>
</blockquote>
<h2 id="3ï¸âƒ£ç½‘ç«™ç”³è¯·è¯ä¹¦">3ï¸âƒ£ç½‘ç«™ç”³è¯·è¯ä¹¦</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">acme.sh --issue  -d alist.zorange.online    --nginx /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>
<p><code>--nginx /usr/local/nginx/conf/nginx.conf</code>æ˜¯ä½ çš„ nginx.conf è·¯å¾„<br>
<code>alist.zorange.online</code> æ˜¯è¦ç”³è¯·çš„ç½‘ç«™çš„åŸŸå</p>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/a6fe12cbcb6949a99ac3c47eca410e36.png" alt="image.png"></p>
<h2 id="4ï¸âƒ£æ‹·è´è¯ä¹¦">4ï¸âƒ£æ‹·è´è¯ä¹¦</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">  acme.sh --install-cert -d alist.zorange.online \</span><br><span class="line">--key-file       /usr/local/nginx/conf/ssl/alist.zorange.online/alist.zorange.online.key  \</span><br><span class="line">--fullchain-file /usr/local/nginx/conf/ssl/alist.zorange.online/fullchain.cer \</span><br><span class="line">--reloadcmd     <span class="string">&quot;service nginx force-reload&quot;</span></span><br></pre></td></tr></table></figure>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/eae53845b18e4be38e2abbc73f2624fc.png" alt="Description"></p>
<h2 id="æ›´æ–°è¯ä¹¦">æ›´æ–°è¯ä¹¦</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">acme.sh --renew -d docker.zorange.online --force</span><br></pre></td></tr></table></figure>
<h2 id="5ï¸âƒ£nginx-è®¾ç½®">5ï¸âƒ£nginx è®¾ç½®</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssl_certificate &quot;/etc/nginx/ssl/hk.v2fy.com/fullchain.cer&quot;;</span><br><span class="line"> ssl_certificate_key &quot;/etc/nginx/ssl/hk.v2fy.com/hk.v2fy.com.key&quot;;</span><br><span class="line"> ssl_session_cache shared:SSL:1m;</span><br><span class="line"> ssl_session_timeout  10m;</span><br><span class="line"> ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line"> ssl_prefer_server_ciphers on;</span><br><span class="line">#å¼ºåˆ¶å°†httpçš„URLé‡å†™æˆhttps</span><br><span class="line"> rewrite ^(.*) https://$server_name$1 permanent;</span><br></pre></td></tr></table></figure>
<h2 id="è‡ªåŠ¨æ›´æ–°è„šæœ¬">è‡ªåŠ¨æ›´æ–°è„šæœ¬</h2>
<p>å¦‚æœä½ æœ‰å¤šä¸ªè¯ä¹¦è¦æ›´æ–°ï¼Œå¯ä»¥å°†æ‰€æœ‰æ›´æ–°è¯ä¹¦çš„å‘½ä»¤æ”¾å…¥ä¸€ä¸ªè„šæœ¬ä¸­ï¼Œå¹¶ä½¿ç”¨<code>acme.sh</code>æ¥è‡ªåŠ¨æ›´æ–°æ‰€æœ‰è¿™äº›è¯ä¹¦ã€‚ä½ åªéœ€ç¡®ä¿<code>acme.sh</code>å·²ç»æ­£ç¡®é…ç½®ï¼Œå¹¶ä¸”ä½ çš„è„šæœ¬åŒ…å«æ‰€æœ‰éœ€è¦æ›´æ–°çš„è¯ä¹¦ã€‚</p>
<ol>
<li><strong>åˆ›å»ºä¸€ä¸ªè„šæœ¬æ¥å®‰è£…å¤šä¸ªè¯ä¹¦</strong>ï¼š</li>
</ol>
<p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œä¾‹å¦‚<code>/usr/local/bin/install_all_certs.sh</code>ï¼Œå¹¶å°†æ‰€æœ‰<code>acme.sh --install-cert</code>å‘½ä»¤æ”¾å…¥è¯¥æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°å¹¶å®‰è£… alist.zorange.online çš„è¯ä¹¦</span></span><br><span class="line">/root/.acme.sh/acme.sh --install-cert -d alist.zorange.online \</span><br><span class="line">--key-file /usr/local/nginx/conf/ssl/alist.zorange.online/alist.zorange.online.key \</span><br><span class="line">--fullchain-file /usr/local/nginx/conf/ssl/alist.zorange.online/fullchain.cer \</span><br><span class="line">--reloadcmd <span class="string">&quot;service nginx force-reload&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°å¹¶å®‰è£… docker.blog.zorange.online çš„è¯ä¹¦</span></span><br><span class="line">/root/.acme.sh/acme.sh --install-cert -d docker.blog.zorange.online \</span><br><span class="line">--key-file /usr/local/nginx/conf/ssl/docker.blog.zorange.online/docker.blog.zorange.online.key \</span><br><span class="line">--fullchain-file /usr/local/nginx/conf/ssl/docker.blog.zorange.online/fullchain.cer \</span><br><span class="line">--reloadcmd <span class="string">&quot;service nginx force-reload&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½ å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šçš„è¯ä¹¦æ›´æ–°å‘½ä»¤...</span></span><br></pre></td></tr></table></figure>
<p>ç¡®ä¿è„šæœ¬æ˜¯å¯æ‰§è¡Œçš„ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/install_all_certs.sh</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>è®¾ç½®ä¸€ä¸ª cron ä»»åŠ¡æ¥è‡ªåŠ¨è¿è¡Œè„šæœ¬</strong>ï¼š</li>
</ol>
<p>ç¼–è¾‘ cron ä»»åŠ¡ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo crontab -e</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ·»åŠ ä»¥ä¸‹è¡Œï¼Œè¿™å°†æ¯å¤©åˆå¤œè¿è¡Œä½ çš„è„šæœ¬ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">0 0 * * * /usr/local/bin/install_all_certs.sh</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæ¯å¤©åˆå¤œ<code>acme.sh</code>å°†æ£€æŸ¥å¹¶æ›´æ–°æ‰€æœ‰åˆ—å‡ºçš„è¯ä¹¦ï¼Œç„¶åä½¿ç”¨<code>service nginx force-reload</code>å‘½ä»¤é‡æ–°åŠ è½½ Nginxï¼Œä»¥åº”ç”¨æ–°çš„è¯ä¹¦ã€‚</p>
<ol start="3">
<li><strong>ç¡®ä¿ <a href="http://acme.sh">acme.sh</a> è‡ªåŠ¨æ›´æ–°è¯ä¹¦</strong>ï¼š</li>
</ol>
<p>ç¡®ä¿ä½ çš„<code>acme.sh</code>é…ç½®æ­£ç¡®ï¼Œä»¥ä¾¿å®ƒèƒ½åœ¨è¯ä¹¦å¿«åˆ°æœŸæ—¶è‡ªåŠ¨æ›´æ–°ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥<code>acme.sh</code>çš„æ›´æ–°ä»»åŠ¡ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">acme.sh --cron --home /path/to/.acme.sh</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>canalçš„ä½¿ç”¨</title>
    <url>/2025/09/15/canal%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1>canalçš„ä½¿ç”¨</h1>
<blockquote>
<p>ç”±äºcanalçš„starteråªæ”¯æŒspring 2.x<br>
å»ºè®®é‡æ–°å»ºä¸ªæ¨¡å—</p>
</blockquote>
<h3 id="1-ä¾èµ–">1.ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.javatool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1-RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.persistence<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>persistence-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-é…ç½®æ–‡ä»¶">2.é…ç½®æ–‡ä»¶</h3>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7080</span></span><br><span class="line"><span class="comment">#canalé…ç½®</span></span><br><span class="line"><span class="attr">canal:</span></span><br><span class="line">  <span class="attr">destination:</span> <span class="string">tingshuTopic</span>   <span class="comment"># éƒ¨ç½²canalæ—¶æŒ‡å®šçš„è¯é¢˜</span></span><br><span class="line">  <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.129</span><span class="string">:11111</span></span><br></pre></td></tr></table></figure>
<h3 id="3-ç›‘å¬çš„å®ä½“ç±»">3.ç›‘å¬çš„å®ä½“ç±»</h3>
<blockquote>
<p>æŒ‡å®šç›‘å¬çš„åˆ—</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.tingshu.cdc.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/11/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlbumInfoCDC</span> &#123;</span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-ç›‘å¬å¤„ç†å™¨">3.ç›‘å¬å¤„ç†å™¨</h3>
<blockquote>
<p>@CanalTable(â€œalbum_infoâ€) æŒ‡å®šç›‘å¬ çš„è¡¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.tingshu.cdc.Handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.tingshu.cdc.constants.RedisConstant;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.tingshu.cdc.entity.AlbumInfoCDC;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> online.zorange.cache.constants.CacheConstants;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> top.javatool.canal.client.annotation.CanalTable;</span><br><span class="line"><span class="keyword">import</span> top.javatool.canal.client.handler.EntryHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/11/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@CanalTable(&quot;album_info&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlbumInfoHandler</span> <span class="keyword">implements</span> <span class="title class_">EntryHandler</span>&lt;AlbumInfoCDC&gt; &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(AlbumInfoCDC albumInfoCDC)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ç›‘å¬åˆ°è¡¨albumInfoæ–°å¢æ•°æ®:&#123;&#125;&quot;</span>, albumInfoCDC.getId());</span><br><span class="line">        <span class="comment">//1. ç›´æ¥æ“ä½œredis</span></span><br><span class="line">        redisTemplate.delete(CacheConstants.REDIS_CACHE + <span class="string">&quot;:&quot;</span> + RedisConstant.ALBUM_INFO_PREFIX + albumInfoCDC.getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.1 å»¶è¿Ÿåˆ é™¤...</span></span><br><span class="line">        <span class="comment">//2. å‘ç”Ÿæ¶ˆæ¯</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(AlbumInfoCDC before, AlbumInfoCDC after)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">delete</span> <span class="operator">=</span> redisTemplate.delete(CacheConstants.REDIS_CACHE + <span class="string">&quot;:&quot;</span> + RedisConstant.ALBUM_INFO_PREFIX + after.getId());</span><br><span class="line">        log.info(<span class="string">&quot;ç›‘å¬åˆ°è¡¨albumInfoæ›´æ–°æ•°æ®:&#123;&#125;--&gt;&#123;&#125;&quot;</span>, before.getId(), after.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;CacheConstants.REDIS_CACHE + \&quot;:\&quot; + RedisConstant.ALBUM_INFO_PREFIX + after.getId() = &quot;</span> + CacheConstants.REDIS_CACHE + <span class="string">&quot;:&quot;</span> + RedisConstant.ALBUM_INFO_PREFIX + after.getId());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(AlbumInfoCDC albumInfoCDC)</span> &#123;</span><br><span class="line">        redisTemplate.delete(CacheConstants.REDIS_CACHE + <span class="string">&quot;:&quot;</span> + RedisConstant.ALBUM_INFO_PREFIX + albumInfoCDC.getId());</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;ç›‘å¬åˆ°è¡¨albumInfoåˆ é™¤æ•°æ®:&#123;&#125;&quot;</span>, albumInfoCDC.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>find_in_set</title>
    <url>/2025/09/15/find_in_set/</url>
    <content><![CDATA[<ul>
<li>find_in_setå¯ä»¥æŸ¥è¯¢ä»¥é€—å·åˆ†éš”ä¸­æ˜¯å¦å­˜åœ¨æŸä¸€ä¸ªæ•°æ®</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">       <span class="keyword">from</span> sys_template</span><br><span class="line">       <span class="keyword">where</span> read_user_id <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">or</span> <span class="keyword">not</span> find_in_set(#&#123;id&#125;,read_user_id)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>github pagesè‡ªå®šä¹‰åŸŸå&amp;CDNé…ç½®</title>
    <url>/2023/10/11/github%20pages%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D-CDN%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="github-è‡ªå®šä¹‰åŸŸå">github è‡ªå®šä¹‰åŸŸå</h2>
<h3 id="DNS-é…ç½®">DNS é…ç½®</h3>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/image-20231011110553135.png" alt=""></p>
<p>Github çš„è‡ªå®šä¹‰åŸŸåï¼š<a href="https://docs.github.com/zh/pages/configuring-a-custom-domain-for-your-github-pages-site/about-custom-domains-and-github-pages">å®˜æ–¹æ–‡æ¡£</a></p>
<p>å¦‚æœæƒ³è‡ªå®šä¹‰è‡ªå·±çš„æ ¹åŸŸåï¼Œé‚£ä¹ˆå°±è¦æ·»åŠ  A è®°å½•ï¼Œè®°å½•ä¸º@</p>
<p>å¦‚æœåªæ˜¯å­åŸŸåï¼Œé‚£å°±åªéœ€è¦ CNAME è®°å½•å°±è¡Œäº†</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">185.199.108.153</span><br><span class="line">185.199.109.153</span><br><span class="line">185.199.110.153</span><br><span class="line">185.199.111.153</span><br></pre></td></tr></table></figure>
<p>A è®°å½•çš„ IP åœ°å€å¯ä»¥é€šè¿‡ Ping <a href="http://YOUNAME.github.io">YOUNAME.github.io</a> å¾—åˆ°</p>
<h3 id="CNAME">CNAME</h3>
<p>åœ¨ github é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ CNAMEï¼Œé‡Œé¢å¡«å†™è‡ªå·±çš„åŸŸåå°±è¡Œäº†</p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012428120.png" alt="image-20260121012428120"></p>
<p>åœ¨ github çš„é¡¹ç›® setting-&gt;Pages ä¸‹é¢ï¼Œåœ¨é‡Œé¢å¡«å…¥è‡ªå·±çš„åŸŸåï¼Œç„¶å Save å°±è¡Œäº†ã€‚</p>
<p>ä¸‹é¢æœ‰ä¸ª Enforce HTTPSï¼Œè‡ªåŠ¨ç”³è¯·ï¼Œå¯ä»¥æ‰“å¼€ä¹Ÿå¯ä»¥ä¸æ‰“å¼€ï¼ˆå¦‚æœè¦é…ç½® CDN å¥½åƒä¸èƒ½æ‰“å¼€ï¼Œä½†æ˜¯æˆ‘æ‰“å¼€äº†ä¹Ÿé…ç½®äº† CDN æ²¡å‡ºç°é—®é¢˜ï¼‰</p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012438052.png" alt="image-20260121012438052"></p>
<h2 id="CDN-é…ç½®">CDN é…ç½®</h2>
<h3 id="æ³¨æ„">æ³¨æ„</h3>
<p>å› ä¸ºé…ç½® cdn éœ€è¦ä¸€æ¡ CNAMEï¼Œä¸”è®°å½•ä¸º@ã€‚å½“ä½ è®¾ç½®è‡ªå®šä¹‰çš„åŸŸåä¸ºæ ¹åŸŸåæ—¶ï¼Œé‚£ä¹ˆä½ çš„ dns è§£æé‡Œé¢è‚¯å®šæœ‰ä¸€æ¡ A è®°å½•ï¼Œè®°å½•ä¸º@ï¼ˆè¯¦æƒ…çœ‹ä¸Šé¢è‡ªå®šä¹‰åŸŸåé…ç½®ï¼‰</p>
<p>æ­¤æ—¶å°±ä¼šå†²çªï¼Œå› æ­¤å¦‚æœæƒ³åŠ é€Ÿæ ¹åŸŸåï¼Œä¸ä¼šã€‚</p>
<p>ä¸è¿‡æœ‰ä¸€ç§å¹³æ›¿çš„æ–¹æ³•ï¼ŒåŠ é€Ÿå­åŸŸå www.æ ¹åŸŸåï¼Œå½“ä½ è®¿é—®æ ¹åŸŸåæ—¶ï¼Œgithub ä¼šé‡å®šå‘åˆ° www.æ ¹åŸŸåã€‚è¿™æ ·æ ¹åŸŸåä¹Ÿå¯ä»¥è®¿é—®ã€‚</p>
<p><a href="https://docs.github.com/zh/pages/configuring-a-custom-domain-for-your-github-pages-site/about-custom-domains-and-github-pages">å®˜æ–¹æ–‡æ¡£</a></p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012450411.png" alt="image-20260121012450411"></p>
<h3 id="dns-è§£æ">dns è§£æ</h3>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012459646.png" alt="image-20260121012459646"></p>
<h3 id="cdn-çš„é…ç½®">cdn çš„é…ç½®</h3>
<h5 id="æºç«™-ipï¼š">æºç«™ ipï¼š</h5>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">185.199.108.153</span><br><span class="line">185.199.109.153</span><br><span class="line">185.199.110.153</span><br><span class="line">185.199.111.153</span><br></pre></td></tr></table></figure>
<p>ç«¯å£ï¼š</p>
<p>è‡ªå®šä¹‰åŸŸåæ—¶å‹¾é€‰äº† HTTPS å°±é€‰ 443ï¼Œæ²¡æœ‰å‹¾å°±å¡« 80</p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012526508.png" alt="image-20260121012526508"></p>
<p>å›æº HOSTï¼š</p>
<p>å¡«è‡ªå·±çš„åŠ é€ŸåŸŸåå°±è¡Œäº†</p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20260121012539614.png" alt="image-20260121012539614"></p>
]]></content>
      <categories>
        <category>Records</category>
      </categories>
      <tags>
        <tag>CDN</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2022/09/25/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start">Quick Start</h2>
<h3 id="Create-a-new-post">Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server">Run server</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files">Generate static files</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites">Deploy to remote sites</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>gitå‘½ä»¤</title>
    <url>/2025/09/15/git%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h1>gitå‘½ä»¤</h1>
<h2 id="æ’¤é”€å·²æäº¤çš„æ›´æ”¹">æ’¤é”€å·²æäº¤çš„æ›´æ”¹</h2>
<p>åœ¨ Git ä¸­ï¼Œè¿˜åŸæäº¤ï¼ˆæ’¤é”€å·²æäº¤çš„æ›´æ”¹ï¼‰æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•ï¼Œå…·ä½“å–å†³äºä½ æƒ³è¾¾åˆ°çš„æ•ˆæœï¼š</p>
<hr>
<h3 id="1-æ’¤é”€æäº¤ä½†ä¿ç•™æ›´æ”¹ï¼ˆå›åˆ°å·¥ä½œåŒºï¼‰">1. <strong>æ’¤é”€æäº¤ä½†ä¿ç•™æ›´æ”¹ï¼ˆå›åˆ°å·¥ä½œåŒºï¼‰</strong></h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reset --soft HEAD~1</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šæ’¤é”€æœ€åä¸€æ¬¡æäº¤ï¼Œä½†ä¿ç•™æ‰€æœ‰æ›´æ”¹åœ¨ <strong>æš‚å­˜åŒº</strong>ï¼ˆ<code>git add</code> çŠ¶æ€ï¼‰</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæƒ³é‡æ–°ä¿®æ”¹æäº¤ä¿¡æ¯æˆ–æ‹†åˆ†æäº¤</li>
</ul>
<hr>
<h3 id="2-æ’¤é”€æäº¤å¹¶å–æ¶ˆæš‚å­˜ï¼ˆæ›´æ”¹ä¿ç•™åœ¨å·¥ä½œç›®å½•ï¼‰">2. <strong>æ’¤é”€æäº¤å¹¶å–æ¶ˆæš‚å­˜ï¼ˆæ›´æ”¹ä¿ç•™åœ¨å·¥ä½œç›®å½•ï¼‰</strong></h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reset HEAD~1</span><br><span class="line"><span class="comment"># æˆ–ç­‰ä»·äº</span></span><br><span class="line">git reset --mixed HEAD~1  <span class="comment"># --mixed æ˜¯é»˜è®¤é€‰é¡¹</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šæ’¤é”€æäº¤ï¼Œå¹¶å°†æ›´æ”¹ç§»å‡ºæš‚å­˜åŒºï¼ˆéœ€é‡æ–° <code>git add</code>ï¼‰</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæƒ³é‡æ–°é€‰æ‹©éƒ¨åˆ†æ–‡ä»¶æäº¤</li>
</ul>
<hr>
<h3 id="3-å½»åº•ä¸¢å¼ƒæäº¤å’Œæ‰€æœ‰æ›´æ”¹ï¼ˆæ…ç”¨ï¼ï¼‰">3. <strong>å½»åº•ä¸¢å¼ƒæäº¤å’Œæ‰€æœ‰æ›´æ”¹ï¼ˆæ…ç”¨ï¼ï¼‰</strong></h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reset --hard HEAD~1</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šå½»åº•ä¸¢å¼ƒæœ€åä¸€æ¬¡æäº¤ <strong>å’Œæ‰€æœ‰å·¥ä½œç›®å½•çš„æ›´æ”¹</strong>ï¼ˆä¸å¯é€†ï¼ï¼‰</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå®Œå…¨æ”¾å¼ƒæœ€è¿‘çš„æäº¤</li>
</ul>
<hr>
<h3 id="4-æ’¤é”€ç‰¹å®šæäº¤ï¼ˆç”Ÿæˆåå‘æäº¤ï¼‰">4. <strong>æ’¤é”€ç‰¹å®šæäº¤ï¼ˆç”Ÿæˆåå‘æäº¤ï¼‰</strong></h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git revert &lt;commit-hash&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æäº¤æ¥æŠµæ¶ˆæŒ‡å®šæäº¤çš„æ›´æ”¹ï¼ˆä¿ç•™æäº¤å†å²ï¼‰</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéœ€è¦æ’¤é”€å…¬å…±ä»“åº“çš„æäº¤ï¼ˆä¸é‡å†™å†å²ï¼‰</li>
</ul>
<hr>
<h3 id="5-å›é€€åˆ°æŸä¸ªæ—§æäº¤ï¼ˆå¼ºåˆ¶è¦†ç›–è¿œç¨‹ï¼‰">5. <strong>å›é€€åˆ°æŸä¸ªæ—§æäº¤ï¼ˆå¼ºåˆ¶è¦†ç›–è¿œç¨‹ï¼‰</strong></h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reset --hard &lt;commit-hash&gt;</span><br><span class="line">git push --force  <span class="comment"># å¼ºåˆ¶è¦†ç›–è¿œç¨‹ï¼ˆä»…é™ä¸ªäººåˆ†æ”¯ä½¿ç”¨ï¼ï¼‰</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å±é™©æ“ä½œ</strong>ï¼šä¼šé‡å†™å†å²ï¼Œä»…é™æœªå…±äº«çš„æäº¤ä½¿ç”¨</li>
</ul>
<hr>
<h3 id="å…³é”®åŒºåˆ«æ€»ç»“ï¼š">å…³é”®åŒºåˆ«æ€»ç»“ï¼š</h3>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>ä¿®æ”¹å†å²ï¼Ÿ</th>
<th>ä¿ç•™æ›´æ”¹ï¼Ÿ</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>git reset --soft</code></td>
<td>æ˜¯</td>
<td>æ˜¯ï¼ˆæš‚å­˜ï¼‰</td>
<td>é‡æ–°æäº¤</td>
</tr>
<tr>
<td><code>git reset --mixed</code></td>
<td>æ˜¯</td>
<td>æ˜¯ï¼ˆå·¥ä½œåŒºï¼‰</td>
<td>é‡æ–°é€‰æ‹©æ–‡ä»¶æäº¤</td>
</tr>
<tr>
<td><code>git reset --hard</code></td>
<td>æ˜¯</td>
<td>å¦</td>
<td>å½»åº•æ”¾å¼ƒæäº¤</td>
</tr>
<tr>
<td><code>git revert</code></td>
<td>å¦</td>
<td>-</td>
<td>å®‰å…¨æ’¤é”€å…¬å…±æäº¤</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="æ“ä½œåæ¢å¤æ–¹æ³•ï¼š">æ“ä½œåæ¢å¤æ–¹æ³•ï¼š</h3>
<p>å¦‚æœè¯¯æ“ä½œ <code>--hard</code> é‡ç½®ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°è¯•æ¢å¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reflog                  <span class="comment"># æŸ¥çœ‹æ‰€æœ‰æ“ä½œè®°å½•</span></span><br><span class="line">git checkout &lt;ä¸¢å¤±çš„æäº¤ID&gt;  <span class="comment"># æ‰¾å›æ•°æ®</span></span><br></pre></td></tr></table></figure>
<p>æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•ï¼Œå¯¹å…¬å…±åˆ†æ”¯å°½é‡ä½¿ç”¨ <code>git revert</code> é¿å…å†å²å†²çªã€‚</p>
<h2 id="gitå¤§æ–‡ä»¶è§£å†³åŠæ³•">gitå¤§æ–‡ä»¶è§£å†³åŠæ³•</h2>
<h3 id="1-ä½¿ç”¨-Git-LFSï¼ˆGit-å¤§æ–‡ä»¶å­˜å‚¨ï¼‰"><strong>1. ä½¿ç”¨ Git LFSï¼ˆGit å¤§æ–‡ä»¶å­˜å‚¨ï¼‰</strong></h3>
<p>GitHub æ¨èä½¿ç”¨ <strong>Git LFS (Large File Storage)</strong> æ¥ç®¡ç†å¤§æ–‡ä»¶ã€‚</p>
<h4 id="æ­¥éª¤ï¼š"><strong>æ­¥éª¤ï¼š</strong></h4>
<ol>
<li>
<p><strong>å®‰è£… Git LFS</strong></p>
<ul>
<li>ä¸‹è½½å¹¶å®‰è£… Git LFSï¼š<a href="https://git-lfs.github.com/">https://git-lfs.github.com/</a></li>
<li>å®‰è£…åè¿è¡Œï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git lfs install</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>è·Ÿè¸ªå¤§æ–‡ä»¶</strong><br>
åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git lfs track <span class="string">&quot;mysql/binlog.000066&quot;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¼šç”Ÿæˆ/ä¿®æ”¹ <code>.gitattributes</code> æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong>é‡æ–°æäº¤å¹¶æ¨é€</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git add .gitattributes</span><br><span class="line">git add mysql/binlog.000066</span><br><span class="line">git commit -m <span class="string">&quot;ä½¿ç”¨ Git LFS è·Ÿè¸ªå¤§æ–‡ä»¶&quot;</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="2-ä»-Git-å†å²ä¸­åˆ é™¤å¤§æ–‡ä»¶"><strong>2. ä» Git å†å²ä¸­åˆ é™¤å¤§æ–‡ä»¶</strong></h3>
<p>å¦‚æœä¸éœ€è¦ <code>binlog.000066</code> æ–‡ä»¶ï¼Œå¯ä»¥ä» Git å†å²ä¸­å½»åº•åˆ é™¤å®ƒï¼š</p>
<h4 id="æ­¥éª¤ï¼š-v2"><strong>æ­¥éª¤ï¼š</strong></h4>
<ol>
<li>
<p><strong>ä½¿ç”¨ <code>git filter-branch</code> æˆ– <code>BFG Repo-Cleaner</code> åˆ é™¤å¤§æ–‡ä»¶</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git filter-branch --force --index-filter \</span><br><span class="line">  <span class="string">&quot;git rm --cached --ignore-unmatch mysql/binlog.000066&quot;</span> \</span><br><span class="line">  --prune-empty --tag-name-filter <span class="built_in">cat</span> -- --all</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>å¼ºåˆ¶æ¨é€ï¼ˆä¼šè¦†ç›–è¿œç¨‹å†å²ï¼‰</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git push origin master --force</span><br></pre></td></tr></table></figure>
<p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šè¿™ä¼šä¿®æ”¹æäº¤å†å²ï¼Œå¦‚æœå…¶ä»–äººä¹Ÿåœ¨åä½œï¼Œå¯èƒ½ä¼šå½±å“ä»–ä»¬çš„ä»“åº“ã€‚</p>
</li>
</ol>
<hr>
<h3 id="3-ä½¿ç”¨-gitignore-å¿½ç•¥å¤§æ–‡ä»¶"><strong>3. ä½¿ç”¨ <code>.gitignore</code> å¿½ç•¥å¤§æ–‡ä»¶</strong></h3>
<p>å¦‚æœ <code>binlog.000066</code> æ˜¯ä¸´æ—¶æ–‡ä»¶ï¼ˆå¦‚æ—¥å¿—æ–‡ä»¶ï¼‰ï¼Œå¯ä»¥ï¼š</p>
<ol>
<li>åœ¨ <code>.gitignore</code> ä¸­æ·»åŠ ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql/binlog.*</span><br></pre></td></tr></table></figure>
</li>
<li>åˆ é™¤å·²æäº¤çš„æ–‡ä»¶ï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">rm</span> --cached mysql/binlog.000066</span><br><span class="line">git commit -m <span class="string">&quot;ç§»é™¤å¤§æ–‡ä»¶&quot;</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h2 id="å¦‚ä½•é¿å…ç±»ä¼¼é—®é¢˜ï¼Ÿ"><strong>å¦‚ä½•é¿å…ç±»ä¼¼é—®é¢˜ï¼Ÿ</strong></h2>
<ul>
<li><strong>ä¸è¦æäº¤æ—¥å¿—ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€æ•°æ®åº“å¤‡ä»½ç­‰å¤§æ–‡ä»¶</strong>ï¼Œä½¿ç”¨ <code>.gitignore</code> è¿‡æ»¤å®ƒä»¬ã€‚</li>
<li>å¦‚æœå¿…é¡»ç®¡ç†å¤§æ–‡ä»¶ï¼Œä½¿ç”¨ <strong>Git LFS</strong>ã€‚</li>
<li>æ£€æŸ¥ç°æœ‰ä»“åº“æ˜¯å¦æœ‰å¤§æ–‡ä»¶ï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git rev-list --objects --all | grep <span class="string">&quot;<span class="subst">$(git verify-pack -v .git/objects/pack/*.idx | sort -k 3 -n | tail -5 | awk &#x27;&#123;print$1&#125;&#x27;)</span>&quot;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="æ€»ç»“"><strong>æ€»ç»“</strong></h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>å‘½ä»¤ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Git LFS</strong></td>
<td>éœ€è¦ä¿ç•™å¤§æ–‡ä»¶</td>
<td><code>git lfs track &quot;å¤§æ–‡ä»¶&quot;</code></td>
</tr>
<tr>
<td><strong><code>filter-branch</code></strong></td>
<td>ä»å†å²ä¸­å½»åº•åˆ é™¤</td>
<td><code>git filter-branch --force ...</code></td>
</tr>
<tr>
<td><strong><code>.gitignore</code></strong></td>
<td>å¿½ç•¥ä¸´æ—¶å¤§æ–‡ä»¶</td>
<td><code>git rm --cached å¤§æ–‡ä»¶</code></td>
</tr>
</tbody>
</table>
<p>é€‰æ‹©åˆé€‚çš„æ–¹æ³•åï¼Œé‡æ–°æ¨é€å³å¯è§£å†³ <code>GH001: Large files detected</code> é”™è¯¯ã€‚ğŸš€</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>jså®šæ—¶ä»»åŠ¡</title>
    <url>/2025/09/15/js%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<h1>jså®šæ—¶ä»»åŠ¡</h1>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> tasks = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">scheduledTasks</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params">task, time</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ä»»åŠ¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼ˆæˆ–è€…ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼‰æ¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (tasks.<span class="title function_">some</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> t.<span class="property">task</span>.<span class="property">name</span> === task.<span class="property">name</span>)) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Task already added.&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> intervalId = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">task</span>();</span><br><span class="line">        &#125;, time);</span><br><span class="line">        tasks.<span class="title function_">push</span>(&#123;task, intervalId&#125;);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Tasks &#123;&#125;.&quot;</span>, tasks)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">clear</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        tasks.<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123;intervalId&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">clearInterval</span>(intervalId);</span><br><span class="line">        &#125;);</span><br><span class="line">        tasks.<span class="property">length</span> = <span class="number">0</span>; <span class="comment">// æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;add, clear, tasks&#125;;  <span class="comment">// è¿”å› tasksï¼Œæ–¹ä¾¿å¤–éƒ¨è®¿é—®</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> scheduledTasks;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>java-mysql JDBC è¿æ¥æ•°æ®åº“</title>
    <url>/2022/09/29/java-mysql%20JDBC%20%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    <content><![CDATA[<h1>java-mysql JDBC è¿æ¥æ•°æ®åº“</h1>
<p>å‰è¨€:</p>
<p>å› ä¸ºæ•°æ®åº“è¯¾ç¨‹è®¾è®¡éœ€è¦è¿æ¥æ•°æ®åº“ï¼Œæˆ‘å”¯ä¸€æ¥è§¦è¿‡çš„å°±æ˜¯ jdbc, ä¹Ÿä¸çŸ¥é“è¿˜æœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•ï¼Œå†åŠ ä¸Šæˆ‘ä»¬å®éªŒè¯¾æ¥è§¦è¿‡ jdbc, æœ€åè¯¾ç¨‹è®¾è®¡åšå®Œäº†ï¼Œå°±æƒ³ç€æŠŠæ–¹æ³•è®°ä¸‹æ¥.</p>
<h1>è¿æ¥å‰å‡†å¤‡:</h1>
<ol>
<li>
<p>å®‰è£… <a href="https://www.mysql.com/downloads/">mysql</a>,mysql å®‰è£…æ•™ç¨‹ç½‘ä¸Šæœ‰å¾ˆå¤šï¼Œå¯¹ç€æ•™ç¨‹ä¸€æ­¥æ­¥å°±èƒ½å®‰è£…ä¸‹æ¥ï¼Œè®°ä½è‡ªå·±è®¾ç½®çš„å¯†ç ï¼Œä¸ç„¶è¿ä¸ä¸Šæ•°æ®åº“.</p>
</li>
<li>
<p>ä¸‹è½½ java è¿æ¥ mysql çš„æ•°æ®åŒ… <a href="https://dev.mysql.com/downloads/connector/j/">jar</a></p>
</li>
</ol>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/1664538641591.png" alt=""></p>
<h2 id="å¯¼å…¥-jar-æ•°æ®åŒ…">å¯¼å…¥ jar æ•°æ®åŒ…</h2>
<p>æ³¨æ„ï¼jar åŒ…ä¸èƒ½éšä¾¿ç§»åŠ¨ï¼Œæˆ‘æ˜¯ç›´æ¥æŠŠ jar åŒ…æ”¾åœ¨äº† IDEA çš„æ ¹ç›®å½•ä¸‹é¢çš„ lib é‡Œé¢.</p>
<ol>
<li>è¿™é‡Œä»¥ IDEA ä¸ºä¾‹ï¼Œæ‰“å¼€ IDEA. æ‰“å¼€é¡¹ç›®ç»“æ„ (theProjectStructure ä½¿ç”¨çš„æ’ä»¶ç¿»è¯‘ï¼Œä¸çŸ¥é“å‡†ä¸å‡†ï¼Œä¸‹é¢ä¸€æ ·)</li>
</ol>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/1664539063792.png" alt=""></p>
<ol start="2">
<li>æ‰¾åˆ°æ¨¡å— (theModule), é€‰æ‹©æƒ³è¦è¿æ¥æ•°æ®åº“çš„é¡¹ç›®ï¼Œç„¶åç‚¹å‡»ä¾èµ– (relyOn), æœ€åç‚¹å‡»åŠ å·.</li>
</ol>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/1664539710423.png" alt=""></p>
<ol start="3">
<li>é€‰æ‹©ç¬¬ä¸€ä¸ª JAR æˆ–ç›®å½•</li>
</ol>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/1664539813085.png" alt=""></p>
<ol start="4">
<li>æœ€åæ‰¾åˆ°ä½ æ”¾ jar çš„ä½ç½®ï¼Œå¯¼å…¥å°±è¡Œäº†ã€‚åˆ°æ­¤ä¸ºæ­¢ jar åŒ…å°±å¯¼å…¥æˆåŠŸäº†.</li>
</ol>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/1664539925809-17210486389646.png" alt=""></p>
<h2 id="è¿æ¥æ•°æ®åº“">è¿æ¥æ•°æ®åº“</h2>
<p>æ³¨æ„ï¼Œè¿™ä¸€æ­¥æˆ‘ä¹Ÿæ˜¯è·Ÿç€èœé¸Ÿæ•™ç¨‹åšçš„ã€‚ç†è§£ä¸æ·±ï¼Œå¯èƒ½è¯´ä¸æ¸…æ¥š.</p>
<ol>
<li>é¦–å…ˆï¼Œå®ä¾‹åŒ–è¿™ä¸‰ä¸ªå¯¹è±¡ã€‚æ ¹æ®æˆ‘çš„ç†è§£ï¼Œç¬¬ä¸€ä¸ª (Connection) å°±æ˜¯ç”¨æ¥è¿æ¥æ•°æ®åº“çš„ï¼Œç¬¬äºŒä¸ª (Statement) æ˜¯è¿æ¥æ•°æ®åº“ä¹‹åï¼Œæƒ³è¦è¿è¡Œ mysql è¯­å¥ç”¨çš„ï¼Œæœ€åä¸€ä¸ª (Resultset) å°±æ˜¯ç”¨æ¥å¾—åˆ°æˆ–æ›´æ–°ä½ çš„ mysql è¯­å¥çš„ç»“æœ.(å¯ä»¥å…ˆä¸ç”¨å†™è¿™ä¸€æ­¥ï¼Œä½ ç”¨åˆ°å†å†™åº”è¯¥ä¹Ÿè¡Œ)</li>
</ol>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/1664540196391.png" alt=""></p>
<p>user å°±æ˜¯ä½ æ•°æ®åº“çš„ç”¨æˆ·åï¼Œé»˜è®¤çš„å°±æ˜¯ root.</p>
<p>password æ˜¯ä½ æ•°æ®çš„å¯†ç ï¼Œå‰é¢å®‰è£… mysql çš„æ—¶å€™è®¾ç½®çš„.</p>
<p>driver å°±æ˜¯é©±åŠ¨çš„åå­—ï¼Œè¿™ä¸ªæ˜¯å›ºå®šçš„.</p>
<p>url æ˜¯ä½ æƒ³è¦è¿æ¥çš„æ•°æ®åº“ï¼Œå°±æ˜¯é‚£ä¸ªæ¡†é‡Œé¢çš„ã€‚å¡«ä½ çš„æ•°æ®åº“åå­—ï¼Œå…¶ä»–çš„éƒ½æ˜¯ä¸€äº›å±æ€§ä»€ä¹ˆçš„ï¼Œéå¿…è¦åº”è¯¥ä¸ç”¨æ”¹.</p>
<p>Calss.forNmae æ˜¯æ³¨å†Œé©±åŠ¨ï¼Œå°±æ˜¯ä¸Šé¢çš„ driver.</p>
<p>æœ€åä¸€æ­¥å°±æ˜¯è¿æ¥æ•°æ®åº“ï¼Œconn æ˜¯ç¬¬ä¸€æ­¥å®ä¾‹åŒ–çš„ (Connetion) å¯¹è±¡.</p>
<p>å¾ˆå¥½ï¼Œè¿™æ ·å°±æˆåŠŸè¿æ¥äº†æ•°æ®åº“.</p>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/1664540663146.png" alt=""></p>
<p>æ³¨æ„ï¼šæ•°æ®åº“çš„è¯­å¥æ“ä½œéƒ½å¿…é¡»æ”¾åœ¨ try {catch (){}} ä¸­ï¼Œå¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">    <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">        System.out.print(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="åŸºæœ¬çš„æ•°æ®åº“æ“ä½œ">åŸºæœ¬çš„æ•°æ®åº“æ“ä½œ</h2>
<p>1.select</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">stmt = conn.createStatement();</span><br><span class="line">String sql=<span class="string">&quot;select * from tablename;&quot;</span>;</span><br><span class="line">rs= stmt.executeQuery(sql);</span><br><span class="line"><span class="comment">// è¿™æ ·rså°±å¾—åˆ°äº†æ•°æ®</span></span><br><span class="line"><span class="comment">// æ ¹æ®è¡¨ä¸­å¾—å­—æ®µåæ¥è¾“å‡ºæ•°æ®ï¼ˆè¿˜å¯ä»¥å¾—åˆ°è¿™ä¸ªè¯­å¥è¿”å›å¾—ç»“æœä¸ªæ•°æ¥è¾“å‡ºï¼Œå› ä¸ºæˆ‘ä¸ä¼šï¼Œæ‰€ä»¥å°±ä¸å†™äº†ï¼‰</span></span><br><span class="line"><span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;id:&quot;</span>+id+<span class="string">&quot; å§“åï¼š&quot;</span>+name+<span class="string">&quot; æ€§åˆ«ï¼š&quot;</span>+gender);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“å®ç°:</p>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/1664541517504.png" alt=""></p>
<ol start="2">
<li>insert:</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‰ä¸¤æ­¥ä¸selectç›¸åŒ</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    stmt = conn.createStatement();</span><br><span class="line">    String sql=<span class="string">&quot;insert into tablename (å­—æ®µå1,å­—æ®µå2,...) values (&quot;</span>å¼ ä¸‰<span class="string">&quot;,&quot;</span>ç”·<span class="string">&quot;,...&quot;</span><span class="string">&quot;);&quot;</span>;</span><br><span class="line">    stmt.executeUpdate(sql); <span class="comment">//å°±è¿™ä¸€æ­¥å˜äº†</span></span><br><span class="line">    <span class="keyword">catch</span>()&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è®°ä½ä¸€å®šè¦åœ¨try&#123;catch()&#123;&#125;&#125;é‡Œé¢å†™mysqlä»£ç ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>JDBC</tag>
      </tags>
  </entry>
  <entry>
    <title>linuxè„šæœ¬</title>
    <url>/2025/09/15/linux%E8%84%9A%E6%9C%AC/</url>
    <content><![CDATA[<h1>Linux è„šæœ¬ï¼ˆBashï¼‰åŸºç¡€æ•™ç¨‹</h1>
<hr>
<h2 id="1-ä»€ä¹ˆæ˜¯-Linux-è„šæœ¬ï¼Ÿ">1. ä»€ä¹ˆæ˜¯ Linux è„šæœ¬ï¼Ÿ</h2>
<ul>
<li>Linux è„šæœ¬æ˜¯ç”¨æ¥è‡ªåŠ¨åŒ–æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤çš„æ–‡æœ¬æ–‡ä»¶ã€‚</li>
<li>å¸¸ç”¨çš„è„šæœ¬è¯­è¨€æ˜¯ Bashï¼ˆBourne Again SHellï¼‰ã€‚</li>
<li>è„šæœ¬é€šå¸¸ä»¥ <code>.sh</code> ç»“å°¾ï¼Œä½†ä¸å¼ºåˆ¶ã€‚</li>
</ul>
<hr>
<h2 id="2-ç¬¬ä¸€ä¸ªè„šæœ¬ï¼šHello-World">2. ç¬¬ä¸€ä¸ªè„šæœ¬ï¼šHello World</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, Linux scripting!&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>#!/bin/bash</code> ï¼šå‘Šè¯‰ç³»ç»Ÿç”¨ bash æ¥æ‰§è¡Œè„šæœ¬</li>
<li><code>echo</code> ï¼šæ‰“å°è¾“å‡º</li>
</ul>
<p>ä¿å­˜ä¸º <code>hello.sh</code>ï¼Œç„¶åè¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x hello.sh   <span class="comment"># ç»™æ‰§è¡Œæƒé™</span></span><br><span class="line">./hello.sh          <span class="comment"># æ‰§è¡Œè„šæœ¬</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-å˜é‡å’ŒåŸºæœ¬è¿ç®—">3. å˜é‡å’ŒåŸºæœ¬è¿ç®—</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">name=<span class="string">&quot;orange&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$name</span>&quot;</span></span><br><span class="line"></span><br><span class="line">num1=10</span><br><span class="line">num2=5</span><br><span class="line"><span class="built_in">sum</span>=$((num1 + num2))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Sum: <span class="variable">$sum</span>&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å˜é‡èµ‹å€¼ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</li>
<li>ä½¿ç”¨ <code>$(( ))</code> è¿›è¡Œç®—æœ¯è¿ç®—ã€‚</li>
<li>å˜é‡å¼•ç”¨æ—¶å‰é¢åŠ  <code>$</code>ã€‚</li>
</ul>
<hr>
<h2 id="4-æ¡ä»¶åˆ¤æ–­">4. æ¡ä»¶åˆ¤æ–­</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">num=5</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$num</span> -gt 3 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$num</span> is greater than 3&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$num</span> is not greater than 3&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>å¸¸ç”¨æ¡ä»¶ï¼š</p>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-eq</code></td>
<td>ç­‰äº</td>
</tr>
<tr>
<td><code>-ne</code></td>
<td>ä¸ç­‰äº</td>
</tr>
<tr>
<td><code>-gt</code></td>
<td>å¤§äº</td>
</tr>
<tr>
<td><code>-lt</code></td>
<td>å°äº</td>
</tr>
<tr>
<td><code>-ge</code></td>
<td>å¤§äºç­‰äº</td>
</tr>
<tr>
<td><code>-le</code></td>
<td>å°äºç­‰äº</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="5-å¾ªç¯è¯­å¥">5. å¾ªç¯è¯­å¥</h2>
<h3 id="for-å¾ªç¯">for å¾ªç¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 1 2 3 4 5</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop <span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="while-å¾ªç¯">while å¾ªç¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Count <span class="variable">$count</span>&quot;</span></span><br><span class="line">    ((count++))</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="6-å‡½æ•°">6. å‡½æ•°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">greet</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$1</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">greet <span class="string">&quot;orange&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å‡½æ•°å®šä¹‰ç”¨ <code>function</code> æˆ–ç›´æ¥ <code>greet()</code></li>
<li>é€šè¿‡ <code>$1</code>, <code>$2</code>â€¦è·å–å‚æ•°</li>
</ul>
<hr>
<h2 id="7-è¯»å–ç”¨æˆ·è¾“å…¥">7. è¯»å–ç”¨æˆ·è¾“å…¥</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Enter your name: &quot;</span> name</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$name</span>&quot;</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="8-è„šæœ¬å‚æ•°">8. è„šæœ¬å‚æ•°</h2>
<p>è„šæœ¬æ‰§è¡Œæ—¶å¯ä»¥å¸¦å‚æ•°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./script.sh arg1 arg2</span><br></pre></td></tr></table></figure>
<p>åœ¨è„šæœ¬é‡Œï¼š</p>
<ul>
<li><code>$0</code> è„šæœ¬å</li>
<li><code>$1</code> ç¬¬ä¸€ä¸ªå‚æ•°</li>
<li><code>$2</code> ç¬¬äºŒä¸ªå‚æ•°</li>
<li><code>$#</code> å‚æ•°ä¸ªæ•°</li>
<li><code>$@</code> æ‰€æœ‰å‚æ•°</li>
</ul>
<hr>
<h2 id="9-å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹">9. å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹</h2>
<ul>
<li><code>ls</code> åˆ—ç›®å½•</li>
<li><code>cd</code> åˆ‡ç›®å½•</li>
<li><code>cat</code> æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</li>
<li><code>grep</code> æŸ¥æ‰¾å†…å®¹</li>
<li><code>awk</code> å¤„ç†æ–‡æœ¬</li>
<li><code>sed</code> æ–‡æœ¬æ›¿æ¢</li>
</ul>
<hr>
<h2 id="10-é”™è¯¯å¤„ç†å’Œè°ƒè¯•">10. é”™è¯¯å¤„ç†å’Œè°ƒè¯•</h2>
<ul>
<li>
<p>è„šæœ¬å¼€å§‹åŠ ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> -euo pipefail</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-e</code> é‡é”™é€€å‡º</li>
<li><code>-u</code> æœªå®šä¹‰å˜é‡æŠ¥é”™</li>
<li><code>-o pipefail</code> ç®¡é“é”™è¯¯æ£€æµ‹</li>
</ul>
</li>
<li>
<p>è°ƒè¯•è¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash -x script.sh</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h1>é¢å¤–æ¨èå­¦ä¹ èµ„æº</h1>
<ul>
<li>ã€ŠThe Linux Command Lineã€‹ â€” å…è´¹ç”µå­ä¹¦</li>
<li>Bash å®˜æ–¹æ‰‹å†Œï¼š<a href="https://www.gnu.org/software/bash/manual/">https://www.gnu.org/software/bash/manual/</a></li>
<li>åœ¨çº¿æ•™ç¨‹ï¼š<a href="https://ryanstutorials.net/bash-scripting-tutorial/">https://ryanstutorials.net/bash-scripting-tutorial/</a></li>
</ul>
<hr>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>logbacké…ç½®æ–‡ä»¶</title>
    <url>/2025/09/15/logback%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<configuration debug="false">
<pre><code>&lt;logger name=&quot;org.springframework.boot.autoconfigure&quot; level=&quot;INFO&quot;/&gt;


&lt;!-- æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„ä½ç½®ï¼ŒConsoleAppenderè¡¨ç¤ºè¾“å‡ºåˆ°æ§åˆ¶å° --&gt;
&lt;appender name=&quot;STDOUT&quot;
          class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
    &lt;encoder&gt;
        &lt;!-- æ—¥å¿—è¾“å‡ºçš„æ ¼å¼ --&gt;
        &lt;!-- æŒ‰ç…§é¡ºåºåˆ†åˆ«æ˜¯ï¼šæ—¶é—´ã€æ—¥å¿—çº§åˆ«ã€çº¿ç¨‹åç§°ã€æ‰“å°æ—¥å¿—çš„ç±»ã€æ—¥å¿—ä¸»ä½“å†…å®¹ã€æ¢è¡Œ --&gt;
        &lt;pattern&gt;[%d&#123;HH:mm:ss.SSS&#125;] [%-5level] [%thread] [%logger] [%msg]%n&lt;/pattern&gt;
        &lt;charset&gt;UTF-8&lt;/charset&gt;
    &lt;/encoder&gt;
&lt;/appender&gt;

&lt;!-- è®¾ç½®å…¨å±€æ—¥å¿—çº§åˆ«ã€‚æ—¥å¿—çº§åˆ«æŒ‰é¡ºåºåˆ†åˆ«æ˜¯ï¼šTRACEã€DEBUGã€INFOã€WARNã€ERROR --&gt;
&lt;!-- æŒ‡å®šä»»ä½•ä¸€ä¸ªæ—¥å¿—çº§åˆ«éƒ½åªæ‰“å°å½“å‰çº§åˆ«å’Œåé¢çº§åˆ«çš„æ—¥å¿—ã€‚ --&gt;
&lt;root level=&quot;INFO&quot;&gt;
    &lt;!-- æŒ‡å®šæ‰“å°æ—¥å¿—çš„appenderï¼Œè¿™é‡Œé€šè¿‡â€œSTDOUTâ€å¼•ç”¨äº†å‰é¢é…ç½®çš„appender --&gt;
    &lt;appender-ref ref=&quot;STDOUT&quot;/&gt;
&lt;/root&gt;

&lt;!-- æ ¹æ®ç‰¹æ®Šéœ€æ±‚æŒ‡å®šå±€éƒ¨æ—¥å¿—çº§åˆ«ï¼Œå¯ä¹Ÿæ˜¯åŒ…åæˆ–å…¨ç±»åã€‚ --&gt;
&lt;logger name=&quot;online.orange.img&quot; level=&quot;DEBUG&quot;/&gt;

&lt;appender name=&quot;FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
    &lt;file&gt;logs/application.log&lt;/file&gt;
    &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
        &lt;!-- æ—¥å¿—æ–‡ä»¶è·¯å¾„å’Œå‘½åè§„åˆ™ --&gt;
        &lt;fileNamePattern&gt;logs/application.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt;
        &lt;!-- æœ€å¤§ä¿ç•™æ—¥å¿—æ–‡ä»¶çš„æ—¶é—´ --&gt;
        &lt;maxHistory&gt;30&lt;/maxHistory&gt;
    &lt;/rollingPolicy&gt;
    &lt;encoder&gt;
        &lt;pattern&gt;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] [%thread] [%logger] [%msg]%n&lt;/pattern&gt;
        &lt;charset&gt;UTF-8&lt;/charset&gt;
    &lt;/encoder&gt;
&lt;/appender&gt;
</code></pre>
</configuration>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>Markdown-Emoji</title>
    <url>/2022/11/01/markdown-Emoji/</url>
    <content><![CDATA[<h2 id="People">People</h2>
<table>
<thead>
<tr>
<th style="text-align:left">:bowtie: <code>:bowtie:</code></th>
<th>ğŸ˜„ <code>:smile:</code></th>
<th>ğŸ˜† <code>:laughing:</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ğŸ˜Š <code>:blush:</code></td>
<td>ğŸ˜ƒ <code>:smiley:</code></td>
<td>â˜ºï¸ <code>:relaxed:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜ <code>:smirk:</code></td>
<td>ğŸ˜ <code>:heart_eyes:</code></td>
<td>ğŸ˜˜ <code>:kissing_heart:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜š <code>:kissing_closed_eyes:</code></td>
<td>ğŸ˜³ <code>:flushed:</code></td>
<td>ğŸ˜Œ <code>:relieved:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜† <code>:satisfied:</code></td>
<td>ğŸ˜ <code>:grin:</code></td>
<td>ğŸ˜‰ <code>:wink:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜œ <code>:stuck_out_tongue_winking_eye:</code></td>
<td>ğŸ˜ <code>:stuck_out_tongue_closed_eyes:</code></td>
<td>ğŸ˜€ <code>:grinning:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜— <code>:kissing:</code></td>
<td>ğŸ˜™ <code>:kissing_smiling_eyes:</code></td>
<td>ğŸ˜› <code>:stuck_out_tongue:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜´ <code>:sleeping:</code></td>
<td>ğŸ˜Ÿ <code>:worried:</code></td>
<td>ğŸ˜¦ <code>:frowning:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜§ <code>:anguished:</code></td>
<td>ğŸ˜® <code>:open_mouth:</code></td>
<td>ğŸ˜¬ <code>:grimacing:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜• <code>:confused:</code></td>
<td>ğŸ˜¯ <code>:hushed:</code></td>
<td>ğŸ˜‘ <code>:expressionless:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜’ <code>:unamused:</code></td>
<td>ğŸ˜… <code>:sweat_smile:</code></td>
<td>ğŸ˜“ <code>:sweat:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜¥ <code>:disappointed_relieved:</code></td>
<td>ğŸ˜© <code>:weary:</code></td>
<td>ğŸ˜” <code>:pensive:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜ <code>:disappointed:</code></td>
<td>ğŸ˜– <code>:confounded:</code></td>
<td>ğŸ˜¨ <code>:fearful:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜° <code>:cold_sweat:</code></td>
<td>ğŸ˜£ <code>:persevere:</code></td>
<td>ğŸ˜¢ <code>:cry:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜­ <code>:sob:</code></td>
<td>ğŸ˜‚ <code>:joy:</code></td>
<td>ğŸ˜² <code>:astonished:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜± <code>:scream:</code></td>
<td>:neckbeard: <code>:neckbeard:</code></td>
<td>ğŸ˜« <code>:tired_face:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜  <code>:angry:</code></td>
<td>ğŸ˜¡ <code>:rage:</code></td>
<td>ğŸ˜¤ <code>:triumph:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜ª <code>:sleepy:</code></td>
<td>ğŸ˜‹ <code>:yum:</code></td>
<td>ğŸ˜· <code>:mask:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜ <code>:sunglasses:</code></td>
<td>ğŸ˜µ <code>:dizzy_face:</code></td>
<td>ğŸ‘¿ <code>:imp:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜ˆ <code>:smiling_imp:</code></td>
<td>ğŸ˜ <code>:neutral_face:</code></td>
<td>ğŸ˜¶ <code>:no_mouth:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜‡ <code>:innocent:</code></td>
<td>ğŸ‘½ <code>:alien:</code></td>
<td>ğŸ’› <code>:yellow_heart:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’™ <code>:blue_heart:</code></td>
<td>ğŸ’œ <code>:purple_heart:</code></td>
<td>â¤ï¸ <code>:heart:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’š <code>:green_heart:</code></td>
<td>ğŸ’” <code>:broken_heart:</code></td>
<td>ğŸ’“ <code>:heartbeat:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’— <code>:heartpulse:</code></td>
<td>ğŸ’• <code>:two_hearts:</code></td>
<td>ğŸ’ <code>:revolving_hearts:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’˜ <code>:cupid:</code></td>
<td>ğŸ’– <code>:sparkling_heart:</code></td>
<td>âœ¨ <code>:sparkles:</code></td>
</tr>
<tr>
<td style="text-align:left">â­ <code>:star:</code></td>
<td>ğŸŒŸ <code>:star2:</code></td>
<td>ğŸ’« <code>:dizzy:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’¥ <code>:boom:</code></td>
<td>ğŸ’¥ <code>:collision:</code></td>
<td>ğŸ’¢ <code>:anger:</code></td>
</tr>
<tr>
<td style="text-align:left">â— <code>:exclamation:</code></td>
<td>â“ <code>:question:</code></td>
<td>â• <code>:grey_exclamation:</code></td>
</tr>
<tr>
<td style="text-align:left">â” <code>:grey_question:</code></td>
<td>ğŸ’¤ <code>:zzz:</code></td>
<td>ğŸ’¨ <code>:dash:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’¦ <code>:sweat_drops:</code></td>
<td>ğŸ¶ <code>:notes:</code></td>
<td>ğŸµ <code>:musical_note:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ”¥ <code>:fire:</code></td>
<td>ğŸ’© <code>:hankey:</code></td>
<td>ğŸ’© <code>:poop:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’© <code>:shit:</code></td>
<td>ğŸ‘ <code>:+1:</code></td>
<td>ğŸ‘ <code>:thumbsup:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘ <code>:-1:</code></td>
<td>ğŸ‘ <code>:thumbsdown:</code></td>
<td>ğŸ‘Œ <code>:ok_hand:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘Š <code>:punch:</code></td>
<td>ğŸ‘Š <code>:facepunch:</code></td>
<td>âœŠ <code>:fist:</code></td>
</tr>
<tr>
<td style="text-align:left">âœŒï¸ <code>:v:</code></td>
<td>ğŸ‘‹ <code>:wave:</code></td>
<td>âœ‹ <code>:hand:</code></td>
</tr>
<tr>
<td style="text-align:left">âœ‹ <code>:raised_hand:</code></td>
<td>ğŸ‘ <code>:open_hands:</code></td>
<td>â˜ï¸ <code>:point_up:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘‡ <code>:point_down:</code></td>
<td>ğŸ‘ˆ <code>:point_left:</code></td>
<td>ğŸ‘‰ <code>:point_right:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ™Œ <code>:raised_hands:</code></td>
<td>ğŸ™ <code>:pray:</code></td>
<td>ğŸ‘† <code>:point_up_2:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘ <code>:clap:</code></td>
<td>ğŸ’ª <code>:muscle:</code></td>
<td>ğŸ¤˜ <code>:metal:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ–• <code>:fu:</code></td>
<td>ğŸš¶ <code>:walking:</code></td>
<td>ğŸƒ <code>:runner:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸƒ <code>:running:</code></td>
<td>ğŸ‘« <code>:couple:</code></td>
<td>ğŸ‘ª <code>:family:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘¬ <code>:two_men_holding_hands:</code></td>
<td>ğŸ‘­ <code>:two_women_holding_hands:</code></td>
<td>ğŸ’ƒ <code>:dancer:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘¯ <code>:dancers:</code></td>
<td>ğŸ™†â€â™€ï¸ <code>:ok_woman:</code></td>
<td>ğŸ™… <code>:no_good:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’ <code>:information_desk_person:</code></td>
<td>ğŸ™‹ <code>:raising_hand:</code></td>
<td>ğŸ‘°â€â™€ï¸ <code>:bride_with_veil:</code></td>
</tr>
<tr>
<td style="text-align:left">:person_with_pouting_face: <code>:person_with_pouting_face:</code></td>
<td>:person_frowning: <code>:person_frowning:</code></td>
<td>ğŸ™‡ <code>:bow:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’ <code>:couplekiss:</code></td>
<td>ğŸ’‘ <code>:couple_with_heart:</code></td>
<td>ğŸ’† <code>:massage:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’‡ <code>:haircut:</code></td>
<td>ğŸ’… <code>:nail_care:</code></td>
<td>ğŸ‘¦ <code>:boy:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘§ <code>:girl:</code></td>
<td>ğŸ‘© <code>:woman:</code></td>
<td>ğŸ‘¨ <code>:man:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘¶ <code>:baby:</code></td>
<td>ğŸ‘µ <code>:older_woman:</code></td>
<td>ğŸ‘´ <code>:older_man:</code></td>
</tr>
<tr>
<td style="text-align:left">:person_with_blond_hair: <code>:person_with_blond_hair:</code></td>
<td>ğŸ‘² <code>:man_with_gua_pi_mao:</code></td>
<td>ğŸ‘³â€â™‚ï¸ <code>:man_with_turban:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘· <code>:construction_worker:</code></td>
<td>ğŸ‘® <code>:cop:</code></td>
<td>ğŸ‘¼ <code>:angel:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘¸ <code>:princess:</code></td>
<td>ğŸ˜º <code>:smiley_cat:</code></td>
<td>ğŸ˜¸ <code>:smile_cat:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜» <code>:heart_eyes_cat:</code></td>
<td>ğŸ˜½ <code>:kissing_cat:</code></td>
<td>ğŸ˜¼ <code>:smirk_cat:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ™€ <code>:scream_cat:</code></td>
<td>ğŸ˜¿ <code>:crying_cat_face:</code></td>
<td>ğŸ˜¹ <code>:joy_cat:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ˜¾ <code>:pouting_cat:</code></td>
<td>ğŸ‘¹ <code>:japanese_ogre:</code></td>
<td>ğŸ‘º <code>:japanese_goblin:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ™ˆ <code>:see_no_evil:</code></td>
<td>ğŸ™‰ <code>:hear_no_evil:</code></td>
<td>ğŸ™Š <code>:speak_no_evil:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ’‚â€â™‚ï¸ <code>:guardsman:</code></td>
<td>ğŸ’€ <code>:skull:</code></td>
<td>ğŸ¾ <code>:feet:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘„ <code>:lips:</code></td>
<td>ğŸ’‹ <code>:kiss:</code></td>
<td>ğŸ’§ <code>:droplet:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘‚ <code>:ear:</code></td>
<td>ğŸ‘€ <code>:eyes:</code></td>
<td>ğŸ‘ƒ <code>:nose:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘… <code>:tongue:</code></td>
<td>ğŸ’Œ <code>:love_letter:</code></td>
<td>ğŸ‘¤ <code>:bust_in_silhouette:</code></td>
</tr>
<tr>
<td style="text-align:left">ğŸ‘¥ <code>:busts_in_silhouette:</code></td>
<td>ğŸ’¬ <code>:speech_balloon:</code></td>
<td>ğŸ’­ <code>:thought_balloon:</code></td>
</tr>
<tr>
<td style="text-align:left">:feelsgood <code>:feelsgood:</code></td>
<td>:finnadie: <code>:finnadie:</code></td>
<td>:goberserk: <code>:goberserk:</code></td>
</tr>
<tr>
<td style="text-align:left">:godmode: <code>:godmode:</code></td>
<td>:hurtrealbad: <code>:hurtrealbad:</code></td>
<td>:rage1: <code>:rage1:</code></td>
</tr>
<tr>
<td style="text-align:left">:rage2: <code>:rage2:</code></td>
<td>:rage3: <code>:rage3:</code></td>
<td>:rage4: <code>:rage4:</code></td>
</tr>
<tr>
<td style="text-align:left">:suspect: <code>:suspect:</code></td>
<td>:trollface: <code>:trollface:</code></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="Nature">Nature</h2>
<table>
<thead>
<tr>
<th>â˜€ï¸ <code>:sunny:</code></th>
<th>â˜” <code>:umbrella:</code></th>
<th>â˜ï¸ <code>:cloud:</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>â„ï¸ <code>:snowflake:</code></td>
<td>â›„ <code>:snowman:</code></td>
<td>âš¡ <code>:zap:</code></td>
</tr>
<tr>
<td>ğŸŒ€ <code>:cyclone:</code></td>
<td>ğŸŒ <code>:foggy:</code></td>
<td>ğŸŒŠ <code>:ocean:</code></td>
</tr>
<tr>
<td>ğŸ± <code>:cat:</code></td>
<td>ğŸ¶ <code>:dog:</code></td>
<td>ğŸ­ <code>:mouse:</code></td>
</tr>
<tr>
<td>ğŸ¹ <code>:hamster:</code></td>
<td>ğŸ° <code>:rabbit:</code></td>
<td>ğŸº <code>:wolf:</code></td>
</tr>
<tr>
<td>ğŸ¸ <code>:frog:</code></td>
<td>ğŸ¯ <code>:tiger:</code></td>
<td>ğŸ¨ <code>:koala:</code></td>
</tr>
<tr>
<td>ğŸ» <code>:bear:</code></td>
<td>ğŸ· <code>:pig:</code></td>
<td>ğŸ½ <code>:pig_nose:</code></td>
</tr>
<tr>
<td>ğŸ® <code>:cow:</code></td>
<td>ğŸ— <code>:boar:</code></td>
<td>ğŸµ <code>:monkey_face:</code></td>
</tr>
<tr>
<td>ğŸ’ <code>:monkey:</code></td>
<td>ğŸ´ <code>:horse:</code></td>
<td>ğŸ <code>:racehorse:</code></td>
</tr>
<tr>
<td>ğŸ« <code>:camel:</code></td>
<td>ğŸ‘ <code>:sheep:</code></td>
<td>ğŸ˜ <code>:elephant:</code></td>
</tr>
<tr>
<td>ğŸ¼ <code>:panda_face:</code></td>
<td>ğŸ <code>:snake:</code></td>
<td>ğŸ¦ <code>:bird:</code></td>
</tr>
<tr>
<td>ğŸ¤ <code>:baby_chick:</code></td>
<td>ğŸ¥ <code>:hatched_chick:</code></td>
<td>ğŸ£ <code>:hatching_chick:</code></td>
</tr>
<tr>
<td>ğŸ” <code>:chicken:</code></td>
<td>ğŸ§ <code>:penguin:</code></td>
<td>ğŸ¢ <code>:turtle:</code></td>
</tr>
<tr>
<td>ğŸ› <code>:bug:</code></td>
<td>ğŸ <code>:honeybee:</code></td>
<td>ğŸœ <code>:ant:</code></td>
</tr>
<tr>
<td>ğŸª² <code>:beetle:</code></td>
<td>ğŸŒ <code>:snail:</code></td>
<td>ğŸ™ <code>:octopus:</code></td>
</tr>
<tr>
<td>ğŸ  <code>:tropical_fish:</code></td>
<td>ğŸŸ <code>:fish:</code></td>
<td>ğŸ³ <code>:whale:</code></td>
</tr>
<tr>
<td>ğŸ‹ <code>:whale2:</code></td>
<td>ğŸ¬ <code>:dolphin:</code></td>
<td>ğŸ„ <code>:cow2:</code></td>
</tr>
<tr>
<td>ğŸ <code>:ram:</code></td>
<td>ğŸ€ <code>:rat:</code></td>
<td>ğŸƒ <code>:water_buffalo:</code></td>
</tr>
<tr>
<td>ğŸ… <code>:tiger2:</code></td>
<td>ğŸ‡ <code>:rabbit2:</code></td>
<td>ğŸ‰ <code>:dragon:</code></td>
</tr>
<tr>
<td>ğŸ <code>:goat:</code></td>
<td>ğŸ“ <code>:rooster:</code></td>
<td>ğŸ• <code>:dog2:</code></td>
</tr>
<tr>
<td>ğŸ– <code>:pig2:</code></td>
<td>ğŸ <code>:mouse2:</code></td>
<td>ğŸ‚ <code>:ox:</code></td>
</tr>
<tr>
<td>ğŸ² <code>:dragon_face:</code></td>
<td>ğŸ¡ <code>:blowfish:</code></td>
<td>ğŸŠ <code>:crocodile:</code></td>
</tr>
<tr>
<td>ğŸª <code>:dromedary_camel:</code></td>
<td>ğŸ† <code>:leopard:</code></td>
<td>ğŸˆ <code>:cat2:</code></td>
</tr>
<tr>
<td>ğŸ© <code>:poodle:</code></td>
<td>ğŸ¾ <code>:paw_prints:</code></td>
<td>ğŸ’ <code>:bouquet:</code></td>
</tr>
<tr>
<td>ğŸŒ¸ <code>:cherry_blossom:</code></td>
<td>ğŸŒ· <code>:tulip:</code></td>
<td>ğŸ€ <code>:four_leaf_clover:</code></td>
</tr>
<tr>
<td>ğŸŒ¹ <code>:rose:</code></td>
<td>ğŸŒ» <code>:sunflower:</code></td>
<td>ğŸŒº <code>:hibiscus:</code></td>
</tr>
<tr>
<td>ğŸ <code>:maple_leaf:</code></td>
<td>ğŸƒ <code>:leaves:</code></td>
<td>ğŸ‚ <code>:fallen_leaf:</code></td>
</tr>
<tr>
<td>ğŸŒ¿ <code>:herb:</code></td>
<td>ğŸ„ <code>:mushroom:</code></td>
<td>ğŸŒµ <code>:cactus:</code></td>
</tr>
<tr>
<td>ğŸŒ´ <code>:palm_tree:</code></td>
<td>ğŸŒ² <code>:evergreen_tree:</code></td>
<td>ğŸŒ³ <code>:deciduous_tree:</code></td>
</tr>
<tr>
<td>ğŸŒ° <code>:chestnut:</code></td>
<td>ğŸŒ± <code>:seedling:</code></td>
<td>ğŸŒ¼ <code>:blossom:</code></td>
</tr>
<tr>
<td>ğŸŒ¾ <code>:ear_of_rice:</code></td>
<td>ğŸš <code>:shell:</code></td>
<td>ğŸŒ <code>:globe_with_meridians:</code></td>
</tr>
<tr>
<td>ğŸŒ <code>:sun_with_face:</code></td>
<td>ğŸŒ <code>:full_moon_with_face:</code></td>
<td>ğŸŒš <code>:new_moon_with_face:</code></td>
</tr>
<tr>
<td>ğŸŒ‘ <code>:new_moon:</code></td>
<td>ğŸŒ’ <code>:waxing_crescent_moon:</code></td>
<td>ğŸŒ“ <code>:first_quarter_moon:</code></td>
</tr>
<tr>
<td>ğŸŒ” <code>:waxing_gibbous_moon:</code></td>
<td>ğŸŒ• <code>:full_moon:</code></td>
<td>ğŸŒ– <code>:waning_gibbous_moon:</code></td>
</tr>
<tr>
<td>ğŸŒ— <code>:last_quarter_moon:</code></td>
<td>ğŸŒ˜ <code>:waning_crescent_moon:</code></td>
<td>ğŸŒœ <code>:last_quarter_moon_with_face:</code></td>
</tr>
<tr>
<td>ğŸŒ› <code>:first_quarter_moon_with_face:</code></td>
<td>ğŸŒ” <code>:moon:</code></td>
<td>ğŸŒ <code>:earth_africa:</code></td>
</tr>
<tr>
<td>ğŸŒ <code>:earth_americas:</code></td>
<td>ğŸŒ <code>:earth_asia:</code></td>
<td>ğŸŒ‹ <code>:volcano:</code></td>
</tr>
<tr>
<td>ğŸŒŒ <code>:milky_way:</code></td>
<td>â›… <code>:partly_sunny:</code></td>
<td>:octocat: <code>:octocat:</code></td>
</tr>
<tr>
<td>:squirrel: <code>:squirrel:</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="Objects">Objects</h2>
<table>
<thead>
<tr>
<th>ğŸ <code>:bamboo:</code></th>
<th>ğŸ’ <code>:gift_heart:</code></th>
<th>ğŸ <code>:dolls:</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ’ <code>:school_satchel:</code></td>
<td>ğŸ“ <code>:mortar_board:</code></td>
<td>ğŸ <code>:flags:</code></td>
</tr>
<tr>
<td>ğŸ† <code>:fireworks:</code></td>
<td>ğŸ‡ <code>:sparkler:</code></td>
<td>ğŸ <code>:wind_chime:</code></td>
</tr>
<tr>
<td>ğŸ‘ <code>:rice_scene:</code></td>
<td>ğŸƒ <code>:jack_o_lantern:</code></td>
<td>ğŸ‘» <code>:ghost:</code></td>
</tr>
<tr>
<td>ğŸ… <code>:santa:</code></td>
<td>ğŸ„ <code>:christmas_tree:</code></td>
<td>ğŸ <code>:gift:</code></td>
</tr>
<tr>
<td>ğŸ”” <code>:bell:</code></td>
<td>ğŸ”• <code>:no_bell:</code></td>
<td>ğŸ‹ <code>:tanabata_tree:</code></td>
</tr>
<tr>
<td>ğŸ‰ <code>:tada:</code></td>
<td>ğŸŠ <code>:confetti_ball:</code></td>
<td>ğŸˆ <code>:balloon:</code></td>
</tr>
<tr>
<td>ğŸ”® <code>:crystal_ball:</code></td>
<td>ğŸ’¿ <code>:cd:</code></td>
<td>ğŸ“€ <code>:dvd:</code></td>
</tr>
<tr>
<td>ğŸ’¾ <code>:floppy_disk:</code></td>
<td>ğŸ“· <code>:camera:</code></td>
<td>ğŸ“¹ <code>:video_camera:</code></td>
</tr>
<tr>
<td>ğŸ¥ <code>:movie_camera:</code></td>
<td>ğŸ’» <code>:computer:</code></td>
<td>ğŸ“º <code>:tv:</code></td>
</tr>
<tr>
<td>ğŸ“± <code>:iphone:</code></td>
<td>â˜ï¸ <code>:phone:</code></td>
<td>â˜ï¸ <code>:telephone:</code></td>
</tr>
<tr>
<td>ğŸ“ <code>:telephone_receiver:</code></td>
<td>ğŸ“Ÿ <code>:pager:</code></td>
<td>ğŸ“  <code>:fax:</code></td>
</tr>
<tr>
<td>ğŸ’½ <code>:minidisc:</code></td>
<td>ğŸ“¼ <code>:vhs:</code></td>
<td>ğŸ”‰ <code>:sound:</code></td>
</tr>
<tr>
<td>ğŸ”ˆ <code>:speaker:</code></td>
<td>ğŸ”‡ <code>:mute:</code></td>
<td>ğŸ“¢ <code>:loudspeaker:</code></td>
</tr>
<tr>
<td>ğŸ“£ <code>:mega:</code></td>
<td>âŒ› <code>:hourglass:</code></td>
<td>â³ <code>:hourglass_flowing_sand:</code></td>
</tr>
<tr>
<td>â° <code>:alarm_clock:</code></td>
<td>âŒš <code>:watch:</code></td>
<td>ğŸ“» <code>:radio:</code></td>
</tr>
<tr>
<td>ğŸ“¡ <code>:satellite:</code></td>
<td>â¿ <code>:loop:</code></td>
<td>ğŸ” <code>:mag:</code></td>
</tr>
<tr>
<td>ğŸ” <code>:mag_right:</code></td>
<td>ğŸ”“ <code>:unlock:</code></td>
<td>ğŸ”’ <code>:lock:</code></td>
</tr>
<tr>
<td>ğŸ” <code>:lock_with_ink_pen:</code></td>
<td>ğŸ” <code>:closed_lock_with_key:</code></td>
<td>ğŸ”‘ <code>:key:</code></td>
</tr>
<tr>
<td>ğŸ’¡ <code>:bulb:</code></td>
<td>ğŸ”¦ <code>:flashlight:</code></td>
<td>ğŸ”† <code>:high_brightness:</code></td>
</tr>
<tr>
<td>ğŸ”… <code>:low_brightness:</code></td>
<td>ğŸ”Œ <code>:electric_plug:</code></td>
<td>ğŸ”‹ <code>:battery:</code></td>
</tr>
<tr>
<td>ğŸ“² <code>:calling:</code></td>
<td>ğŸ“§ <code>:email:</code></td>
<td>ğŸ“« <code>:mailbox:</code></td>
</tr>
<tr>
<td>ğŸ“® <code>:postbox:</code></td>
<td>ğŸ›€ <code>:bath:</code></td>
<td>ğŸ› <code>:bathtub:</code></td>
</tr>
<tr>
<td>ğŸš¿ <code>:shower:</code></td>
<td>ğŸš½ <code>:toilet:</code></td>
<td>ğŸ”§ <code>:wrench:</code></td>
</tr>
<tr>
<td>ğŸ”© <code>:nut_and_bolt:</code></td>
<td>ğŸ”¨ <code>:hammer:</code></td>
<td>ğŸ’º <code>:seat:</code></td>
</tr>
<tr>
<td>ğŸ’° <code>:moneybag:</code></td>
<td>ğŸ’´ <code>:yen:</code></td>
<td>ğŸ’µ <code>:dollar:</code></td>
</tr>
<tr>
<td>ğŸ’· <code>:pound:</code></td>
<td>ğŸ’¶ <code>:euro:</code></td>
<td>ğŸ’³ <code>:credit_card:</code></td>
</tr>
<tr>
<td>ğŸ’¸ <code>:money_with_wings:</code></td>
<td>ğŸ“§ <code>:e-mail:</code></td>
<td>ğŸ“¥ <code>:inbox_tray:</code></td>
</tr>
<tr>
<td>ğŸ“¤ <code>:outbox_tray:</code></td>
<td>âœ‰ï¸ <code>:envelope:</code></td>
<td>ğŸ“¨ <code>:incoming_envelope:</code></td>
</tr>
<tr>
<td>ğŸ“¯ <code>:postal_horn:</code></td>
<td>ğŸ“ª <code>:mailbox_closed:</code></td>
<td>ğŸ“¬ <code>:mailbox_with_mail:</code></td>
</tr>
<tr>
<td>ğŸ“­ <code>:mailbox_with_no_mail:</code></td>
<td>ğŸšª <code>:door:</code></td>
<td>ğŸš¬ <code>:smoking:</code></td>
</tr>
<tr>
<td>ğŸ’£ <code>:bomb:</code></td>
<td>ğŸ”« <code>:gun:</code></td>
<td>ğŸ”ª <code>:hocho:</code></td>
</tr>
<tr>
<td>ğŸ’Š <code>:pill:</code></td>
<td>ğŸ’‰ <code>:syringe:</code></td>
<td>ğŸ“„ <code>:page_facing_up:</code></td>
</tr>
<tr>
<td>ğŸ“ƒ <code>:page_with_curl:</code></td>
<td>ğŸ“‘ <code>:bookmark_tabs:</code></td>
<td>ğŸ“Š <code>:bar_chart:</code></td>
</tr>
<tr>
<td>ğŸ“ˆ <code>:chart_with_upwards_trend:</code></td>
<td>ğŸ“‰ <code>:chart_with_downwards_trend:</code></td>
<td>ğŸ“œ <code>:scroll:</code></td>
</tr>
<tr>
<td>ğŸ“‹ <code>:clipboard:</code></td>
<td>ğŸ“† <code>:calendar:</code></td>
<td>ğŸ“… <code>:date:</code></td>
</tr>
<tr>
<td>ğŸ“‡ <code>:card_index:</code></td>
<td>ğŸ“ <code>:file_folder:</code></td>
<td>ğŸ“‚ <code>:open_file_folder:</code></td>
</tr>
<tr>
<td>âœ‚ï¸ <code>:scissors:</code></td>
<td>ğŸ“Œ <code>:pushpin:</code></td>
<td>ğŸ“ <code>:paperclip:</code></td>
</tr>
<tr>
<td>âœ’ï¸ <code>:black_nib:</code></td>
<td>âœï¸ <code>:pencil2:</code></td>
<td>ğŸ“ <code>:straight_ruler:</code></td>
</tr>
<tr>
<td>ğŸ“ <code>:triangular_ruler:</code></td>
<td>ğŸ“• <code>:closed_book:</code></td>
<td>ğŸ“— <code>:green_book:</code></td>
</tr>
<tr>
<td>ğŸ“˜ <code>:blue_book:</code></td>
<td>ğŸ“™ <code>:orange_book:</code></td>
<td>ğŸ““ <code>:notebook:</code></td>
</tr>
<tr>
<td>ğŸ“” <code>:notebook_with_decorative_cover:</code></td>
<td>ğŸ“’ <code>:ledger:</code></td>
<td>ğŸ“š <code>:books:</code></td>
</tr>
<tr>
<td>ğŸ”– <code>:bookmark:</code></td>
<td>ğŸ“› <code>:name_badge:</code></td>
<td>ğŸ”¬ <code>:microscope:</code></td>
</tr>
<tr>
<td>ğŸ”­ <code>:telescope:</code></td>
<td>ğŸ“° <code>:newspaper:</code></td>
<td>ğŸˆ <code>:football:</code></td>
</tr>
<tr>
<td>ğŸ€ <code>:basketball:</code></td>
<td>âš½ <code>:soccer:</code></td>
<td>âš¾ <code>:baseball:</code></td>
</tr>
<tr>
<td>ğŸ¾ <code>:tennis:</code></td>
<td>ğŸ± <code>:8ball:</code></td>
<td>ğŸ‰ <code>:rugby_football:</code></td>
</tr>
<tr>
<td>ğŸ³ <code>:bowling:</code></td>
<td>â›³ <code>:golf:</code></td>
<td>ğŸšµ <code>:mountain_bicyclist:</code></td>
</tr>
<tr>
<td>ğŸš´ <code>:bicyclist:</code></td>
<td>ğŸ‡ <code>:horse_racing:</code></td>
<td>ğŸ‚ <code>:snowboarder:</code></td>
</tr>
<tr>
<td>ğŸŠ <code>:swimmer:</code></td>
<td>ğŸ„ <code>:surfer:</code></td>
<td>ğŸ¿ <code>:ski:</code></td>
</tr>
<tr>
<td>â™ ï¸ <code>:spades:</code></td>
<td>â™¥ï¸ <code>:hearts:</code></td>
<td>â™£ï¸ <code>:clubs:</code></td>
</tr>
<tr>
<td>â™¦ï¸ <code>:diamonds:</code></td>
<td>ğŸ’ <code>:gem:</code></td>
<td>ğŸ’ <code>:ring:</code></td>
</tr>
<tr>
<td>ğŸ† <code>:trophy:</code></td>
<td>ğŸ¼ <code>:musical_score:</code></td>
<td>ğŸ¹ <code>:musical_keyboard:</code></td>
</tr>
<tr>
<td>ğŸ» <code>:violin:</code></td>
<td>ğŸ‘¾ <code>:space_invader:</code></td>
<td>ğŸ® <code>:video_game:</code></td>
</tr>
<tr>
<td>ğŸƒ <code>:black_joker:</code></td>
<td>ğŸ´ <code>:flower_playing_cards:</code></td>
<td>ğŸ² <code>:game_die:</code></td>
</tr>
<tr>
<td>ğŸ¯ <code>:dart:</code></td>
<td>ğŸ€„ <code>:mahjong:</code></td>
<td>ğŸ¬ <code>:clapper:</code></td>
</tr>
<tr>
<td>ğŸ“ <code>:memo:</code></td>
<td>ğŸ“ <code>:pencil:</code></td>
<td>ğŸ“– <code>:book:</code></td>
</tr>
<tr>
<td>ğŸ¨ <code>:art:</code></td>
<td>ğŸ¤ <code>:microphone:</code></td>
<td>ğŸ§ <code>:headphones:</code></td>
</tr>
<tr>
<td>ğŸº <code>:trumpet:</code></td>
<td>ğŸ· <code>:saxophone:</code></td>
<td>ğŸ¸ <code>:guitar:</code></td>
</tr>
<tr>
<td>ğŸ‘ <code>:shoe:</code></td>
<td>ğŸ‘¡ <code>:sandal:</code></td>
<td>ğŸ‘  <code>:high_heel:</code></td>
</tr>
<tr>
<td>ğŸ’„ <code>:lipstick:</code></td>
<td>ğŸ‘¢ <code>:boot:</code></td>
<td>ğŸ‘• <code>:shirt:</code></td>
</tr>
<tr>
<td>ğŸ‘• <code>:tshirt:</code></td>
<td>ğŸ‘” <code>:necktie:</code></td>
<td>ğŸ‘š <code>:womans_clothes:</code></td>
</tr>
<tr>
<td>ğŸ‘— <code>:dress:</code></td>
<td>ğŸ½ <code>:running_shirt_with_sash:</code></td>
<td>ğŸ‘– <code>:jeans:</code></td>
</tr>
<tr>
<td>ğŸ‘˜ <code>:kimono:</code></td>
<td>ğŸ‘™ <code>:bikini:</code></td>
<td>ğŸ€ <code>:ribbon:</code></td>
</tr>
<tr>
<td>ğŸ© <code>:tophat:</code></td>
<td>ğŸ‘‘ <code>:crown:</code></td>
<td>ğŸ‘’ <code>:womans_hat:</code></td>
</tr>
<tr>
<td>ğŸ‘ <code>:mans_shoe:</code></td>
<td>ğŸŒ‚ <code>:closed_umbrella:</code></td>
<td>ğŸ’¼ <code>:briefcase:</code></td>
</tr>
<tr>
<td>ğŸ‘œ <code>:handbag:</code></td>
<td>ğŸ‘ <code>:pouch:</code></td>
<td>ğŸ‘› <code>:purse:</code></td>
</tr>
<tr>
<td>ğŸ‘“ <code>:eyeglasses:</code></td>
<td>ğŸ£ <code>:fishing_pole_and_fish:</code></td>
<td>â˜• <code>:coffee:</code></td>
</tr>
<tr>
<td>ğŸµ <code>:tea:</code></td>
<td>ğŸ¶ <code>:sake:</code></td>
<td>ğŸ¼ <code>:baby_bottle:</code></td>
</tr>
<tr>
<td>ğŸº <code>:beer:</code></td>
<td>ğŸ» <code>:beers:</code></td>
<td>ğŸ¸ <code>:cocktail:</code></td>
</tr>
<tr>
<td>ğŸ¹ <code>:tropical_drink:</code></td>
<td>ğŸ· <code>:wine_glass:</code></td>
<td>ğŸ´ <code>:fork_and_knife:</code></td>
</tr>
<tr>
<td>ğŸ• <code>:pizza:</code></td>
<td>ğŸ” <code>:hamburger:</code></td>
<td>ğŸŸ <code>:fries:</code></td>
</tr>
<tr>
<td>ğŸ— <code>:poultry_leg:</code></td>
<td>ğŸ– <code>:meat_on_bone:</code></td>
<td>ğŸ <code>:spaghetti:</code></td>
</tr>
<tr>
<td>ğŸ› <code>:curry:</code></td>
<td>ğŸ¤ <code>:fried_shrimp:</code></td>
<td>ğŸ± <code>:bento:</code></td>
</tr>
<tr>
<td>ğŸ£ <code>:sushi:</code></td>
<td>ğŸ¥ <code>:fish_cake:</code></td>
<td>ğŸ™ <code>:rice_ball:</code></td>
</tr>
<tr>
<td>ğŸ˜ <code>:rice_cracker:</code></td>
<td>ğŸš <code>:rice:</code></td>
<td>ğŸœ <code>:ramen:</code></td>
</tr>
<tr>
<td>ğŸ² <code>:stew:</code></td>
<td>ğŸ¢ <code>:oden:</code></td>
<td>ğŸ¡ <code>:dango:</code></td>
</tr>
<tr>
<td>ğŸ¥š <code>:egg:</code></td>
<td>ğŸ <code>:bread:</code></td>
<td>ğŸ© <code>:doughnut:</code></td>
</tr>
<tr>
<td>ğŸ® <code>:custard:</code></td>
<td>ğŸ¦ <code>:icecream:</code></td>
<td>ğŸ¨ <code>:ice_cream:</code></td>
</tr>
<tr>
<td>ğŸ§ <code>:shaved_ice:</code></td>
<td>ğŸ‚ <code>:birthday:</code></td>
<td>ğŸ° <code>:cake:</code></td>
</tr>
<tr>
<td>ğŸª <code>:cookie:</code></td>
<td>ğŸ« <code>:chocolate_bar:</code></td>
<td>ğŸ¬ <code>:candy:</code></td>
</tr>
<tr>
<td>ğŸ­ <code>:lollipop:</code></td>
<td>ğŸ¯ <code>:honey_pot:</code></td>
<td>ğŸ <code>:apple:</code></td>
</tr>
<tr>
<td>ğŸ <code>:green_apple:</code></td>
<td>ğŸŠ <code>:tangerine:</code></td>
<td>ğŸ‹ <code>:lemon:</code></td>
</tr>
<tr>
<td>ğŸ’ <code>:cherries:</code></td>
<td>ğŸ‡ <code>:grapes:</code></td>
<td>ğŸ‰ <code>:watermelon:</code></td>
</tr>
<tr>
<td>ğŸ“ <code>:strawberry:</code></td>
<td>ğŸ‘ <code>:peach:</code></td>
<td>ğŸˆ <code>:melon:</code></td>
</tr>
<tr>
<td>ğŸŒ <code>:banana:</code></td>
<td>ğŸ <code>:pear:</code></td>
<td>ğŸ <code>:pineapple:</code></td>
</tr>
<tr>
<td>ğŸ  <code>:sweet_potato:</code></td>
<td>ğŸ† <code>:eggplant:</code></td>
<td>ğŸ… <code>:tomato:</code></td>
</tr>
<tr>
<td>ğŸŒ½ <code>:corn:</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="Places">Places</h2>
<table>
<thead>
<tr>
<th>ğŸ  <code>:house:</code></th>
<th>ğŸ¡ <code>:house_with_garden:</code></th>
<th>ğŸ« <code>:school:</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ¢ <code>:office:</code></td>
<td>ğŸ£ <code>:post_office:</code></td>
<td>ğŸ¥ <code>:hospital:</code></td>
</tr>
<tr>
<td>ğŸ¦ <code>:bank:</code></td>
<td>ğŸª <code>:convenience_store:</code></td>
<td>ğŸ© <code>:love_hotel:</code></td>
</tr>
<tr>
<td>ğŸ¨ <code>:hotel:</code></td>
<td>ğŸ’’ <code>:wedding:</code></td>
<td>â›ª <code>:church:</code></td>
</tr>
<tr>
<td>ğŸ¬ <code>:department_store:</code></td>
<td>ğŸ¤ <code>:european_post_office:</code></td>
<td>ğŸŒ‡ <code>:city_sunrise:</code></td>
</tr>
<tr>
<td>ğŸŒ† <code>:city_sunset:</code></td>
<td>ğŸ¯ <code>:japanese_castle:</code></td>
<td>ğŸ° <code>:european_castle:</code></td>
</tr>
<tr>
<td>â›º <code>:tent:</code></td>
<td>ğŸ­ <code>:factory:</code></td>
<td>ğŸ—¼ <code>:tokyo_tower:</code></td>
</tr>
<tr>
<td>ğŸ—¾ <code>:japan:</code></td>
<td>ğŸ—» <code>:mount_fuji:</code></td>
<td>ğŸŒ„ <code>:sunrise_over_mountains:</code></td>
</tr>
<tr>
<td>ğŸŒ… <code>:sunrise:</code></td>
<td>ğŸŒ  <code>:stars:</code></td>
<td>ğŸ—½ <code>:statue_of_liberty:</code></td>
</tr>
<tr>
<td>ğŸŒ‰ <code>:bridge_at_night:</code></td>
<td>ğŸ  <code>:carousel_horse:</code></td>
<td>ğŸŒˆ <code>:rainbow:</code></td>
</tr>
<tr>
<td>ğŸ¡ <code>:ferris_wheel:</code></td>
<td>â›² <code>:fountain:</code></td>
<td>ğŸ¢ <code>:roller_coaster:</code></td>
</tr>
<tr>
<td>ğŸš¢ <code>:ship:</code></td>
<td>ğŸš¤ <code>:speedboat:</code></td>
<td>â›µ <code>:boat:</code></td>
</tr>
<tr>
<td>â›µ <code>:sailboat:</code></td>
<td>ğŸš£ <code>:rowboat:</code></td>
<td>âš“ <code>:anchor:</code></td>
</tr>
<tr>
<td>ğŸš€ <code>:rocket:</code></td>
<td>âœˆï¸ <code>:airplane:</code></td>
<td>ğŸš <code>:helicopter:</code></td>
</tr>
<tr>
<td>ğŸš‚ <code>:steam_locomotive:</code></td>
<td>ğŸšŠ <code>:tram:</code></td>
<td>ğŸš <code>:mountain_railway:</code></td>
</tr>
<tr>
<td>ğŸš² <code>:bike:</code></td>
<td>ğŸš¡ <code>:aerial_tramway:</code></td>
<td>ğŸšŸ <code>:suspension_railway:</code></td>
</tr>
<tr>
<td>ğŸš  <code>:mountain_cableway:</code></td>
<td>ğŸšœ <code>:tractor:</code></td>
<td>ğŸš™ <code>:blue_car:</code></td>
</tr>
<tr>
<td>ğŸš˜ <code>:oncoming_automobile:</code></td>
<td>ğŸš— <code>:car:</code></td>
<td>ğŸš— <code>:red_car:</code></td>
</tr>
<tr>
<td>ğŸš• <code>:taxi:</code></td>
<td>ğŸš– <code>:oncoming_taxi:</code></td>
<td>ğŸš› <code>:articulated_lorry:</code></td>
</tr>
<tr>
<td>ğŸšŒ <code>:bus:</code></td>
<td>ğŸš <code>:oncoming_bus:</code></td>
<td>ğŸš¨ <code>:rotating_light:</code></td>
</tr>
<tr>
<td>ğŸš“ <code>:police_car:</code></td>
<td>ğŸš” <code>:oncoming_police_car:</code></td>
<td>ğŸš’ <code>:fire_engine:</code></td>
</tr>
<tr>
<td>ğŸš‘ <code>:ambulance:</code></td>
<td>ğŸš <code>:minibus:</code></td>
<td>ğŸšš <code>:truck:</code></td>
</tr>
<tr>
<td>ğŸš‹ <code>:train:</code></td>
<td>ğŸš‰ <code>:station:</code></td>
<td>ğŸš† <code>:train2:</code></td>
</tr>
<tr>
<td>ğŸš… <code>:bullettrain_front:</code></td>
<td>ğŸš„ <code>:bullettrain_side:</code></td>
<td>ğŸšˆ <code>:light_rail:</code></td>
</tr>
<tr>
<td>ğŸš <code>:monorail:</code></td>
<td>ğŸšƒ <code>:railway_car:</code></td>
<td>ğŸš <code>:trolleybus:</code></td>
</tr>
<tr>
<td>ğŸ« <code>:ticket:</code></td>
<td>â›½ <code>:fuelpump:</code></td>
<td>ğŸš¦ <code>:vertical_traffic_light:</code></td>
</tr>
<tr>
<td>ğŸš¥ <code>:traffic_light:</code></td>
<td>âš ï¸ <code>:warning:</code></td>
<td>ğŸš§ <code>:construction:</code></td>
</tr>
<tr>
<td>ğŸ”° <code>:beginner:</code></td>
<td>ğŸ§ <code>:atm:</code></td>
<td>ğŸ° <code>:slot_machine:</code></td>
</tr>
<tr>
<td>ğŸš <code>:busstop:</code></td>
<td>ğŸ’ˆ <code>:barber:</code></td>
<td>â™¨ï¸ <code>:hotsprings:</code></td>
</tr>
<tr>
<td>ğŸ <code>:checkered_flag:</code></td>
<td>ğŸŒ <code>:crossed_flags:</code></td>
<td>ğŸ® <code>:izakaya_lantern:</code></td>
</tr>
<tr>
<td>ğŸ—¿ <code>:moyai:</code></td>
<td>ğŸª <code>:circus_tent:</code></td>
<td>ğŸ­ <code>:performing_arts:</code></td>
</tr>
<tr>
<td>ğŸ“ <code>:round_pushpin:</code></td>
<td>ğŸš© <code>:triangular_flag_on_post:</code></td>
<td>ğŸ‡¯ğŸ‡µ <code>:jp:</code></td>
</tr>
<tr>
<td>ğŸ‡°ğŸ‡· <code>:kr:</code></td>
<td>ğŸ‡¨ğŸ‡³ <code>:cn:</code></td>
<td>ğŸ‡ºğŸ‡¸ <code>:us:</code></td>
</tr>
<tr>
<td>ğŸ‡«ğŸ‡· <code>:fr:</code></td>
<td>ğŸ‡ªğŸ‡¸ <code>:es:</code></td>
<td>ğŸ‡®ğŸ‡¹ <code>:it:</code></td>
</tr>
<tr>
<td>ğŸ‡·ğŸ‡º <code>:ru:</code></td>
<td>ğŸ‡¬ğŸ‡§ <code>:gb:</code></td>
<td>ğŸ‡¬ğŸ‡§ <code>:uk:</code></td>
</tr>
<tr>
<td>ğŸ‡©ğŸ‡ª <code>:de:</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="Symbols">Symbols</h2>
<table>
<thead>
<tr>
<th>1ï¸âƒ£ <code>:one:</code></th>
<th>2ï¸âƒ£ <code>:two:</code></th>
<th>3ï¸âƒ£ <code>:three:</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>4ï¸âƒ£ <code>:four:</code></td>
<td>5ï¸âƒ£ <code>:five:</code></td>
<td>6ï¸âƒ£ <code>:six:</code></td>
</tr>
<tr>
<td>7ï¸âƒ£ <code>:seven:</code></td>
<td>8ï¸âƒ£ <code>:eight:</code></td>
<td>9ï¸âƒ£ <code>:nine:</code></td>
</tr>
<tr>
<td>ğŸ”Ÿ <code>:keycap_ten:</code></td>
<td>ğŸ”¢ <code>:1234:</code></td>
<td>0ï¸âƒ£ <code>:zero:</code></td>
</tr>
<tr>
<td>#ï¸âƒ£ <code>:hash:</code></td>
<td>ğŸ”£ <code>:symbols:</code></td>
<td>â—€ï¸ <code>:arrow_backward:</code></td>
</tr>
<tr>
<td>â¬‡ï¸ <code>:arrow_down:</code></td>
<td>â–¶ï¸ <code>:arrow_forward:</code></td>
<td>â¬…ï¸ <code>:arrow_left:</code></td>
</tr>
<tr>
<td>ğŸ”  <code>:capital_abcd:</code></td>
<td>ğŸ”¡ <code>:abcd:</code></td>
<td>ğŸ”¤ <code>:abc:</code></td>
</tr>
<tr>
<td>â†™ï¸ <code>:arrow_lower_left:</code></td>
<td>â†˜ï¸ <code>:arrow_lower_right:</code></td>
<td>â¡ï¸ <code>:arrow_right:</code></td>
</tr>
<tr>
<td>â¬†ï¸ <code>:arrow_up:</code></td>
<td>â†–ï¸ <code>:arrow_upper_left:</code></td>
<td>â†—ï¸ <code>:arrow_upper_right:</code></td>
</tr>
<tr>
<td>â¬ <code>:arrow_double_down:</code></td>
<td>â« <code>:arrow_double_up:</code></td>
<td>ğŸ”½ <code>:arrow_down_small:</code></td>
</tr>
<tr>
<td>â¤µï¸ <code>:arrow_heading_down:</code></td>
<td>â¤´ï¸ <code>:arrow_heading_up:</code></td>
<td>â†©ï¸ <code>:leftwards_arrow_with_hook:</code></td>
</tr>
<tr>
<td>â†ªï¸ <code>:arrow_right_hook:</code></td>
<td>â†”ï¸ <code>:left_right_arrow:</code></td>
<td>â†•ï¸ <code>:arrow_up_down:</code></td>
</tr>
<tr>
<td>ğŸ”¼ <code>:arrow_up_small:</code></td>
<td>ğŸ”ƒ <code>:arrows_clockwise:</code></td>
<td>ğŸ”„ <code>:arrows_counterclockwise:</code></td>
</tr>
<tr>
<td>âª <code>:rewind:</code></td>
<td>â© <code>:fast_forward:</code></td>
<td>â„¹ï¸ <code>:information_source:</code></td>
</tr>
<tr>
<td>ğŸ†— <code>:ok:</code></td>
<td>ğŸ”€ <code>:twisted_rightwards_arrows:</code></td>
<td>ğŸ” <code>:repeat:</code></td>
</tr>
<tr>
<td>ğŸ”‚ <code>:repeat_one:</code></td>
<td>ğŸ†• <code>:new:</code></td>
<td>ğŸ” <code>:top:</code></td>
</tr>
<tr>
<td>ğŸ†™ <code>:up:</code></td>
<td>ğŸ†’ <code>:cool:</code></td>
<td>ğŸ†“ <code>:free:</code></td>
</tr>
<tr>
<td>ğŸ†– <code>:ng:</code></td>
<td>ğŸ¦ <code>:cinema:</code></td>
<td>ğŸˆ <code>:koko:</code></td>
</tr>
<tr>
<td>ğŸ“¶ <code>:signal_strength:</code></td>
<td>:u5272: <code>:u5272:</code></td>
<td>:u5408: <code>:u5408:</code></td>
</tr>
<tr>
<td>:u55b6: <code>:u55b6:</code></td>
<td>:u6307: <code>:u6307:</code></td>
<td>:u6708: <code>:u6708:</code></td>
</tr>
<tr>
<td>:u6709: <code>:u6709:</code></td>
<td>ğŸˆµ <code>:u6e80:</code></td>
<td>:u7121: <code>:u7121:</code></td>
</tr>
<tr>
<td>:u7533: <code>:u7533:</code></td>
<td>:u7a7a: <code>:u7a7a:</code></td>
<td>:u7981: <code>:u7981:</code></td>
</tr>
<tr>
<td>ğŸˆ‚ï¸ <code>:sa:</code></td>
<td>ğŸš» <code>:restroom:</code></td>
<td>ğŸš¹ <code>:mens:</code></td>
</tr>
<tr>
<td>ğŸšº <code>:womens:</code></td>
<td>ğŸš¼ <code>:baby_symbol:</code></td>
<td>ğŸš­ <code>:no_smoking:</code></td>
</tr>
<tr>
<td>ğŸ…¿ï¸ <code>:parking:</code></td>
<td>â™¿ <code>:wheelchair:</code></td>
<td>ğŸš‡ <code>:metro:</code></td>
</tr>
<tr>
<td>ğŸ›„ <code>:baggage_claim:</code></td>
<td>ğŸ‰‘ <code>:accept:</code></td>
<td>ğŸš¾ <code>:wc:</code></td>
</tr>
<tr>
<td>ğŸš° <code>:potable_water:</code></td>
<td>ğŸš® <code>:put_litter_in_its_place:</code></td>
<td>ãŠ™ï¸ <code>:secret:</code></td>
</tr>
<tr>
<td>ãŠ—ï¸ <code>:congratulations:</code></td>
<td>â“‚ï¸ <code>:m:</code></td>
<td>ğŸ›‚ <code>:passport_control:</code></td>
</tr>
<tr>
<td>ğŸ›… <code>:left_luggage:</code></td>
<td>ğŸ›ƒ <code>:customs:</code></td>
<td>ğŸ‰ <code>:ideograph_advantage:</code></td>
</tr>
<tr>
<td>ğŸ†‘ <code>:cl:</code></td>
<td>ğŸ†˜ <code>:sos:</code></td>
<td>ğŸ†” <code>:id:</code></td>
</tr>
<tr>
<td>ğŸš« <code>:no_entry_sign:</code></td>
<td>ğŸ” <code>:underage:</code></td>
<td>ğŸ“µ <code>:no_mobile_phones:</code></td>
</tr>
<tr>
<td>ğŸš¯ <code>:do_not_litter:</code></td>
<td>ğŸš± <code>:non-potable_water:</code></td>
<td>ğŸš³ <code>:no_bicycles:</code></td>
</tr>
<tr>
<td>ğŸš· <code>:no_pedestrians:</code></td>
<td>ğŸš¸ <code>:children_crossing:</code></td>
<td>â›” <code>:no_entry:</code></td>
</tr>
<tr>
<td>âœ³ï¸ <code>:eight_spoked_asterisk:</code></td>
<td>âœ´ï¸ <code>:eight_pointed_black_star:</code></td>
<td>ğŸ’Ÿ <code>:heart_decoration:</code></td>
</tr>
<tr>
<td>ğŸ†š <code>:vs:</code></td>
<td>ğŸ“³ <code>:vibration_mode:</code></td>
<td>ğŸ“´ <code>:mobile_phone_off:</code></td>
</tr>
<tr>
<td>ğŸ’¹ <code>:chart:</code></td>
<td>ğŸ’± <code>:currency_exchange:</code></td>
<td>â™ˆ <code>:aries:</code></td>
</tr>
<tr>
<td>â™‰ <code>:taurus:</code></td>
<td>â™Š <code>:gemini:</code></td>
<td>â™‹ <code>:cancer:</code></td>
</tr>
<tr>
<td>â™Œ <code>:leo:</code></td>
<td>â™ <code>:virgo:</code></td>
<td>â™ <code>:libra:</code></td>
</tr>
<tr>
<td>â™ <code>:scorpius:</code></td>
<td>â™ <code>:sagittarius:</code></td>
<td>â™‘ <code>:capricorn:</code></td>
</tr>
<tr>
<td>â™’ <code>:aquarius:</code></td>
<td>â™“ <code>:pisces:</code></td>
<td>â› <code>:ophiuchus:</code></td>
</tr>
<tr>
<td>ğŸ”¯ <code>:six_pointed_star:</code></td>
<td>â <code>:negative_squared_cross_mark:</code></td>
<td>ğŸ…°ï¸ <code>:a:</code></td>
</tr>
<tr>
<td>ğŸ…±ï¸ <code>:b:</code></td>
<td>ğŸ† <code>:ab:</code></td>
<td>ğŸ…¾ï¸ <code>:o2:</code></td>
</tr>
<tr>
<td>ğŸ’  <code>:diamond_shape_with_a_dot_inside:</code></td>
<td>â™»ï¸ <code>:recycle:</code></td>
<td>ğŸ”š <code>:end:</code></td>
</tr>
<tr>
<td>ğŸ”› <code>:on:</code></td>
<td>ğŸ”œ <code>:soon:</code></td>
<td>ğŸ• <code>:clock1:</code></td>
</tr>
<tr>
<td>ğŸ•œ <code>:clock130:</code></td>
<td>ğŸ•™ <code>:clock10:</code></td>
<td>ğŸ•¥ <code>:clock1030:</code></td>
</tr>
<tr>
<td>ğŸ•š <code>:clock11:</code></td>
<td>ğŸ•¦ <code>:clock1130:</code></td>
<td>ğŸ•› <code>:clock12:</code></td>
</tr>
<tr>
<td>ğŸ•§ <code>:clock1230:</code></td>
<td>ğŸ•‘ <code>:clock2:</code></td>
<td>ğŸ• <code>:clock230:</code></td>
</tr>
<tr>
<td>ğŸ•’ <code>:clock3:</code></td>
<td>ğŸ• <code>:clock330:</code></td>
<td>ğŸ•“ <code>:clock4:</code></td>
</tr>
<tr>
<td>ğŸ•Ÿ <code>:clock430:</code></td>
<td>ğŸ•” <code>:clock5:</code></td>
<td>ğŸ•  <code>:clock530:</code></td>
</tr>
<tr>
<td>ğŸ•• <code>:clock6:</code></td>
<td>ğŸ•¡ <code>:clock630:</code></td>
<td>ğŸ•– <code>:clock7:</code></td>
</tr>
<tr>
<td>ğŸ•¢ <code>:clock730:</code></td>
<td>ğŸ•— <code>:clock8:</code></td>
<td>ğŸ•£ <code>:clock830:</code></td>
</tr>
<tr>
<td>ğŸ•˜ <code>:clock9:</code></td>
<td>ğŸ•¤ <code>:clock930:</code></td>
<td>ğŸ’² <code>:heavy_dollar_sign:</code></td>
</tr>
<tr>
<td>Â©ï¸ <code>:copyright:</code></td>
<td>Â®ï¸ <code>:registered:</code></td>
<td>â„¢ï¸ <code>:tm:</code></td>
</tr>
<tr>
<td>âŒ <code>:x:</code></td>
<td>â— <code>:heavy_exclamation_mark:</code></td>
<td>â€¼ï¸ <code>:bangbang:</code></td>
</tr>
<tr>
<td>â‰ï¸ <code>:interrobang:</code></td>
<td>â­• <code>:o:</code></td>
<td>âœ–ï¸ <code>:heavy_multiplication_x:</code></td>
</tr>
<tr>
<td>â• <code>:heavy_plus_sign:</code></td>
<td>â– <code>:heavy_minus_sign:</code></td>
<td>â— <code>:heavy_division_sign:</code></td>
</tr>
<tr>
<td>ğŸ’® <code>:white_flower:</code></td>
<td>ğŸ’¯ <code>:100:</code></td>
<td>âœ”ï¸ <code>:heavy_check_mark:</code></td>
</tr>
<tr>
<td>â˜‘ï¸ <code>:ballot_box_with_check:</code></td>
<td>ğŸ”˜ <code>:radio_button:</code></td>
<td>ğŸ”— <code>:link:</code></td>
</tr>
<tr>
<td>â° <code>:curly_loop:</code></td>
<td>ã€°ï¸ <code>:wavy_dash:</code></td>
<td>ã€½ï¸ <code>:part_alternation_mark:</code></td>
</tr>
<tr>
<td>ğŸ”± <code>:trident:</code></td>
<td>:black_square: <code>:black_square:</code></td>
<td>:white_square: <code>:white_square:</code></td>
</tr>
<tr>
<td>âœ… <code>:white_check_mark:</code></td>
<td>ğŸ”² <code>:black_square_button:</code></td>
<td>ğŸ”³ <code>:white_square_button:</code></td>
</tr>
<tr>
<td>âš« <code>:black_circle:</code></td>
<td>âšª <code>:white_circle:</code></td>
<td>ğŸ”´ <code>:red_circle:</code></td>
</tr>
<tr>
<td>ğŸ”µ <code>:large_blue_circle:</code></td>
<td>ğŸ”· <code>:large_blue_diamond:</code></td>
<td>ğŸ”¶ <code>:large_orange_diamond:</code></td>
</tr>
<tr>
<td>ğŸ”¹ <code>:small_blue_diamond:</code></td>
<td>ğŸ”¸ <code>:small_orange_diamond:</code></td>
<td>ğŸ”º <code>:small_red_triangle:</code></td>
</tr>
<tr>
<td>ğŸ”» <code>:small_red_triangle_down:</code></td>
<td>:shipit: <code>:shipit:</code></td>
<td></td>
</tr>
</tbody>
</table>
]]></content>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>redis</title>
    <url>/2025/09/15/redis/</url>
    <content><![CDATA[<h1>redis</h1>
<p>å¸¸è§5ç§æ•°æ®ç±»å‹ï¼šstringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œlistï¼ˆåˆ—è¡¨ï¼‰ï¼Œhashï¼ˆå“ˆå¸Œï¼‰ï¼Œsetï¼ˆé›†åˆï¼‰ï¼Œzset(æœ‰åºé›†åˆ)</p>
<h2 id="ç¬¬ä¸€èŠ‚-keyæ“ä½œçš„ç›¸å…³å‘½ä»¤">ç¬¬ä¸€èŠ‚ keyæ“ä½œçš„ç›¸å…³å‘½ä»¤</h2>
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>keys *</td>
<td>æŸ¥çœ‹å½“å‰åº“æ‰€æœ‰key (åŒ¹é…ï¼škeys *1)</td>
</tr>
<tr>
<td>exists key</td>
<td>åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>type key</td>
<td>æŸ¥çœ‹ä½ çš„keyæ˜¯ä»€ä¹ˆç±»å‹</td>
</tr>
<tr>
<td>del key</td>
<td>åˆ é™¤æŒ‡å®šçš„keyæ•°æ®</td>
</tr>
<tr>
<td>unlink key</td>
<td>éé˜»å¡åˆ é™¤,ä»…å°†keysä»keyspaceå…ƒæ•°æ®ä¸­åˆ é™¤ï¼ŒçœŸæ­£çš„åˆ é™¤ä¼šåœ¨åç»­å¼‚æ­¥æ“ä½œ</td>
</tr>
<tr>
<td>expire key 10</td>
<td>10ç§’é’Ÿï¼šä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´</td>
</tr>
<tr>
<td>ttl key</td>
<td>æŸ¥çœ‹è¿˜æœ‰å¤šå°‘ç§’è¿‡æœŸï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸ</td>
</tr>
<tr>
<td>select</td>
<td>å‘½ä»¤åˆ‡æ¢æ•°æ®åº“</td>
</tr>
<tr>
<td>dbsize</td>
<td>æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„keyçš„æ•°é‡</td>
</tr>
<tr>
<td>flushdb</td>
<td>æ¸…ç©ºå½“å‰åº“</td>
</tr>
<tr>
<td>flushall</td>
<td>æ¸…ç©ºå…¨éƒ¨åº“</td>
</tr>
</tbody>
</table>
<h2 id="ç¬¬äºŒèŠ‚-å­—ç¬¦ä¸²ç±»å‹-String">ç¬¬äºŒèŠ‚ å­—ç¬¦ä¸²ç±»å‹(String)</h2>
<h3 id="2-1-ç®€ä»‹">2.1 ç®€ä»‹</h3>
<p>1 Stringæ˜¯Redisæœ€åŸºæœ¬çš„ç±»å‹ï¼Œä½ å¯ä»¥ç†è§£æˆä¸Memcachedä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueã€‚</p>
<p>2 Stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„å‘³ç€Redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚</p>
<p>3 Stringç±»å‹æ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªRedisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥æ˜¯512M</p>
<h3 id="2-2-å¸¸ç”¨å‘½ä»¤">2.2 å¸¸ç”¨å‘½ä»¤</h3>
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>set &lt;key&gt;&lt;value&gt;</td>
<td>æ·»åŠ é”®å€¼å¯¹</td>
</tr>
<tr>
<td></td>
<td>NXï¼šå½“æ•°æ®åº“ä¸­keyä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥å°†key-valueæ·»åŠ æ•°æ®åº“</td>
</tr>
<tr>
<td></td>
<td>XXï¼šå½“æ•°æ®åº“ä¸­keyå­˜åœ¨æ—¶ï¼Œå¯ä»¥å°†key-valueæ·»åŠ æ•°æ®åº“ï¼Œä¸NXå‚æ•°äº’æ–¥</td>
</tr>
<tr>
<td></td>
<td>EXï¼škeyçš„è¶…æ—¶ç§’æ•°</td>
</tr>
<tr>
<td></td>
<td>PXï¼škeyçš„è¶…æ—¶æ¯«ç§’æ•°ï¼Œä¸EXäº’æ–¥</td>
</tr>
<tr>
<td>get &lt;key&gt;</td>
<td>æŸ¥è¯¢å¯¹åº”é”®å€¼</td>
</tr>
<tr>
<td>append &lt;key&gt;&lt;value&gt;</td>
<td>å°†ç»™å®šçš„&lt;value&gt; è¿½åŠ åˆ°åŸå€¼çš„æœ«å°¾</td>
</tr>
<tr>
<td>strlen &lt;key&gt;</td>
<td>è·å¾—å€¼çš„é•¿åº¦</td>
</tr>
<tr>
<td>setnx &lt;key&gt;&lt;value&gt;</td>
<td>åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶ è®¾ç½® key çš„å€¼</td>
</tr>
<tr>
<td>incr &lt;key&gt;</td>
<td>å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢1,åªèƒ½å¯¹æ•°å­—å€¼æ“ä½œï¼Œå¦‚æœä¸ºç©ºï¼Œæ–°å¢å€¼ä¸º1</td>
</tr>
<tr>
<td>decr &lt;key&gt;</td>
<td>å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡1,åªèƒ½å¯¹æ•°å­—å€¼æ“ä½œï¼Œå¦‚æœä¸ºç©ºï¼Œæ–°å¢å€¼ä¸º-1</td>
</tr>
<tr>
<td>incrby / decrby &lt;key&gt;&lt;æ­¥é•¿&gt;</td>
<td>å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢å‡ã€‚è‡ªå®šä¹‰æ­¥é•¿</td>
</tr>
<tr>
<td>mset &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt; â€¦</td>
<td>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-valueå¯¹</td>
</tr>
<tr>
<td>mget &lt;key1&gt;&lt;key2&gt;&lt;key3&gt; â€¦</td>
<td>åŒæ—¶è·å–ä¸€ä¸ªæˆ–å¤šä¸ª value</td>
</tr>
<tr>
<td>msetnx &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt; â€¦</td>
<td>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨ã€‚æœ‰ä¸€ä¸ªå¤±è´¥åˆ™éƒ½å¤±è´¥(åŸå­æ€§)</td>
</tr>
<tr>
<td>getrange &lt;key&gt;&lt;èµ·å§‹ä½ç½®&gt;&lt;ç»“æŸä½ç½®&gt;</td>
<td>è·å¾—å€¼çš„èŒƒå›´ï¼Œç±»ä¼¼javaä¸­çš„substringï¼Œ<strong>å‰åŒ…ï¼ŒååŒ…</strong></td>
</tr>
<tr>
<td>setrange &lt;key&gt;&lt;èµ·å§‹ä½ç½®&gt;&lt;value&gt;</td>
<td>ç”¨ &lt;value&gt; è¦†å†™&lt;key&gt;æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œä»&lt;èµ·å§‹ä½ç½®&gt;å¼€å§‹(<strong>ç´¢å¼•ä»0</strong>å¼€å§‹)ã€‚</td>
</tr>
<tr>
<td>setex &lt;key&gt; &lt;è¿‡æœŸæ—¶é—´&gt; &lt;value&gt;</td>
<td>è®¾ç½®é”®å€¼çš„åŒæ—¶ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ã€‚</td>
</tr>
<tr>
<td>getset &lt;key&gt;&lt;value&gt;</td>
<td>ä»¥æ–°æ¢æ—§ï¼Œè®¾ç½®äº†æ–°å€¼åŒæ—¶è·å¾—æ—§å€¼ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>redisæŒ‡ä»¤è¿è¡Œçš„åŸå­æ€§</p>
</blockquote>
<ul>
<li>æ‰€è°“åŸå­æ“ä½œæ˜¯æŒ‡ä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­çš„æ“ä½œï¼›è¿™ç§æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°ç»“æŸï¼Œä¸­é—´ä¸ä¼šæœ‰ä»»ä½• context switch ï¼ˆåˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼‰ã€‚
<ul>
<li>ï¼ˆ1ï¼‰åœ¨å•çº¿ç¨‹ä¸­ï¼Œ èƒ½å¤Ÿåœ¨å•æ¡æŒ‡ä»¤ä¸­å®Œæˆçš„æ“ä½œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯&quot;åŸå­æ“ä½œ&quot;ï¼Œå› ä¸ºä¸­æ–­åªèƒ½å‘ç”ŸäºæŒ‡ä»¤ä¹‹é—´ã€‚</li>
<li>ï¼ˆ2ï¼‰åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä¸èƒ½è¢«å…¶å®ƒè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰æ‰“æ–­çš„æ“ä½œå°±å«åŸå­æ“ä½œã€‚</li>
<li>ï¼ˆ3ï¼‰Rediså•å‘½ä»¤çš„åŸå­æ€§ä¸»è¦å¾—ç›Šäºçš„å•çº¿ç¨‹ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>é—®é¢˜ JAVAä¸­çš„ a++ æ˜¯å¦å…·æœ‰åŸå­æ€§</p>
</blockquote>
<p><strong>åŸå­æ€§ï¼š<strong>å³ä¸å¯åˆ†å‰²æ€§ã€‚æ¯”å¦‚ a=0ï¼›ï¼ˆaélongå’Œdoubleç±»å‹ï¼‰ è¿™ä¸ªæ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´è¿™ä¸ªæ“ä½œæ˜¯åŸå­æ“ä½œã€‚å†æ¯”å¦‚ï¼ša++ï¼› è¿™ä¸ªæ“ä½œå®é™…æ˜¯a = a + 1ï¼›æ˜¯å¯åˆ†å‰²çš„ï¼Œæ‰€ä»¥ä»–ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚éåŸå­æ“ä½œéƒ½ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œéœ€è¦</strong>ä½¿ç”¨åŒæ­¥æŠ€æœ¯ï¼ˆsychronizedï¼‰æˆ–è€…é”ï¼ˆLockï¼‰æ¥è®©å®ƒå˜æˆä¸€ä¸ªåŸå­æ“ä½œ</strong>ã€‚ä¸€ä¸ªæ“ä½œæ˜¯åŸå­æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°å®ƒå…·æœ‰åŸå­æ€§ã€‚</p>
<h3 id="2-3-æ•°æ®ç»“æ„">2.3 æ•°æ®ç»“æ„</h3>
<p>Stringçš„æ•°æ®ç»“æ„ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²(Simple Dynamic String,ç¼©å†™SDS)ã€‚æ˜¯å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Šç±»ä¼¼äºJavaçš„ArrayListï¼Œé‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é….</p>
<p><img src="http://120.26.79.238:9000/blog/img/58b2bd2f781e5df2d1a4ebcd523c07c0.png" alt=""></p>
<p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå†…éƒ¨ä¸ºå½“å‰å­—ç¬¦ä¸²å®é™…åˆ†é…çš„ç©ºé—´capacityä¸€èˆ¬è¦é«˜äºå®é™…å­—ç¬¦ä¸²é•¿åº¦lenã€‚å½“å­—ç¬¦ä¸²é•¿åº¦å°äº1Mæ—¶ï¼Œæ‰©å®¹éƒ½æ˜¯åŠ å€ç°æœ‰çš„ç©ºé—´ï¼Œå¦‚æœè¶…è¿‡1Mï¼Œæ‰©å®¹æ—¶ä¸€æ¬¡åªä¼šå¤šæ‰©1Mçš„ç©ºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ä¸º512Mã€‚</p>
<h2 id="ç¬¬ä¸‰èŠ‚-Redis-åˆ—è¡¨-List">ç¬¬ä¸‰èŠ‚ Redis åˆ—è¡¨(List)</h2>
<h3 id="3-1-ç®€ä»‹">3.1 ç®€ä»‹</h3>
<p>å•é”®å¤šå€¼, ä¸€ä¸ªé”®ä¸‹çš„valueæ˜¯ä¸€ä¸ªList.Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚å®ƒçš„åº•å±‚å®é™…æ˜¯ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯¹ä¸¤ç«¯çš„æ“ä½œæ€§èƒ½å¾ˆé«˜ï¼Œé€šè¿‡ç´¢å¼•ä¸‹æ ‡çš„æ“ä½œä¸­é—´çš„èŠ‚ç‚¹æ€§èƒ½ä¼šè¾ƒå·®ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/012ad0bda3eaf308eb159c0558155651.png" alt=""></p>
<h3 id="3-2-å¸¸ç”¨å‘½ä»¤">3.2 å¸¸ç”¨å‘½ä»¤</h3>
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>lpush/rpush &lt;key&gt;&lt;value1&gt;&lt;value2&gt;&lt;value3&gt; â€¦</td>
<td>ä»å·¦è¾¹/å³è¾¹æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</td>
</tr>
<tr>
<td>lpop/rpop &lt;key&gt;</td>
<td>ä»å·¦è¾¹/å³è¾¹åå‡ºä¸€ä¸ªå€¼ã€‚å€¼åœ¨é”®åœ¨ï¼Œå€¼å…‰é”®äº¡ã€‚</td>
</tr>
<tr>
<td>rpoplpush &lt;key1&gt;&lt;key2&gt;</td>
<td>ä»&lt;key1&gt;åˆ—è¡¨å³è¾¹åå‡ºä¸€ä¸ªå€¼ï¼Œæ’åˆ°&lt;key2&gt;åˆ—è¡¨å·¦è¾¹</td>
</tr>
<tr>
<td>lrange &lt;key&gt;&lt;start&gt;&lt;stop&gt;</td>
<td>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³)</td>
</tr>
<tr>
<td></td>
<td>0å·¦è¾¹ç¬¬ä¸€ä¸ªï¼Œ-1å³è¾¹ç¬¬ä¸€ä¸ªï¼Œï¼ˆ0-1è¡¨ç¤ºè·å–æ‰€æœ‰ï¼‰</td>
</tr>
<tr>
<td>lindex &lt;key&gt;&lt;index&gt;</td>
<td>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³)</td>
</tr>
<tr>
<td>llen &lt;key&gt;</td>
<td>è·å¾—åˆ—è¡¨é•¿åº¦</td>
</tr>
<tr>
<td>linsert &lt;key&gt; before &lt;value&gt;&lt;newvalue&gt;</td>
<td>åœ¨&lt;value&gt;çš„å‰é¢æ’å…¥&lt;newvalue&gt;æ’å…¥å€¼</td>
</tr>
<tr>
<td>linsert &lt;key&gt; after &lt;value&gt;&lt;newvalue&gt;</td>
<td>åœ¨&lt;value&gt;çš„åé¢æ’å…¥&lt;newvalue&gt;æ’å…¥å€¼</td>
</tr>
<tr>
<td>lrem &lt;key&gt;&lt;n&gt;&lt;value&gt;</td>
<td>ä»å·¦è¾¹åˆ é™¤nä¸ªvalue(ä»å·¦åˆ°å³)</td>
</tr>
<tr>
<td>lset&lt;key&gt;&lt;index&gt;&lt;value&gt;</td>
<td>å°†åˆ—è¡¨keyä¸‹æ ‡ä¸ºindexçš„å€¼æ›¿æ¢æˆvalue</td>
</tr>
</tbody>
</table>
<h3 id="3-3-æ•°æ®ç»“æ„">3.3 æ•°æ®ç»“æ„</h3>
<p>Listçš„æ•°æ®ç»“æ„ä¸ºå¿«é€Ÿé“¾è¡¨quickListã€‚é¦–å…ˆåœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„æ˜¯ziplistï¼Œä¹Ÿå³æ˜¯å‹ç¼©åˆ—è¡¨ã€‚å®ƒå°†æ‰€æœ‰çš„å…ƒç´ ç´§æŒ¨ç€ä¸€èµ·å­˜å‚¨ï¼Œåˆ†é…çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ã€‚å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™æ‰ä¼šæ”¹æˆquicklistã€‚å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ã€‚æ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„åªæ˜¯intç±»å‹çš„æ•°æ®ï¼Œç»“æ„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆprevå’Œnextã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/ecae126ab4f2ea87b36f29d897d3eafe.png" alt=""></p>
<p>Rediså°†é“¾è¡¨å’Œziplistç»“åˆèµ·æ¥ç»„æˆäº†quicklistã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ªziplistä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚</p>
<h2 id="ç¬¬å››èŠ‚Redis-é›†åˆ-Set">ç¬¬å››èŠ‚Redis é›†åˆ(Set)</h2>
<h3 id="4-1-ç®€ä»‹">4.1 ç®€ä»‹</h3>
<p>    Redis setå¯¹å¤–æä¾›çš„åŠŸèƒ½ä¸listç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äºsetæ˜¯å¯ä»¥<strong>è‡ªåŠ¨æ’é‡</strong>çš„ï¼Œå½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œsetæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸”setæä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ªseté›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯listæ‰€ä¸èƒ½æä¾›çš„ã€‚</p>
<p>    Redisçš„Setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚å®ƒåº•å±‚å…¶å®æ˜¯ä¸€ä¸ªvalueä¸ºnullçš„hashè¡¨ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„<strong>å¤æ‚åº¦éƒ½æ˜¯O(1)</strong>ã€‚ä¸€ä¸ªç®—æ³•ï¼Œéšç€æ•°æ®çš„å¢åŠ ï¼Œæ‰§è¡Œæ—¶é—´çš„é•¿çŸ­ï¼Œå¦‚æœæ˜¯O(1)ï¼Œæ•°æ®å¢åŠ ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ—¶é—´ä¸å˜   </p>
<h3 id="4-2-å¸¸ç”¨å‘½ä»¤">4.2 å¸¸ç”¨å‘½ä»¤</h3>
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>sadd &lt;key&gt;&lt;value1&gt;&lt;value2&gt; â€¦</td>
<td>å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠ å…¥åˆ°é›†åˆ key ä¸­ï¼Œå·²ç»å­˜åœ¨çš„ member å…ƒç´ å°†è¢«å¿½ç•¥</td>
</tr>
<tr>
<td>smembers &lt;key&gt;</td>
<td>å–å‡ºè¯¥é›†åˆçš„æ‰€æœ‰å€¼ã€‚</td>
</tr>
<tr>
<td>sismember &lt;key&gt;&lt;value&gt;</td>
<td>åˆ¤æ–­é›†åˆ&lt;key&gt;æ˜¯å¦ä¸ºå«æœ‰è¯¥&lt;value&gt;å€¼ï¼Œæœ‰1ï¼Œæ²¡æœ‰0</td>
</tr>
<tr>
<td>scard&lt;key&gt;</td>
<td>è¿”å›è¯¥é›†åˆçš„å…ƒç´ ä¸ªæ•°ã€‚</td>
</tr>
<tr>
<td>srem &lt;key&gt;&lt;value1&gt;&lt;value2&gt; â€¦</td>
<td>åˆ é™¤é›†åˆä¸­çš„æŸä¸ªå…ƒç´ ã€‚</td>
</tr>
<tr>
<td>spop &lt;key&gt;</td>
<td>éšæœºä»è¯¥é›†åˆä¸­åå‡ºä¸€ä¸ªå€¼</td>
</tr>
<tr>
<td>spop &lt;key&gt;&lt;N&gt;</td>
<td>éšæœºä»è¯¥é›†åˆä¸­åå‡ºNä¸ªå€¼ã€‚</td>
</tr>
<tr>
<td>srandmember &lt;key&gt;&lt;n&gt;</td>
<td>éšæœºä»è¯¥é›†åˆä¸­å–å‡ºnä¸ªå€¼ã€‚ä¸ä¼šä»é›†åˆä¸­åˆ é™¤ ã€‚</td>
</tr>
<tr>
<td>smove &lt;source&gt;&lt;destination&gt;&lt;value&gt;</td>
<td>æŠŠé›†åˆä¸­ä¸€ä¸ªå€¼ä»ä¸€ä¸ªé›†åˆç§»åŠ¨åˆ°å¦ä¸€ä¸ªé›†åˆ</td>
</tr>
<tr>
<td>sinter &lt;key1&gt;&lt;key2&gt;</td>
<td>è¿”å›ä¸¤ä¸ªé›†åˆçš„äº¤é›†å…ƒç´ ã€‚</td>
</tr>
<tr>
<td>sunion &lt;key1&gt;&lt;key2&gt;</td>
<td>è¿”å›ä¸¤ä¸ªé›†åˆçš„å¹¶é›†å…ƒç´ ã€‚</td>
</tr>
<tr>
<td>sdiff &lt;key1&gt;&lt;key2&gt;</td>
<td>è¿”å›ä¸¤ä¸ªé›†åˆçš„<strong>å·®é›†</strong>å…ƒç´ (key1ä¸­çš„ï¼Œä¸åŒ…å«key2ä¸­çš„)</td>
</tr>
</tbody>
</table>
<h3 id="4-2-æ•°æ®ç»“æ„">4.2 æ•°æ®ç»“æ„</h3>
<p>Setæ•°æ®ç»“æ„æ˜¯dictå­—å…¸ï¼Œå­—å…¸æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„ã€‚Javaä¸­HashSetçš„å†…éƒ¨å®ç°ä½¿ç”¨çš„æ˜¯HashMapï¼Œåªä¸è¿‡æ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚Redisçš„setç»“æ„ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒå†…éƒ¨ä¹Ÿä½¿ç”¨hashç»“æ„ï¼Œæ‰€æœ‰valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ã€‚</p>
<h2 id="ç¬¬äº”èŠ‚-Redis-å“ˆå¸Œ-Hash">ç¬¬äº”èŠ‚ Redis å“ˆå¸Œ(Hash)</h2>
<h3 id="5-1-ç®€ä»‹">5.1 ç®€ä»‹</h3>
<p>Redis hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚ç±»ä¼¼Javaé‡Œé¢çš„Map&lt;String,Object&gt;ç”¨æˆ·IDä¸ºæŸ¥æ‰¾çš„keyï¼Œå­˜å‚¨çš„valueç”¨æˆ·å¯¹è±¡åŒ…å«å§“åï¼Œå¹´é¾„ï¼Œç”Ÿæ—¥ç­‰ä¿¡æ¯</p>
<ul>
<li>æ–¹å¼1  å•key+åºåˆ—åŒ– .é—®é¢˜:æ¯æ¬¡ä¿®æ”¹ç”¨æˆ·çš„æŸä¸ªå±æ€§éœ€è¦ï¼Œå…ˆååºåˆ—åŒ–æ”¹å¥½åå†åºåˆ—åŒ–å›å»ã€‚å¼€é”€è¾ƒå¤§ã€‚</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/05649361cc760c58cd08be72043e2edf.png" alt=""></p>
<ul>
<li>æ–¹å¼2 å¤škey-value .é—®é¢˜:ç”¨æˆ·IDæ•°æ®å†—ä½™  </li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/b98a8372e6efaa97a316b2b6bd8c3533.png" alt=""></p>
<ul>
<li>æ–¹å¼3 å•key + å¤š(field+value)</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/82564120c9e0fbd3d0f82d24b55477d7.png" alt=""></p>
<ul>
<li><strong>é€šè¿‡ key(ç”¨æˆ·ID) + field(å±æ€§æ ‡ç­¾) å°±å¯ä»¥æ“ä½œå¯¹åº”å±æ€§æ•°æ®äº†ï¼Œæ—¢ä¸éœ€è¦é‡å¤å­˜å‚¨æ•°æ®ï¼Œä¹Ÿä¸ä¼šå¸¦æ¥åºåˆ—åŒ–å’Œå¹¶å‘ä¿®æ”¹æ§åˆ¶çš„é—®é¢˜</strong> </li>
</ul>
<h3 id="5-2-å¸¸ç”¨å‘½ä»¤">5.2 å¸¸ç”¨å‘½ä»¤</h3>
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>hset &lt;key&gt;&lt;field&gt;&lt;value&gt;</td>
<td>ç»™&lt;key&gt;é›†åˆä¸­çš„ &lt;field&gt;é”®èµ‹å€¼&lt;value&gt;</td>
</tr>
<tr>
<td>hget &lt;key1&gt;&lt;field&gt;</td>
<td>ä»&lt;key1&gt;é›†åˆ&lt;field&gt;å–å‡º value</td>
</tr>
<tr>
<td>hmset &lt;key1&gt;&lt;field1&gt;&lt;value1&gt;&lt;field2&gt;&lt;value2&gt;â€¦</td>
<td>æ‰¹é‡è®¾ç½®hashçš„å€¼</td>
</tr>
<tr>
<td>hexists&lt;key1&gt;&lt;field&gt;</td>
<td>æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼Œç»™å®šåŸŸ field æ˜¯å¦å­˜åœ¨ã€‚</td>
</tr>
<tr>
<td>hkeys &lt;key&gt;</td>
<td>åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰field</td>
</tr>
<tr>
<td>hvals &lt;key&gt;</td>
<td>åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰value</td>
</tr>
<tr>
<td>hincrby &lt;key&gt;&lt;field&gt;&lt;increment&gt;</td>
<td>ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼åŠ ä¸Šå¢é‡ 1 -1</td>
</tr>
<tr>
<td>hsetnx &lt;key&gt;&lt;field&gt;&lt;value&gt;</td>
<td>å°†å“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼è®¾ç½®ä¸º value ï¼Œå½“ä¸”ä»…å½“åŸŸ field ä¸å­˜åœ¨ .</td>
</tr>
</tbody>
</table>
<h3 id="5-3-æ•°æ®ç»“æ„">5.3 æ•°æ®ç»“æ„</h3>
<p>Hashç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ä¸¤ç§ï¼šziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ï¼Œhashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰ã€‚å½“field-valueé•¿åº¦è¾ƒçŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨hashtableã€‚</p>
<h2 id="ç¬¬å…­èŠ‚-Redis-æœ‰åºé›†åˆZset">ç¬¬å…­èŠ‚ Redis æœ‰åºé›†åˆZset</h2>
<h3 id="6-1-ç®€ä»‹">6.1 ç®€ä»‹</h3>
<p>Redisæœ‰åºé›†åˆzsetä¸æ™®é€šé›†åˆsetéå¸¸ç›¸ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„å­—ç¬¦ä¸²é›†åˆã€‚ä¸åŒä¹‹å¤„æ˜¯æœ‰åºé›†åˆçš„æ¯ä¸ªæˆå‘˜éƒ½å…³è”äº†ä¸€ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰,è¿™ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰è¢«ç”¨æ¥æŒ‰ç…§ä»æœ€ä½åˆ†åˆ°æœ€é«˜åˆ†çš„æ–¹å¼æ’åºé›†åˆä¸­çš„æˆå‘˜ã€‚é›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯è¯„åˆ†å¯ä»¥æ˜¯é‡å¤äº† ã€‚å› ä¸ºå…ƒç´ æ˜¯æœ‰åºçš„, æ‰€ä»¥ä½ ä¹Ÿå¯ä»¥å¾ˆå¿«çš„æ ¹æ®è¯„åˆ†ï¼ˆscoreï¼‰æˆ–è€…æ¬¡åºï¼ˆpositionï¼‰æ¥è·å–ä¸€ä¸ªèŒƒå›´çš„å…ƒç´ ã€‚è®¿é—®æœ‰åºé›†åˆçš„ä¸­é—´å…ƒç´ ä¹Ÿæ˜¯éå¸¸å¿«çš„,å› æ­¤ä½ èƒ½å¤Ÿä½¿ç”¨æœ‰åºé›†åˆä½œä¸ºä¸€ä¸ªæ²¡æœ‰é‡å¤æˆå‘˜çš„æ™ºèƒ½åˆ—è¡¨ã€‚</p>
<h3 id="6-2-å¸¸ç”¨å‘½ä»¤">6.2 å¸¸ç”¨å‘½ä»¤</h3>
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>zadd &lt;key&gt;&lt;score1&gt;&lt;value1&gt;&lt;score2&gt;&lt;value2&gt;â€¦</td>
<td>å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠå…¶ score å€¼åŠ å…¥åˆ°æœ‰åºé›† key å½“ä¸­ã€‚</td>
</tr>
<tr>
<td>zrange&lt;key&gt;&lt;start&gt;&lt;stop&gt;  [WITHSCORES]</td>
<td>å‡åºè¿”å›æœ‰åºé›† key ä¸­ï¼Œä¸‹æ ‡åœ¨&lt;start&gt;&lt;stop&gt;ä¹‹é—´çš„å…ƒç´ ,0ä»£è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ ç´¢å¼•,-1ä»£è¡¨æœ€åä¸€ä¸ªå…ƒç´ ç´¢å¼•.å¸¦WITHSCORESï¼Œå¯ä»¥è®©åˆ†æ•°ä¸€èµ·å’Œå€¼è¿”å›åˆ°ç»“æœé›†ã€‚</td>
</tr>
<tr>
<td>zrevrange &lt;key&gt;&lt;start&gt;&lt;stop&gt; [WITHSCORES]</td>
<td>é™åºè¿”å›æœ‰åºé›† key ä¸­ï¼Œä¸‹æ ‡åœ¨&lt;start&gt;&lt;stop&gt;ä¹‹é—´çš„å…ƒç´ ,0ä»£è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ ç´¢å¼•,-1ä»£è¡¨æœ€åä¸€ä¸ªå…ƒç´ ç´¢å¼•.å¸¦WITHSCORESï¼Œå¯ä»¥è®©åˆ†æ•°ä¸€èµ·å’Œå€¼è¿”å›åˆ°ç»“æœé›†</td>
</tr>
<tr>
<td>zrangebyscore &lt;key&gt; &lt;min&gt; &lt;max&gt; [withscores] [limit offset count]</td>
<td>è¿”å›æœ‰åºé›† key ä¸­ï¼Œæ‰€æœ‰ score å€¼ä»‹äº min å’Œ max ä¹‹é—´(åŒ…æ‹¬ç­‰äº min æˆ– max )çš„æˆå‘˜ã€‚æœ‰åºé›†æˆå‘˜æŒ‰ score å€¼é€’å¢(ä»å°åˆ°å¤§)æ¬¡åºæ’åˆ—ã€‚</td>
</tr>
<tr>
<td>zrevrangebyscore &lt;key&gt; &lt;max&gt; &lt;min&gt; [withscores] [limit offset count]</td>
<td>åŒä¸Šï¼Œæ”¹ä¸ºä»å¤§åˆ°å°æ’åˆ—ã€‚</td>
</tr>
<tr>
<td>zincrby &lt;key&gt;&lt;increment&gt;&lt;value&gt;</td>
<td>ä¸ºå…ƒç´ çš„scoreåŠ ä¸Šå¢é‡</td>
</tr>
<tr>
<td>zrem &lt;key&gt;&lt;value&gt;</td>
<td>åˆ é™¤è¯¥é›†åˆä¸‹ï¼ŒæŒ‡å®šå€¼çš„å…ƒç´ </td>
</tr>
<tr>
<td>zcount &lt;key&gt;&lt;min&gt;&lt;max&gt;</td>
<td>ç»Ÿè®¡è¯¥é›†åˆï¼Œåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•°</td>
</tr>
<tr>
<td>zrank &lt;key&gt;&lt;value&gt;</td>
<td>è¿”å›è¯¥å€¼åœ¨é›†åˆä¸­çš„æ’åï¼Œä»0å¼€å§‹ã€‚</td>
</tr>
</tbody>
</table>
<p>æ¡ˆä¾‹ï¼šå¦‚ä½•åˆ©ç”¨zsetå®ç°ä¸€ä¸ªæ–‡ç« è®¿é—®é‡çš„æ’è¡Œæ¦œï¼Ÿ</p>
<p><img src="http://120.26.79.238:9000/blog/img/20b976b3b5e3a46b83aa5e498f25a15a.png" alt=""></p>
<h3 id="6-3-æ•°æ®ç»“æ„">6.3 æ•°æ®ç»“æ„</h3>
<p>SortedSet(zset)æ˜¯Redisæä¾›çš„ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„æ•°æ®ç»“æ„ï¼Œä¸€æ–¹é¢å®ƒç­‰ä»·äºJavaçš„æ•°æ®ç»“æ„Map&lt;String, Double&gt;ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå…ƒç´ valueèµ‹äºˆä¸€ä¸ªæƒé‡scoreï¼Œå¦ä¸€æ–¹é¢å®ƒåˆç±»ä¼¼äºTreeSetï¼Œå†…éƒ¨çš„å…ƒç´ ä¼šæŒ‰ç…§æƒé‡scoreè¿›è¡Œæ’åºï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå…ƒç´ çš„åæ¬¡ï¼Œè¿˜å¯ä»¥é€šè¿‡scoreçš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚</p>
<h2 id="é¢è¯•é¢˜ï¼š">é¢è¯•é¢˜ï¼š</h2>
<ol>
<li>
<p>rediså¯¹å®¢æˆ·ç«¯å‘èµ·çš„å‘½ä»¤æ˜¯å•çº¿ç¨‹</p>
<ol>
<li>å†…éƒ¨æœ‰ä¸¤å¤§ä½“ç°ï¼š
<ol>
<li>ç½‘ç»œä¼ è¾“</li>
<li>æ‰§è¡Œåˆ°å‘½ä»¤</li>
</ol>
</li>
</ol>
</li>
<li>
<p>rediså¤šçº¿ç¨‹çš„ä½“ç°ï¼šå¼‚æ­¥åˆ é™¤ã€é›†ç¾¤çš„æ•°æ®åŒæ­¥ã€AOFå’ŒRDBæŒä¹…åŒ–æ–¹å¼</p>
</li>
<li>
<p>redisçš„åº•å±‚æ•°æ®ç»“æ„ï¼š</p>
<p>sdsæ•°æ®ç»“æ„:{</p>
<p>lenï¼Œ</p>
<p>alloc</p>
<p>flag</p>
<p>char</p>
<p>}</p>
<ol>
<li>ä¸ºä»€ä¹ˆä¸ç”¨cè¯­è¨€è‡ªå·±çš„chraæ•°ç»„
<ol>
<li>å› ä¸ºcè¯­è¨€çš„charæ•°ç»„ä»¥/0æ¥åˆ¤æ–­æ˜¯å¦ç»“æŸï¼Œä¼šå¯¼è‡´ä¸èƒ½å­˜å‚¨ä»»æ„çš„å­—ç¬¦ä¸²ã€‚</li>
<li>åœ¨è¿½åŠ å’Œè®¡ç®—é•¿åº¦æ—¶ï¼Œcè¯­è¨€åº•å±‚æ˜¯å˜é‡ç›®æ ‡charæ•°ç»„æ¥å®ç°çš„ï¼Œæ•ˆç‡ä½</li>
</ol>
</li>
<li>sdsæ•°æ®ç»“æ„çš„ä¼˜åŠ¿
<ol>
<li>å¯å˜çš„å¤§å°ï¼Œsdså¯ä»¥æ ¹æ®å­˜å‚¨æ•°æ®çš„å¤§å°ï¼Œç»™æ•°æ®ç»“æ„åˆ†é…åˆé€‚çš„å¤§å°ï¼Œä»¥èŠ‚çœç©ºé—´</li>
<li>é‡‡ç”¨ç´§å¯†å­˜å‚¨ç»“æ„ï¼Œcè¯­è¨€åœ¨æ•°æ®ä¸è¶³8å­—èŠ‚æ—¶ï¼Œä¼šç›´æ¥åˆ†é…8å­—èŠ‚ç©ºé—´ï¼Œå¯¼è‡´ç©ºé—´æµªè´¹ï¼Œè€Œsdsé‡‡ç”¨ç¼–è¯‘ä¼˜åŒ–ï¼Œå å¤šå°‘ç©ºé—´å°±åˆ†é…å¤šå°‘ï¼ŒèŠ‚çœç©ºé—´</li>
<li>sdsæ•°æ®ç»“æ„åœ¨è®¡ç®—é•¿åº¦å’Œè¿½åŠ å­—ç¬¦ä¸²æ—¶ï¼Œä¸ç”¨éå†ç›®æ ‡charæ•°ç»„ï¼Œè€Œæ˜¯ç›´æ¥æ ¹æ®ç›®æ ‡æ•°ç»„çš„é•¿åº¦ç›´æ¥åœ¨åé¢è¿½åŠ ï¼Œæ•ˆç‡é«˜</li>
</ol>
</li>
</ol>
</li>
<li>
<p>redisäº”ç§æ•°æ®ç»“æ„çš„ä½¿ç”¨åœºæ™¯</p>
<ol>
<li><strong>å­—ç¬¦ä¸² (Strings)</strong>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šå­—ç¬¦ä¸²æ˜¯ Redis æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå®ƒå¯ä»¥å­˜å‚¨äºŒè¿›åˆ¶å®‰å…¨çš„å­—ç¬¦ä¸²ï¼Œæœ€å¤§é•¿åº¦ä¸º 512MBã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ï¼š
<ul>
<li>å­˜å‚¨ç®€å•çš„é”®å€¼å¯¹æ•°æ®ï¼Œä¾‹å¦‚ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€ç½‘ç«™è®¡æ•°å™¨ç­‰ã€‚</li>
<li>ä½œä¸ºç¼“å­˜ï¼Œå­˜å‚¨ç»å¸¸æŸ¥è¯¢ä½†ä¸ç»å¸¸å˜åŒ–çš„æ•°æ®ï¼Œå¦‚å•†å“è¯¦æƒ…é¡µçš„ç¼“å­˜ã€‚</li>
<li>å­˜å‚¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œé…åˆ Redis çš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>åˆ—è¡¨ (Lists)</strong>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šåˆ—è¡¨æ˜¯æŒ‰ç…§æ’å…¥é¡ºåºæ’åˆ—çš„å­—ç¬¦ä¸²é›†åˆï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ï¼š
<ul>
<li>å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚ä»»åŠ¡é˜Ÿåˆ—ã€å¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚</li>
<li>å­˜å‚¨å†å²è®°å½•ï¼Œå¦‚ç”¨æˆ·çš„æµè§ˆå†å²ã€èŠå¤©è®°å½•ç­‰ã€‚</li>
<li>åˆ†å¸ƒå¼é”å®ç°ï¼Œåˆ©ç”¨åˆ—è¡¨çš„åŸå­æ“ä½œæ¥å®ç°é”çš„è·å–å’Œé‡Šæ”¾ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>é›†åˆ (Sets)</strong>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šé›†åˆæ˜¯å­˜å‚¨å”¯ä¸€å­—ç¬¦ä¸²å…ƒç´ çš„æ— åºé›†åˆã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ï¼š
<ul>
<li>å­˜å‚¨ä¸é‡å¤çš„å…ƒç´ é›†åˆï¼Œå¦‚ç”¨æˆ·å¥½å‹åˆ—è¡¨ã€é»‘åå•ç­‰ã€‚</li>
<li>è¿›è¡Œäº¤é›†ã€å¹¶é›†å’Œå·®é›†è¿ç®—ï¼Œæ¯”å¦‚ç»Ÿè®¡å…±åŒå…´è¶£çš„ç”¨æˆ·ã€ä¸åŒå¹¿å‘Šæ¸ é“çš„ç”¨æˆ·é‡å æƒ…å†µç­‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>æœ‰åºé›†åˆ (Sorted Sets)</strong>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šæœ‰åºé›†åˆä¸é›†åˆç±»ä¼¼ï¼Œä½†æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªåˆ†æ•°ï¼Œç”¨äºæ’åºã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ï¼š
<ul>
<li>æ’è¡Œæ¦œï¼Œå¦‚æ¸¸æˆæ’è¡Œæ¦œã€çƒ­é—¨æ–°é—»æ’è¡Œç­‰ã€‚</li>
<li>æ—¶é—´çº¿ï¼ŒæŒ‰å‘å¸ƒæ—¶é—´æ’åºçš„æ¶ˆæ¯æµã€‚</li>
<li>ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå¦‚ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿä¸­çš„ä»»åŠ¡ä¼˜å…ˆçº§ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>å“ˆå¸Œ (Hashes)</strong>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šå“ˆå¸Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—æ®µå’Œå­—ç¬¦ä¸²å€¼çš„æ˜ å°„è¡¨ï¼Œç±»ä¼¼äºä¸€ä¸ªå­—å…¸ã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ï¼š
<ul>
<li>å­˜å‚¨å¤æ‚å¯¹è±¡ï¼Œå¦‚ç”¨æˆ·èµ„æ–™ã€å•†å“è¯¦æƒ…ç­‰ï¼Œå°†å¯¹è±¡çš„ä¸åŒå±æ€§ä½œä¸ºå­—æ®µå­˜å‚¨ã€‚</li>
<li>ç»Ÿè®¡æŒ‡æ ‡ï¼Œæ¯”å¦‚è®°å½•ç½‘ç«™å„ä¸ªé¡µé¢çš„è®¿é—®æ¬¡æ•°ã€‚</li>
<li>å¤šä¸ªå­—æ®µçš„æ‰¹é‡è¯»å†™æ“ä½œï¼Œå¦‚è´­ç‰©è½¦å•†å“åˆ—è¡¨ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h2 id="å†…å­˜æ·˜æ±°æœºåˆ¶">å†…å­˜æ·˜æ±°æœºåˆ¶</h2>
<p><strong>è¯´æ˜</strong>ï¼šredisçš„æ·˜æ±°æœºåˆ¶ä¸»è¦åˆ†ä¸ºä¸‰å¤§ç±»</p>
<ol>
<li>
<p>é’ˆå¯¹è®¾ç½®ttkï¼ˆè¿‡æœŸæ—¶é—´ï¼‰</p>
<ul>
<li>volatile-lruï¼šä½¿ç”¨LRUç®—æ³•ç§»é™¤keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼›ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰</li>
<li>volatile-lfuï¼šå¯¹è®¾ç½®äº†TTLçš„keyåŸºäºLFUç®—æ³•è¿›è¡Œæ·˜æ±°ã€‚(æœ€ä¸ç»å¸¸ä½¿ç”¨)</li>
<li>volatile-randomï¼šåœ¨è¿‡æœŸé›†åˆä¸­ç§»é™¤éšæœºçš„keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®</li>
<li>volatile-ttlï¼šç§»é™¤é‚£äº›TTLå€¼æœ€å°çš„keyï¼Œå³é‚£äº›æœ€è¿‘è¦è¿‡æœŸçš„key</li>
</ul>
</li>
<li>
<p>æ²¡æœ‰è®¾ç½®ttk</p>
<ul>
<li>allkeys-randomï¼šåœ¨æ‰€æœ‰é›†åˆkeyä¸­ï¼Œç§»é™¤éšæœºçš„key</li>
<li>allkeys-lruï¼šåœ¨æ‰€æœ‰é›†åˆkeyä¸­ï¼Œä½¿ç”¨LRUç®—æ³•ç§»é™¤key</li>
<li>allkeys-lfu:å¯¹å…¨ä½“keyç»™äºˆLFRUç®—æ³•è¿›è¡Œæ·˜æ±°</li>
</ul>
</li>
<li>
<p>ä¸æ·˜æ±°</p>
<ul>
<li>noevictionï¼šä¸è¿›è¡Œç§»é™¤ã€‚é’ˆå¯¹å†™æ“ä½œï¼Œåªæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯(é»˜è®¤ä½¿ç”¨ä¸æ·˜æ±°)</li>
</ul>
</li>
</ol>
<h2 id="redisäº‹åŠ¡">redisäº‹åŠ¡</h2>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>multi</td>
<td>å¼€å§‹ç»„é˜Ÿ</td>
</tr>
<tr>
<td>exec</td>
<td>æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤</td>
</tr>
<tr>
<td>discard</td>
<td>å–æ¶ˆç»„é˜Ÿ</td>
</tr>
</tbody>
</table>
<h3 id="ä¸‰ç§æƒ…å†µ">ä¸‰ç§æƒ…å†µ</h3>
<ol>
<li>ç»„é˜ŸæˆåŠŸï¼Œæäº¤æˆåŠŸ</li>
<li>æƒ…å†µ2,ç»„é˜ŸæŠ¥é”™,æäº¤å¤±è´¥ï¼šæäº¤å¤±è´¥ç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆ</li>
<li>æƒ…å†µ3, ç»„é˜ŸæˆåŠŸ,æäº¤æ—¶æœ‰æˆåŠŸæœ‰å¤±è´¥ã€‚å¦‚æœæ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤æŠ¥å‡ºäº†é”™è¯¯ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚</li>
</ol>
<h3 id="é”æœºåˆ¶">é”æœºåˆ¶</h3>
<ol>
<li>
<p>æ‚²è§‚é”</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ‚²è§‚é”(Pessimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¹è§‚é”</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¹è§‚é”(Optimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ã€‚Rediså°±æ˜¯åˆ©ç”¨è¿™ç§check-and-setæœºåˆ¶å®ç°äº‹åŠ¡çš„ã€‚</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç›‘è§†å’Œå–æ¶ˆç›‘è§†key</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨æ‰§è¡Œmultiä¹‹å‰ï¼Œå…ˆæ‰§è¡Œwatch key1 [key2],å¯ä»¥ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡**æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚**</span><br></pre></td></tr></table></figure>
<p>å–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†ã€‚å¦‚æœåœ¨æ‰§è¡Œ WATCH å‘½ä»¤ä¹‹åï¼ŒEXEC å‘½ä»¤æˆ–DISCARD å‘½ä»¤å…ˆè¢«æ‰§è¡Œäº†çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†æ‰§è¡ŒUNWATCH äº†ã€‚</p>
<p>warch ç›‘å¬keyï¼Œ</p>
</li>
</ol>
<h4 id="ä¸‰ä¸ªç‰¹æ€§">ä¸‰ä¸ªç‰¹æ€§</h4>
<ul>
<li>å•ç‹¬çš„éš”ç¦»æ“ä½œ<br>
äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</li>
<li>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ<br>
é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œ</li>
<li>ä¸ä¿è¯åŸå­æ€§<br>
äº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š</li>
</ul>
<h3 id="Luaè„šæœ¬">Luaè„šæœ¬</h3>
<h3 id="redisçš„æŒä¹…åŒ–">redisçš„æŒä¹…åŒ–</h3>
<ol>
<li>
<p>æŒä¹…åŒ–æœºåˆ¶ï¼š</p>
<p>RDBã€AOF</p>
<blockquote>
<p>DBï¼ˆRedisDataBaseï¼‰å®šæ—¶æ•°æ®å¿«ç…§é»˜è®¤æ–¹å¼</p>
<p>AOFï¼ˆAppendOnly Fileï¼‰æŒ‡ä»¤æ—¥å¿—æ–‡ä»¶æ‰‹åŠ¨å¼€å¯</p>
<p>RDBæ–‡ä»¶æœªæ¥å­˜æ”¾æ˜¯å†…å­˜ä¸­æŸä¸€æ—¶åˆ»çš„æ‰€ä»¥æ•°æ®ï¼Œå‹ç¼©å­˜å‚¨äºŒè¿›åˆ¶ï¼ˆçœ‹ä¸æ‡‚ï¼‰ã€‚â€œ-çœç©ºé—´</p>
<p>AOFæ–‡ä»¶æœªæ¥å­˜æ”¾çš„æ˜¯æ‰€æœ‰å®¢æˆ·ç«¯æ‰§è¡Œçš„å†™å‘½ä»¤ï¼ŒAOFã€‚RESPæ ¼å¼å­˜å‚¨ï¼ˆå¯è¯»ï¼‰</p>
</blockquote>
</li>
</ol>
<h4 id="RDBæŒä¹…åŒ–">RDBæŒä¹…åŒ–</h4>
<ol>
<li>åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜,ä¹Ÿå°±æ˜¯è¡Œè¯è®²çš„Snapshotå¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œ.</li>
<li>æŒä¹…åŒ–æµç¨‹ï¼š
<ol>
<li>
<p>â€”&gt;RDBæ–‡ä»¶ä»€ä¹ˆæ—¶å€™ç”Ÿæˆçš„ã€‚<br>
1.è‡ªåŠ¨ç”Ÿæˆ<br>
2.æ‰‹åŠ¨ç”Ÿæˆã€‚<br>
æ‰‹åŠ¨æ‰§è¡Œsaveå‘½ä»¤-Redisä¼šç»™æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªRDBæ–‡ä»¶<br>
æ‰‹åŠ¨æ‰§è¡Œbgsaveå‘½ä»¤ï¼ŒRedisä¹Ÿä¼šç»™æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªRDBæ–‡ä»¶ã€‚<br>
save or bgsaveåŒºåˆ«<br>
å…±åŒç‚¹ï¼šç”ŸæˆäºŒè¿›åˆ¶å‹ç¼©çš„æ–‡ä»¶ï¼Œä¸”æœªæ¥å¯æ¢å¤æ•°æ®<br>
ä¸åŒç‚¹ï¼šæ€§èƒ½ï¼šå¦‚æœç”¨saveå‘½ä»¤ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°RDBæ–‡ä»¶ä½¿ç”¨çš„æ˜¯Redisçš„ï¼ˆå’Œæ‰§è¡Œå®¢æˆ·ç«¯å‘½ä»¤ï¼‰ç›¸åŒçš„çº¿ç¨‹ã€‚ï¼ˆå…¬ç”¨ä¸€ä¸ªçº¿ç¨‹)<br>
æ€§èƒ½ï¼šå¦‚æœç”¨rgsaVeå‘½ä»¤ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°RDBæ–‡ä»¶ä½¿ç”¨çš„æ˜¯å’Œæ‰§è¡Œå®¢æˆ·ç«¯å‘½çš„çº¿ç¨‹ä¸æ˜¯åŒä¸€ä¸ªã€‚(å¦å¤–å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œ)</p>
</li>
<li>
<p>ä¼˜åŠ¿</p>
<ul>
<li>é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤</li>
<li>å¯¹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜æ›´é€‚åˆä½¿ç”¨</li>
<li><strong>èŠ‚çœç£ç›˜ç©ºé—´</strong></li>
<li><strong>æ¢å¤é€Ÿåº¦å¿«</strong></li>
</ul>
</li>
<li>
<p>åŠ£åŠ¿</p>
<ul>
<li>Forkçš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´2å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘</li>
<li>è™½ç„¶Redisåœ¨forkæ—¶ä½¿ç”¨äº†<strong>å†™æ—¶æ‹·è´æŠ€æœ¯</strong>,ä½†æ˜¯å¦‚æœæ•°æ®åºå¤§æ—¶è¿˜æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚</li>
<li>åœ¨å¤‡ä»½å‘¨æœŸåœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œæ‰€ä»¥å¦‚æœRedisæ„å¤–downæ‰çš„è¯ï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹ã€‚</li>
</ul>
</li>
</ol>
</li>
</ol>
<h4 id="AOFæŒä¹…åŒ–">AOFæŒä¹…åŒ–</h4>
<p>Append Only File ä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼ˆå¢é‡ä¿å­˜ï¼‰ï¼Œå°†Redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥(è¯»æ“ä½œä¸è®°å½•)ï¼Œ åªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œrediså¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®ï¼Œæ¢è¨€ä¹‹ï¼Œredis é‡å¯çš„è¯å°±æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œ</p>
<blockquote>
<p>åœ¨é‡å†™æ—¶ï¼Œä½¿ç”¨çš„æ˜¯å­è¿›ç¨‹ï¼Œæ²¡é‡å†™æ—¶ï¼Œæºaofæ–‡ä»¶æ˜¯ä¸»è¿›ç¨‹ä¿®æ”¹çš„</p>
</blockquote>
<h5 id="æŒä¹…åŒ–æµç¨‹">æŒä¹…åŒ–æµç¨‹</h5>
<p>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯çš„è¯·æ±‚å†™å‘½ä»¤ä¼šè¢«appendè¿½åŠ åˆ°AOFç¼“å†²åŒºå†…ï¼›</p>
<p>ï¼ˆ2ï¼‰AOFç¼“å†²åŒºæ ¹æ®AOFæŒä¹…åŒ–ç­–ç•¥[always,everysec,no]å°†æ“ä½œsyncåŒæ­¥åˆ°ç£ç›˜çš„AOFæ–‡ä»¶ä¸­ï¼›</p>
<p>ï¼ˆ3ï¼‰AOFæ–‡ä»¶å¤§å°è¶…è¿‡é‡å†™ç­–ç•¥æˆ–æ‰‹åŠ¨é‡å†™æ—¶ï¼Œä¼šå¯¹AOFæ–‡ä»¶rewriteé‡å†™ï¼Œå‹ç¼©AOFæ–‡ä»¶å®¹é‡ï¼›</p>
<p>ï¼ˆ4ï¼‰RedisæœåŠ¡é‡å¯æ—¶ï¼Œä¼šé‡æ–°loadåŠ è½½AOFæ–‡ä»¶ä¸­çš„å†™æ“ä½œè¾¾åˆ°æ•°æ®æ¢å¤çš„ç›®çš„ï¼›</p>
<h5 id="AOFåŒæ­¥ç­–ç•¥">AOFåŒæ­¥ç­–ç•¥</h5>
<ul>
<li>appendfsync always
<ul>
<li>å§‹ç»ˆåŒæ­¥ï¼Œæ¯æ¬¡Redisçš„å†™å…¥éƒ½ä¼šç«‹åˆ»è®°å…¥æ—¥å¿—ï¼›æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½</li>
</ul>
</li>
<li>appendfsync everysec
<ul>
<li>æ¯ç§’åŒæ­¥ï¼Œæ¯ç§’è®°å…¥æ—¥å¿—ä¸€æ¬¡ï¼Œå¦‚æœå®•æœºï¼Œæœ¬ç§’çš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚</li>
</ul>
</li>
<li>appendfsync no
<ul>
<li>redisä¸ä¸»åŠ¨è¿›è¡ŒåŒæ­¥ï¼ŒæŠŠåŒæ­¥æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿã€‚</li>
</ul>
</li>
</ul>
<h3 id="ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶</h3>
<ol>
<li>è¯»å†™åˆ†ç¦»</li>
<li>å®¹ç¾</li>
</ol>
<h4 id="å®ç°æ€è·¯">å®ç°æ€è·¯</h4>
<ol>
<li>ä¸€ä¸ªredisæœåŠ¡ä½œä¸ºä¸»æœº,ä¸»è¦è´Ÿè´£å†™æ“ä½œ</li>
<li>ä¸¤ä¸ªredisæœåŠ¡ä½œä¸ºä»æœº,ä¸»è¦è´Ÿè´£è¯»æ“ä½œ</li>
<li>ä»æœºè‡ªåŠ¨ä»ä¸»æœºåŒæ­¥æ•°æ®ä¸‹æ¥</li>
<li>ä»æœºä¸»åŠ¨æ‰¾ä¸»æœº,è€Œä¸»æœºä¸ä¼šæ‰¾ä»æœº</li>
</ol>
<h4 id="ä¸»ä»å¤åˆ¶çš„ä¸‰ç§æ¨¡å¼">ä¸»ä»å¤åˆ¶çš„ä¸‰ç§æ¨¡å¼</h4>
<ol>
<li>ä¸€ä¸»äºŒä»†</li>
<li>æ˜Ÿç«ç›¸ä¼ </li>
<li>åå®¢ä¸ºä¸» ï¼š masteræ‰äº†ä¹‹åï¼Œä»†äººé€šè¿‡slaveof no one å˜æˆmaster</li>
</ol>
<h3 id="å“¨å…µæ¨¡å¼">å“¨å…µæ¨¡å¼</h3>
<p>åå®¢ä¸ºä¸»çš„è‡ªåŠ¨ç‰ˆï¼Œèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“</p>
<ol>
<li>
<p>è®¾ç½®ä¸€ä¸»å¤šä»†</p>
<p>è®¾ç½®ä¼˜å…ˆçº§ï¼šreplica-priority 100</p>
</li>
<li>
<p>ç¼–è¾‘å“¨å…µé…ç½® :é…ç½®masterçš„   1 ä»£è¡¨å“¨å…µçš„æ•°é‡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sentinel monitor mymaster 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¯åŠ¨å“¨å…µ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">redis-sentinel /root/myredis/sentinel.conf</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="redisé›†ç¾¤">redisé›†ç¾¤</h3>
<ol>
<li>
<p>ä»€ä¹ˆæ˜¯é›†ç¾¤</p>
<blockquote>
<p>Redis é›†ç¾¤å®ç°äº†å¯¹Redisçš„æ°´å¹³æ‰©å®¹ï¼Œå³å¯åŠ¨Nä¸ªredisèŠ‚ç‚¹ï¼Œå°†æ•´ä¸ªæ•°æ®åº“åˆ†å¸ƒå­˜å‚¨åœ¨è¿™Nä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ€»æ•°æ®çš„1/Nã€‚</p>
</blockquote>
<blockquote>
<p>Redis é›†ç¾¤é€šè¿‡åˆ†åŒºï¼ˆpartitionï¼‰æ¥æä¾›ä¸€å®šç¨‹åº¦çš„å¯ç”¨æ€§ï¼ˆavailability ï¼‰ï¼šå³ä½¿é›†ç¾¤ä¸­æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæˆ–è€…æ— æ³•è¿›è¡Œé€šè®¯ï¼Œé›†ç¾¤ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚</p>
</blockquote>
</li>
<li>
<p>æ­å»ºé›†ç¾¤</p>
<ol>
<li>
<p>ç¼–å†™é…ç½®æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">....</span><br><span class="line">cluster-enabled yes  // å¼€å¯é›†ç¾¤</span><br><span class="line">cluster-config-file nodes-6379.conf</span><br><span class="line">cluster-node-timeout 15000</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¯åŠ¨é›†ç¾¤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">redis-cli --cluster create --cluster-replicas 1 192.168.1.128:6379 192.168.1.128:6380 192.168.1.128:6381 192.168.1.128:6389 192.168.1.128:6390 192.168.1.128:6391</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é›†ç¾¤çš„ç™»å½•</p>
<p><code>redis-cli -c -p 6379</code></p>
</li>
</ol>
</li>
</ol>
<h4 id="é›†ç¾¤æä¾›çš„å¥½å¤„">é›†ç¾¤æä¾›çš„å¥½å¤„</h4>
<ul>
<li>å®ç°æ‰©å®¹</li>
<li>åˆ†æ‘Šå‹åŠ›</li>
<li>æ— ä¸­å¿ƒé…ç½®ç›¸å¯¹ç®€å•</li>
</ul>
<h4 id="é›†ç¾¤çš„ä¸è¶³">é›†ç¾¤çš„ä¸è¶³</h4>
<ul>
<li>å¤šé”®æ“ä½œæ˜¯ä¸è¢«æ”¯æŒçš„</li>
<li>å¤šé”®çš„Redisäº‹åŠ¡æ˜¯ä¸è¢«æ”¯æŒçš„ã€‚luaè„šæœ¬ä¸è¢«æ”¯æŒ</li>
<li>ç”±äºé›†ç¾¤æ–¹æ¡ˆå‡ºç°è¾ƒæ™šï¼Œå¾ˆå¤šå…¬å¸å·²ç»é‡‡ç”¨äº†å…¶ä»–çš„é›†ç¾¤æ–¹æ¡ˆï¼Œè€Œä»£ç†æˆ–è€…å®¢æˆ·ç«¯åˆ†ç‰‡çš„æ–¹æ¡ˆæƒ³è¦è¿ç§»è‡³redis clusterï¼Œéœ€è¦æ•´ä½“è¿ç§»è€Œä¸æ˜¯é€æ­¥è¿‡æ¸¡ï¼Œå¤æ‚åº¦è¾ƒå¤§ã€‚</li>
</ul>
<h2 id="1-2ã€ç¼“å­˜å¸¸è§é—®é¢˜">1.2ã€ç¼“å­˜å¸¸è§é—®é¢˜</h2>
<p>ç¼“å­˜æœ€å¸¸è§çš„3ä¸ªé—®é¢˜ï¼š é¢è¯•</p>
<ol>
<li>ç¼“å­˜ç©¿é€</li>
<li>ç¼“å­˜é›ªå´©</li>
<li>ç¼“å­˜å‡»ç©¿</li>
</ol>
<p><strong>ç¼“å­˜ç©¿é€</strong>: æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œå°†å»æŸ¥è¯¢æ•°æ®åº“ï¼Œä½†æ˜¯æ•°æ®åº“ä¹Ÿæ— æ­¤è®°å½•ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œæˆ‘ä»¬æ²¡æœ‰å°†è¿™æ¬¡æŸ¥è¯¢çš„nullå†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚åœ¨æµé‡å¤§æ—¶ï¼Œå¯èƒ½DBå°±æŒ‚æ‰äº†ï¼Œè¦æ˜¯æœ‰äººåˆ©ç”¨ä¸å­˜åœ¨çš„keyé¢‘ç¹æ”»å‡»æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™å°±æ˜¯æ¼æ´ã€‚</p>
<ul>
<li>
<p>è§£å†³1 ï¼šç©ºç»“æœä¹Ÿè¿›è¡Œç¼“å­˜ï¼Œä½†å®ƒçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿï¼Œä½†æ˜¯ä¸èƒ½é˜²æ­¢éšæœºç©¿é€ã€‚</p>
</li>
<li>
<p>è§£å†³2 ï¼šä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥è§£å†³éšæœºç©¿é€é—®é¢˜ã€‚</p>
</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/f832ce6671b14aa9a1ba6df3b7e9a403.png" alt=""></p>
<p><strong>ç¼“å­˜é›ªå´©</strong>:æ˜¯æŒ‡åœ¨æˆ‘ä»¬è®¾ç½®ç¼“å­˜æ—¶é‡‡ç”¨äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´ç¼“å­˜åœ¨æŸä¸€æ—¶åˆ»åŒæ—¶å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨è½¬å‘åˆ°DBï¼ŒDBç¬æ—¶å‹åŠ›è¿‡é‡é›ªå´©ã€‚</p>
<ul>
<li>
<p>è§£å†³1ï¼šåŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚</p>
</li>
<li>
<p>è§£å†³2ï¼šå¦‚æœå•èŠ‚ç‚¹å®•æœºï¼Œå¯ä»¥é‡‡ç”¨é›†ç¾¤éƒ¨ç½²æ–¹å¼é˜²æ­¢é›ªå´©</p>
</li>
</ul>
<p><strong>ç¼“å­˜å‡»ç©¿</strong>: æ˜¯æŒ‡å¯¹äºä¸€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œå¦‚æœè¿™äº›keyå¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´ç‚¹è¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®ï¼Œæ˜¯ä¸€ç§éå¸¸â€œçƒ­ç‚¹â€çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœè¿™ä¸ªkeyåœ¨å¤§é‡è¯·æ±‚åŒæ—¶è¿›æ¥ä¹‹å‰æ­£å¥½å¤±æ•ˆï¼Œé‚£ä¹ˆæ‰€æœ‰å¯¹è¿™ä¸ªkeyçš„æ•°æ®æŸ¥è¯¢éƒ½è½åˆ°dbï¼Œæˆ‘ä»¬ç§°ä¸ºç¼“å­˜å‡»ç©¿ã€‚</p>
<p>ä¸ç¼“å­˜é›ªå´©çš„åŒºåˆ«ï¼š</p>
<ol>
<li>å‡»ç©¿æ˜¯ä¸€ä¸ªçƒ­ç‚¹keyå¤±æ•ˆ</li>
<li>é›ªå´©æ˜¯å¾ˆå¤škeyé›†ä½“å¤±æ•ˆ</li>
</ol>
<ul>
<li>è§£å†³ï¼šé”</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/6b3f9ab61263a1d00ce92554ae76955e.png" alt=""></p>
<p>ç¼“å­˜ç©¿é€ï¼šæŸ¥è¯¢æ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®</p>
<p>â€‹     1.è§£å†³æ–¹æ¡ˆ1ï¼šç¼“å­˜null</p>
<p>â€‹     2â€¦è§£å†³æ–¹æ¡ˆ2ï¼šå¸ƒéš†è¿‡æ»¤å™¨</p>
<p>ç¼“å­˜é›ªå´©: åŒä¸€æ—¶åˆ»å¤§é‡çš„keyåŒæ—¶å¤±æ•ˆ|ç¼“å­˜å•èŠ‚ç‚¹æ•…éšœé—®é¢˜é€ æˆçš„</p>
<p>è§£å†³æ–¹æ¡ˆ1ï¼šè®¾ç½®éšæœºçš„è¿‡æœŸæ—¶é—´,</p>
<p>è§£å†³æ–¹æ¡ˆ2ï¼šåŠ redisé›†ç¾¤</p>
<p>ç¼“å­˜å‡»ç©¿ï¼š æŸä¸ªçƒ­ç‚¹keyè¿‡æœŸ,æ¯”å¦‚ç§’æ€</p>
<p>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨åˆ†å¸ƒå¼é”</p>
<p>ç¼“å­˜ä¸€è‡´æ€§ï¼šcanalè§£å†³</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>spring bootè‡ªåŠ¨é…ç½®åŸç†</title>
    <url>/2025/09/15/spring%20boot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h2 id="spring-bootè‡ªåŠ¨é…ç½®åŸç†">spring bootè‡ªåŠ¨é…ç½®åŸç†</h2>
<ol>
<li>
<p><strong>å¯¼å…¥åœºæ™¯</strong>ï¼šå¯¼å…¥ä¾èµ–å’Œbeanå¯¹è±¡</p>
</li>
<li>
<p><strong>é»˜è®¤çš„æ‰«æåŒ…è§„åˆ™</strong></p>
<p><code>@SpringBootApplication(scanBeanPackages=&quot;online.zorange&quot;)</code></p>
<p>é»˜è®¤æ‰«æå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…ï¼Œä»¥åŠå­åŒ…</p>
</li>
<li>
<p><strong>ç»‘å®šé…ç½®</strong></p>
<p>é…ç½®æ–‡ä»¶çš„é…ç½®é¡¹å’Œjavaç±»çš„å¯¹è±¡è¿›è¡Œä¸€ä¸€ç»‘å®š</p>
</li>
<li>
<p><strong>æŒ‰éœ€åŠ è½½è‡ªåŠ¨é…ç½®</strong></p>
<ol>
<li>
<p>spring.boot.autoconfiguration åœ¨spting-boot-startåŒ…ä¸­ï¼Œå®ƒåŒ…å«å„ç§æŠ€æœ¯çš„é…ç½®ç±»ï¼Œæ¥ç”Ÿäº§å¯¹åº”æŠ€æœ¯beanå¯¹è±¡ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/image-20240816150132987.png" alt="image-20240816150132987"></p>
</li>
<li>
<p>å¯¼å…¥å“ªä¸ªåœºæ™¯å°±å¼€å¯å“ªä¸ªè‡ªåŠ¨é…ç½®,å¦‚æœæ²¡æœ‰å¼•å…¥å¯¹åº”æŠ€æœ¯çš„åœºæ™¯å¯åŠ¨å™¨ï¼Œåˆ™ä¸ä¼šå¼•å…¥ã€‚</p>
</li>
<li>
<p>SpringBootApplicationåœ¨å¯åŠ¨æ—¶ä¼šï¼Œæ‹¿åˆ°æ‰€æœ‰æŠ€æœ¯çš„XXXautoconfiguration.classã€spiæŠ€æœ¯ã€‘ã€META-INF/spring/org.springframework.boot.autoconfiqure.AutoConfiguration.importsé‡Œé¢çš„æŠ€æœ¯ã€‘ã€‚åªæœ‰åœ¨å¼•å…¥å¯¹åº”çš„å¯åŠ¨å™¨ï¼Œæ‰ä¼šåŠ è½½ï¼Œå¹¶ä¸ä¼šç›´æ¥å…¨éƒ¨åŠ è½½ã€‚</p>
</li>
<li>
<p>@SpringBootApplicationâ€”&gt;</p>
<ol>
<li>
<pre><code class="language-java">@SpringBootConfiguration
@EnableAutoConfiguration  //è‡ªåŠ¨é…ç½®çš„å¼€å…³
@ComponentScan
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">      2. æ¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»éƒ½æœ‰ä¸€ä¸ªæ¡ä»¶æ³¨è§£ConditioOnXXX,åªæœ‰è¿”å›trueæ‰ç”Ÿæ•ˆ</span><br><span class="line"></span><br><span class="line">      3. æ¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»éƒ½æœ‰@ConfigurationXXXPropertiesï¼Œæ¥åŠ è½½é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯¹åº”æŠ€æœ¯çš„é…ç½®é¡¹ã€‚</span><br><span class="line"></span><br><span class="line">### spring bootè‡ªåŠ¨é…ç½®çš„ç†è§£</span><br><span class="line"></span><br><span class="line">#### @SpringBootApplicationæ³¨è§£</span><br><span class="line"></span><br><span class="line">åŒ…å«ä¸‰ä¸ªæ³¨è§£ï¼š</span><br><span class="line"></span><br><span class="line">1. `@SpringBootConfiguration`</span><br><span class="line"></span><br><span class="line">2. `@EnableAutoConfiguration`</span><br><span class="line"></span><br><span class="line">3. `@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="line">   @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)`</span><br><span class="line"></span><br><span class="line">#### @SpringBootConfiguration</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªæ³¨è§£å°±æ˜¯ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªspringbootçš„é…ç½®ç±»</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### @EnableAutoConfiguration</span><br><span class="line"></span><br><span class="line">æ³¨è§£é‡Œé¢çš„ä¸¤ä¸ªæ³¨è§£</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>@AutoConfigurationPackage<br>
@Import({AutoConfigurationImportSelector.class})</p>
<pre><code>
 1. **@AutoConfigurationPackage**

    é»˜è®¤æ‰«æå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…ï¼Œä»¥åŠå­åŒ…

    

 2. **@Import(&#123;AutoConfigurationImportSelector.class&#125;)**

 3. å¼€å¯==è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒ==ï¼Œæ‰¹é‡å¯¼å…¥é…ç½®ç±»

 4. é»˜è®¤åŠ è½½142ä¸ªé…ç½®ç±»  -&gt;  æ¥æºäº  `spring-boot-autoConfiguration` åŒ…ä¸‹çš„MATE-`INFO/spring/org.springframework.boot.autoconfigure.AutoConfiguration**.imports`æ–‡ä»¶é‡Œé¢

 5. åœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œåˆ™åˆ©ç”¨`@Import(&#123;AutoConfigurationImportSelector.class&#125;)`å°†`autoconfigration`åŒ…ä¸‹çš„`XXXAutoConfiguration`çš„142ä¸ªé…ç½®ç±»å¯¼å…¥

 6. è™½ç„¶å¯¼äº†142ä¸ªé…ç½®ç±»ï¼š

    ä½†æ˜¯è¿™å†™é…ç½®ç±»å¹¶ä¸ä¼šå…¨éƒ¨ç”Ÿæ•ˆï¼Œ`AutoConfigurationImportSelector`æ ¹æ®æ¡ä»¶æ³¨è§£`@ConditionlOnXXX`,åªæœ‰æ¡ä»¶æˆç«‹æ—¶æ‰å¯¼å…¥

##### XXXAutoConfiguration

1. ç”¨äºé…ç½®ç¬¬ä¸‰æ–¹æŠ€æœ¯çš„`bean`ã€‚@Bean

2. å¦‚æœéœ€è¦ç”¨åˆ°é…ç½®æ–‡ä»¶ã€‚åˆ™ä¼šæœ‰`@EnableConfigurationProperties(**ServerProperties**.class)`æ³¨è§£ï¼Œç”¨äºæŠŠé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå‰ç¼€çš„çš„å€¼å°è£…åˆ°xxxPropertiesçš„ç±»çš„å±æ€§ä¸­ã€‚

   ä»¥jbdcä¸ºä¾‹ï¼Œ`@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)`æ‰€æœ‰ä»¥spring.datasourceä¸ºå‰ç¼€çš„éƒ½å°è£…åˆ°äº†å±æ€§ç±»ä¸­ã€‚

3. åªéœ€è¦ä¿®æ”¹æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå°±èƒ½æ›´æ”¹ç»„ä»¶ä¸­çš„æ ¸å¿ƒå‚æ•°çš„å€¼



##### æ ¸å¿ƒæµç¨‹æ€»ç»“

1ã€å¯¼å…¥`starter`ï¼Œå°±ä¼šå¯¼å…¥`autoconfigure`åŒ…ã€‚

2ã€`autoconfigure` åŒ…é‡Œé¢ æœ‰ä¸€ä¸ªæ–‡ä»¶ `META-INF/spring/**org.springframework.boot.autoconfigure.AutoConfiguration**.imports`,é‡Œé¢æŒ‡å®šçš„æ‰€æœ‰å¯åŠ¨è¦åŠ è½½çš„è‡ªåŠ¨é…ç½®ç±»

3ã€@EnableAutoConfiguration ä¼šè‡ªåŠ¨çš„æŠŠä¸Šé¢æ–‡ä»¶é‡Œé¢å†™çš„æ‰€æœ‰**è‡ªåŠ¨é…ç½®ç±»éƒ½å¯¼å…¥è¿›æ¥ã€‚xxxAutoConfiguration æ˜¯æœ‰æ¡ä»¶æ³¨è§£è¿›è¡ŒæŒ‰éœ€åŠ è½½**

4ã€`xxxAutoConfiguration`ç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€å †ç»„ä»¶ï¼Œç»„ä»¶éƒ½æ˜¯ä» `xxxProperties`ä¸­æå–å±æ€§å€¼

5ã€`xxxProperties`åˆæ˜¯å’Œ**é…ç½®æ–‡ä»¶**è¿›è¡Œäº†ç»‘å®š

**æ•ˆæœï¼š**å¯¼å…¥`starter`ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°±èƒ½ä¿®æ”¹åº•å±‚è¡Œä¸ºã€‚



#### @ComponentScan

1. `TypeExcludeFilter`
   - é€šå¸¸ç”±ç¨‹åºå‘˜è‡ªå®šä¹‰ï¼Œç”¨äºæ’é™¤ç‰¹å®šç±»å‹çš„ç»„ä»¶ã€‚
2. `AutoConfigurationExcludeFilter`
   - ç”± Spring Boot æä¾›ï¼Œç”¨äºæ’é™¤é‚£äº›å·²ç»è¢«è‡ªåŠ¨é…ç½®æœºåˆ¶å¤„ç†è¿‡çš„ç»„ä»¶ã€‚
   - å¦‚æœå·²ç»è¢«è‡ªåŠ¨é…ç½®æœºåˆ¶å¤„ç†äº†ï¼Œé‚£ä¹ˆé…ç½®ç±»å°±ä¸ä¼šç”Ÿæ•ˆäº†ã€‚</code></pre>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>spring ç›‘å¬å™¨</title>
    <url>/2025/09/15/spring%20%E7%9B%91%E5%90%AC%E5%99%A8/</url>
    <content><![CDATA[<h2 id="å®ç°æ–¹å¼">å®ç°æ–¹å¼:</h2>
<p>1ï¸âƒ£ Spring æ¡†æ¶è‡ªå¸¦çš„ApplicationListener</p>
<p>2ï¸âƒ£ ä½¿ç”¨Spring Boot æ¡†æ¶å°è£…çš„SpringApplicationRunListener</p>
<h2 id="å…·ä½“ä½¿ç”¨æµç¨‹">å…·ä½“ä½¿ç”¨æµç¨‹:</h2>
<h3 id="1-ApplicationListener">1. ApplicationListener</h3>
<p>ç”¨äºç›‘å¬ Spring åº”ç”¨ä¸Šä¸‹æ–‡äº‹ä»¶çš„æœºåˆ¶ã€‚é€šè¿‡å®ç° <code>ApplicationListener</code> æ¥å£ï¼Œä½ å¯ä»¥åœ¨åº”ç”¨å¯åŠ¨ã€åœæ­¢ç­‰ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œç‰¹å®šçš„é€»è¾‘</p>
<p>å¸¸è§äº‹ä»¶: ContextRefreshedEvent å’Œ ContextClosedEvent  \ ApplicationStartedEvent</p>
<table>
<thead>
<tr>
<th>äº‹ä»¶ç±»å‹</th>
<th>è§¦å‘æ—¶æœº</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>ApplicationStartedEvent</code></strong></td>
<td>åº”ç”¨å¯åŠ¨æ—¶ï¼ˆ<code>SpringApplication.run()</code>ï¼‰</td>
<td>è®°å½•å¯åŠ¨æ—¥å¿—ã€ç›‘æ§å¯åŠ¨è¿‡ç¨‹</td>
</tr>
<tr>
<td><strong><code>ApplicationEnvironmentPreparedEvent</code></strong></td>
<td><code>Environment</code> åˆå§‹åŒ–åï¼Œ<code>ApplicationContext</code> å¯åŠ¨å‰</td>
<td>ä¿®æ”¹ç¯å¢ƒå˜é‡ã€æ·»åŠ é…ç½®æº</td>
</tr>
<tr>
<td><strong><code>ApplicationContextInitializedEvent</code></strong></td>
<td><code>ApplicationContext</code> åˆå§‹åŒ–å</td>
<td>è¿›è¡Œåº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–æ“ä½œ</td>
</tr>
<tr>
<td><strong><code>ApplicationPreparedEvent</code></strong></td>
<td><code>ApplicationContext</code> å®Œå…¨åŠ è½½å¹¶å‡†å¤‡å¥½ï¼Œä½†æœªå¯åŠ¨æ—¶</td>
<td>åˆå§‹åŒ–èµ„æºã€æ‰§è¡Œå¯åŠ¨æ£€æŸ¥</td>
</tr>
<tr>
<td><strong><code>ApplicationReadyEvent</code></strong></td>
<td>åº”ç”¨å®Œå…¨å¯åŠ¨å¹¶å‡†å¤‡å¥½å¤„ç†è¯·æ±‚æ—¶</td>
<td>æ‰§è¡Œåº”ç”¨å¯åŠ¨åä»»åŠ¡</td>
</tr>
<tr>
<td><strong><code>ApplicationFailedEvent</code></strong></td>
<td>åº”ç”¨å¯åŠ¨å¤±è´¥æ—¶</td>
<td>è®°å½•å¤±è´¥æ—¥å¿—ã€é€šçŸ¥ç›‘æ§ç³»ç»Ÿ</td>
</tr>
</tbody>
</table>
<h3 id="2-SpringApplicationRunListener">2. SpringApplicationRunListener</h3>
<p>â‘  : ç¼–å†™ä¸€ä¸ªç±»å‹å®ç°ApringApplicationRunListener</p>
<p>â‘¡ : é‡å†™è¯¥æ¥å£çš„7ä¸ªæ–¹æ³•, æ¯ä¸€ä¸ªæ–¹æ³•éƒ½æœ‰ä¸åŒçš„å›è°ƒæ—¶æœº, å› ä¸ºå¸ƒéš†è¿‡æ»¤å™¨éœ€è¦ä½¿ç”¨Redisson, å› æ­¤åœ¨ä¸šåŠ¡æˆ‘é€‰æ‹©åœ¨Startedä¸­å®ç°å¸ƒéš†è¿‡æ»¤å™¨çš„åˆå§‹åŒ–</p>
<p>â€‹	7ä¸ªæ–¹æ³•çš„å›è°ƒæ—¶æœº:</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>å›è°ƒæ—¶æœº</th>
<th>ç”¨ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>starting()</code></strong></td>
<td>åº”ç”¨å¯åŠ¨å¼€å§‹æ—¶</td>
<td>è¿›è¡Œåˆå§‹åŒ–ã€è®¾ç½®å¯åŠ¨å‚æ•°</td>
</tr>
<tr>
<td><strong><code>environmentPrepared()</code></strong></td>
<td>Spring ç¯å¢ƒå‡†å¤‡å¥½æ—¶</td>
<td>ä¿®æ”¹ç¯å¢ƒå˜é‡ã€é…ç½®æº</td>
</tr>
<tr>
<td><strong><code>contextPrepared()</code></strong></td>
<td>Spring å®¹å™¨å‡†å¤‡å¥½æ—¶</td>
<td>ä¿®æ”¹åº”ç”¨ä¸Šä¸‹æ–‡ã€é…ç½® Bean</td>
</tr>
<tr>
<td><strong><code>contextLoaded()</code></strong></td>
<td>Spring å®¹å™¨å®Œå…¨åŠ è½½å®Œæˆæ—¶</td>
<td>è¿›ä¸€æ­¥åˆå§‹åŒ–ã€é…ç½®åº”ç”¨</td>
</tr>
<tr>
<td><strong><code>started()</code></strong></td>
<td>åº”ç”¨å·²å¯åŠ¨ä½†å°šæœªå®Œå…¨å‡†å¤‡å¥½æ¥å—è¯·æ±‚æ—¶</td>
<td>å¯åŠ¨åä»»åŠ¡ã€å¤–éƒ¨æœåŠ¡æ³¨å†Œ</td>
</tr>
<tr>
<td><strong><code>running()</code></strong></td>
<td>åº”ç”¨å·²å®Œå…¨å‡†å¤‡å¥½ï¼Œå·²èƒ½å¤„ç†è¯·æ±‚æ—¶</td>
<td>å¯åŠ¨åæ“ä½œã€å¥åº·æ£€æŸ¥ç­‰</td>
</tr>
<tr>
<td><strong><code>failed()</code></strong></td>
<td>åº”ç”¨å¯åŠ¨å¤±è´¥æ—¶</td>
<td>é”™è¯¯æ—¥å¿—ã€é€šçŸ¥ã€æ¢å¤æ“ä½œ</td>
</tr>
</tbody>
</table>
<p>è¿™äº›å›è°ƒæ–¹æ³•ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿåœ¨åº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­ç²¾ç»†åœ°æ§åˆ¶ä¸åŒé˜¶æ®µçš„è¡Œä¸ºï¼Œæ¯”å¦‚ä¿®æ”¹é…ç½®ã€æ³¨å†Œå¤–</p>
<ul>
<li>
<p><code>starting()</code>ï¼šSpring Boot åº”ç”¨å¯åŠ¨å‰</p>
<p>ä¿®æ”¹å¯åŠ¨å‚æ•°æˆ–ç¯å¢ƒé…ç½®ã€‚</p>
<p>æ‰“å°å¯åŠ¨æ—¥å¿—ã€‚</p>
</li>
<li>
<p><code>environmentPrepared</code>: Spring åº”ç”¨ç¯å¢ƒå‡†å¤‡å¥½å</p>
<p>ä¿®æ”¹ç³»ç»Ÿå±æ€§æˆ–ç¯å¢ƒå˜é‡ã€‚</p>
<p>åœ¨ç¯å¢ƒä¸­æ·»åŠ è‡ªå®šä¹‰çš„ <code>PropertySource</code>ã€‚</p>
</li>
<li>
<p><code>contextPrepared</code>: Spring åº”ç”¨ä¸Šä¸‹æ–‡å‡†å¤‡å¥½å</p>
</li>
<li>
<p><code>contextLoaded</code>: Spring åº”ç”¨ä¸Šä¸‹æ–‡å®Œå…¨åŠ è½½å,</p>
<p>æ‰§è¡Œ Bean åˆå§‹åŒ–åçš„ä¸€äº›æ“ä½œã€‚</p>
<p>å®Œæˆä¸€äº›é¢å¤–çš„åˆå§‹åŒ–å·¥ä½œã€‚</p>
</li>
<li>
<p><code>started</code> : Spring åº”ç”¨å¯åŠ¨åï¼Œ<code>ApplicationStartedEvent</code> è§¦å‘æ—¶</p>
</li>
<li>
<p><code>running</code>: Spring åº”ç”¨å®Œå…¨å‡†å¤‡å¥½åï¼Œ<code>ApplicationReadyEvent</code> è§¦å‘æ—¶</p>
</li>
<li>
<p><code>failed</code>: Spring åº”ç”¨å¯åŠ¨å¤±è´¥æ—¶</p>
</li>
</ul>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>seata åˆ†å¸ƒå¼äº‹åŠ¡</title>
    <url>/2025/09/15/seata%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/</url>
    <content><![CDATA[<h1>äº‹åŠ¡å›é¡¾</h1>
<ul>
<li>æ¦‚è¿°: å°±æ˜¯ç”±å¤šä¸ªæ“ä½œç»„æˆçš„ä¸€ä¸ªé€»è¾‘å•å…ƒï¼Œç»„æˆè¿™ä¸ªé€»è¾‘å•å…ƒçš„å¤šä¸ªæ“ä½œè¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥ã€‚</li>
</ul>
<h2 id="ACIDå››å¤§ç‰¹æ€§">ACIDå››å¤§ç‰¹æ€§</h2>
<p><strong>Aï¼šåŸå­æ€§(Atomicity)</strong></p>
<p>ä¸€ä¸ªäº‹åŠ¡(transaction)ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰</p>
<p>çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚</p>
<p><strong>Cï¼šä¸€è‡´æ€§(Consistency)</strong></p>
<p>äº‹åŠ¡çš„ä¸€è‡´æ€§æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åæ•°æ®åº“éƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚</p>
<p>å¦‚æœäº‹åŠ¡æˆåŠŸåœ°å®Œæˆï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­æ‰€æœ‰å˜åŒ–å°†æ­£ç¡®åœ°åº”ç”¨ï¼Œç³»ç»Ÿå¤„äºæœ‰æ•ˆçŠ¶æ€ã€‚</p>
<p>å¦‚æœåœ¨äº‹åŠ¡ä¸­å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­çš„æ‰€æœ‰å˜åŒ–å°†è‡ªåŠ¨åœ°å›æ»šï¼Œç³»ç»Ÿè¿”å›åˆ°åŸå§‹çŠ¶æ€ã€‚</p>
<p><strong>Iï¼šéš”ç¦»æ€§(Isolation)</strong></p>
<p>æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“çºµç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæ•´æ•°æ®ç©ºé—´ã€‚ç”±å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¿…é¡»ä¸ä»»ä½•å…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»ã€‚äº‹åŠ¡æŸ¥çœ‹</p>
<p>æ•°æ®æ›´æ–°æ—¶ï¼Œæ•°æ®æ‰€å¤„çš„çŠ¶æ€è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹åçš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚</p>
<p><strong>Dï¼šæŒä¹…æ€§(Durability)</strong></p>
<p>æŒ‡çš„æ˜¯åªè¦äº‹åŠ¡æˆåŠŸç»“æŸï¼Œå®ƒå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°å°±å¿…é¡»ä¿å­˜ä¸‹æ¥ã€‚å³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œé‡æ–°å¯åŠ¨æ•°æ®åº“ç³»ç»Ÿåï¼Œæ•°æ®åº“è¿˜èƒ½æ¢å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€ã€‚</p>
<h2 id="äº‹åŠ¡çš„å¹¶å‘é—®é¢˜">äº‹åŠ¡çš„å¹¶å‘é—®é¢˜</h2>
<p><strong>è„è¯»</strong>ï¼šäº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bæ›´æ–°çš„æ•°æ®ï¼Œäº‹åŠ¡Bæœªæäº¤å¹¶å›æ»šæ•°æ®ï¼Œé‚£ä¹ˆAè¯»å–åˆ°çš„æ•°æ®æ˜¯è„æ•°æ®</p>
<p><strong>ä¸å¯é‡å¤è¯»</strong>ï¼šäº‹åŠ¡Aå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œäº‹åŠ¡Båœ¨äº‹åŠ¡Aå¤šæ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®ä½œäº†æ›´æ–°å¹¶æäº¤ï¼Œå¯¼è‡´äº‹åŠ¡Aå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®æ—¶ï¼Œç»“æœä¸ä¸€è‡´ã€‚</p>
<p><strong>å¹»è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ’å…¥çš„æ•°æ®ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œè¿™å°±å«å¹»è¯»ã€‚</p>
<p><strong>å°ç»“</strong>ï¼šä¸å¯é‡å¤è¯»çš„å’Œå¹»è¯»å¾ˆå®¹æ˜“æ··æ·†ï¼Œä¸å¯é‡å¤è¯»ä¾§é‡äºä¿®æ”¹ï¼Œå¹»è¯»ä¾§é‡äºæ–°å¢æˆ–åˆ é™¤ã€‚</p>
<h2 id="äº‹åŠ¡éš”ç¦»çº§åˆ«">äº‹åŠ¡éš”ç¦»çº§åˆ«</h2>
<p>é’ˆå¯¹å¹¶å‘äº‹åŠ¡æ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œè¦æƒ³è§£å†³å°±éœ€è¦ä½¿ç”¨åˆ°äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚</p>
<p>å¸¸è§çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å’Œè§£å†³çš„é—®é¢˜çš„å¯¹åº”å…³ç³»è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š<br>
<img src="http://120.26.79.238:9000/blog/img/70e8222c4c5185cf2cae6a9436219e32.png" alt=""></p>
<h2 id="äº‹åŠ¡ä¼ æ’­è¡Œä¸º">äº‹åŠ¡ä¼ æ’­è¡Œä¸º</h2>
<ul>
<li><strong>æ¦‚è¿°</strong>ï¼šæŒ‡çš„å°±æ˜¯å½“ä¸€ä¸ªæ–¹æ³•è¢«å¦ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å¯¹äº‹åŠ¡çš„æ€åº¦ã€‚</li>
</ul>
<p>Springå®šä¹‰äº†ä¸ƒç§ä¼ æ’­è¡Œä¸ºï¼š<br>
<img src="http://120.26.79.238:9000/blog/img/b8355de5ce618d4071211f66780424ab.png" alt=""></p>
<h1>åˆ†å¸ƒå¼äº‹åŠ¡æ¦‚è¿°</h1>
<h2 id="æœ¬åœ°äº‹åŠ¡">æœ¬åœ°äº‹åŠ¡</h2>
<ul>
<li>ç§°ä¸ºæ•°æ®åº“äº‹åŠ¡æˆ–ä¼ ç»Ÿäº‹åŠ¡ï¼ˆç›¸å¯¹äºåˆ†å¸ƒå¼äº‹åŠ¡è€Œè¨€ï¼‰ã€‚è¿™ä¸€ç±»äº‹åŠ¡æ˜¯åŸºäºå•ä¸ªæœåŠ¡å•ä¸€æ•°æ®åº“è®¿é—®çš„äº‹åŠ¡ã€‚</li>
</ul>
<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡ç®€ä»‹">åˆ†å¸ƒå¼äº‹åŠ¡ç®€ä»‹</h2>
<ul>
<li>æ¦‚è¿°ï¼šåˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯ç»„æˆä¸šåŠ¡é€»è¾‘å•å…ƒçš„å¤šä¸ªæ“ä½œä½äºä¸åŒçš„æœåŠ¡ä¸Šæˆ–è€…è®¿é—®ä¸åŒçš„æ•°æ®åº“èŠ‚ç‚¹ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦ä¿è¯è¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li>
</ul>
<h1>ç†è®ºåŸºç¡€</h1>
<h2 id="CAPå®šç†">CAPå®šç†</h2>
<p>1998å¹´ï¼ŒåŠ å·å¤§å­¦çš„è®¡ç®—æœºç§‘å­¦å®¶ Eric Brewer æå‡ºï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæœ‰ä¸‰ä¸ªæŒ‡æ ‡ã€‚</p>
<p>1ã€Consistencyï¼ˆä¸€è‡´æ€§ï¼‰</p>
<p>2ã€Availabilityï¼ˆå¯ç”¨æ€§ï¼‰</p>
<p>3ã€Partition tolerance ï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</p>
<p>å®ƒä»¬çš„ç¬¬ä¸€ä¸ªå­—æ¯åˆ†åˆ«æ˜¯ Cã€Aã€Pã€‚</p>
<p>Eric Brewer è¯´ï¼Œè¿™ä¸‰ä¸ªæŒ‡æ ‡ä¸å¯èƒ½åŒæ—¶åšåˆ°ã€‚è¿™ä¸ªç»“è®ºå°±å«åš CAP å®šç†ã€‚</p>
<h3 id="ä¸€è‡´æ€§">ä¸€è‡´æ€§</h3>
<p>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šç”¨æˆ·è®¿é—®åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„æ•°æ®å¿…é¡»ä¸€è‡´ã€‚</p>
<h3 id="å¯ç”¨æ€§">å¯ç”¨æ€§</h3>
<p>Availability ï¼ˆå¯ç”¨æ€§ï¼‰ï¼šç”¨æˆ·è®¿é—®é›†ç¾¤ä¸­çš„ä»»æ„å¥åº·èŠ‚ç‚¹ï¼Œå¿…é¡»èƒ½å¾—åˆ°å“åº”ï¼Œè€Œä¸æ˜¯è¶…æ—¶æˆ–æ‹’ç»ã€‚</p>
<h3 id="åˆ†åŒºå®¹é”™">åˆ†åŒºå®¹é”™</h3>
<p>å› ä¸ºç½‘ç»œæ•…éšœæˆ–å…¶å®ƒåŸå› å¯¼è‡´åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„éƒ¨åˆ†èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹å¤±å»è¿æ¥ï¼Œå½¢æˆç‹¬ç«‹åˆ†åŒºã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/6eee135715558706fc80fe9a8f2765db.png" alt=""></p>
<ul>
<li>Toleranceï¼ˆå®¹é”™ï¼‰ï¼šåœ¨é›†ç¾¤å‡ºç°åˆ†åŒºæ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿä¹Ÿè¦æŒç»­å¯¹å¤–æä¾›æœåŠ¡</li>
</ul>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿé—´çš„ç½‘ç»œä¸èƒ½100%ä¿è¯å¥åº·ï¼Œä¸€å®šä¼šæœ‰æ•…éšœçš„æ—¶å€™ï¼Œè€ŒæœåŠ¡æœ‰å¿…é¡»å¯¹å¤–ä¿è¯æœåŠ¡ã€‚å› æ­¤Partition Toleranceä¸å¯é¿å…ã€‚å½“èŠ‚ç‚¹æ¥æ”¶åˆ°æ–°çš„æ•°æ®å˜æ›´æ—¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜äº†ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/b3fef90f191b4db5800b1c0b026de78d.png" alt=""></p>
<ul>
<li>
<p>å¦‚æœæ­¤æ—¶è¦ä¿è¯ä¸€è‡´æ€§ï¼Œå°±å¿…é¡»ç­‰å¾…ç½‘ç»œæ¢å¤ï¼Œå®Œæˆæ•°æ®åŒæ­¥åï¼Œæ•´ä¸ªé›†ç¾¤æ‰å¯¹å¤–æä¾›æœåŠ¡ï¼ŒæœåŠ¡å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸å¯ç”¨ã€‚</p>
</li>
<li>
<p>å¦‚æœæ­¤æ—¶è¦ä¿è¯å¯ç”¨æ€§ï¼Œå°±ä¸èƒ½ç­‰å¾…ç½‘ç»œæ¢å¤ï¼Œé‚£node01ã€node02ä¸node03ä¹‹é—´å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´ã€‚</p>
</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨Pä¸€å®šä¼šå‡ºç°çš„æƒ…å†µä¸‹ï¼ŒAå’ŒCä¹‹é—´åªèƒ½å®ç°ä¸€ä¸ªã€‚</p>
<p>æ³¨æ„ï¼šåœ¨CAPå®šç†ä¸­ä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯å¼ºä¸€è‡´æ€§</p>
<h2 id="BASEç†è®º">BASEç†è®º</h2>
<p>BASEç†è®ºæ˜¯å¯¹CAPçš„ä¸€ç§è§£å†³æ€è·¯ï¼ŒåŒ…å«ä¸‰ä¸ªæ€æƒ³ï¼š</p>
<p>1ã€Basically Available ï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œå³ä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚</p>
<p>2ã€Soft Stateï¼ˆè½¯çŠ¶æ€ï¼‰ï¼šåœ¨ä¸€å®šæ—¶é—´å†…ï¼Œå…è®¸å‡ºç°ä¸­é—´çŠ¶æ€ï¼Œæ¯”å¦‚ä¸´æ—¶çš„ä¸ä¸€è‡´çŠ¶æ€ã€‚</p>
<p>3ã€Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ï¼šè™½ç„¶æ— æ³•ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä½†æ˜¯åœ¨è½¯çŠ¶æ€ç»“æŸåï¼Œæœ€ç»ˆè¾¾åˆ°æ•°æ®ä¸€è‡´ã€‚</p>
<h1>Seata</h1>
<h2 id="Seataç®€ä»‹">Seataç®€ä»‹</h2>
<p>Seataæ˜¯ 2019 å¹´ 1 æœˆä»½èš‚èšé‡‘æœå’Œé˜¿é‡Œå·´å·´å…±åŒå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚è‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://seata.io/zh-cn/%EF%BC%8C%E5%85%B6%E4%B8%AD%E7%9A%84%E6%96%87%E6%A1%A3%E3%80%81%E6%92%AD%E5%AE%A2%E4%B8%AD%E6%8F%90%E4%BE%9B%E4%BA%86%E5%A4%A7%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%E3%80%81%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E3%80%82">https://seata.io/zh-cn/ï¼Œå…¶ä¸­çš„æ–‡æ¡£ã€æ’­å®¢ä¸­æä¾›äº†å¤§é‡çš„ä½¿ç”¨è¯´æ˜ã€æºç åˆ†æã€‚</a></p>
<h2 id="Seataæ¶æ„">Seataæ¶æ„</h2>
<ul>
<li>
<p>åŸºç¡€æ¦‚å¿µï¼š</p>
<ul>
<li>
<p>åˆ†æ”¯äº‹åŠ¡ï¼šæ¯ä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿçš„äº‹åŠ¡</p>
</li>
<li>
<p>å…¨å±€äº‹åŠ¡ï¼šå¤šä¸ªæœ‰å…³è”çš„å„ä¸ªåˆ†æ”¯äº‹åŠ¡ç»„æˆåœ¨ä¸€èµ·</p>
</li>
</ul>
</li>
</ul>
<p><strong>Seataäº‹åŠ¡ç®¡ç†ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„è§’è‰²ï¼š</strong></p>
<ul>
<li>
<p>1ã€TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€…ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p>
</li>
<li>
<p>2ã€TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ï¼šå®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</p>
</li>
<li>
<p>3ã€RM (Resource Manager) - èµ„æºç®¡ç†å™¨ï¼šç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p>
</li>
</ul>
<p>å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/68e4364165e0e1e70eb84c2cc5b2dac2.png" alt=""></p>
<p>åŸºæœ¬æµç¨‹ä»‹ç»ï¼š</p>
<p>1ã€ç”±TMæ³¨å†Œå…¨å±€äº‹åŠ¡åˆ°TCæœåŠ¡å™¨</p>
<p>2ã€TCæœåŠ¡å™¨ä¼šè¿”å›xid(æœ¬æ¬¡å…¨å±€äº‹åŠ¡çš„id)ï¼Œè¿™ä¸ªxidä¼šéšç€å¾®æœåŠ¡çš„è°ƒç”¨ä¸€å¹¶ä¼ é€’ä¸‹å»</p>
<p>3ã€æ‰§è¡Œåˆ†æ”¯äº‹åŠ¡ï¼Œæ­¤æ—¶å°±éœ€è¦é€šè¿‡RMæœåŠ¡å™¨æ³¨å†Œåˆ†æ”¯äº‹åŠ¡åˆ°TCæœåŠ¡å™¨</p>
<p>4ã€æ‰§è¡Œä¸šåŠ¡SQLï¼Œå¹¶æœ‰RMæœåŠ¡å™¨æŠ¥å‘Šæ¯ä¸€ä¸ªåˆ†æ”¯äº‹åŠ¡çš„æ‰§è¡ŒçŠ¶æ€åˆ°TCæœåŠ¡å™¨</p>
<p>5ã€å½“å…¨å±€äº‹åŠ¡ç»“æŸä»¥åï¼ŒTCä¼šè¿›è¡Œåˆ†æ”¯äº‹åŠ¡çŠ¶æ€çš„ç»Ÿè®¡ï¼Œç„¶ååœ¨é€šè¿‡RMæœåŠ¡å™¨è¿›è¡Œåˆ†æ”¯äº‹åŠ¡çš„å›æ»šæˆ–è€…æäº¤</p>
<p><img src="http://120.26.79.238:9000/blog/img/d8cb491b07849f9c074b9297a20d511e.png" alt=""></p>
<h3 id="å››ç§ä¸åŒçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼š">å››ç§ä¸åŒçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼š</h3>
<p>1ã€XAæ¨¡å¼ï¼šå¼ºä¸€è‡´æ€§åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œç‰ºç‰²äº†ä¸€å®šçš„å¯ç”¨æ€§ï¼Œæ— ä¸šåŠ¡ä¾µå…¥</p>
<p>2ã€ATæ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæ— ä¸šåŠ¡ä¾µå…¥ï¼Œä¹Ÿæ˜¯Seataçš„é»˜è®¤æ¨¡å¼</p>
<p>3ã€TCCæ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥</p>
<p>4ã€SAGAæ¨¡å¼ï¼šé•¿äº‹åŠ¡æ¨¡å¼ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥</p>
<p>æ— è®ºå“ªç§æ–¹æ¡ˆï¼Œéƒ½ç¦»ä¸å¼€TCï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡çš„åè°ƒè€…ã€‚</p>
<h3 id="è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€æƒ³å’Œæ¨¡å‹ï¼š">è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€æƒ³å’Œæ¨¡å‹ï¼š</h3>
<ul>
<li>
<p>å…¨å±€äº‹åŠ¡ï¼šæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡</p>
</li>
<li>
<p>åˆ†æ”¯äº‹åŠ¡ï¼šåˆ†å¸ƒå¼äº‹åŠ¡ä¸­åŒ…å«çš„æ¯ä¸ªå­ç³»ç»Ÿçš„äº‹åŠ¡</p>
</li>
<li>
<p>æœ€ç»ˆä¸€è‡´æ€æƒ³ï¼šå„åˆ†æ”¯äº‹åŠ¡åˆ†åˆ«æ‰§è¡Œå¹¶æäº¤ï¼Œå¦‚æœæœ‰ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå†æƒ³åŠæ³•æ¢å¤æ•°æ®</p>
</li>
<li>
<p>å¼ºä¸€è‡´æ€æƒ³ï¼šå„åˆ†æ”¯äº‹åŠ¡æ‰§è¡Œå®Œä¸šåŠ¡ä¸è¦æäº¤ï¼Œç­‰å¾…å½¼æ­¤ç»“æœã€‚è€Œå¯ç»Ÿä¸€æäº¤æˆ–å›æ»š</p>
</li>
</ul>
<h2 id="Seata-é…ç½®">Seata é…ç½®</h2>
<h3 id="1-ä¿®æ”¹seata-çš„é…ç½®æ–‡ä»¶">1. ä¿®æ”¹seata çš„é…ç½®æ–‡ä»¶</h3>
<p>è¿™ä¸ªTCæœåŠ¡åœ¨è¿è¡Œçš„æ—¶å€™éœ€è¦ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›é…ç½®ä¿¡æ¯äº¤ç”±Nacosè¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚å¹¶ä¸”éœ€è¦å°†TCæœåŠ¡æ³¨å†Œåˆ°Nacosï¼ŒåæœŸå¾®æœåŠ¡å°±å¯ä»¥ä»Nacosä¸­è·å–TCæœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯å®Œæˆäº‹åŠ¡çš„æ§åˆ¶ã€‚</p>
<ul>
<li>config/application.yml</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é…ç½®seataåå°ç®¡ç†ç³»ç»Ÿçš„è®¿é—®ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line">  <span class="attr">console:</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">seata</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">seata</span></span><br><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="comment"># support: nacos, consul, apollo, zk, etcd3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.136</span><span class="number">.145</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">namespace:</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">SEATA_GROUP</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">      <span class="attr">password:</span></span><br><span class="line">      <span class="attr">context-path:</span></span><br><span class="line">      <span class="attr">data-id:</span> <span class="string">seataServer.properties</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="comment"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">application:</span> <span class="string">seata-server</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.136</span><span class="number">.145</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">SEATA_GROUP</span></span><br><span class="line">      <span class="attr">namespace:</span></span><br><span class="line">      <span class="attr">cluster:</span> <span class="string">default</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">      <span class="attr">password:</span></span><br><span class="line">      <span class="attr">context-path:</span></span><br><span class="line">  <span class="comment">#store:</span></span><br><span class="line">    <span class="comment"># support: file ã€ db ã€ redis ã€ raft</span></span><br><span class="line">    <span class="comment"># mode: file</span></span><br><span class="line">  <span class="comment">#  server:</span></span><br><span class="line">  <span class="comment">#    service-port: 8091 #If not configured, the default is &#x27;$&#123;server.port&#125; + 1000&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-ä¸ºseataé…ç½®-nacosé…ç½®ä¸­å¿ƒ">2.  ä¸ºseataé…ç½®,(nacosé…ç½®ä¸­å¿ƒ)</h3>
<p>åœ¨Nacosä¸­æ·»åŠ TCæœåŠ¡æ‰€éœ€è¦çš„é…ç½®æ–‡ä»¶seataServer.propertiesã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#For details about configuration items, see https://seata.io/zh-cn/docs/user/configurations.html</span><br><span class="line">#Transport configuration, for client and server</span><br><span class="line">transport.type=TCP</span><br><span class="line">transport.server=NIO</span><br><span class="line">transport.heartbeat=true</span><br><span class="line">transport.enableTmClientBatchSendRequest=false</span><br><span class="line">transport.enableRmClientBatchSendRequest=true</span><br><span class="line">transport.enableTcServerBatchSendResponse=false</span><br><span class="line">transport.rpcRmRequestTimeout=30000</span><br><span class="line">transport.rpcTmRequestTimeout=30000</span><br><span class="line">transport.rpcTcRequestTimeout=30000</span><br><span class="line">transport.threadFactory.bossThreadPrefix=NettyBoss</span><br><span class="line">transport.threadFactory.workerThreadPrefix=NettyServerNIOWorker</span><br><span class="line">transport.threadFactory.serverExecutorThreadPrefix=NettyServerBizHandler</span><br><span class="line">transport.threadFactory.shareBossWorker=false</span><br><span class="line">transport.threadFactory.clientSelectorThreadPrefix=NettyClientSelector</span><br><span class="line">transport.threadFactory.clientSelectorThreadSize=1</span><br><span class="line">transport.threadFactory.clientWorkerThreadPrefix=NettyClientWorkerThread</span><br><span class="line">transport.threadFactory.bossThreadSize=1</span><br><span class="line">transport.threadFactory.workerThreadSize=default</span><br><span class="line">transport.shutdown.wait=3</span><br><span class="line">transport.serialization=seata</span><br><span class="line">transport.compressor=none</span><br><span class="line"></span><br><span class="line"># é¦–å…ˆåº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸­é…ç½®äº†äº‹åŠ¡åˆ†ç»„ï¼Œè‹¥åº”ç”¨ç¨‹åºæ˜¯SpringBootåˆ™é€šè¿‡é…ç½®seata.tx-service-group=[äº‹åŠ¡åˆ†ç»„é…ç½®é¡¹]</span><br><span class="line"># äº‹åŠ¡ç¾¤ç»„ï¼Œservice.vgroupMapping.[äº‹åŠ¡åˆ†ç»„é…ç½®é¡¹]=TCé›†ç¾¤çš„åç§°</span><br><span class="line">service.vgroupMapping.default_tx_group=default</span><br><span class="line">#If you use a registry, you can ignore it</span><br><span class="line">service.default.grouplist=127.0.0.1:8091</span><br><span class="line">service.enableDegrade=false</span><br><span class="line">service.disableGlobalTransaction=false</span><br><span class="line"></span><br><span class="line">client.metadataMaxAgeMs=30000</span><br><span class="line">#Transaction rule configuration, only for the client</span><br><span class="line">client.rm.asyncCommitBufferLimit=10000</span><br><span class="line">client.rm.lock.retryInterval=10</span><br><span class="line">client.rm.lock.retryTimes=30</span><br><span class="line">client.rm.lock.retryPolicyBranchRollbackOnConflict=true</span><br><span class="line">client.rm.reportRetryCount=5</span><br><span class="line">client.rm.tableMetaCheckEnable=true</span><br><span class="line">client.rm.tableMetaCheckerInterval=60000</span><br><span class="line">client.rm.sqlParserType=druid</span><br><span class="line">client.rm.reportSuccessEnable=false</span><br><span class="line">client.rm.sagaBranchRegisterEnable=false</span><br><span class="line">client.rm.sagaJsonParser=fastjson</span><br><span class="line">client.rm.tccActionInterceptorOrder=-2147482648</span><br><span class="line">client.rm.sqlParserType=druid</span><br><span class="line">client.tm.commitRetryCount=5</span><br><span class="line">client.tm.rollbackRetryCount=5</span><br><span class="line">client.tm.defaultGlobalTransactionTimeout=60000</span><br><span class="line">client.tm.degradeCheck=false</span><br><span class="line">client.tm.degradeCheckAllowTimes=10</span><br><span class="line">client.tm.degradeCheckPeriod=2000</span><br><span class="line">client.tm.interceptorOrder=-2147482648</span><br><span class="line">client.undo.dataValidation=true</span><br><span class="line">client.undo.logSerialization=jackson</span><br><span class="line">client.undo.onlyCareUpdateColumns=true</span><br><span class="line">server.undo.logSaveDays=7</span><br><span class="line">server.undo.logDeletePeriod=86400000</span><br><span class="line">client.undo.logTable=undo_log</span><br><span class="line">client.undo.compress.enable=true</span><br><span class="line">client.undo.compress.type=zip</span><br><span class="line">client.undo.compress.threshold=64k</span><br><span class="line">#For TCC transaction mode</span><br><span class="line">tcc.fence.logTableName=tcc_fence_log</span><br><span class="line">tcc.fence.cleanPeriod=1h</span><br><span class="line"># You can choose from the following options: fastjson, jackson, gson</span><br><span class="line">tcc.contextJsonParserType=fastjson</span><br><span class="line"></span><br><span class="line">#Log rule configuration, for client and server</span><br><span class="line">log.exceptionRate=100</span><br><span class="line"></span><br><span class="line">#äº‹åŠ¡ä¼šè¯ä¿¡æ¯å­˜å‚¨æ–¹å¼</span><br><span class="line">#Transaction storage configuration, only for the server. The file, db, and redis configuration values are optional.</span><br><span class="line">store.mode=db</span><br><span class="line">#äº‹åŠ¡é”ä¿¡æ¯å­˜å‚¨æ–¹å¼</span><br><span class="line">store.lock.mode=db</span><br><span class="line">#äº‹åŠ¡å›è¯ä¿¡æ¯å­˜å‚¨æ–¹å¼</span><br><span class="line">store.session.mode=db</span><br><span class="line">#Used for password encryption</span><br><span class="line">store.publicKey=</span><br><span class="line"></span><br><span class="line">#If `store.mode,store.lock.mode,store.session.mode` are not equal to `file`, you can remove the configuration block.</span><br><span class="line">store.file.dir=file_store/data</span><br><span class="line">store.file.maxBranchSessionSize=16384</span><br><span class="line">store.file.maxGlobalSessionSize=512</span><br><span class="line">store.file.fileWriteBufferCacheSize=16384</span><br><span class="line">store.file.flushDiskMode=async</span><br><span class="line">store.file.sessionReloadReadSize=100</span><br><span class="line"></span><br><span class="line">#å­˜å‚¨æ–¹å¼ä¸ºdb</span><br><span class="line">#These configurations are required if the `store mode` is `db`. If `store.mode,store.lock.mode,store.session.mode` are not equal to `db`, you can remove the configuration block.</span><br><span class="line">store.db.datasource=druid</span><br><span class="line">store.db.dbType=mysql</span><br><span class="line">store.db.driverClassName=com.mysql.cj.jdbc.Driver</span><br><span class="line">store.db.url=jdbc:mysql://192.168.136.145:3308/seata?useUnicode=true&amp;rewriteBatchedStatements=true&amp;useSSL=false</span><br><span class="line">store.db.user=root</span><br><span class="line">store.db.password=1234</span><br><span class="line">store.db.minConn=5</span><br><span class="line">store.db.maxConn=30</span><br><span class="line">store.db.globalTable=global_table</span><br><span class="line">store.db.branchTable=branch_table</span><br><span class="line">store.db.distributedLockTable=distributed_lock</span><br><span class="line">store.db.queryLimit=100</span><br><span class="line">store.db.lockTable=lock_table</span><br><span class="line">store.db.maxWait=5000</span><br><span class="line"></span><br><span class="line">#These configurations are required if the `store mode` is `redis`. If `store.mode,store.lock.mode,store.session.mode` are not equal to `redis`, you can remove the configuration block.</span><br><span class="line">store.redis.mode=single</span><br><span class="line">store.redis.type=pipeline</span><br><span class="line">store.redis.single.host=127.0.0.1</span><br><span class="line">store.redis.single.port=6379</span><br><span class="line">store.redis.sentinel.masterName=</span><br><span class="line">store.redis.sentinel.sentinelHosts=</span><br><span class="line">store.redis.sentinel.sentinelPassword=</span><br><span class="line">store.redis.maxConn=10</span><br><span class="line">store.redis.minConn=1</span><br><span class="line">store.redis.maxTotal=100</span><br><span class="line">store.redis.database=0</span><br><span class="line">store.redis.password=</span><br><span class="line">store.redis.queryLimit=100</span><br><span class="line"></span><br><span class="line">#Transaction rule configuration, only for the server</span><br><span class="line">server.recovery.committingRetryPeriod=1000</span><br><span class="line">server.recovery.asynCommittingRetryPeriod=1000</span><br><span class="line">server.recovery.rollbackingRetryPeriod=1000</span><br><span class="line">server.recovery.timeoutRetryPeriod=1000</span><br><span class="line">server.maxCommitRetryTimeout=-1</span><br><span class="line">server.maxRollbackRetryTimeout=-1</span><br><span class="line">server.rollbackRetryTimeoutUnlockEnable=false</span><br><span class="line">server.distributedLockExpireTime=10000</span><br><span class="line">server.session.branchAsyncQueueSize=5000</span><br><span class="line">server.session.enableBranchAsyncRemove=false</span><br><span class="line">server.enableParallelRequestHandle=true</span><br><span class="line">server.enableParallelHandleBranch=false</span><br><span class="line"></span><br><span class="line">server.raft.cluster=127.0.0.1:7091,127.0.0.1:7092,127.0.0.1:7093</span><br><span class="line">server.raft.snapshotInterval=600</span><br><span class="line">server.raft.applyBatch=32</span><br><span class="line">server.raft.maxAppendBufferSize=262144</span><br><span class="line">server.raft.maxReplicatorInflightMsgs=256</span><br><span class="line">server.raft.disruptorBufferSize=16384</span><br><span class="line">server.raft.electionTimeoutMs=2000</span><br><span class="line">server.raft.reporterEnabled=false</span><br><span class="line">server.raft.reporterInitialDelay=60</span><br><span class="line">server.raft.serialization=jackson</span><br><span class="line">server.raft.compressor=none</span><br><span class="line">server.raft.sync=true</span><br><span class="line"></span><br><span class="line">#Metrics configuration, only for the server</span><br><span class="line">metrics.enabled=false</span><br><span class="line">metrics.registryType=compact</span><br><span class="line">metrics.exporterList=prometheus</span><br><span class="line">metrics.exporterPrometheusPort=9898</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼š</p>
<p>1ã€å…¶ä¸­çš„æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç éƒ½éœ€è¦ä¿®æ”¹æˆä½ è‡ªå·±çš„æ•°æ®åº“ä¿¡æ¯</p>
<p>2ã€æ·»åŠ useSSL=falseå‚æ•°ï¼Œå…³é—­å®‰å…¨é“¾æ¥</p>
<p>3ã€å¦‚æœä½¿ç”¨çš„æ˜¯mysql8ï¼Œéœ€è¦æŒ‡å®šmysql8çš„é©±åŠ¨ï¼šcom.mysql.cj.jdbc.Driver</p>
<p>4ã€æ³¨æ„jdkç‰ˆæœ¬æ˜¯8æˆ–è€…11ï¼Œå…¶ä»–çš„jdkç‰ˆæœ¬å¯èƒ½å¯¼è‡´å‡ºç°é—®é¢˜<br>
5ã€åˆ›å»ºæ•°æ®åº“è¡¨</p>
<blockquote>
<p>ç‰¹åˆ«æ³¨æ„ï¼štcæœåŠ¡åœ¨ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œéœ€è¦è®°å½•äº‹åŠ¡ç›¸å…³æ•°æ®åˆ°æ•°æ®åº“ä¸­ï¼Œä½ éœ€è¦æå‰åˆ›å»ºå¥½è¿™äº›è¡¨ã€‚<br>
æ–°å»ºä¸€ä¸ªåä¸ºseataçš„æ•°æ®åº“ï¼Œè¿è¡Œscript\server\db\mysql.sqlè„šæœ¬æ–‡ä»¶ã€‚</p>
</blockquote>
<ul>
<li>å¯åŠ¨seata:<br>
æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®seataåå°ç®¡ç†ç³»ç»Ÿã€‚åœ°å€ï¼š<a href="http://localhost:7091">http://localhost:7091</a>ï¼Œç”¨æˆ·å/å¯†ç : seata/seata</li>
</ul>
<h3 id="3-å¼•å…¥ä¾èµ–">3. å¼•å…¥ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--Seataä¾èµ–  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ä½¿ç”¨2.0.0çš„seataçš„ç‰ˆæœ¬--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-æ·»åŠ å…¬å…±é…ç½®">4. æ·»åŠ å…¬å…±é…ç½®</h3>
<ul>
<li>åœ¨nacosé…ç½®ä¸­å¿ƒä¸Šæ·»åŠ seataçš„tcæœåŠ¡çš„å…¬å…±é…ç½®ï¼šdata-id=seata-common.yaml   group=SEATA_GROUP</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="comment"># é…ç½®seata-serveråœ¨nacosæ³¨å†Œä¸­å¿ƒä¸Šçš„ä¿¡æ¯</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">namespace:</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">SEATA_GROUP</span></span><br><span class="line">      <span class="attr">application:</span> <span class="string">seata-server</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.136</span><span class="number">.145</span><span class="string">:8848</span></span><br><span class="line">  <span class="comment"># é…ç½®äº‹åŠ¡ç»„çš„åç§°ï¼Œéœ€è¦å’ŒseataæœåŠ¡ç«¯çš„é…ç½®ä¿æŒä¸€è‡´</span></span><br><span class="line">  <span class="attr">tx-service-group:</span> <span class="string">default_tx_group</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">vgroup-mapping:</span></span><br><span class="line">      <span class="attr">default_tx_group:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">data-source-proxy-mode:</span> <span class="string">XA</span>   <span class="comment"># é…ç½®äº‹åŠ¡ç®¡ç†æ¨¡å¼ä¸ºxaæ¨¡å¼</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring.cloud.nacos.config.shared-configs[0].data-id=seata-common.yaml</span><br><span class="line">spring.cloud.nacos.config.shared-configs[0].group=SEATA_GROUP</span><br></pre></td></tr></table></figure>
<h3 id="5-ä½¿ç”¨">5. ä½¿ç”¨</h3>
<p>@GlobalTransactional<br>
åœ¨BusinessServiceImplçš„addæ–¹æ³•ä¸Šæ·»åŠ @GlobalTransactionalæ³¨è§£ï¼Œå£°æ˜å½“å‰æ–¹æ³•æ˜¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡æ–¹æ³•ã€‚</p>
<h1>XAåŸç†</h1>
<p>XAè§„èŒƒæ˜¯X/Open ç»„ç»‡å®šä¹‰çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ï¼ˆDTPï¼ŒDistributed Transaction Processingï¼‰æ ‡å‡†ã€‚</p>
<p>XAè§„èŒƒæè¿°äº†å…¨å±€çš„äº‹åŠ¡ç®¡ç†å™¨ä¸å±€éƒ¨çš„èµ„æºç®¡ç†å™¨ä¹‹é—´çš„æ¥å£ã€‚ XAè§„èŒƒçš„ç›®çš„æ˜¯å…è®¸çš„å¤šä¸ªèµ„æºï¼ˆå¦‚æ•°æ®åº“ï¼Œåº”ç”¨æœåŠ¡å™¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰åœ¨åŒä¸€äº‹åŠ¡ä¸­è®¿é—®ï¼Œè¿™æ ·å¯ä»¥ä½¿</p>
<p>ACIDå±æ€§è·¨è¶Šåº”ç”¨ç¨‹åºè€Œä¿æŒæœ‰æ•ˆã€‚</p>
<p>XAè§„èŒƒä½¿ç”¨ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼ŒTwo-Phase Commitï¼‰æ¥ä¿è¯æ‰€æœ‰èµ„æºåŒæ—¶æäº¤æˆ–å›æ»šä»»ä½•ç‰¹å®šçš„äº‹åŠ¡ã€‚</p>
<p>XAè§„èŒƒåœ¨ä¸Šä¸–çºª 90 å¹´ä»£åˆå°±è¢«æå‡ºã€‚ç›®å‰ï¼Œå‡ ä¹æ‰€æœ‰ä¸»æµçš„æ•°æ®åº“(MySQLã€Oracle)éƒ½å¯¹ XA è§„èŒƒ æä¾›äº†æ”¯æŒã€‚</p>
<h2 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h2>
<p>åœ¨ Seata å®šä¹‰çš„åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶å†…ï¼Œåˆ©ç”¨äº‹åŠ¡èµ„æºï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯æœåŠ¡ç­‰ï¼‰å¯¹XAåè®®çš„æ”¯æŒï¼Œä»¥XAåè®®çš„æœºåˆ¶æ¥ç®¡ç†åˆ†æ”¯äº‹åŠ¡çš„ä¸€ç§äº‹åŠ¡æ¨¡å¼ã€‚<br>
<img src="http://120.26.79.238:9000/blog/img/098e4a093965a9b27dbf05d93e38201e.png" alt=""></p>
<ul>
<li>å·¥ä½œæµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ul>
<p><strong>RMä¸€é˜¶æ®µçš„å·¥ä½œ</strong>ï¼š</p>
<p>1ã€æ³¨å†Œåˆ†æ”¯äº‹åŠ¡åˆ°TC</p>
<p>2ã€æ‰§è¡Œåˆ†æ”¯ä¸šåŠ¡sqlä½†ä¸æäº¤</p>
<p>3ã€æŠ¥å‘Šæ‰§è¡ŒçŠ¶æ€åˆ°TC</p>
<p><strong>TCäºŒé˜¶æ®µçš„å·¥ä½œ</strong>ï¼šTCæ£€æµ‹å„åˆ†æ”¯äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€</p>
<p>a.å¦‚æœéƒ½æˆåŠŸï¼Œé€šçŸ¥æ‰€æœ‰RMæäº¤äº‹åŠ¡</p>
<p>b.å¦‚æœæœ‰å¤±è´¥ï¼Œé€šçŸ¥æ‰€æœ‰RMå›æ»šäº‹åŠ¡</p>
<p><strong>RMäºŒé˜¶æ®µçš„å·¥ä½œ</strong>ï¼šæ¥æ”¶TCæŒ‡ä»¤ï¼Œæäº¤æˆ–å›æ»šäº‹åŠ¡</p>
<ul>
<li>
<p>æ­£å¸¸æƒ…å†µï¼š<br>
<img src="http://120.26.79.238:9000/blog/img/4bd77fdbe3836562005674bbb6f94427.png" alt=""></p>
</li>
<li>
<p>å¼‚å¸¸æƒ…å†µï¼š<br>
<img src="http://120.26.79.238:9000/blog/img/9e20a6800eaf8f7b03337a042e66a3cc.png" alt=""></p>
</li>
</ul>
<h2 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h2>
<ul>
<li>XAæ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ul>
<p>1ã€ä¸šåŠ¡æ— ä¾µå…¥ï¼šå’Œ AT ä¸€æ ·ï¼ŒXA æ¨¡å¼å°†æ˜¯ä¸šåŠ¡æ— ä¾µå…¥çš„ï¼Œä¸ç»™åº”ç”¨è®¾è®¡å’Œå¼€å‘å¸¦æ¥é¢å¤–è´Ÿæ‹…ã€‚</p>
<p>2ã€äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ï¼Œæ»¡è¶³ACIDåŸåˆ™ã€‚</p>
<p>3ã€æ•°æ®åº“çš„æ”¯æŒå¹¿æ³›ï¼šXA åè®®è¢«ä¸»æµå…³ç³»å‹æ•°æ®åº“å¹¿æ³›æ”¯æŒï¼Œä¸éœ€è¦é¢å¤–çš„é€‚é…å³å¯ä½¿ç”¨ã€‚</p>
<ul>
<li>XAæ¨¡å¼çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ul>
<p>XA prepareåï¼Œåˆ†æ”¯äº‹åŠ¡è¿›å…¥é˜»å¡é˜¶æ®µï¼Œæ”¶åˆ°XA commit æˆ– XA rollback å‰å¿…é¡»é˜»å¡ç­‰å¾…ã€‚äº‹åŠ¡èµ„æºé•¿æ—¶é—´å¾—ä¸åˆ°é‡Šæ”¾ï¼Œé”å®šå‘¨æœŸé•¿ï¼Œè€Œä¸”åœ¨åº”ç”¨å±‚ä¸Šé¢æ— æ³•å¹²é¢„ï¼Œæ€§èƒ½å·®ã€‚</p>
<h1>ATæ¨¡å¼</h1>
<p>æ›´æ”¹nacosä¸­seata-common.yamlçš„é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line"><span class="attr">data-source-proxy-mode:</span> <span class="string">AT</span>          <span class="comment"># ä½¿ç”¨Seataæ¡†æ¶çš„ATæ¨¡å¼ï¼Œé»˜è®¤æ˜¯ATæ¨¡å¼</span></span><br></pre></td></tr></table></figure>
<p>é‡å¯æœåŠ¡è¿›è¡Œæµ‹è¯•ã€‚</p>
<h2 id="åŸç†ä»‹ç»">åŸç†ä»‹ç»</h2>
<p><img src="http://120.26.79.238:9000/blog/img/883e33edda608618b89a9a8614d808fd.png" alt=""></p>
<ul>
<li>å·¥ä½œæµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ul>
<p><strong>é˜¶æ®µä¸€RMçš„å·¥ä½œï¼š</strong></p>
<p>1ã€æ³¨å†Œåˆ†æ”¯äº‹åŠ¡</p>
<p>2ã€è®°å½•undo-logï¼ˆæ•°æ®å¿«ç…§ï¼šè®°å½•æŸä¸€æ—¶åˆ»æ•°æ®çš„çŠ¶æ€ï¼‰</p>
<p>3ã€æ‰§è¡Œä¸šåŠ¡sqlå¹¶æäº¤</p>
<p>4ã€æŠ¥å‘Šäº‹åŠ¡çŠ¶æ€</p>
<p><strong>é˜¶æ®µäºŒæäº¤æ—¶RMçš„å·¥ä½œ</strong>ï¼šåˆ é™¤undo-logå³å¯</p>
<p><strong>é˜¶æ®µäºŒå›æ»šæ—¶RMçš„å·¥ä½œ</strong>ï¼šæ ¹æ®undo-logæ¢å¤æ•°æ®åˆ°æ›´æ–°å‰</p>
<h2 id="æµç¨‹æ¢³ç†">æµç¨‹æ¢³ç†</h2>
<p>ATæ¨¡å¼ä¸‹ï¼Œå½“å‰åˆ†æ”¯äº‹åŠ¡æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<h3 id="ä¸€é˜¶æ®µï¼š">ä¸€é˜¶æ®µï¼š</h3>
<p>1ï¼‰TMå‘èµ·å¹¶æ³¨å†Œå…¨å±€äº‹åŠ¡åˆ°TC</p>
<p>2ï¼‰TMè°ƒç”¨åˆ†æ”¯äº‹åŠ¡</p>
<p>3ï¼‰åˆ†æ”¯äº‹åŠ¡å‡†å¤‡æ‰§è¡Œä¸šåŠ¡SQL</p>
<p>4ï¼‰RMæ‹¦æˆªä¸šåŠ¡SQLï¼Œæ ¹æ®whereæ¡ä»¶æŸ¥è¯¢åŸå§‹æ•°æ®ï¼Œå½¢æˆå¿«ç…§ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;money&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>5ï¼‰RMæ‰§è¡Œä¸šåŠ¡SQLï¼Œæäº¤æœ¬åœ°äº‹åŠ¡ï¼Œé‡Šæ”¾æ•°æ®åº“é”ã€‚æ­¤æ—¶ money = 90</p>
<p>6ï¼‰RMæŠ¥å‘Šæœ¬åœ°äº‹åŠ¡çŠ¶æ€ç»™TC</p>
<h3 id="äºŒé˜¶æ®µï¼š">äºŒé˜¶æ®µï¼š</h3>
<p>1ï¼‰TMé€šçŸ¥TCäº‹åŠ¡ç»“æŸ</p>
<p>2ï¼‰TCæ£€æŸ¥åˆ†æ”¯äº‹åŠ¡çŠ¶æ€</p>
<p>2.1 å¦‚æœéƒ½æˆåŠŸï¼Œåˆ™ç«‹å³åˆ é™¤å¿«ç…§</p>
<p>2.2 å¦‚æœæœ‰åˆ†æ”¯äº‹åŠ¡å¤±è´¥ï¼Œéœ€è¦å›æ»šã€‚è¯»å–å¿«ç…§æ•°æ®ï¼ˆ{â€œidâ€: 1, â€œmoneyâ€: 100}ï¼‰ï¼Œå°†å¿«ç…§æ¢å¤åˆ°æ•°æ®åº“ã€‚æ­¤æ—¶æ•°æ®åº“å†æ¬¡æ¢å¤ä¸º100</p>
<p><img src="http://120.26.79.238:9000/blog/img/a434854772308504fab555287337eb29.png" alt=""></p>
<p><img src="http://120.26.79.238:9000/blog/img/d5ee70dc3dec24d1a2ffdaaa63ecb242.png" alt=""></p>
<h2 id="ATä¸XAçš„åŒºåˆ«">ATä¸XAçš„åŒºåˆ«</h2>
<p>ç®€è¿°ATæ¨¡å¼ä¸XAæ¨¡å¼æœ€å¤§çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>1ã€XAæ¨¡å¼ä¸€é˜¶æ®µä¸æäº¤äº‹åŠ¡ï¼Œé”å®šèµ„æºï¼›ATæ¨¡å¼ä¸€é˜¶æ®µç›´æ¥æäº¤ï¼Œä¸é”å®šèµ„æºã€‚</p>
<p>2ã€XAæ¨¡å¼ä¾èµ–æ•°æ®åº“æœºåˆ¶å®ç°å›æ»šï¼›ATæ¨¡å¼åˆ©ç”¨æ•°æ®å¿«ç…§å®ç°æ•°æ®å›æ»šã€‚(undo_logè¡¨(å¿«ç…§))</p>
<p>3ã€XAæ¨¡å¼å¼ºä¸€è‡´ï¼›ATæ¨¡å¼æœ€ç»ˆä¸€è‡´</p>
<h2 id="è„å†™é—®é¢˜">è„å†™é—®é¢˜</h2>
<h3 id="é—®é¢˜ä»‹ç»">é—®é¢˜ä»‹ç»</h3>
<p>åœ¨å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ATæ¨¡å¼çš„åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œæœ‰å¯èƒ½å‡ºç°ä¸¢å¤±æ›´æ–°é—®é¢˜ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/1f43a45b40f83b2146fae8e97e9b4bc7.png" alt=""></p>
<h3 id="å…¨å±€é”">å…¨å±€é”</h3>
<p>è§£å†³æ€è·¯å°±æ˜¯å¼•å…¥äº†å…¨å±€é”çš„æ¦‚å¿µã€‚åœ¨é‡Šæ”¾DBé”ä¹‹å‰ï¼Œå…ˆæ‹¿åˆ°å…¨å±€é”ã€‚é¿å…åŒä¸€æ—¶åˆ»æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ¥æ“ä½œå½“å‰æ•°æ®ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>tx1 å…ˆå¼€å§‹ï¼Œå¼€å¯æœ¬åœ°äº‹åŠ¡ï¼Œæ‹¿åˆ°æœ¬åœ°é”ï¼Œæ›´æ–°æ“ä½œ m = 1000 - 100 = 900ã€‚æœ¬åœ°äº‹åŠ¡æäº¤å‰ï¼Œå…ˆæ‹¿åˆ°è¯¥è®°å½•çš„ å…¨å±€é” ï¼Œæœ¬åœ°æäº¤é‡Šæ”¾æœ¬åœ°é”ã€‚ tx2 åå¼€å§‹ï¼Œå¼€å¯æœ¬åœ°äº‹åŠ¡ï¼Œæ‹¿åˆ°æœ¬åœ°é”ï¼Œæ›´æ–°æ“ä½œ m = 900 - 100 = 800ã€‚æœ¬åœ°äº‹åŠ¡æäº¤å‰ï¼Œå°è¯•æ‹¿è¯¥è®°å½•çš„ å…¨å±€é” ï¼Œtx1 å…¨å±€æäº¤å‰ï¼Œè¯¥è®°å½•çš„å…¨å±€é”è¢« tx1 æŒæœ‰ï¼Œtx2 éœ€è¦é‡è¯•ç­‰å¾… å…¨å±€é” ã€‚</p>
<p>tx1 äºŒé˜¶æ®µå…¨å±€æäº¤ï¼Œé‡Šæ”¾ å…¨å±€é” ã€‚tx2 æ‹¿åˆ° å…¨å±€é” æäº¤æœ¬åœ°äº‹åŠ¡ã€‚</p>
<p>å¦‚æœ tx1 çš„äºŒé˜¶æ®µå…¨å±€å›æ»šï¼Œåˆ™tx1éœ€è¦é‡æ–°è·å–è¯¥æ•°æ®çš„æœ¬åœ°é”ï¼Œè¿›è¡Œåå‘è¡¥å¿çš„æ›´æ–°æ“ä½œï¼Œå®ç°åˆ†æ”¯çš„å›æ»šã€‚æ­¤æ—¶ï¼Œå¦‚æœtx2ä»åœ¨ç­‰å¾…è¯¥æ•°æ®çš„ å…¨å±€é”ï¼ŒåŒæ—¶æŒæœ‰æœ¬åœ°é”ï¼Œåˆ™tx1çš„åˆ†æ”¯å›æ»šä¼šå¤±è´¥ã€‚åˆ†æ”¯çš„å›æ»šä¼šä¸€ç›´é‡è¯•ï¼Œç›´åˆ°tx2çš„ å…¨å±€é” ç­‰é”è¶…æ—¶ï¼Œæ”¾å¼ƒ å…¨å±€é” å¹¶å›æ»šæœ¬åœ°äº‹åŠ¡é‡Šæ”¾æœ¬åœ°é”ï¼Œtx1 çš„åˆ†æ”¯å›æ»šæœ€ç»ˆæˆåŠŸã€‚</p>
<p>ä¸ºæ•´ä¸ªè¿‡ç¨‹ å…¨å±€é” åœ¨ tx1 ç»“æŸå‰ä¸€ç›´æ˜¯è¢« tx1 æŒæœ‰çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿ è„å†™ çš„é—®é¢˜ã€‚</p>
<p>æ€è€ƒé—®é¢˜ï¼šæ¯ä¸€ä¸ªå¾®æœåŠ¡ä¸­æ‰€æä¾›çš„undo_logè¡¨çš„ä½œç”¨ã€ä»¥åŠseataæ•°æ®åº“ä¸­æ‰€å¯¹åº”çš„è¡¨çš„ä½œç”¨åˆ†è¡¨æ˜¯ä»€ä¹ˆ?</p>
<h1>TCCæ¨¡å¼</h1>
<h2 id="TCCæ¨¡å¼æ¦‚è¿°">TCCæ¨¡å¼æ¦‚è¿°</h2>
<p>TCCæ¨¡å¼ä¸ATæ¨¡å¼éå¸¸ç›¸ä¼¼ï¼Œæ¯é˜¶æ®µéƒ½æ˜¯ç‹¬ç«‹äº‹åŠ¡ï¼Œä¸åŒçš„æ˜¯TCCé€šè¿‡<strong>äººå·¥ç¼–ç </strong>æ¥å®ç°æ•°æ®æ¢å¤ã€‚éœ€è¦å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<p>1ã€Tryï¼šèµ„æºçš„æ£€æµ‹å’Œé¢„ç•™ï¼›</p>
<p>2ã€Confirmï¼šå®Œæˆèµ„æºæ“ä½œä¸šåŠ¡ï¼›è¦æ±‚ Try æˆåŠŸ Confirm ä¸€å®šè¦èƒ½æˆåŠŸã€‚</p>
<p>3ã€Cancelï¼šé¢„ç•™èµ„æºé‡Šæ”¾ï¼Œå¯ä»¥ç†è§£ä¸ºtryçš„åå‘æ“ä½œã€‚</p>
<h2 id="æµç¨‹åˆ†æ">æµç¨‹åˆ†æ</h2>
<p>ä¸¾ä¾‹ï¼Œä¸€ä¸ªæ‰£å‡ç”¨æˆ·ä½™é¢çš„ä¸šåŠ¡ã€‚å‡è®¾è´¦æˆ·AåŸæ¥ä½™é¢æ˜¯100ï¼Œéœ€è¦ä½™é¢æ‰£å‡30å…ƒã€‚</p>
<p><strong>é˜¶æ®µä¸€ï¼ˆ Try ï¼‰</strong>ï¼šæ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³ï¼Œå¦‚æœå……è¶³åˆ™å†»ç»“é‡‘é¢å¢åŠ 30å…ƒï¼Œå¯ç”¨ä½™é¢æ‰£é™¤30</p>
<p>åˆè¯†ä½™é¢ï¼š<br>
<img src="http://120.26.79.238:9000/blog/img/bfcf35531d2f9f6ccb02e133b7d776c1.png" alt=""></p>
<p>ä½™é¢å……è¶³ï¼Œå¯ä»¥å†»ç»“ï¼š<br>
<img src="http://120.26.79.238:9000/blog/img/6431cfac8b9f19d26b8230bd0fe0a9b8.png" alt=""></p>
<p>æ­¤æ—¶ï¼Œæ€»é‡‘é¢ = å†»ç»“é‡‘é¢ + å¯ç”¨é‡‘é¢ï¼Œæ•°é‡ä¾ç„¶æ˜¯100ä¸å˜ã€‚äº‹åŠ¡ç›´æ¥æäº¤æ— éœ€ç­‰å¾…å…¶å®ƒäº‹åŠ¡ã€‚</p>
<p><strong>é˜¶æ®µäºŒï¼ˆConfirm)</strong>ï¼šå‡å¦‚è¦æäº¤ï¼ˆConfirmï¼‰ï¼Œåˆ™å†»ç»“é‡‘é¢æ‰£å‡30</p>
<p>ç¡®è®¤å¯ä»¥æäº¤ï¼Œä¸è¿‡ä¹‹å‰å¯ç”¨é‡‘é¢å·²ç»æ‰£å‡è¿‡äº†ï¼Œè¿™é‡Œåªè¦æ¸…é™¤å†»ç»“é‡‘é¢å°±å¥½äº†ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/751ecd147e82aef38e0a52ff7914a1a8.png" alt=""></p>
<p>æ­¤æ—¶ï¼Œæ€»é‡‘é¢ = å†»ç»“é‡‘é¢ + å¯ç”¨é‡‘é¢ = 0 + 70  = 70å…ƒ</p>
<p><strong>é˜¶æ®µäºŒ(Canncel)</strong>ï¼šå¦‚æœè¦å›æ»šï¼ˆCancelï¼‰ï¼Œåˆ™å†»ç»“é‡‘é¢æ‰£å‡30ï¼Œå¯ç”¨ä½™é¢å¢åŠ 30</p>
<p>éœ€è¦å›æ»šï¼Œé‚£ä¹ˆå°±è¦é‡Šæ”¾å†»ç»“é‡‘é¢ï¼Œæ¢å¤å¯ç”¨é‡‘é¢ï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/301479a856a77e47521610c8dc8038d7.png" alt=""></p>
<h2 id="7-3-åŸç†ä»‹ç»">7.3 åŸç†ä»‹ç»</h2>
<p>å·¥ä½œæ¨¡å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/bfa02782458a9a4ba2d677002031a441.png" alt=""></p>
<h2 id="7-4-ä¼˜ç¼ºç‚¹">7.4 ä¼˜ç¼ºç‚¹</h2>
<p>TCCæ¨¡å¼çš„æ¯ä¸ªé˜¶æ®µæ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</p>
<ul>
<li>Tryï¼šèµ„æºæ£€æŸ¥å’Œé¢„ç•™</li>
<li>Confirmï¼šä¸šåŠ¡æ‰§è¡Œå’Œæäº¤</li>
<li>Cancelï¼šé¢„ç•™èµ„æºçš„é‡Šæ”¾</li>
</ul>
<p>TCCçš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>ä¸€é˜¶æ®µå®Œæˆç›´æ¥æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾æ•°æ®åº“èµ„æºï¼Œæ€§èƒ½å¥½</li>
<li>ç›¸æ¯”ATæ¨¡å‹ï¼Œæ— éœ€ç”Ÿæˆå¿«ç…§ï¼Œæ— éœ€ä½¿ç”¨å…¨å±€é”ï¼Œ<strong>æ€§èƒ½æœ€å¼º</strong></li>
<li><strong>ä¸ä¾èµ–æ•°æ®åº“äº‹åŠ¡</strong>ï¼Œè€Œæ˜¯ä¾èµ–è¡¥å¿æ“ä½œï¼Œå¯ä»¥ç”¨äºéäº‹åŠ¡å‹æ•°æ®åº“</li>
</ul>
<p>TCCçš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>æœ‰ä»£ç ä¾µå…¥ï¼Œéœ€è¦äººä¸ºç¼–å†™tryã€Confirmå’ŒCancelæ¥å£ï¼Œå¤ªéº»çƒ¦</li>
<li>è½¯çŠ¶æ€ï¼Œäº‹åŠ¡æ˜¯æœ€ç»ˆä¸€è‡´</li>
</ul>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>springç›¸å…³æ³¨è§£</title>
    <url>/2025/09/15/spring%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3/</url>
    <content><![CDATA[<ol>
<li><strong>IoC</strong> (æ§åˆ¶åè½¬) å’Œ ä¾èµ–æ³¨å…¥</li>
</ol>
<h2 id="Spring-æ ¸å¿ƒæ³¨è§£">Spring æ ¸å¿ƒæ³¨è§£:</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ ‡è®°ç±»ä¸º Spring å®¹å™¨ç®¡ç†çš„ Beanï¼Œå…¶é»˜è®¤çš„ Bean åç§°ç”±ç±»åæ´¾ç”Ÿè€Œæ¥ã€‚</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ Spring æ³¨è§£ã€‚</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">// æŒä¹…å±‚æ³¨è§£</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="comment">// æ ‡è®°ç±»ä¸ºä¸€ä¸ªæ§åˆ¶å™¨ Beanã€‚é€šå¸¸ç”¨äº Web å±‚çš„ç»„ä»¶ã€‚</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// JDKæä¾›çš„ä¾èµ–æ³¨å…¥æ³¨è§£ï¼Œé»˜è®¤æ ¹æ®name</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ‡è®°ä¾èµ–æ³¨å…¥ï¼Œæ˜¯ Spring æ¡†æ¶ä¸­æœ€å¸¸ç”¨çš„ä¾èµ–æ³¨å…¥æ–¹å¼ã€‚</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‹¥ä¸€ä¸ªæ¥å£æœ‰å¤šä¸ªå®ç°ç±»ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šnameæ¥æ³¨å…¥</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;name&quot;)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šè¦æ‰«æçš„åŒ…ä»¥å‘ç°å¸¦æœ‰ @Component ç­‰æ³¨è§£çš„ç±»ã€‚</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;online.zorange.define_components&quot;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šå±æ€§æ–‡ä»¶çš„ä½ç½®ï¼Œè¯¥æ–‡ä»¶ä¸­åŒ…å«äº†é…ç½®ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ‡è®°ç±»ä¸ºé…ç½®ç±»ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª @Bean æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥å…¶ä»–é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">@import(&quot;ConfigB.&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">myConditionå®ç°Conditionæ¥å£ï¼Œå®ç°matchæ–¹æ³•ï¼Œ</span></span><br><span class="line"><span class="comment">å¦‚æœè¿”å›ä¸ºtrueï¼Œåˆ™æ³¨å…¥beanï¼Œå¦‚æœä¸ºfalseï¼Œåˆ™ä¸æ³¨å…¥</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="meta">@conditional(&#123;myCondition.class,....&#125;)</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">// å®šä¹‰ä¸€ä¸ª Bean å¯¹è±¡ï¼Œè¿”å›ç±»å‹å³ä¸º Bean ç±»å‹ã€‚</span></span><br><span class="line"><span class="string">@Bean</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// ä»é…ç½®æ–‡ä»¶ä¸­è·å–æŒ‡å®šå±æ€§çš„å€¼ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°å­—æ®µæˆ–æ–¹æ³•å‚æ•°ä¸­ã€‚</span></span><br><span class="line"><span class="string">@Value(&quot;$&#123;name&#125;&quot;)</span></span><br></pre></td></tr></table></figure>
<h2 id="2-AOP-é¢å‘åˆ‡é¢ç¼–ç¨‹">2. <strong>AOP</strong> (é¢å‘åˆ‡é¢ç¼–ç¨‹)</h2>
<p>Spring AOP æ³¨è§£:</p>
   <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ ‡è®°ç±»ä¸ºä¸€ä¸ªåˆ‡é¢ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªé€šçŸ¥ï¼ˆAdviceï¼‰ã€‚</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…ç›®æ ‡æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(public int online.zorange.annotation.CalculatorImpl.*(..))&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ–¹æ³•æ‰§è¡Œå‰è§¦å‘çš„é€šçŸ¥ã€‚</span></span><br><span class="line"><span class="meta">@Before(&quot;pointCut()&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ–¹æ³•æ‰§è¡Œåè§¦å‘çš„é€šçŸ¥ã€‚</span></span><br><span class="line"><span class="meta">@After(&quot;pointCut()&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ–¹æ³•æ­£å¸¸è¿”å›åè§¦å‘çš„é€šçŸ¥ï¼Œå¯ä»¥è·å–åˆ°è¿”å›ç»“æœã€‚</span></span><br><span class="line"><span class="meta">@AfterReturning(value = &quot;pointCut()&quot;, returning = &quot;result&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè§¦å‘çš„é€šçŸ¥ï¼Œå¯ä»¥è·å–åˆ°å¼‚å¸¸å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="meta">@AfterThrowing(pointcut = &quot;pointCut()&quot;, throwing = &quot;e&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¯ç»•é€šçŸ¥ï¼Œåœ¨æ–¹æ³•è°ƒç”¨å‰åéƒ½ä¼šè§¦å‘ã€‚</span></span><br><span class="line"><span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br></pre></td></tr></table></figure>
<h2 id="3-JUnit-æµ‹è¯•">3. <strong>JUnit æµ‹è¯•</strong></h2>
<p>Spring æµ‹è¯•æ³¨è§£:</p>
   <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é…ç½® Spring æµ‹è¯•ä¸Šä¸‹æ–‡ï¼ŒæŒ‡å®š Spring é…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚</span></span><br><span class="line"><span class="meta">@SpringJUnitConfig(locations = &quot;classpath:JDBCTemplate.xml&quot;)</span></span><br></pre></td></tr></table></figure>
<h2 id="4-äº‹åŠ¡ç®¡ç†">4. <strong>äº‹åŠ¡ç®¡ç†</strong></h2>
<p>Spring äº‹åŠ¡ç®¡ç†æ³¨è§£:</p>
   <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”¨äºæ ‡è®°æ–¹æ³•éœ€è¦å¼€å¯äº‹åŠ¡ç®¡ç†ã€‚</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br></pre></td></tr></table></figure>
<h2 id="5-Spring-MVC">5. <strong>Spring-MVC</strong></h2>
   <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// ä¸ºæ¯ä¸ªæ–¹æ³•é»˜è®¤åŠ ä¸Š@ResponseBodyæ³¨è§£</span></span><br><span class="line"> <span class="meta">@RestController</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// å°†åç«¯å¯¹è±¡è½¬ä¸ºjsonå¯¹è±¡</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="comment">// å°†å‰ç«¯jsonè½¬ä¸ºåç«¯å¯¹è±¡</span></span><br><span class="line"> <span class="meta">@RequestBody</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// è®¾ç½®èµ„æºè·¯å¾„</span></span><br><span class="line"> <span class="meta">@RequestMapping(&quot;/hello&quot;,method=RequestMethod[].class)</span></span><br><span class="line"> <span class="comment">// è·å–è¯·æ±‚å¤´ä¸­çš„æ•°æ®</span></span><br><span class="line"> <span class="meta">@RequestHeader(value=&quot;&quot;,requier=&quot;&quot;)</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// è·å–è¯·æ±‚å¤´ä¸­çš„cookie</span></span><br><span class="line"> <span class="meta">@CookieValue(value=&quot;&quot;)</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// æ¥æ”¶Paramå‚æ•°,</span></span><br><span class="line"> <span class="meta">@RequestParam(value=&quot;name&quot;,required=&quot;true&quot;,defaultValue=&quot;orange&quot;)</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// æ¥æ”¶è·¯å¾„ä¸­çš„å‚æ•°ï¼Œå°†è·¯å¾„å ä½ç¬¦ç»‘å®šåˆ°ç›®æ ‡æ–¹æ³•çš„å‚æ•°ä¸Š</span></span><br><span class="line"> <span class="comment">//valueã€require</span></span><br><span class="line"> <span class="meta">@PathVariable(&quot;id&quot;)</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// æ¥æ”¶è¯·æ±‚ä½“ä¸­çš„å‚æ•° json</span></span><br><span class="line"> <span class="meta">@RequestBody(&quot;name&quot;)</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// é»˜è®¤æŒ‡å®šæ–¹æ³•çš„èµ„æºè·¯å¾„æ³¨è§£ RESTFul f</span></span><br><span class="line"> <span class="meta">@GetMapping(&quot;/&quot;)</span>  <span class="meta">@PostMapping(&quot;/&quot;)</span>  <span class="meta">@Put</span>- <span class="meta">@Delete</span>- <span class="meta">@Update</span>- </span><br><span class="line">     </span><br><span class="line"> <span class="comment">// è§£å†³è·¨åŸŸw</span></span><br><span class="line"> <span class="meta">@CrossOrigin</span></span><br><span class="line">    </span><br><span class="line">     </span><br><span class="line"> <span class="comment">// å‚æ•°æ ¡éªŒ</span></span><br><span class="line"> <span class="meta">@Validated</span>   <span class="comment">//BindingResult result æ¥æ”¶æ ¡éªŒç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–cookie</span></span><br><span class="line"><span class="meta">@CookieValue</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¼‚å¸¸å¤„ç†</p>
   <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// æ§åˆ¶å™¨é€šçŸ¥</span></span><br><span class="line"> <span class="meta">@RestControllerAdvice</span></span><br><span class="line"> <span class="comment">// å¤„ç†çš„å¼‚å¸¸ç±»å‹</span></span><br><span class="line"> <span class="meta">@ExceptionHandler(ServiceException.class)</span></span><br><span class="line"><span class="comment">//æŠ›å‡ºå¼‚å¸¸ï¼ˆç±»ä¼¼Throws ï¼‰ä¸”åœ¨å‡ºå£ä¸ç”¨å¤„ç†</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br></pre></td></tr></table></figure>
<h2 id="spring-cloud-æ³¨è§£">spring cloud æ³¨è§£</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@LoadBalanced</span>   <span class="comment">//è®©Resttmplateå…·æœ‰è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</span></span><br><span class="line"><span class="comment">// å°†è´Ÿè½½å‡è¡¡ç®—æ³•åº”ç”¨åˆ°æŒ‡å®šçš„æœåŠ¡æä¾›æ–¹ä¸­</span></span><br><span class="line"><span class="meta">@LoadBalancerClients(value = @LoadBalancerClient(name = &quot;spzx-cloud-user&quot;, configuration = CustomLoadBalancerConfiguration.class))</span></span><br><span class="line"><span class="meta">@RefreshScope</span>  <span class="comment">// åˆ·æ–°@Valueæ˜ å°„çš„å€¼</span></span><br><span class="line"><span class="meta">@SentienlResorce</span>  <span class="comment">//å®šä¹‰èµ„æºåç§°</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;spzx-cloud-user&quot;,path = &quot;/user&quot;,fallback = UserFeignFallback.class)</span> <span class="comment">//æ³¨å†ŒFeignæ¥å£å’Œé™çº§ç±»</span></span><br><span class="line"><span class="meta">@EnableAdminServer</span>  <span class="comment">//å¾®æœåŠ¡ç›‘æ§å›¾åƒç•Œé¢</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;one&quot;)</span>   <span class="comment">//è®¾ç½®Rabbitmqç›‘å¬é˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(value = &quot;direct_queue_02&quot; , durable = &quot;true&quot;) ,</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(value = &quot;direct_exchange&quot; , durable = &quot;true&quot; , type = ExchangeTypes.DIRECT) ,</span></span><br><span class="line"><span class="meta">            key = &#123; &quot;error&quot; , &quot;info&quot;&#125;</span></span><br><span class="line"><span class="meta">    ))</span>    <span class="comment">// åœ¨æ¶ˆè´¹æ–¹ï¼Œå®šä¹‰é˜Ÿåˆ—ï¼Œäº¤æ¢æœºä»¥åŠç»‘å®šå…³ç³»</span></span><br><span class="line">		</span><br><span class="line">	<span class="comment">// OpenFeignè¿œç¨‹è°ƒç”¨é»˜è®¤ä¸ºjsonæ•°æ®ï¼Œä½¿ç”¨è¿™ä¸ªæ³¨è§£å°†jsonè§£æä¸ºæ™®é€šæ•°æ®</span></span><br><span class="line">	<span class="meta">@SpringQueryMap</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>ssh</title>
    <url>/2025/09/15/ssh/</url>
    <content><![CDATA[<h1>Linux å®‰è£… Git + ç”Ÿæˆ SSH å…¬é’¥ + é…ç½®å…¬é’¥ + è‡ªå®šä¹‰ SSH åç§°è¿æ¥æœåŠ¡å™¨æ•™ç¨‹</h1>
<h2 id="1-å®‰è£…-Git">1. å®‰è£… Git</h2>
<p>å¤§éƒ¨åˆ† Linux å‘è¡Œç‰ˆé»˜è®¤è‡ªå¸¦ Gitï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å®‰è£…ï¼š</p>
<h3 id="Debian-Ubuntu-ç³»ç»Ÿï¼š">Debian/Ubuntu ç³»ç»Ÿï¼š</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install git -y</span><br></pre></td></tr></table></figure>
<h3 id="CentOS-RHEL-ç³»ç»Ÿï¼š">CentOS/RHEL ç³»ç»Ÿï¼š</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum install git -y</span><br></pre></td></tr></table></figure>
<h3 id="Fedora-ç³»ç»Ÿï¼š">Fedora ç³»ç»Ÿï¼š</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dnf install git -y</span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæˆåï¼ŒéªŒè¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git --version</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="2-ç”Ÿæˆ-SSH-å…¬é’¥å’Œç§é’¥">2. ç”Ÿæˆ SSH å…¬é’¥å’Œç§é’¥</h2>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;your_email@example.com&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>-t rsa</code> è¡¨ç¤ºä½¿ç”¨ RSA ç®—æ³•</li>
<li><code>-b 4096</code> è¡¨ç¤ºå¯†é’¥é•¿åº¦ 4096 ä½ï¼ˆæ›´å®‰å…¨ï¼‰</li>
<li><code>-C</code> æ·»åŠ æ³¨é‡Šï¼Œä¸€èˆ¬å¡«å†™é‚®ç®±</li>
</ul>
<p>è¿‡ç¨‹ç¤ºä¾‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/home/youruser/.ssh/id_rsa):  # ç›´æ¥å›è½¦å³å¯ä½¿ç”¨é»˜è®¤è·¯å¾„ï¼Œæˆ–è€…è‡ªå®šä¹‰è·¯å¾„</span><br><span class="line">Enter passphrase (empty for no passphrase):  # å»ºè®®è®¾ç½®å¯†ç ï¼Œå¢åŠ å®‰å…¨æ€§ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å›è½¦è·³è¿‡</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /home/youruser/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /home/youruser/.ssh/id_rsa.pub.</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-å°†å…¬é’¥å†…å®¹æ·»åŠ åˆ°æœåŠ¡å™¨">3. å°†å…¬é’¥å†…å®¹æ·»åŠ åˆ°æœåŠ¡å™¨</h2>
<h3 id="3-1-æŸ¥çœ‹å…¬é’¥å†…å®¹">3.1 æŸ¥çœ‹å…¬é’¥å†…å®¹</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>
<p>å¤åˆ¶è¾“å‡ºçš„å†…å®¹ï¼ˆä»¥ <code>ssh-rsa</code> å¼€å¤´ï¼Œæœ«å°¾å¸¦æ³¨é‡Šï¼‰ã€‚</p>
<hr>
<h3 id="3-2-ç™»å½•ç›®æ ‡æœåŠ¡å™¨ï¼ˆæ¯”å¦‚é€šè¿‡å¯†ç ç™»å½•ï¼‰">3.2 ç™»å½•ç›®æ ‡æœåŠ¡å™¨ï¼ˆæ¯”å¦‚é€šè¿‡å¯†ç ç™»å½•ï¼‰</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh user@server_ip</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="3-3-æ·»åŠ å…¬é’¥åˆ°æœåŠ¡å™¨">3.3 æ·»åŠ å…¬é’¥åˆ°æœåŠ¡å™¨</h3>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/.ssh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å¤åˆ¶çš„å…¬é’¥å†…å®¹&quot;</span> &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line"><span class="built_in">chmod</span> 700 ~/.ssh</span><br><span class="line"><span class="built_in">chmod</span> 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±æˆæƒäº†æœ¬åœ°æœºå™¨çš„å…¬é’¥ç™»å½•æœåŠ¡å™¨ã€‚</p>
<hr>
<h2 id="4-é…ç½®-SSH-å®¢æˆ·ç«¯çš„è‡ªå®šä¹‰è¿æ¥åç§°ï¼ˆåˆ«åï¼‰">4. é…ç½® SSH å®¢æˆ·ç«¯çš„è‡ªå®šä¹‰è¿æ¥åç§°ï¼ˆåˆ«åï¼‰</h2>
<p>ç¼–è¾‘æœ¬åœ°æœºå™¨çš„ SSH é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim ~/.ssh/config</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Host myserver</span><br><span class="line">    HostName server_ip_or_domain</span><br><span class="line">    User your_server_username</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa</span><br><span class="line">    Port 22  # å¦‚æœæœåŠ¡å™¨ SSH ç«¯å£ä¸æ˜¯22ï¼Œè¯·æ”¹æˆå¯¹åº”ç«¯å£</span><br></pre></td></tr></table></figure>
<p>ä¿å­˜é€€å‡ºã€‚</p>
<hr>
<h2 id="5-ä½¿ç”¨è‡ªå®šä¹‰åç§°è¿æ¥æœåŠ¡å™¨">5. ä½¿ç”¨è‡ªå®šä¹‰åç§°è¿æ¥æœåŠ¡å™¨</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh myserver</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶ SSH ä¼šè‡ªåŠ¨ä½¿ç”¨é…ç½®çš„ç”¨æˆ·åã€IPã€å¯†é’¥å’Œç«¯å£è¿æ¥ã€‚</p>
<hr>
<h2 id="6-æµ‹è¯•-SSH-è¿æ¥æ˜¯å¦æˆåŠŸ">6. æµ‹è¯• SSH è¿æ¥æ˜¯å¦æˆåŠŸ</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æ˜¯ä¸ºäº†ä½¿ç”¨ Git è¿æ¥ GitHubï¼Œä¹Ÿå¯ä»¥æµ‹è¯•ï¼š</p>
<ul>
<li>å¦‚æœæç¤º <code>You've successfully authenticated</code>ï¼Œè¯´æ˜ SSH é…ç½®æˆåŠŸã€‚</li>
</ul>
<hr>
<h1>æ€»ç»“</h1>
<table>
<thead>
<tr>
<th>æ­¥éª¤</th>
<th>å‘½ä»¤ç¤ºä¾‹æˆ–è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®‰è£… Git</td>
<td><code>sudo apt install git -y</code></td>
</tr>
<tr>
<td>ç”Ÿæˆå¯†é’¥</td>
<td><code>ssh-keygen -t rsa -b 4096 -C &quot;email&quot;</code></td>
</tr>
<tr>
<td>æŸ¥çœ‹å…¬é’¥</td>
<td><code>cat ~/.ssh/id_rsa.pub</code></td>
</tr>
<tr>
<td>ç™»å½•æœåŠ¡å™¨</td>
<td><code>ssh user@server_ip</code></td>
</tr>
<tr>
<td>æ·»åŠ å…¬é’¥</td>
<td><code>echo &quot;å…¬é’¥å†…å®¹&quot; &gt;&gt; ~/.ssh/authorized_keys</code></td>
</tr>
<tr>
<td>é…ç½®åˆ«å</td>
<td>ç¼–è¾‘ <code>~/.ssh/config</code> æ–‡ä»¶</td>
</tr>
<tr>
<td>ç”¨åˆ«åè¿æ¥</td>
<td><code>ssh myserver</code></td>
</tr>
</tbody>
</table>
<hr>
<h1>è‡ªåŠ¨åŒ–è„šæœ¬</h1>
<ul>
<li>æ£€æŸ¥å¹¶å®‰è£… Gitï¼ˆé€‚é… Debian/Ubuntuï¼‰</li>
<li>ç”Ÿæˆ SSH å¯†é’¥ï¼ˆé»˜è®¤è·¯å¾„ï¼Œå¸¦æ³¨é‡Šé‚®ç®±ï¼‰</li>
<li>æ˜¾ç¤ºå…¬é’¥å†…å®¹ï¼Œæ–¹ä¾¿å¤åˆ¶</li>
<li>æç¤ºä½ æ‰‹åŠ¨ç™»å½•æœåŠ¡å™¨ï¼ŒæŠŠå…¬é’¥åŠ åˆ°æœåŠ¡å™¨ <code>~/.ssh/authorized_keys</code></li>
<li>å¸®ä½ é…ç½®æœ¬åœ° <code>~/.ssh/config</code> é‡Œçš„ SSH è¿æ¥åˆ«å</li>
</ul>
<hr>
<h1>è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆå‡è®¾ä½ ç”¨çš„æ˜¯ Debian/Ubuntuï¼‰</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å‚æ•°ï¼šä¿®æ”¹æˆä½ è‡ªå·±çš„é‚®ç®±ï¼ŒæœåŠ¡å™¨IPï¼Œç”¨æˆ·åï¼ŒSSHç«¯å£å’Œåˆ«å</span></span><br><span class="line">EMAIL=<span class="string">&quot;your_email@example.com&quot;</span></span><br><span class="line">SERVER_IP=<span class="string">&quot;your.server.ip&quot;</span></span><br><span class="line">SERVER_USER=<span class="string">&quot;youruser&quot;</span></span><br><span class="line">SSH_PORT=22</span><br><span class="line">SSH_ALIAS=<span class="string">&quot;myserver&quot;</span></span><br><span class="line">KEY_PATH=<span class="string">&quot;<span class="variable">$HOME</span>/.ssh/id_rsa&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å®‰è£… git</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ£€æŸ¥ Git æ˜¯å¦å®‰è£…...&quot;</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">command</span> -v git &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Git æœªå®‰è£…ï¼Œå¼€å§‹å®‰è£… Git...&quot;</span></span><br><span class="line">    sudo apt update</span><br><span class="line">    sudo apt install git -y</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Git å·²å®‰è£…ï¼Œç‰ˆæœ¬ï¼š<span class="subst">$(git --version)</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ç”Ÿæˆ SSH å¯†é’¥</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$KEY_PATH</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ£€æµ‹åˆ°å·²æœ‰ SSH å¯†é’¥ï¼š<span class="variable">$KEY_PATH</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ç”Ÿæˆæ–°çš„ SSH å¯†é’¥...&quot;</span></span><br><span class="line">    ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;<span class="variable">$EMAIL</span>&quot;</span> -f <span class="string">&quot;<span class="variable">$KEY_PATH</span>&quot;</span> -N <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;SSH å¯†é’¥ç”ŸæˆæˆåŠŸã€‚&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æ˜¾ç¤ºå…¬é’¥ï¼Œæé†’å¤åˆ¶</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;è¯·å¤åˆ¶ä¸‹é¢çš„å…¬é’¥å†…å®¹ï¼š&quot;</span></span><br><span class="line"><span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$&#123;KEY_PATH&#125;</span>.pub&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;è¯·ä½¿ç”¨ä½ çš„å¯†ç ç™»å½•æœåŠ¡å™¨ï¼ŒæŠŠä¸Šé¢å…¬é’¥å†…å®¹è¿½åŠ åˆ° ~/.ssh/authorized_keys æ–‡ä»¶é‡Œã€‚&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ç¤ºä¾‹ï¼š&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ssh <span class="variable">$SERVER_USER</span>@<span class="variable">$SERVER_IP</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;mkdir -p ~/.ssh &amp;&amp; echo &#x27;ä½ çš„å…¬é’¥å†…å®¹&#x27; &gt;&gt; ~/.ssh/authorized_keys &amp;&amp; chmod 600 ~/.ssh/authorized_keys&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. é…ç½® SSH åˆ«å</span></span><br><span class="line">CONFIG_FILE=<span class="string">&quot;<span class="variable">$HOME</span>/.ssh/config&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å¼€å§‹é…ç½® SSH åˆ«åï¼š<span class="variable">$SSH_ALIAS</span> åˆ° <span class="variable">$CONFIG_FILE</span> ...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­ config æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$CONFIG_FILE</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">touch</span> <span class="string">&quot;<span class="variable">$CONFIG_FILE</span>&quot;</span></span><br><span class="line">    <span class="built_in">chmod</span> 600 <span class="string">&quot;<span class="variable">$CONFIG_FILE</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥åˆ«åæ˜¯å¦å·²å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> grep -q <span class="string">&quot;Host <span class="variable">$SSH_ALIAS</span>&quot;</span> <span class="string">&quot;<span class="variable">$CONFIG_FILE</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;SSH åˆ«å <span class="variable">$SSH_ALIAS</span> å·²å­˜åœ¨ï¼Œè·³è¿‡å†™å…¥ã€‚&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">cat</span> &gt;&gt; <span class="string">&quot;<span class="variable">$CONFIG_FILE</span>&quot;</span> &lt;&lt;<span class="string">EOL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Host $SSH_ALIAS</span></span><br><span class="line"><span class="string">    HostName $SERVER_IP</span></span><br><span class="line"><span class="string">    User $SERVER_USER</span></span><br><span class="line"><span class="string">    Port $SSH_PORT</span></span><br><span class="line"><span class="string">    IdentityFile $KEY_PATH</span></span><br><span class="line"><span class="string">EOL</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;SSH åˆ«åé…ç½®å®Œæˆã€‚&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ä½ å¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤æµ‹è¯•è¿æ¥ï¼š&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ssh <span class="variable">$SSH_ALIAS</span>&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h1>ä½¿ç”¨æ­¥éª¤</h1>
<ol>
<li>
<p>å°†ä¸Šé¢è„šæœ¬ä¿å­˜ä¸º <code>setup_ssh_git.sh</code></p>
</li>
<li>
<p>ä¿®æ”¹è„šæœ¬é¡¶éƒ¨çš„å‚æ•°ï¼š</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">EMAIL=<span class="string">&quot;ä½ çš„é‚®ç®±&quot;</span></span><br><span class="line">SERVER_IP=<span class="string">&quot;æœåŠ¡å™¨IP&quot;</span></span><br><span class="line">SERVER_USER=<span class="string">&quot;æœåŠ¡å™¨ç”¨æˆ·å&quot;</span></span><br><span class="line">SSH_PORT=22 <span class="comment"># å¦‚æœä¸æ˜¯22ï¼Œæ”¹æˆä½ çš„ç«¯å£</span></span><br><span class="line">SSH_ALIAS=<span class="string">&quot;ä½ æƒ³èµ·çš„åˆ«å&quot;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ç»™äºˆæ‰§è¡Œæƒé™å¹¶è¿è¡Œï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x setup_ssh_git.sh</span><br><span class="line">./setup_ssh_git.sh</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>
<p>æ ¹æ®è„šæœ¬æç¤ºï¼Œå¤åˆ¶å…¬é’¥å†…å®¹ï¼Œç™»å½•æœåŠ¡å™¨ï¼Œè¿½åŠ åˆ° <code>~/.ssh/authorized_keys</code></p>
</li>
<li>
<p>ç”¨å‘½ä»¤ <code>ssh myserver</code>ï¼ˆæˆ–è€…ä½ é…ç½®çš„åˆ«åï¼‰è¿æ¥æœåŠ¡å™¨</p>
</li>
</ol>
<hr>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>swap</title>
    <url>/2025/09/15/swap/</url>
    <content><![CDATA[<h1>swap</h1>
<hr>
<h1>ğŸ“š Linux åˆ›å»º swap è¯¦ç»†æŒ‡å—</h1>
<blockquote>
<p>âš™ é€‚ç”¨ç³»ç»Ÿï¼š</p>
<ul>
<li>CentOS / RHEL / Rocky / AlmaLinux</li>
<li>Ubuntu / Debian</li>
</ul>
</blockquote>
<hr>
<h2 id="1ï¸âƒ£-æŸ¥çœ‹å½“å‰-swap-æƒ…å†µ">1ï¸âƒ£ æŸ¥çœ‹å½“å‰ swap æƒ…å†µ</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ swap æ€»ä½“ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ swap è®¾å¤‡åˆ—è¡¨</span></span><br><span class="line">swapon -s</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¯¦ç»†</span></span><br><span class="line"><span class="built_in">cat</span> /proc/swaps</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="2ï¸âƒ£-åˆ›å»º-swap-æ–‡ä»¶">2ï¸âƒ£ åˆ›å»º swap æ–‡ä»¶</h2>
<p>è¿™é‡Œä»¥ <strong>åˆ›å»º 4G swap æ–‡ä»¶</strong> ä¸ºä¾‹ã€‚</p>
<h3 id="â¡ï¸-2-1-åˆ›å»º-swap-æ–‡ä»¶">â¡ï¸ 2.1 åˆ›å»º swap æ–‡ä»¶</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ /swapfile åˆ›å»ºå¤§å°ä¸º 4G çš„ swap æ–‡ä»¶</span></span><br><span class="line">sudo fallocate -l 4G /swapfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœ fallocate ä¸å¯ç”¨ï¼Œå¯ä½¿ç”¨ dd (æ›´å…¼å®¹)</span></span><br><span class="line"><span class="comment"># sudo dd if=/dev/zero of=/swapfile bs=1M count=4096</span></span><br></pre></td></tr></table></figure>
<h3 id="â¡ï¸-2-2-ä¿®æ”¹æƒé™">â¡ï¸ 2.2 ä¿®æ”¹æƒé™</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> 600 /swapfile</span><br></pre></td></tr></table></figure>
<h3 id="â¡ï¸-2-3-è®¾ç½®ä¸º-swap-æ ¼å¼">â¡ï¸ 2.3 è®¾ç½®ä¸º swap æ ¼å¼</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mkswap /swapfile</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3ï¸âƒ£-å¯ç”¨-swap">3ï¸âƒ£ å¯ç”¨ swap</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo swapon /swapfile</span><br></pre></td></tr></table></figure>
<p>éªŒè¯æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">swapon -s</span><br><span class="line">free -h</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="4ï¸âƒ£-å¼€æœºè‡ªåŠ¨æŒ‚è½½">4ï¸âƒ£ å¼€æœºè‡ªåŠ¨æŒ‚è½½</h2>
<p>ç¼–è¾‘ <code>/etc/fstab</code>ï¼Œæ·»åŠ ä¸€è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/fstab</span><br></pre></td></tr></table></figure>
<p>åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/swapfile swap swap defaults 0 0</span><br></pre></td></tr></table></figure>
<p>ç„¶åæµ‹è¯•æ˜¯å¦èƒ½æ­£å¸¸æŒ‚è½½ï¼ˆé¿å…ä¸‹æ¬¡é‡å¯å¤±è´¥ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mount -a</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="5ï¸âƒ£-è°ƒæ•´-swap-ä½¿ç”¨é¢‘ç‡ï¼ˆswappinessï¼‰">5ï¸âƒ£ è°ƒæ•´ swap ä½¿ç”¨é¢‘ç‡ï¼ˆswappinessï¼‰</h2>
<p>swappiness è¡¨ç¤ºç³»ç»Ÿä½¿ç”¨ swap çš„å€¾å‘ï¼š</p>
<ul>
<li><strong>0</strong> è¡¨ç¤ºå°½å¯èƒ½é¿å…ä½¿ç”¨ swapï¼ˆå‡ ä¹ç”¨å®Œç‰©ç†å†…å­˜æ‰ç”¨ï¼‰ã€‚</li>
<li><strong>100</strong> è¡¨ç¤ºå°½é‡ä½¿ç”¨ swapã€‚</li>
</ul>
<p>é€šå¸¸è®¾ç½®ä¸º <strong>10-20</strong> æ€§èƒ½è¾ƒå¥½ã€‚</p>
<h3 id="â¡ï¸-5-1-ä¸´æ—¶ä¿®æ”¹">â¡ï¸ 5.1 ä¸´æ—¶ä¿®æ”¹</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo sysctl vm.swappiness=10</span><br></pre></td></tr></table></figure>
<p>ç«‹å³ç”Ÿæ•ˆï¼Œä½†é‡å¯å¤±æ•ˆã€‚</p>
<h3 id="â¡ï¸-5-2-æ°¸ä¹…ä¿®æ”¹">â¡ï¸ 5.2 æ°¸ä¹…ä¿®æ”¹</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ ä¸€è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vm.swappiness=10</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="6ï¸âƒ£-æ‰©å±•-swap-å¤§å°">6ï¸âƒ£ æ‰©å±• swap å¤§å°</h2>
<p>å¦‚æœåŸ swap ä¸å¤Ÿï¼Œå¯ä»¥æ–°å¢ swap æ–‡ä»¶ï¼Œæˆ–åˆ é™¤åŸæ–‡ä»¶é‡æ–°åˆ›å»ºã€‚</p>
<h3 id="â¡ï¸-6-1-åˆ é™¤æ—§-swapï¼ˆè‹¥éœ€è¦ï¼‰">â¡ï¸ 6.1 åˆ é™¤æ—§ swapï¼ˆè‹¥éœ€è¦ï¼‰</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo swapoff /swapfile</span><br><span class="line">sudo <span class="built_in">rm</span> -f /swapfile</span><br></pre></td></tr></table></figure>
<p>ç„¶åé‡æ–°æŒ‰ä¸Šé¢æ­¥éª¤å†åˆ›å»ºæ›´å¤§çš„ swap æ–‡ä»¶ã€‚</p>
<hr>
<h2 id="7ï¸âƒ£-é¢å¤–ä¼˜åŒ–ï¼šè®¾ç½®-cache-pressure">7ï¸âƒ£ é¢å¤–ä¼˜åŒ–ï¼šè®¾ç½® cache pressure</h2>
<p><code>vm.vfs_cache_pressure</code> å†³å®šäº†å†…æ ¸å¤šç§¯æé‡Šæ”¾ inode/dentry ç¼“å­˜ã€‚é»˜è®¤æ˜¯ 100ã€‚</p>
<p>å¯ä»¥é€‚å½“è°ƒä½åˆ° 50ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo sysctl vm.vfs_cache_pressure=50</span><br></pre></td></tr></table></figure>
<p>æ°¸ä¹…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vm.vfs_cache_pressure=50</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure>
<hr>
<h1>âœ… å®Œæ•´å¿«é€Ÿè„šæœ¬ç¤ºä¾‹</h1>
<p>å¦‚æœæƒ³ä¸€é”®æ‰§è¡Œï¼Œå¯ç”¨ä¸‹é¢è„šæœ¬ï¼ˆä»¥ 4Gï¼Œswappiness=10 ä¸ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo fallocate -l 4G /swapfile</span><br><span class="line">sudo <span class="built_in">chmod</span> 600 /swapfile</span><br><span class="line">sudo mkswap /swapfile</span><br><span class="line">sudo swapon /swapfile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/swapfile swap swap defaults 0 0&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/fstab</span><br><span class="line">sudo sysctl vm.swappiness=10</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;vm.swappiness=10&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure>
<hr>
<h1>ğŸ¯ å°ç»“ï¼šå¸¸ç”¨å‘½ä»¤è¡¨</h1>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
<td>æŸ¥çœ‹ swap</td>
<td><code>free -h</code> / <code>swapon -s</code></td>
</tr>
<tr>
<td>åˆ›å»º swap æ–‡ä»¶</td>
<td><code>fallocate -l 4G /swapfile</code></td>
</tr>
<tr>
<td>æƒé™ã€æ ¼å¼åŒ–ã€å¯ç”¨</td>
<td><code>chmod 600 /swapfile &amp;&amp; mkswap /swapfile &amp;&amp; swapon /swapfile</code></td>
</tr>
<tr>
<td>è®¾ç½®å¼€æœºæŒ‚è½½</td>
<td><code>/etc/fstab</code> ä¸­æ·»åŠ  <code>/swapfile swap swap defaults 0 0</code></td>
</tr>
<tr>
<td>ä¿®æ”¹ swappiness</td>
<td><code>sysctl vm.swappiness=10</code></td>
</tr>
<tr>
<td>æ°¸ä¹… swappiness</td>
<td><code>/etc/sysctl.conf</code> ä¸­æ·»åŠ  <code>vm.swappiness=10</code></td>
</tr>
<tr>
<td>ç§»é™¤ swap</td>
<td><code>swapoff /swapfile &amp;&amp; rm /swapfile</code></td>
</tr>
</tbody>
</table>
<hr>
<h1>swapè„šæœ¬</h1>
<hr>
<h2 id="ğŸš€-è„šæœ¬å¢å¼ºåŠŸèƒ½">ğŸš€ è„šæœ¬å¢å¼ºåŠŸèƒ½</h2>
<p>âœ… <strong>è‡ªåŠ¨æ£€æµ‹å†…å­˜å¤§å°ï¼Œå†³å®š swap å¤§å°</strong><br>
âœ… <strong>è‡ªåŠ¨æ£€æµ‹æ ¹åˆ†åŒºå‰©ä½™ç©ºé—´ï¼Œé¿å… swap å¤ªå¤§å¯¼è‡´ç£ç›˜å æ»¡</strong><br>
âœ… <strong>å¦‚éœ€è¦ï¼Œä¼šæ‹†åˆ†ä¸ºå¤šä¸ª swap æ–‡ä»¶ä»¥åˆ†æ‘Š I/O</strong><br>
âœ… <strong>æ‰€æœ‰è¾“å‡ºå†™å…¥ <code>/var/log/swap_setup.log</code></strong><br>
âœ… <strong>ä¾ç„¶è‡ªåŠ¨è®¾ç½® swappiness å’Œ cache_pressureï¼Œå¹¶å¼€æœºè‡ªåŠ¨æŒ‚è½½</strong></p>
<hr>
<h2 id="ğŸ“œ-å®Œæ•´è„šæœ¬-auto-swap-sh">ğŸ“œ å®Œæ•´è„šæœ¬ <code>auto_swap.sh</code></h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ===============================================</span></span><br><span class="line"><span class="comment"># è‡ªåŠ¨æ ¹æ®å†…å­˜å’Œç£ç›˜ç©ºé—´é…ç½® swap</span></span><br><span class="line"><span class="comment"># æ”¯æŒå¤š swap æ–‡ä»¶åˆ†æ‘Š IOï¼Œå¹¶å†™æ—¥å¿—åˆ° /var/log/swap_setup.log</span></span><br><span class="line"><span class="comment"># ===============================================</span></span><br><span class="line"></span><br><span class="line">log_file=<span class="string">&quot;/var/log/swap_setup.log&quot;</span></span><br><span class="line"><span class="built_in">exec</span> &gt; &gt;(<span class="built_in">tee</span> -a <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span>) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====== <span class="subst">$(date &#x27;+%F %T&#x27;)</span> Starting swap setup ======&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># è·å–æ€»å†…å­˜(MB)</span></span><br><span class="line">mem_total=$(grep MemTotal /proc/meminfo | awk <span class="string">&#x27;&#123;print int($2/1024)&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Detected memory: <span class="variable">$&#123;mem_total&#125;</span> MB&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># æ ¹æ®å†…å­˜å¤§å°å†³å®š swap å¤§å°</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$mem_total</span>&quot;</span> -lt 2048 ]; <span class="keyword">then</span></span><br><span class="line">    swap_target=2048</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$mem_total</span>&quot;</span> -lt 8192 ]; <span class="keyword">then</span></span><br><span class="line">    swap_target=<span class="variable">$mem_total</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    swap_target=4096</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Initial calculated swap target: <span class="variable">$&#123;swap_target&#125;</span> MB&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ ¹æŒ‚è½½ç‚¹å‰©ä½™ç©ºé—´</span></span><br><span class="line">root_avail=$(<span class="built_in">df</span> --output=avail / | <span class="built_in">tail</span> -1 | awk <span class="string">&#x27;&#123;print int($1/1024)&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Available disk space on / : <span class="variable">$&#123;root_avail&#125;</span> MB&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœ swap å¤§äºå‰©ä½™ç©ºé—´çš„80%ï¼Œè°ƒæ•´</span></span><br><span class="line">max_swap=$((root_avail * <span class="number">80</span> / <span class="number">100</span>))</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$swap_target</span>&quot;</span> -gt <span class="string">&quot;<span class="variable">$max_swap</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    swap_target=<span class="variable">$max_swap</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Adjusted swap to <span class="variable">$&#123;swap_target&#125;</span> MB to fit disk capacity (80%).&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># å¦‚æœè¿˜æœ‰è€ swapfileï¼Œå…ˆç§»é™¤</span></span><br><span class="line"><span class="keyword">if</span> swapon --summary | grep -q <span class="string">&#x27;/swapfile&#x27;</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Existing /swapfile found, turning off swap.&quot;</span></span><br><span class="line">    sudo swapoff /swapfile</span><br><span class="line">    sudo <span class="built_in">rm</span> -f /swapfile</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># åˆ é™¤å¤š swap æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..4&#125;; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">&quot;/swapfile<span class="variable">$i</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        sudo swapoff <span class="string">&quot;/swapfile<span class="variable">$i</span>&quot;</span></span><br><span class="line">        sudo <span class="built_in">rm</span> -f <span class="string">&quot;/swapfile<span class="variable">$i</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># å¤š swap æ–‡ä»¶åˆ†æ‘Š IO</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚ å¦‚æœ swap_target &gt; 2GBï¼Œåˆ™åˆ† 2 ä¸ª swap æ–‡ä»¶</span></span><br><span class="line">files=1</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$swap_target</span>&quot;</span> -gt 2048 ]; <span class="keyword">then</span></span><br><span class="line">    files=2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">per_file=$((swap_target / files))</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Will create <span class="variable">$files</span> swap files, each ~<span class="variable">$&#123;per_file&#125;</span> MB&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 <span class="variable">$files</span>); <span class="keyword">do</span></span><br><span class="line">    swapfile=<span class="string">&quot;/swapfile<span class="variable">$i</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Creating <span class="variable">$swapfile</span> of size <span class="variable">$&#123;per_file&#125;</span> MB&quot;</span></span><br><span class="line">    sudo fallocate -l <span class="variable">$&#123;per_file&#125;</span>M <span class="string">&quot;<span class="variable">$swapfile</span>&quot;</span> || sudo <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=<span class="string">&quot;<span class="variable">$swapfile</span>&quot;</span> bs=1M count=<span class="variable">$per_file</span></span><br><span class="line">    sudo <span class="built_in">chmod</span> 600 <span class="string">&quot;<span class="variable">$swapfile</span>&quot;</span></span><br><span class="line">    sudo mkswap <span class="string">&quot;<span class="variable">$swapfile</span>&quot;</span></span><br><span class="line">    sudo swapon <span class="string">&quot;<span class="variable">$swapfile</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ! grep -q <span class="string">&quot;<span class="variable">$swapfile</span>&quot;</span> /etc/fstab; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$swapfile</span> swap swap defaults 0 0&quot;</span> | sudo <span class="built_in">tee</span> -a /etc/fstab</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœåªæœ‰ 1 ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º /swapfile</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$files</span>&quot;</span> -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">mv</span> <span class="string">&quot;/swapfile1&quot;</span> <span class="string">&quot;/swapfile&quot;</span></span><br><span class="line">    sed -i <span class="string">&#x27;s|/swapfile1|/swapfile|g&#x27;</span> /etc/fstab</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># è°ƒæ•´ swappiness å’Œ cache pressure</span></span><br><span class="line">sudo sysctl vm.swappiness=10</span><br><span class="line">sudo sysctl vm.vfs_cache_pressure=50</span><br><span class="line">grep -q <span class="string">&#x27;vm.swappiness&#x27;</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">&#x27;vm.swappiness=10&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line">grep -q <span class="string">&#x27;vm.vfs_cache_pressure&#x27;</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">&#x27;vm.vfs_cache_pressure=50&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line">sudo sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># æœ€ç»ˆç»“æœ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====== Swap setup complete ======&quot;</span></span><br><span class="line">free -h</span><br><span class="line">swapon --show</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====== <span class="subst">$(date &#x27;+%F %T&#x27;)</span> Swap setup done ======&quot;</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="ğŸš€-ä½¿ç”¨æ–¹å¼">ğŸš€ ä½¿ç”¨æ–¹å¼</h2>
<h3 id="1ï¸âƒ£-ä¿å­˜è„šæœ¬">1ï¸âƒ£ ä¿å­˜è„šæœ¬</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nano auto_swap.sh</span><br></pre></td></tr></table></figure>
<p>ç²˜è´´ä¸Šé¢çš„è„šæœ¬ï¼Œä¿å­˜é€€å‡ºã€‚</p>
<hr>
<h3 id="2ï¸âƒ£-æˆæƒæ‰§è¡Œ">2ï¸âƒ£ æˆæƒæ‰§è¡Œ</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x auto_swap.sh</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="3ï¸âƒ£-è¿è¡Œè„šæœ¬">3ï¸âƒ£ è¿è¡Œè„šæœ¬</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ./auto_swap.sh</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè¿‡ç¨‹å’Œæ‰€æœ‰æ—¥å¿—éƒ½ä¼šå†™å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/var/log/swap_setup.log</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥éšæ—¶æŸ¥çœ‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /var/log/swap_setup.log</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="âœ…-å®ƒçš„ä¼˜ç‚¹">âœ… å®ƒçš„ä¼˜ç‚¹</h2>
<ul>
<li><strong>å®‰å…¨</strong>ï¼šæ°¸è¿œä¸ä¼šå ç”¨è¶…è¿‡æ ¹åˆ†åŒºå‰©ä½™çš„ 80%ï¼Œé¿å…å¯¼è‡´ç³»ç»Ÿæ— æ³•å†™å…¥ã€‚</li>
<li><strong>æ™ºèƒ½</strong>ï¼šè‡ªåŠ¨å†³å®š swap å¤§å°ã€‚</li>
<li><strong>åˆ†æ•£ I/O</strong>ï¼šå¤§äº 2GB å°±æ‹†æˆå¤šä¸ª swap æ–‡ä»¶ã€‚</li>
<li><strong>è‡ªåŠ¨æŒ‚è½½</strong>ï¼šå†™å…¥ <code>/etc/fstab</code>ã€‚</li>
<li><strong>ä¼˜åŒ–å‚æ•°</strong>ï¼šè®¾ç½® <code>swappiness=10</code>ï¼Œ<code>cache_pressure=50</code>ã€‚</li>
<li><strong>å¯è¿½æº¯</strong>ï¼šæ‰€æœ‰è¿‡ç¨‹å’Œç»“æœéƒ½å†™åˆ° <code>/var/log/swap_setup.log</code>ã€‚</li>
</ul>
<hr>
<p>å¤ªæ£’äº†ï¼ä½ è¿™ä¸ªéœ€æ±‚éå¸¸â€œä¸“ä¸šçº§â€ï¼Œæˆ‘ä»¬å°±æ¥æä¸ª <strong>é¡¶é…çº§è‡ªåŠ¨ swap ç®¡ç†æ–¹æ¡ˆ</strong><br>
ğŸ‘‡ æˆ‘ä¼šè¯¦ç»†æ‹†è§£æˆä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¹¶ç»™å‡ºå®Œæ•´å¯æ‰§è¡Œè„šæœ¬ç¤ºä¾‹ã€‚</p>
<hr>
<h1>ğŸš€ åŠŸèƒ½ä¸€ï¼šåŸºäºç£ç›˜ I/O æ€§èƒ½è‡ªåŠ¨å†³å®š swap æ–‡ä»¶æ•°</h1>
<p>ä¸€èˆ¬ swap æ–‡ä»¶è¶Šå¤šï¼Œå¯ä»¥åˆ†æ‘Šåˆ°ä¸åŒç£ç›˜/ä¸åŒ inodeï¼Œæé«˜å¹¶è¡Œ IO æ€§èƒ½ï¼ˆè™½ä¸å¦‚ RAIDï¼‰ã€‚<br>
æˆ‘ä»¬å¯ä»¥ï¼š</p>
<ul>
<li>ç”¨ <code>dd</code> æˆ– <code>fio</code> ç®€å•è·‘ä¸ªå†™å…¥æµ‹è¯•ã€‚</li>
<li>æ ¹æ® MB/s é€Ÿåº¦å†³å®š swap æ–‡ä»¶æ•°é‡ã€‚</li>
</ul>
<p>ä¸¾ä¸ªç®€å•è§„åˆ™ç¤ºä¾‹ï¼š</p>
<ul>
<li>IOPS &lt; 50 MB/sï¼Œåˆ›å»º 1 ä¸ª swap æ–‡ä»¶ï¼ˆé¿å…è¿‡å¤šç¢ç‰‡ï¼‰ã€‚</li>
<li>IOPS 50~150 MB/sï¼Œåˆ›å»º 2 ä¸ª swap æ–‡ä»¶ã€‚</li>
<li>IOPS &gt; 150 MB/sï¼Œåˆ›å»º 3 ä¸ª swap æ–‡ä»¶ã€‚</li>
</ul>
<hr>
<h2 id="ğŸš€-åŠŸèƒ½äºŒï¼šç»“åˆ-zram-å‹ç¼©-swapï¼ˆåŸºäºå†…å­˜ï¼‰">ğŸš€ åŠŸèƒ½äºŒï¼šç»“åˆ zram å‹ç¼© swapï¼ˆåŸºäºå†…å­˜ï¼‰</h2>
<p>zram ç±»ä¼¼åœ¨å†…å­˜é‡Œå¼€ä¸€ä¸ªå‹ç¼©å—è®¾å¤‡ï¼Œæ€§èƒ½æ¯”çœŸå®ç£ç›˜ swap é«˜å¾ˆå¤šï¼ˆé€šå¸¸ 4~10xï¼‰ã€‚<br>
é€‚åˆï¼š</p>
<ul>
<li>CPU æ¯”è¾ƒç©ºé—²ï¼Œå†…å­˜åƒç´§æ—¶ã€‚</li>
<li>åšå†…å­˜â€œè¿‡åº¦æ‰¿è½½â€ï¼ŒåŒæ—¶å‡å°‘ç‰©ç† swap è§¦å‘ã€‚</li>
</ul>
<hr>
<h2 id="ğŸš€-åŠŸèƒ½ä¸‰ï¼šcron-å®šæœŸæ£€æŸ¥-swap-ç£ç›˜">ğŸš€ åŠŸèƒ½ä¸‰ï¼šcron å®šæœŸæ£€æŸ¥ swap + ç£ç›˜</h2>
<p>è‡ªåŠ¨æ¯å¤©æˆ–æ¯å°æ—¶æ£€æµ‹ swap ä½¿ç”¨ç‡ã€I/O loadã€ç£ç›˜å¯ç”¨ç©ºé—´ï¼Œè‡ªåŠ¨å†™å…¥æ—¥å¿—ï¼Œå¹¶å¯å‘é‚®ä»¶æˆ–æ¨é€ã€‚</p>
<hr>
<h1>âœ… ç°åœ¨æ•´åˆä¸ºè¶…å®Œæ•´çš„æ–¹æ¡ˆ</h1>
<hr>
<h2 id="ğŸ“œ-å®Œæ•´å¢å¼ºè„šæœ¬-smart-swap-setup-sh">ğŸ“œ å®Œæ•´å¢å¼ºè„šæœ¬ <code>smart_swap_setup.sh</code></h2>
<h3 id="ğŸ”¥-è‡ªåŠ¨ï¼š">ğŸ”¥ è‡ªåŠ¨ï¼š</h3>
<ul>
<li>æ£€æµ‹å†…å­˜</li>
<li>è·‘ <code>dd</code> æµ‹ I/O</li>
<li>æ ¹æ®é€Ÿåº¦åˆ†é… swap æ–‡ä»¶æ•°</li>
<li>å¯ç”¨ zram å‹ç¼© swap</li>
<li>é…ç½® swappiness</li>
<li>å†™ <code>/etc/fstab</code></li>
<li>è¾“å‡ºåˆ° <code>/var/log/swap_manager.log</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ================================================</span></span><br><span class="line"><span class="comment"># æ™ºèƒ½ swap ç®¡ç†è„šæœ¬ (å†…å­˜+ç£ç›˜I/Oè‡ªåŠ¨åŒ–, å¤šæ–‡ä»¶, zram è‡ªåŠ¨æ£€æµ‹)</span></span><br><span class="line"><span class="comment"># æ—¥å¿—è¾“å‡ºåˆ° /var/log/swap_manager.log</span></span><br><span class="line"><span class="comment"># ================================================</span></span><br><span class="line"></span><br><span class="line">log_file=<span class="string">&quot;/var/log/swap_manager.log&quot;</span></span><br><span class="line"><span class="built_in">exec</span> &gt; &gt;(<span class="built_in">tee</span> -a <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span>) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====== <span class="subst">$(date &#x27;+%F %T&#x27;)</span> Starting smart swap setup ======&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># æ£€æµ‹å†…å­˜</span></span><br><span class="line">mem_total=$(grep MemTotal /proc/meminfo | awk <span class="string">&#x27;&#123;print int($2/1024)&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Detected memory: <span class="variable">$&#123;mem_total&#125;</span> MB&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># å¼ºåˆ¶è‹±æ–‡è¿è¡Œ dd æµ‹è¯•ï¼Œé¿å…ä¸­æ–‡ç¯å¢ƒåŒ¹é…å¤±è´¥</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Running IO test with dd...&quot;</span></span><br><span class="line">speed=$(LANG=C <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=test_io.tmp bs=1M count=256 conv=fdatasync 2&gt;&amp;1 | \</span><br><span class="line">    grep -Eo <span class="string">&#x27;[0-9\.]+ (MB/s|MB/ç§’)&#x27;</span> | awk <span class="string">&#x27;&#123;print int($1)&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">rm</span> -f test_io.tmp</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$speed</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;IO speed detection failed, defaulting to 1 swap file.&quot;</span></span><br><span class="line">    swap_files=1</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$speed</span>&quot;</span> -lt 50 ]; <span class="keyword">then</span></span><br><span class="line">    swap_files=1</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$speed</span>&quot;</span> -lt 150 ]; <span class="keyword">then</span></span><br><span class="line">    swap_files=2</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    swap_files=3</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Measured disk speed: <span class="variable">$&#123;speed:-N/A&#125;</span> MB/s&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Will create <span class="variable">$&#123;swap_files&#125;</span> swap file(s).&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># æ ¹æ®å†…å­˜å†³å®š swap æ€»å¤§å°</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$mem_total</span>&quot;</span> -lt 2048 ]; <span class="keyword">then</span></span><br><span class="line">    swap_target=2048</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$mem_total</span>&quot;</span> -lt 8192 ]; <span class="keyword">then</span></span><br><span class="line">    swap_target=<span class="variable">$mem_total</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    swap_target=4096</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Total swap target: <span class="variable">$&#123;swap_target&#125;</span> MB&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># æ¸…ç†æ—§ swap</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Cleaning old swap configurations...&quot;</span></span><br><span class="line">sudo swapoff -a</span><br><span class="line">sudo sed -i <span class="string">&#x27;/swapfile/d&#x27;</span> /etc/fstab</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;; <span class="keyword">do</span></span><br><span class="line">    [ -f <span class="string">&quot;/swapfile<span class="variable">$i</span>&quot;</span> ] &amp;&amp; sudo <span class="built_in">rm</span> -f <span class="string">&quot;/swapfile<span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># åˆ†é… swap æ–‡ä»¶</span></span><br><span class="line">per_swap=$((swap_target / swap_files))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 <span class="variable">$swap_files</span>); <span class="keyword">do</span></span><br><span class="line">    file=<span class="string">&quot;/swapfile<span class="variable">$i</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Creating <span class="variable">$file</span> of size <span class="variable">$&#123;per_swap&#125;</span> MB&quot;</span></span><br><span class="line">    sudo fallocate -l <span class="variable">$&#123;per_swap&#125;</span>M <span class="string">&quot;<span class="variable">$file</span>&quot;</span> || sudo <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=<span class="string">&quot;<span class="variable">$file</span>&quot;</span> bs=1M count=<span class="variable">$per_swap</span></span><br><span class="line">    sudo <span class="built_in">chmod</span> 600 <span class="string">&quot;<span class="variable">$file</span>&quot;</span></span><br><span class="line">    sudo mkswap <span class="string">&quot;<span class="variable">$file</span>&quot;</span></span><br><span class="line">    sudo swapon <span class="string">&quot;<span class="variable">$file</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$file</span> swap swap defaults 0 0&quot;</span> | sudo <span class="built_in">tee</span> -a /etc/fstab</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># å¯ç”¨ zram å¹¶æ£€æµ‹è®¾å¤‡æ•°é‡</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Installing zram (if needed)...&quot;</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">command</span> -v zramctl &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    sudo apt install -y zram-tools || sudo yum install -y zram</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Loading zram kernel module...&quot;</span></span><br><span class="line">sudo modprobe zram</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—å½“å‰ç³»ç»Ÿæ”¯æŒçš„ zram æ•°é‡</span></span><br><span class="line">available_zrams=$(<span class="built_in">ls</span> /sys/block/ | grep zram | <span class="built_in">wc</span> -l)</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$available_zrams</span>&quot;</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;No zram device detected, skipping zram setup.&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Detected <span class="variable">$available_zrams</span> zram device(s)&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 0 $((available_zrams-<span class="number">1</span>))); <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;mem_total&#125;</span>M&quot;</span> | sudo <span class="built_in">tee</span> /sys/block/zram<span class="variable">$&#123;i&#125;</span>/disksize</span><br><span class="line">        sudo mkswap /dev/zram<span class="variable">$&#123;i&#125;</span></span><br><span class="line">        sudo swapon /dev/zram<span class="variable">$&#123;i&#125;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># ç³»ç»Ÿå†…æ ¸ä¼˜åŒ–å‚æ•°</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Setting vm.swappiness=10 and vm.vfs_cache_pressure=50&quot;</span></span><br><span class="line">sudo sysctl -w vm.swappiness=10</span><br><span class="line">sudo sysctl -w vm.vfs_cache_pressure=50</span><br><span class="line">grep -q <span class="string">&#x27;vm.swappiness&#x27;</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">&#x27;vm.swappiness=10&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line">grep -q <span class="string">&#x27;vm.vfs_cache_pressure&#x27;</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">&#x27;vm.vfs_cache_pressure=50&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># æœ€ç»ˆç»“æœå±•ç¤º</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====== Smart swap setup complete ======&quot;</span></span><br><span class="line">free -h</span><br><span class="line">swapon --show</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="âš™ï¸-ä½¿ç”¨æ–¹å¼">âš™ï¸ ä½¿ç”¨æ–¹å¼</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nano smart_swap_setup.sh</span><br><span class="line"><span class="comment"># ç²˜è´´è„šæœ¬</span></span><br><span class="line"><span class="built_in">chmod</span> +x smart_swap_setup.sh</span><br><span class="line">sudo ./smart_swap_setup.sh</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œåï¼š</p>
<ul>
<li>è‡ªåŠ¨è·‘ dd æµ‹è¯•</li>
<li>å†³å®š swap æ–‡ä»¶æ•°</li>
<li>å¼€å¯ zram</li>
<li>å†™ <code>/etc/fstab</code></li>
<li>è°ƒæ•´å‚æ•°</li>
<li>è¾“å‡ºåˆ° <code>/var/log/swap_manager.log</code></li>
</ul>
<hr>
<h2 id="ğŸš€-å®šæœŸ-cron-ç›‘æ§-swap-ç£ç›˜">ğŸš€ å®šæœŸ cron ç›‘æ§ swap + ç£ç›˜</h2>
<p>ä¾‹å¦‚æ¯ 1 å°æ—¶æ£€æŸ¥ï¼Œå¹¶è®°å½•ä½¿ç”¨æƒ…å†µã€‚</p>
<h3 id="swap-check-sh"><code>swap_check.sh</code></h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">log_file=<span class="string">&quot;/var/log/swap_health.log&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====== <span class="subst">$(date &#x27;+%F %T&#x27;)</span> ======&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Disk usage:&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"><span class="built_in">df</span> -h &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Swap usage:&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line">free -h &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IO stat:&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line">iostat -xz 1 3 &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------------------------------&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å®‰è£… <code>sysstat</code> è·å– <code>iostat</code>ï¼š</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install sysstat</span><br><span class="line"><span class="comment"># æˆ–</span></span><br><span class="line">sudo yum install sysstat</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="åŠ å…¥-cron">åŠ å…¥ cron</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0 * * * * /bin/bash /path/to/swap_check.sh</span><br></pre></td></tr></table></figure>
<hr>
<h1>ğŸ”¥ ç»“è®ºï¼š</h1>
<p>âœ… <strong>åŸºäºç£ç›˜ IO æ™ºèƒ½åˆ†é… swap æ–‡ä»¶æ•°</strong><br>
âœ… <strong>ç»“åˆ zram é«˜é€Ÿå‹ç¼© swap</strong><br>
âœ… <strong>å®šæœŸ swap &amp; disk å¥åº·æ£€æµ‹</strong></p>
<hr>
<h1>swapé¢„è­¦è„šæœ¬</h1>
<hr>
<h1>ğŸš€ <code>swap_health.sh</code> æ”¯æŒé‚®ä»¶ &amp; å¾®ä¿¡æŠ¥è­¦</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ================================================</span></span><br><span class="line"><span class="comment"># swap_health.sh</span></span><br><span class="line"><span class="comment"># å®šæ—¶æ£€æµ‹ç³»ç»Ÿ swapã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="comment"># è®°å½•æ—¥å¿—åˆ° /var/log/swap_health.log</span></span><br><span class="line"><span class="comment"># swap ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨å‘é€é‚®ä»¶å’Œå¾®ä¿¡æŠ¥è­¦</span></span><br><span class="line"><span class="comment"># ================================================</span></span><br><span class="line"></span><br><span class="line">log_file=<span class="string">&quot;/var/log/swap_health.log&quot;</span></span><br><span class="line">threshold_swap_used_percent=70</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- é…ç½®ä½ çš„é‚®ç®±å’Œå¾®ä¿¡æ¨é€ç›¸å…³ä¿¡æ¯ ---</span></span><br><span class="line">EMAIL=<span class="string">&quot;your_email@example.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾®ä¿¡æ¨é€ URLï¼ˆä¼ä¸šå¾®ä¿¡/Serveré…±ç­‰å‡å¯ï¼‰</span></span><br><span class="line"><span class="comment"># è¿™é‡Œç¤ºä¾‹ç”¨ Serveré…± https://sct.ftqq.com/ çš„æ¨é€åœ°å€</span></span><br><span class="line">WECHAT_PUSH_URL=<span class="string">&quot;https://sctapi.ftqq.com/ä½ çš„SCKEY.send&quot;</span></span><br><span class="line"></span><br><span class="line">now=$(<span class="built_in">date</span> <span class="string">&#x27;+%F %T&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;===== <span class="variable">$now</span> =====&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># æ£€æŸ¥å†…å­˜ &amp; swap ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[MEMORY]&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line">free -h &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"></span><br><span class="line">swap_total=$(free | awk <span class="string">&#x27;/Swap:/ &#123;print $2&#125;&#x27;</span>)</span><br><span class="line">swap_used=$(free | awk <span class="string">&#x27;/Swap:/ &#123;print $3&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$swap_total</span>&quot;</span> -gt 0 ]; <span class="keyword">then</span></span><br><span class="line">    swap_used_percent=$(( <span class="number">100</span> * swap_used / swap_total ))</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    swap_used_percent=0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[SWAP] Total: <span class="variable">$swap_total</span> KB, Used: <span class="variable">$swap_used</span> KB, Used%: <span class="variable">$swap_used_percent</span>%&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç£ç›˜</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[DISK]&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"><span class="built_in">df</span> -h &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------</span></span><br><span class="line"><span class="comment"># åˆ¤æ–­æ˜¯å¦å‘é€æŠ¥è­¦</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$swap_used_percent</span>&quot;</span> -gt <span class="string">&quot;<span class="variable">$threshold_swap_used_percent</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    alert_msg=<span class="string">&quot;âš ï¸ Swap ä½¿ç”¨ç‡è­¦å‘Šï¼å½“å‰ä½¿ç”¨ç‡ä¸º <span class="variable">$&#123;swap_used_percent&#125;</span>% (é˜ˆå€¼ <span class="variable">$&#123;threshold_swap_used_percent&#125;</span>%)&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[ALERT] <span class="variable">$alert_msg</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‘é€é‚®ä»¶æŠ¥è­¦ï¼ˆéœ€è¦ç³»ç»Ÿæ”¯æŒ mail å‘½ä»¤ï¼‰</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$alert_msg</span>&quot;</span> | mail -s <span class="string">&quot;Swap ä½¿ç”¨ç‡è­¦å‘Š&quot;</span> <span class="string">&quot;<span class="variable">$EMAIL</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‘é€å¾®ä¿¡æ¨é€æŠ¥è­¦</span></span><br><span class="line">    curl -s --get --data-urlencode <span class="string">&quot;title=Swap ä½¿ç”¨ç‡è­¦å‘Š&quot;</span> --data-urlencode <span class="string">&quot;desp=<span class="variable">$alert_msg</span>&quot;</span> <span class="string">&quot;<span class="variable">$WECHAT_PUSH_URL</span>&quot;</span> &gt; /dev/null</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br></pre></td></tr></table></figure>
<hr>
<h1>ğŸ”§ ä½¿ç”¨è¯´æ˜</h1>
<ol>
<li>ä¿®æ”¹è„šæœ¬ä¸­ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">EMAIL=<span class="string">&quot;your_email@example.com&quot;</span></span><br><span class="line">WECHAT_PUSH_URL=<span class="string">&quot;https://sctapi.ftqq.com/ä½ çš„SCKEY.send&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ›¿æ¢æˆä½ çš„é‚®ç®±åœ°å€å’Œå¾®ä¿¡æ¨é€ URLã€‚</p>
<ol start="2">
<li>
<p>ç¡®ä¿ç³»ç»Ÿå·²å®‰è£…å¹¶é…ç½®å¥½ <code>mail</code> å‘½ä»¤ï¼ˆå¦‚ <code>mailutils</code> æˆ– <code>mailx</code>ï¼‰ã€‚</p>
</li>
<li>
<p>ä¿å­˜è„šæœ¬ï¼ˆå¦‚ <code>/usr/local/bin/swap_health.sh</code>ï¼‰ï¼Œèµ‹æƒé™ï¼š</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/swap_health.sh</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>æ‰‹åŠ¨è¿è¡Œæµ‹è¯•ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/local/bin/swap_health.sh</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>æŸ¥çœ‹æ—¥å¿—ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f /var/log/swap_health.log</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚æ¯10åˆ†é’Ÿï¼‰ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*/10 * * * * /usr/local/bin/swap_health.sh</span><br></pre></td></tr></table></figure>
<hr>
<h1>ğŸ“¢ å…³äºå¾®ä¿¡æ¨é€</h1>
<ul>
<li>ä¸Šé¢ç¤ºä¾‹ä½¿ç”¨ <a href="https://sct.ftqq.com/">Serveré…±</a> æœåŠ¡ï¼Œç®€å•æ˜“ç”¨</li>
<li>æ³¨å†Œåè·å– <code>SCKEY</code>ï¼Œæ‹¼æˆæ¨é€ URL</li>
<li>ä¹Ÿå¯ä»¥ç”¨ä¼ä¸šå¾®ä¿¡æœºå™¨äººæˆ–è€…å…¶ä»–å¾®ä¿¡æ¨é€å·¥å…·ï¼Œè°ƒæ•´ <code>curl</code> éƒ¨åˆ†å³å¯</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>vscode setting</title>
    <url>/2022/09/28/vscode%20setting/</url>
    <content><![CDATA[<h1>vscode setting</h1>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;code-runner.saveFileBeforeRun&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;code-runner.runInTerminal&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;editor.mouseWheelZoom&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;explorer.confirmDelete&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;json.schemas&quot;</span>: [</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;problems.decorations.enabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;explorer.compactFolders&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;editor.fastScrollSensitivity&quot;</span>: 6,</span><br><span class="line">    <span class="string">&quot;editor.fontSize&quot;</span>: 20,</span><br><span class="line">    <span class="string">&quot;tabnine.experimentalAutoImports&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;editor.formatOnSave&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;workbench.iconTheme&quot;</span>: <span class="string">&quot;material-icon-theme&quot;</span>,</span><br><span class="line">    <span class="string">&quot;explorer.confirmDragAndDrop&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;java.jdt.ls.java.home&quot;</span>: <span class="string">&quot;D:\\jdk-17_windows-x64_bin\\jdk-17.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;java.import.gradle.java.home&quot;</span>: <span class="string">&quot;D:\\jdk-17_windows-x64_bin\\jdk-17.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[java]&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;editor.suggest.snippetsPreventQuickSuggestions&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;diffEditor.codeLens&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;editor.acceptSuggestionOnCommitCharacter&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;editor.bracketPairColorization.enabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;editor.bracketPairColorization.independentColorPoolPerBracketType&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;editor.mouseWheelZoom&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;editor.suggest.shareSuggestSelections&quot;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;files.exclude&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;**/*.class&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;**/*.exe&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;editor.fontLigatures&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;files.encoding&quot;</span>: <span class="string">&quot;utf8bom&quot;</span>,</span><br><span class="line">    <span class="string">&quot;editor.suggest.snippetsPreventQuickSuggestions&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;settingsSync.ignoredSettings&quot;</span>: [</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;editor.codeActionsOnSave&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;editor.fontWeight&quot;</span>: <span class="string">&quot;normal&quot;</span>,</span><br><span class="line">    <span class="string">&quot;editor.quickSuggestions&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;other&quot;</span>: <span class="string">&quot;on&quot;</span>,</span><br><span class="line">        <span class="string">&quot;comments&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">        <span class="string">&quot;strings&quot;</span>: <span class="string">&quot;on&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;java.jdt.ls.vmargs&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;settingsSync.ignoredExtensions&quot;</span>: [</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;terminal.integrated.enableMultiLinePasteWarning&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;backgroundCover.opacity&quot;</span>: 0.3,</span><br><span class="line">    <span class="string">&quot;backgroundCover.autoStatus&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;sync.gist&quot;</span>: <span class="string">&quot;12b849b762c4f2a961cd2e407ac0f957&quot;</span>,</span><br><span class="line">    <span class="string">&quot;backgroundCover.imagePath&quot;</span>: <span class="string">&quot;d:\\steam\\steamapps\\workshop\\content\\431960\\2791831225\\preview.jpg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;java.configuration.maven.globalSettings&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tomcat.restart_when_http(s)_port_change&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;[html]&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;editor.defaultFormatter&quot;</span>: <span class="string">&quot;vscode.html-language-features&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;translation.provider&quot;</span>: <span class="string">&quot;google&quot;</span>,</span><br><span class="line">    <span class="string">&quot;workbench.colorTheme&quot;</span>: <span class="string">&quot;GitHub Dark&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vscode-office.openOutline&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;workbench.editorAssociations&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;*.md&quot;</span>: <span class="string">&quot;default&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Records</category>
      </categories>
      <tags>
        <tag>setting</tag>
      </tags>
  </entry>
  <entry>
    <title>ssm</title>
    <url>/2025/09/15/ssm/</url>
    <content><![CDATA[<h2 id="SSMæ•´åˆ">SSMæ•´åˆ</h2>
<p>spring + spring mvc + mybatis</p>
<p>spring ï¼šæ•´åˆå‹/è®¾è®¡å‹</p>
<p>spring mvc : æ§åˆ¶å±‚</p>
<p>mybatisï¼šæŒä¹…å±‚</p>
<ol>
<li>æ¶‰åŠ çš„iocå®¹å™¨ï¼šspring mvc+ spring çš„å®¹å™¨</li>
<li>å…³ç³»ï¼šçˆ¶å­å…³ç³»</li>
<li>å­å®¹å™¨å¯ä»¥è®¿é—®çˆ¶å®¹å™¨çš„beanï¼Œä½†æ˜¯çˆ¶å®¹å™¨ä¸èƒ½è®¿é—®å­å®¹å™¨çš„bean</li>
<li>åœ¨ServletContextLinslinerä¸­è·å–Spring iocå®¹å™¨</li>
</ol>
<table>
<thead>
<tr>
<th>é…ç½®å</th>
<th>å¯¹åº”å†…å®¹</th>
<th>å¯¹åº”å®¹å™¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>spring-mvc.xml</td>
<td>controller,springmvcç›¸å…³</td>
<td>webå®¹å™¨</td>
</tr>
<tr>
<td>spring-service.xml</td>
<td>service,aop,txç›¸å…³</td>
<td>rootå®¹å™¨</td>
</tr>
<tr>
<td>spring-mapper.xml</td>
<td>mapper,datasource,mybatisç›¸å…³</td>
<td>rootå®¹å™¨</td>
</tr>
</tbody>
</table>
<p>é…ç½®springçš„iocé…ç½®ã€‚è®©DipatcherServeletåœ¨åˆå§‹åŒ–æ—¶ï¼ŒåŠ è½½spring iocçš„å®¹å™¨ä½œä¸ºçˆ¶å®¹å™¨ï¼ŒContextLoaderListenerä¼šåœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è¿è¡Œã€‚</p>
<h3 id="ä¸‰ä¸ªspringé…ç½®æ–‡ä»¶">ä¸‰ä¸ªspringé…ç½®æ–‡ä»¶:</h3>
<ol>
<li>
<p><code>spring-service.xml </code>      spring-ioc  çˆ¶å®¹å™¨</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;online.zorange&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.RestController&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.name&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-mapper.xml&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>spring-mvc.xml </code>           spring-mvcçš„iocå®¹å™¨ï¼Œç®¡ç†controller</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;online.zorange.controller&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>web.xml </code>   é…ç½®DispacherServelet</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®Spring MVCçš„DispatcherServlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šservletçš„åç§°ä¸º&quot;spring-mvc&quot; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring-mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šservletçš„ç±»ä¸ºSpringçš„DispatcherServlet --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®DispatcherServletçš„åˆå§‹åŒ–å‚æ•°ï¼ŒæŒ‡å®šSpring MVCé…ç½®æ–‡ä»¶çš„ä½ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šè¯¥servletåœ¨webåº”ç”¨å¯åŠ¨æ—¶å³åŠ è½½å’Œåˆ›å»ºï¼Œä¼˜å…ˆçº§ä¸º1 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ˜ å°„servletåç§°&quot;spring-mvc&quot;åˆ°æ‰€æœ‰è¯·æ±‚çš„URLæ¨¡å¼&quot;/&quot; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring-mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®åº”ç”¨ä¸Šä¸‹æ–‡çš„åˆå§‹åŒ–å‚æ•°ï¼ŒæŒ‡å®šSpringæœåŠ¡å±‚é…ç½®æ–‡ä»¶çš„ä½ç½® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-service.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ³¨å†ŒSpringçš„ç›‘å¬å™¨ï¼Œç”¨äºåœ¨åº”ç”¨å¯åŠ¨æ—¶åŠ è½½Springåº”ç”¨ä¸Šä¸‹æ–‡ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>spring-mapper.xml </code>     springæ•´åˆMyBatisçš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        è®¾ç½®é…ç½®æ–‡ä»¶ä½ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        è®¾ç½®æ˜ å°„æ–‡ä»¶ä½ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mapper/*Mapper.xml&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        è®¾ç½®åˆ«å--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;online.zorange.entity&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    è®¾ç½®Mapperæ‰«æçš„åŒ…å--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;online.zorange.mapper&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>mybati-config.xml  </code>      mybatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ•´åˆé…ç½®æ–‡ä»¶æ¥é…ç½®ï¼Œä¸¤ä¸ªä¸€èµ·é…ç½®ä¹Ÿå¯ä»¥ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼•å…¥jdbc.properties--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å°†xxx_xxxè¿™æ ·çš„åˆ—åè‡ªåŠ¨æ˜ å°„åˆ°xxXxxè¿™æ ·é©¼å³°å¼å‘½åçš„å±æ€§å --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¼€å¯resultMapè‡ªåŠ¨æ˜ å°„ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;FULL&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--        è®¾ç½®åˆ«å--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;online.zorange.entity&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;helperDialect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>ä¸‰è§’æ´²æ”¹æªç </title>
    <url>/2025/09/15/%E4%B8%89%E8%A7%92%E6%B4%B2%E6%94%B9%E6%9E%AA%E7%A0%81/</url>
    <content><![CDATA[<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">M14å°„æ‰‹æ­¥æª-å…¨é¢æˆ˜åœº-6H6B6KS0383RCT51GRAKE</span><br><span class="line">AK-12çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B6NS0383RCT51GRAKE</span><br><span class="line">M7æˆ˜æ–—æ­¥æª-å…¨é¢æˆ˜åœº-6H6B3RG0383RCT51GRAKE</span><br><span class="line">AUGçªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B6TG0383RCT51GRAKE</span><br><span class="line">PKMé€šç”¨æœºæª-å…¨é¢æˆ˜åœº-6H6B6VC0383RCT51GRAKE</span><br><span class="line">M250é€šç”¨æœºæª-å…¨é¢æˆ˜åœº-6H6B79G0383RCT51GRAKE</span><br><span class="line">M249è½»æœºæª-å…¨é¢æˆ˜åœº-6H6B8040383RCT51GRAKE</span><br><span class="line">725åŒç®¡éœ°å¼¹æª-å…¨é¢æˆ˜åœº-6H6B68O0383RCT51GRAKE</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">KC17çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B59K0383RCT51GRAKE</span><br><span class="line">CAR-15çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B5RO0383RCT51GRAKE</span><br><span class="line">K416çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B5VS0383RCT51GRAKE</span><br><span class="line">UZIå†²é”‹æª-å…¨é¢æˆ˜åœº-6H6B6180383RCT51GRAKE</span><br><span class="line">QCQ171å†²é”‹æª-å…¨é¢æˆ˜åœº-6H6B6380383RCT51GRAKE</span><br><span class="line">P90å†²é”‹æª-å…¨é¢æˆ˜åœº-6H6B65C0383RCT51GRAKE</span><br><span class="line">MP7å†²é”‹æª-å…¨é¢æˆ˜åœº-6H6B6700383RCT51GRAKE</span><br><span class="line">725åŒç®¡éœ°å¼¹æª-å…¨é¢æˆ˜åœº-6H6B68O0383RCT51GRAKE</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AS Valçªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6GR61OC0383RCT51GRAKE</span><br><span class="line">SG552çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B3A40383RCT51GRAKE</span><br><span class="line">AK-12çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B3C00383RCT51GRAKE</span><br><span class="line">AKMçªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B3NG0383RCT51GRAKE</span><br><span class="line">M4A1çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B3P00383RCT51GRAKE</span><br><span class="line">M7æˆ˜æ–—æ­¥æª-å…¨é¢æˆ˜åœº-6H6B3RG0383RCT51GRAKE</span><br><span class="line">K416çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B3TK0383RCT51GRAKE</span><br><span class="line">K437çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B42G0383RCT51GRAKE</span><br><span class="line">è…¾é¾™çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6GRIFF00383RCT51GRAKE</span><br><span class="line">S12Kéœ°å¼¹æª-å…¨é¢æˆ˜åœº-6H6B46G0383RCT51GRAKE</span><br><span class="line">725åŒç®¡éœ°å¼¹æª-å…¨é¢æˆ˜åœº-6H6B4940383RCT51GRAKE</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">KC17çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B59K0383RCT51GRAKE</span><br><span class="line">CAR-15çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B5RO0383RCT51GRAKE</span><br><span class="line">K416çªå‡»æ­¥æª-å…¨é¢æˆ˜åœº-6H6B5VS0383RCT51GRAKE</span><br><span class="line">UZIå†²é”‹æª-å…¨é¢æˆ˜åœº-6H6B6180383RCT51GRAKE</span><br><span class="line">QCQ171å†²é”‹æª-å…¨é¢æˆ˜åœº-6H6B6380383RCT51GRAKE</span><br><span class="line">P90å†²é”‹æª-å…¨é¢æˆ˜åœº-6H6B65C0383RCT51GRAKE</span><br><span class="line">MP7å†²é”‹æª-å…¨é¢æˆ˜åœº-6H6B6700383RCT51GRAKE</span><br><span class="line">725åŒç®¡éœ°å¼¹æª-å…¨é¢æˆ˜åœº-6H6B68O0383RCT51GRAKE</span><br></pre></td></tr></table></figure>
<h1>çƒ½ç«</h1>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">M14å°„æ‰‹æ­¥æªï¹£çƒ½ç«åœ°</span><br><span class="line">å¸¦ï¹£6GBMGF007ODLT6ETQT3GS</span><br><span class="line">M700ç‹™å‡»æ­¥æªï¹£çƒ½ç«åœ°</span><br><span class="line">å¸¦ï¹£6FG5OGC051CKRTT084FIR </span><br><span class="line">M7æˆ˜æ–—æ­¥æªï¹£çƒ½ç«åœ°å¸¦ï¹£6FPVFLC07ODLT6ETQT3GS </span><br><span class="line">AWMç‹™å‡»æ­¥æªï¹£çƒ½ç«åœ°å¸¦ï¹£6F32GRK09HAS1HSET4H5P </span><br><span class="line">Vectorå†²é”‹æªï¹£çƒ½ç«åœ°å¸¦ï¹£6F4P1BG07ODLT6ETQT3GS </span><br><span class="line">SR-3Mç´§å‡‘çªå‡»æ­¥æªï¹£çƒ½ç«åœ°å¸¦ï¹£6F6Q83007ODLT6ETQT3GS </span><br><span class="line">M250é€šç”¨æœºæªï¹£çƒ½ç«åœ°å¸¦ï¹£6FHDKVO03UJ179LGPMGNB </span><br><span class="line">SMG-45å†²é”‹æªï¹£çƒ½ç«åœ°å¸¦ï¹£6FQ93AC02J1BTCMSP82T7</span><br><span class="line">MP7å†²é”‹æªï¹£çƒ½ç«åœ°å¸¦ï¹£6FVLU2G07ODLT6ETQT3GS </span><br><span class="line">K437çªå‡»æ­¥æªï¹£çƒ½ç«åœ°å¸¦ï¹£6G08FQSOALA6TB7GJCL3H </span><br><span class="line">AS Valçªå‡»æ­¥æªï¹£çƒ½ç«åœ°å¸¦ï¹£6G4777S08MB5NDOJ56KH8</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>äº‹åŠ¡çš„å››å¤§ç‰¹æ€§</title>
    <url>/2025/09/15/%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7/</url>
    <content><![CDATA[<p>æ¦‚è¿°<br>
æ•°æ®åº“ä¸­çš„äº‹åŠ¡æœ‰å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰ï¼Œåˆ†åˆ«æ˜¯åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ã€‚é’ˆå¯¹éš”ç¦»æ€§ï¼Œè¿˜æœ‰å››ä¸ªéš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«æ˜¯ä¸²è¡ŒåŒ–ã€å¯é‡å¤è¯»ã€è¯»å·²æäº¤å’Œè¯»æœªæäº¤ã€‚è¿™å››ä¸ªéš”ç¦»çº§åˆ«æ˜¯é’ˆå¯¹å¹¶å‘äº‹åŠ¡ä¸­å­˜åœ¨çš„ä¸‰ä¸ªé—®é¢˜ï¼Œåˆ†åˆ«æ˜¯è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</p>
<h2 id="äº‹åŠ¡çš„å››å¤§ç‰¹æ€§">äº‹åŠ¡çš„å››å¤§ç‰¹æ€§</h2>
<ol>
<li>
<p>åŸå­æ€§ï¼ˆAtomicityï¼‰<br>
äº‹åŠ¡åŒ…å«çš„æ‰€æœ‰æ•°æ®åº“æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¸å…¨éƒ¨å¤±è´¥å›æ»šã€‚</p>
</li>
<li>
<p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰<br>
ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡å¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åéƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚ä¸€è‡´æ€§è§„å®šäº‹åŠ¡æäº¤å‰ååªå­˜åœ¨ä¸¤ä¸ªçŠ¶æ€ï¼Œæäº¤å‰çš„çŠ¶æ€å’Œæäº¤åçš„çŠ¶æ€ï¼Œç»å¯¹ä¸ä¼šå‡ºç°ä¸­é—´çš„çŠ¶æ€ã€‚æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯é“¶è¡Œè½¬è´¦ï¼ŒAå’ŒBä¹‹é—´äº’ç›¸è½¬è´¦ï¼Œè´¦é¢åŠ èµ·æ¥æ€»å’Œ5000å…ƒï¼Œæ— è®ºAå’ŒBä¹‹é—´æ€ä¹ˆè½¬ï¼Œè½¬å‡ æ¬¡ï¼ŒæˆåŠŸä¸å¦ï¼Œäº‹åŠ¡ç»“æŸåAå’ŒBè´¦é¢æ€»å’Œè¿˜æ˜¯5000å…ƒã€‚</p>
</li>
<li>
<p>éš”ç¦»æ€§ï¼ˆIsolationï¼‰<br>
éš”ç¦»æ€§æ˜¯å½“å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œæ¯”å¦‚æ“ä½œåŒä¸€å¼ è¡¨æ—¶ï¼Œæ•°æ®åº“ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·å¼€å¯çš„äº‹åŠ¡ï¼Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡çš„æ“ä½œæ‰€å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´è¦ç›¸äº’éš”ç¦»ã€‚å³è¦è¾¾åˆ°è¿™ä¹ˆä¸€ç§æ•ˆæœï¼šå¯¹äºä»»æ„ä¸¤ä¸ªå¹¶å‘çš„äº‹åŠ¡T1å’ŒT2ï¼Œåœ¨äº‹åŠ¡T1çœ‹æ¥ï¼ŒT2è¦ä¹ˆåœ¨T1å¼€å§‹ä¹‹å‰å°±å·²ç»ç»“æŸï¼Œè¦ä¹ˆåœ¨T1ç»“æŸä¹‹åæ‰å¼€å§‹ï¼Œè¿™æ ·æ¯ä¸ªäº‹åŠ¡éƒ½æ„Ÿè§‰ä¸åˆ°æœ‰å…¶ä»–äº‹åŠ¡åœ¨å¹¶å‘åœ°æ‰§è¡Œã€‚</p>
</li>
<li>
<p>æŒä¹…æ€§ï¼ˆDurabilityï¼‰<br>
æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤äº†ï¼Œé‚£ä¹ˆå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä¾¿æ˜¯åœ¨æ•°æ®åº“ç³»ç»Ÿé‡åˆ°æ•…éšœçš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šä¸¢å¤±æäº¤äº‹åŠ¡çš„æ“ä½œã€‚</p>
</li>
</ol>
<h2 id="äº‹åŠ¡å¹¶å‘æ—¶å­˜åœ¨çš„é—®é¢˜">äº‹åŠ¡å¹¶å‘æ—¶å­˜åœ¨çš„é—®é¢˜</h2>
<ol>
<li>
<p>è„è¯»ï¼ˆDirty Readï¼‰<br>
è„æ•°æ®æ‰€æŒ‡çš„å°±æ˜¯æœªæäº¤çš„æ•°æ®ï¼Œè€Œè„è¯»æ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å¤„ç†è¿‡ç¨‹é‡Œè¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡ä¸­çš„æ•°æ®ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªäº‹åŠ¡æ­£åœ¨å¯¹ä¸€æ¡è®°å½•åšä¿®æ”¹ï¼Œåœ¨è¿™ä¸ªäº‹åŠ¡å®Œæˆå¹¶æäº¤ä¹‹å‰ï¼Œè¿™æ¡æ•°æ®æ˜¯å¤„äºå¾…å®šçŠ¶æ€çš„ï¼ˆå¯èƒ½æäº¤ä¹Ÿå¯èƒ½å›æ»šï¼‰ï¼Œè¿™æ—¶ï¼Œç¬¬äºŒä¸ªäº‹åŠ¡æ¥è¯»å–è¿™æ¡æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œå¹¶æ®æ­¤åšè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œå°±ä¼šäº§ç”Ÿæœªæäº¤çš„æ•°æ®ä¾èµ–å…³ç³»ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸ºè„è¯»ã€‚</p>
</li>
<li>
<p>ä¸å¯é‡å¤è¯»ï¼ˆNon-repeatable Readï¼‰<br>
ä¸€ä¸ªäº‹åŠ¡å…ˆåè¯»å–åŒä¸€æ¡è®°å½•ï¼Œè€Œäº‹åŠ¡åœ¨ä¸¤æ¬¡è¯»å–ä¹‹é—´è¯¥æ•°æ®è¢«å…¶å®ƒäº‹åŠ¡æ‰€ä¿®æ”¹ï¼Œåˆ™ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸åŒï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä¸å¯é‡å¤è¯»ã€‚ä¾‹å¦‚äº‹åŠ¡T1åœ¨è¯»å–æŸä¸€æ•°æ®ï¼Œè€Œäº‹åŠ¡T2ç«‹é©¬ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®å¹¶ä¸”æäº¤äº‹åŠ¡ç»™æ•°æ®åº“ï¼Œäº‹åŠ¡T1å†æ¬¡è¯»å–è¯¥æ•°æ®å°±å¾—åˆ°äº†ä¸åŒçš„ç»“æœï¼Œå‘é€äº†ä¸å¯é‡å¤è¯»ã€‚</p>
</li>
</ol>
<p>ä¸å¯é‡å¤è¯»å’Œè„è¯»çš„åŒºåˆ«ï¼šè„è¯»æ˜¯æŸä¸€äº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„è„æ•°æ®ï¼Œè€Œä¸å¯é‡å¤è¯»åˆ™æ˜¯åœ¨åŒä¸€äº‹åŠ¡å†…è¯»å–äº†å‰ä¸€äº‹åŠ¡æäº¤çš„æ•°æ®ï¼Œå³å‰ä¸€æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯å¦ä¸€ä¸ªäº‹åŠ¡æäº¤å‰ï¼Œåä¸€æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯æäº¤åçš„ã€‚</p>
<ol start="3">
<li>å¹»è¯»ï¼ˆPhantom Readï¼‰<br>
ä¸€ä¸ªäº‹åŠ¡æŒ‰ç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶é‡æ–°è¯»å–ä»¥å‰æ£€ç´¢è¿‡çš„æ•°æ®ï¼Œå´å‘ç°å…¶ä»–äº‹åŠ¡æ’å…¥äº†æ»¡è¶³å…¶æŸ¥è¯¢æ¡ä»¶çš„æ–°æ•°æ®ï¼Œè¿™ç§ç°è±¡å°±ç§°ä¸ºå¹»è¯»ã€‚å¹»è¯»æ˜¯æŒ‡å½“äº‹åŠ¡ä¸æ˜¯ç‹¬ç«‹æ‰§è¡Œæ—¶å‘ç”Ÿçš„ä¸€ç§ç°è±¡ï¼Œä¾‹å¦‚ç¬¬ä¸€ä¸ªäº‹åŠ¡å¯¹ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œæ¯”å¦‚è¿™ç§ä¿®æ”¹æ¶‰åŠåˆ°è¡¨ä¸­çš„â€œå…¨éƒ¨æ•°æ®è¡Œâ€ã€‚åŒæ—¶ï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿä¿®æ”¹è¿™ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè¿™ç§ä¿®æ”¹æ˜¯å‘è¡¨ä¸­æ’å…¥â€œä¸€è¡Œæ–°æ•°æ®â€ã€‚é‚£ä¹ˆï¼Œä»¥åå°±ä¼šå‘ç”Ÿæ“ä½œç¬¬ä¸€ä¸ªäº‹åŠ¡çš„ç”¨æˆ·å‘ç°è¡¨ä¸­è¿˜å­˜åœ¨æ²¡æœ‰ä¿®æ”¹çš„æ•°æ®è¡Œï¼Œå°±å¥½è±¡å‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ã€‚</li>
</ol>
<p>å¹»è¯»å’Œä¸å¯é‡å¤è¯»éƒ½æ˜¯è¯»å–äº†å¦ä¸€æ¡å·²ç»æäº¤çš„äº‹åŠ¡ï¼ˆè¿™ç‚¹å°±è„è¯»ä¸åŒï¼‰ï¼Œæ‰€ä¸åŒçš„æ˜¯ä¸å¯é‡å¤è¯»æŸ¥è¯¢çš„éƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®é¡¹ï¼Œè€Œå¹»è¯»é’ˆå¯¹çš„æ˜¯ä¸€æ‰¹æ•°æ®æ•´ä½“ï¼ˆæ¯”å¦‚æ•°æ®çš„ä¸ªæ•°ï¼‰ã€‚</p>
<p>åœ¨å®é™…å¼€å‘å’Œä½¿ç”¨ä¸­ï¼Œå…¶å®å¹»è¯»é—®é¢˜æ˜¯å¯ä»¥æ¥å—ä¹Ÿç¬¦åˆç”¨æˆ·çš„å¿ƒç†é¢„æœŸï¼Œæ¯”å¦‚åœ¨æ·˜å®åŒåä¸€æŠ¢ä¸œè¥¿ï¼Œç‚¹å‡»â€œè´­ä¹°â€ï¼ŒæˆåŠŸè¿›å…¥**â€œä¸‹å•é¡µé¢â€ï¼Œç»“æœåˆ°â€œä»˜æ¬¾é¡µé¢â€**å´æç¤ºå·²ç»è¢«æŠ¢å®Œï¼Œè¿™æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<h2 id="å››ä¸ªéš”ç¦»çº§åˆ«">å››ä¸ªéš”ç¦»çº§åˆ«</h2>
<ol>
<li>
<p>è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰<br>
æ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚æœ¬éš”ç¦»çº§åˆ«æ˜¯æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œè™½ç„¶æ‹¥æœ‰è¶…é«˜çš„å¹¶å‘å¤„ç†èƒ½åŠ›åŠå¾ˆä½çš„ç³»ç»Ÿå¼€é”€ï¼Œä½†å¾ˆå°‘ç”¨äºå®é™…åº”ç”¨ã€‚å› ä¸ºé‡‡ç”¨è¿™ç§éš”ç¦»çº§åˆ«åªèƒ½é˜²æ­¢æ›´æ–°ä¸¢å¤±é—®é¢˜ï¼ˆè¿™ä¸ªé—®é¢˜ç°ä»£å…³ç³»å‹æ•°æ®åº“å·²ç»ä¸ä¼šå‘ç”Ÿï¼‰ï¼Œä¸èƒ½è§£å†³è„è¯»ï¼Œä¸å¯é‡å¤è¯»åŠå¹»è¯»é—®é¢˜ã€‚</p>
</li>
<li>
<p>è¯»å·²æäº¤ï¼ˆRead committedï¼‰<br>
è¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼ˆä½†ä¸æ˜¯MySQLé»˜è®¤çš„ï¼‰ã€‚å®ƒæ»¡è¶³äº†éš”ç¦»çš„ç®€å•å®šä¹‰ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚è¿™ç§éš”ç¦»çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»é—®é¢˜ï¼Œä½†ä¼šå‡ºç°ä¸å¯é‡å¤è¯»åŠå¹»è¯»é—®é¢˜ã€‚</p>
</li>
<li>
<p>å¯é‡å¤è¯»ï¼ˆRepeatable readï¼‰<br>
è¿™æ˜¯MySQLçš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒç¡®ä¿åŒä¸€äº‹åŠ¡çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶å‘è¯»å–æ•°æ®æ—¶ï¼Œä¼šçœ‹åˆ°åŒæ ·çš„æ•°æ®è¡Œã€‚è¿™ç§éš”ç¦»çº§åˆ«å¯ä»¥é˜²æ­¢é™¤å¹»è¯»å¤–çš„å…¶ä»–é—®é¢˜ã€‚</p>
</li>
<li>
<p>ä¸²è¡ŒåŒ–ï¼ˆSerializable ï¼‰<br>
è¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡å¼ºåˆ¶äº‹åŠ¡æ’åºï¼Œä½¿ä¹‹ä¸å¯èƒ½ç›¸äº’å†²çªï¼Œä»è€Œè§£å†³å¹»è¯»ã€ç¬¬äºŒç±»æ›´æ–°ä¸¢å¤±é—®é¢˜ã€‚åœ¨è¿™ä¸ªçº§åˆ«ï¼Œå¯ä»¥è§£å†³ä¸Šé¢æåˆ°çš„æ‰€æœ‰å¹¶å‘é—®é¢˜ï¼Œä½†å¯èƒ½å¯¼è‡´å¤§é‡çš„è¶…æ—¶ç°è±¡å’Œé”ç«äº‰ï¼Œé€šå¸¸æ•°æ®åº“ä¸ä¼šç”¨è¿™ä¸ªéš”ç¦»çº§åˆ«ï¼Œæˆ‘ä»¬éœ€è¦å…¶ä»–çš„æœºåˆ¶æ¥è§£å†³è¿™äº›é—®é¢˜:ä¹è§‚é”å’Œæ‚²è§‚é”ã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>ä»£ç†æ¨¡å¼</title>
    <url>/2025/09/15/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="ä»£ç†æ¨¡å¼">ä»£ç†æ¨¡å¼</h2>
<ol>
<li>åŠŸèƒ½å¢å¼ºï¼šåœ¨åŸæœ‰çš„åŠŸèƒ½ä¸Šï¼Œå¢åŠ äº†é¢å¤–çš„åŠŸèƒ½ï¼Œ</li>
<li>æ§åˆ¶è®¿é—®ï¼šä»£ç†ç±»ä¸è®©ä½ è®¿é—®ç›®æ ‡å¯¹è±¡ï¼Œåªèƒ½é€šè¿‡ä»£ç†å¯¹è±¡æ¥æ§åˆ¶ç›®æ ‡å¯¹è±¡ã€‚</li>
</ol>
<blockquote>
<p>ä½¿ç”¨ä»£ç†å¯¹è±¡åŒ…è£…ç›®æ ‡å¯¹è±¡ï¼Œæ¯æ¬¡è®¿é—®ç›®æ ‡å¯¹è±¡æ—¶ï¼Œéƒ½é€šè¿‡ä»£ç†å¯¹è±¡æ¥è®¿é—®ã€‚</p>
<p>ä»£ç†å¯¹è±¡å°±å¯ä»¥æ§åˆ¶ç›®æ ‡å¯¹è±¡å®ç°åŠŸèƒ½çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”åœ¨å…¶ä¸­æ·»åŠ é¢å¤–çš„åŠŸèƒ½.</p>
</blockquote>
<p>ä¸¤ä¸ªä¸€è‡´ï¼š</p>
<ol>
<li>
<p>ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ åŠŸèƒ½ä¸€è‡´ ï¼šä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°ç›¸åŒçš„æ¥å£</p>
</li>
<li>
<p>ç»“æœä¸€è‡´ : ä»£ç†å¯¹è±¡å®ç°åŠŸèƒ½çš„è¿‡ç¨‹ï¼Œå°±æ˜¯ç›®æ ‡å¯¹è±¡å®ç°åŠŸèƒ½çš„è¿‡ç¨‹ã€‚</p>
</li>
</ol>
<h3 id="é™æ€ä»£ç†">é™æ€ä»£ç†</h3>
<blockquote>
<p>ä»£ç†ç±»æ˜¯è‡ªå·±æ‰‹åŠ¨å®ç°çš„ï¼Œ</p>
<p>ç›®æ ‡ç±»æ˜¯ç¡®å®šå¥½çš„ã€‚</p>
</blockquote>
<ol>
<li>æ ¸å¿ƒåŠŸèƒ½å‰</li>
<li>æ ¸å¿ƒåŠŸèƒ½å</li>
<li>catchä¸­</li>
<li>finallyä¸­</li>
</ol>
<h3 id="åŠ¨æ€ä»£ç†">åŠ¨æ€ä»£ç†</h3>
<h4 id="1-JDKåŠ¨æ€ä»£ç†-Interface-Proxy">1. JDKåŠ¨æ€ä»£ç† (Interface Proxy)</h4>
<p>JDKåŠ¨æ€ä»£ç†ä¸»è¦ä¾èµ–äº<code>java.lang.reflect.Proxy</code>ç±»å’Œ<code>java.lang.reflect.InvocationHandler</code>æ¥å£ã€‚JDKåŠ¨æ€ä»£ç†é€‚ç”¨äºé‚£äº›å®ç°äº†æ¥å£çš„ç±»ã€‚</p>
<ul>
<li>
<p><strong>å®ç°åŸç†</strong>ï¼š</p>
<ul>
<li>åˆ©ç”¨åå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªå®ç°äº†ç»™å®šæ¥å£åˆ—è¡¨çš„æ–°ç±»ã€‚</li>
<li>è¿™ä¸ªæ–°ç±»å°†ä»£ç†åŸå§‹çš„å¯¹è±¡ï¼Œå¹¶ä¸”æ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨éƒ½å°†è¢«è½¬å‘åˆ°ä¸€ä¸ªå®ç°äº†<code>InvocationHandler</code>æ¥å£çš„å®ä¾‹ä¸Šã€‚</li>
<li><code>InvocationHandler</code>çš„<code>invoke</code>æ–¹æ³•ä¼šåœ¨æ¯æ¬¡ä»£ç†å¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶è§¦å‘ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MyInterface target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyInterfaceHandler</span><span class="params">(MyInterface target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before method call&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;After method call&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">MyInterface</span> <span class="variable">myInterface</span> <span class="operator">=</span> (MyInterface) Proxy.newProxyInstance(</span><br><span class="line">    MyInterface.class.getClassLoader(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[]&#123;MyInterface.class&#125;,</span><br><span class="line">    handler</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>æ— éœ€ç¼–å†™ä»£ç†ç±»çš„æºä»£ç ã€‚</li>
<li>ä»£ç†ç±»åœ¨è¿è¡Œæ—¶ç”Ÿæˆï¼Œå‡å°‘äº†ç¼–ç å·¥ä½œé‡ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ã€‚</li>
<li>å¦‚æœæ²¡æœ‰å®ç°æ¥å£ï¼Œåˆ™æ— æ³•ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ã€‚</li>
</ul>
</li>
</ul>
<h4 id="2-CGLIBåŠ¨æ€ä»£ç†-Subclass-Proxy">2. CGLIBåŠ¨æ€ä»£ç† (Subclass Proxy)</h4>
<p>CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªå¼ºå¤§çš„é«˜æ€§èƒ½çš„ä»£ç ç”Ÿæˆåº“ï¼Œå®ƒä½¿ç”¨ASMï¼ˆå­—èŠ‚ç æ“ä½œåº“ï¼‰æ¥åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ã€‚</p>
<ul>
<li>
<p><strong>å®ç°åŸç†</strong>ï¼š</p>
<ul>
<li>é€šè¿‡å­—èŠ‚ç æŠ€æœ¯ä¸ºä¸€ä¸ªç±»åˆ›å»ºä¸€ä¸ªå­ç±»å®ä¾‹ã€‚</li>
<li>è¿™ä¸ªå­ç±»é‡å†™äº†çˆ¶ç±»çš„æ‰€æœ‰é<code>final</code>æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å‰åæ·»åŠ é¢å¤–çš„é€»è¾‘ã€‚</li>
<li>ä½¿ç”¨<code>Enhancer</code>ç±»æ¥åˆ›å»ºåŠ¨æ€ä»£ç†ç±»ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Doing something...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">enhancer.setSuperclass(MyClass.class);</span><br><span class="line">enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">MethodInterceptor</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before method call&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proxy.invokeSuper(obj, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;After method call&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">myClass</span> <span class="operator">=</span> (MyClass) enhancer.create();</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ã€‚</li>
<li>å¯ä»¥ä»£ç†ä»»æ„ç±»ï¼Œåªè¦è¯¥ç±»ä¸æ˜¯<code>final</code>çš„ï¼Œä¸”å…¶æ–¹æ³•ä¸æ˜¯<code>final</code>çš„ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ç”Ÿæˆçš„ä»£ç†ç±»æ¯”JDKåŠ¨æ€ä»£ç†è¦ç¨å¾®æ…¢ä¸€ç‚¹ã€‚</li>
<li>ä¸èƒ½ä»£ç†<code>final</code>ç±»å’Œ<code>final</code>æ–¹æ³•ã€‚</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>ä»£ç ç”Ÿæˆå™¨</title>
    <url>/2023/11/01/%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/</url>
    <content><![CDATA[<h2 id="Mybatis-plus-ä»£ç ç”Ÿæˆå™¨">Mybatis-plus ä»£ç ç”Ÿæˆå™¨</h2>
<div class="note info no-icon modern"><p><strong>ä½¿ç”¨ä¹‹å‰å¤‡ä»½ä»£ç ï¼ï¼ï¼</strong></p>
</div>
<h3 id="ğŸ“–ä¾èµ–">ğŸ“–ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatisä»£ç ç”Ÿæˆå™¨--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--velocityæ¨¡æ¿ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>utils/CodeGenerator.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.springboot.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.FastAutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.OutputFile;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="comment"> * Created by macro on 2018/4/26.</span></span><br><span class="line"><span class="comment"> * Modified by zorange on 2020/4/26.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> zorange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/26 22:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGenerator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        generate();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">generate</span><span class="params">()</span> &#123;</span><br><span class="line">        FastAutoGenerator.create(<span class="string">&quot;jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;root&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;421232&quot;</span>)</span><br><span class="line">                .globalConfig(builder -&gt; &#123;</span><br><span class="line">                    builder.author(<span class="string">&quot;zorange&quot;</span>)</span><br><span class="line">                            .fileOverride()</span><br><span class="line">                            .outputDir(<span class="string">&quot;C:\\Users\\15629\\Desktop\\å‰åç«¯åˆ†ç¦»å¼€å‘\\springboot\\src\\main\\java&quot;</span>)</span><br><span class="line">                            .enableSwagger();</span><br><span class="line">                &#125;)</span><br><span class="line">                .packageConfig(builder -&gt; &#123;</span><br><span class="line">                    builder.parent(<span class="string">&quot;online.zorange.springboot&quot;</span>) <span class="comment">// è®¾ç½®çˆ¶åŒ…å</span></span><br><span class="line">                            .moduleName(<span class="literal">null</span>)<span class="comment">//æ¨¡å—å</span></span><br><span class="line">                            .pathInfo(Collections.singletonMap(OutputFile.mapperXml, <span class="string">&quot;C:\\Users\\15629\\Desktop\\å‰åç«¯åˆ†ç¦»å¼€å‘\\springboot\\src\\main\\resources\\mapper\\&quot;</span>)); <span class="comment">// è®¾ç½®mapper.xmlç”Ÿæˆè·¯å¾„</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .strategyConfig(builder -&gt; &#123;</span><br><span class="line">                    builder.entityBuilder().enableLombok();  <span class="comment">// ä¸ºå®ä½“ç±»æ·»åŠ lombokæ³¨è§£</span></span><br><span class="line">                    builder.controllerBuilder().enableRestStyle(); <span class="comment">// ä¸ºæ§åˆ¶å™¨æ·»åŠ @RestControlleræ³¨è§£</span></span><br><span class="line">                    builder.mapperBuilder().enableMapperAnnotation().build(); <span class="comment">// ä¸ºmapperæ·»åŠ @Mapperæ³¨è§£</span></span><br><span class="line">                    builder.addInclude(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">                            .addTablePrefix(<span class="string">&quot;t_&quot;</span>);</span><br><span class="line">                &#125;)</span><br><span class="line"><span class="comment">//                .templateEngine(new FreemarkerTemplateEngine()) // æŒ‡å®šæ¨¡æ¿å¼•æ“ï¼Œé»˜è®¤æ˜¯VelocityTemplateEngine ï¼Œéœ€è¦å¼•å…¥ç›¸å…³å¼•æ“ä¾èµ–</span></span><br><span class="line">                .execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="è§„åˆ™ï¼š">è§„åˆ™ï¼š</h3>
<ol>
<li>controller.java.vm</li>
</ol>
<figure class="highlight v"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> $&#123;<span class="keyword">package</span><span class="variable">.Controller</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com<span class="variable">.baomidou</span><span class="variable">.mybatisplus</span><span class="variable">.extension</span><span class="variable">.plugins</span><span class="variable">.pagination</span><span class="variable">.Page</span>;</span><br><span class="line"><span class="keyword">import</span> org<span class="variable">.springframework</span><span class="variable">.web</span><span class="variable">.bind</span><span class="variable">.annotation</span>.*;</span><br><span class="line"><span class="keyword">import</span> javax<span class="variable">.annotation</span><span class="variable">.Resource</span>;</span><br><span class="line"><span class="keyword">import</span> java<span class="variable">.util</span><span class="variable">.List</span>;</span><br><span class="line"><span class="keyword">import</span> com<span class="variable">.baomidou</span><span class="variable">.mybatisplus</span><span class="variable">.core</span><span class="variable">.conditions</span><span class="variable">.query</span><span class="variable">.QueryWrapper</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> $&#123;<span class="keyword">package</span><span class="variable">.Entity</span>&#125;.$&#123;entity&#125;;</span><br><span class="line"><span class="keyword">import</span> $&#123;<span class="keyword">package</span><span class="variable">.Service</span>&#125;.$&#123;<span class="keyword">table</span><span class="variable">.serviceName</span>&#125;;</span><br><span class="line"></span><br><span class="line">#<span class="keyword">if</span>($&#123;restControllerStyle&#125;)</span><br><span class="line"><span class="keyword">import</span> org<span class="variable">.springframework</span><span class="variable">.web</span><span class="variable">.bind</span><span class="variable">.annotation</span><span class="variable">.RestController</span>;</span><br><span class="line">#<span class="keyword">else</span></span><br><span class="line"><span class="keyword">import</span> org<span class="variable">.springframework</span><span class="variable">.stereotype</span><span class="variable">.Controller</span>;</span><br><span class="line">#<span class="keyword">end</span></span><br><span class="line">#<span class="keyword">if</span>($&#123;superControllerClassPackage&#125;)</span><br><span class="line"><span class="keyword">import</span> $&#123;superControllerClassPackage&#125;;</span><br><span class="line">#<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * $!&#123;table.comment&#125; å‰ç«¯æ§åˆ¶å™¨</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @author $&#123;author&#125;</span></span><br><span class="line"><span class="comment"> * @since $&#123;date&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">#<span class="keyword">if</span>($&#123;restControllerStyle&#125;)</span><br><span class="line">@RestController</span><br><span class="line">#<span class="keyword">else</span></span><br><span class="line">@Controller</span><br><span class="line">#<span class="keyword">end</span></span><br><span class="line">@RequestMapping(<span class="string">&quot;#if($&#123;package.ModuleName&#125;)/$&#123;package.ModuleName&#125;#end/#if($&#123;controllerMappingHyphenStyle&#125;)$&#123;controllerMappingHyphen&#125;#else$&#123;table.entityPath&#125;#end&quot;</span>)</span><br><span class="line">#<span class="keyword">if</span>($&#123;kotlin&#125;)</span><br><span class="line"><span class="keyword">class</span> $&#123;<span class="keyword">table</span><span class="variable">.controllerName</span>&#125;#<span class="keyword">if</span>($&#123;superControllerClass&#125;) : $&#123;superControllerClass&#125;()#<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">#<span class="keyword">else</span></span><br><span class="line">#<span class="keyword">if</span>($&#123;superControllerClass&#125;)</span><br><span class="line">public <span class="keyword">class</span> $&#123;<span class="keyword">table</span><span class="variable">.controllerName</span>&#125; <span class="keyword">extends</span> $&#123;superControllerClass&#125; &#123;</span><br><span class="line">#<span class="keyword">else</span></span><br><span class="line">public <span class="keyword">class</span> $&#123;<span class="keyword">table</span><span class="variable">.controllerName</span>&#125; &#123;</span><br><span class="line">#<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private $&#123;<span class="keyword">table</span><span class="variable">.serviceName</span>&#125; $&#123;<span class="keyword">table</span><span class="variable">.entityPath</span>&#125;Service;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ–°å¢å’Œä¿®æ”¹</span></span><br><span class="line"><span class="comment">    * @param $&#123;table.entityPath&#125; å®ä½“å¯¹è±¡</span></span><br><span class="line"><span class="comment">    * @return Result</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    @PostMapping</span><br><span class="line">    public boolean save(@RequestBody $&#123;entity&#125; $&#123;<span class="keyword">table</span><span class="variable">.entityPath</span>&#125;) &#123;</span><br><span class="line">        <span class="keyword">return</span> $&#123;<span class="keyword">table</span><span class="variable">.entityPath</span>&#125;Service<span class="variable">.saveOrUpdate</span>($&#123;<span class="keyword">table</span><span class="variable">.entityPath</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®idåˆ é™¤</span></span><br><span class="line"><span class="comment">    * @param id ä¸»é”®id</span></span><br><span class="line"><span class="comment">    * @return boolean</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    @DeleteMapping(<span class="string">&quot;/&#123;id&#125;&quot;</span>)</span><br><span class="line">    public boolean deleteById(@PathVariable Integer id) &#123;</span><br><span class="line">        <span class="keyword">return</span> $&#123;<span class="keyword">table</span><span class="variable">.entityPath</span>&#125;Service<span class="variable">.removeById</span>(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æŸ¥è¯¢æ‰€æœ‰</span></span><br><span class="line"><span class="comment">    * @return List&lt;$&#123;entity&#125;&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    @GetMapping</span><br><span class="line">    public List&lt;$&#123;entity&#125;&gt; findAll() &#123;</span><br><span class="line">        <span class="keyword">return</span> $&#123;<span class="keyword">table</span><span class="variable">.entityPath</span>&#125;Service<span class="variable">.list</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®idæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">    * @param id ä¸»é”®id</span></span><br><span class="line"><span class="comment">    * @return $&#123;entity&#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    @GetMapping(<span class="string">&quot;/&#123;id&#125;&quot;</span>)</span><br><span class="line">    public $&#123;entity&#125; findById(@PathVariable Integer id) &#123;</span><br><span class="line">        <span class="keyword">return</span> $&#123;<span class="keyword">table</span><span class="variable">.entityPath</span>&#125;Service<span class="variable">.getById</span>(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">    * @param pageNum å½“å‰é¡µ</span></span><br><span class="line"><span class="comment">    * @param pageSize æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°</span></span><br><span class="line"><span class="comment">    * @return Page&lt;$&#123;entity&#125;&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    @GetMapping(<span class="string">&quot;/page&quot;</span>)</span><br><span class="line">    public Page&lt;$&#123;entity&#125;&gt; findPage(@RequestParam Integer pageNum, @RequestParam Integer pageSize) &#123;</span><br><span class="line">        QueryWrapper&lt;$&#123;entity&#125;&gt; wrapper=<span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="keyword">return</span> $&#123;<span class="keyword">table</span><span class="variable">.entityPath</span>&#125;Service<span class="variable">.page</span>(<span class="keyword">new</span> Page&lt;&gt;(pageNum, pageSize), wrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ‰¹é‡åˆ é™¤</span></span><br><span class="line"><span class="comment">    * @param ids ä¸»é”®idé›†åˆ</span></span><br><span class="line"><span class="comment">    * @return boolean</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    @DeleteMapping(<span class="string">&quot;del/batch&quot;</span>)</span><br><span class="line">    public boolean deleteBatchById(@RequestBody List&lt;Integer&gt; ids) &#123;</span><br><span class="line">        <span class="keyword">return</span> $&#123;<span class="keyword">table</span><span class="variable">.entityPath</span>&#125;Service<span class="variable">.removeBatchByIds</span>(ids);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="keyword">end</span></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªæŠ€æœ¯Zipkin+Micrometer Tracing</title>
    <url>/2025/09/15/%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA%E6%8A%80%E6%9C%AFZipkin+Micrometer%20Tracing/</url>
    <content><![CDATA[<h1>åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªæŠ€æœ¯Zipkin+Micrometer Tracing</h1>
<h2 id="zipkinä»‹ç»">zipkinä»‹ç»</h2>
<p><strong>Zipkin åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿ</strong>å°±èƒ½éå¸¸å¥½åœ°è§£å†³è¯¥é—®é¢˜ï¼Œ<strong>ä¸»è¦è§£å†³ä»¥ä¸‹3ç‚¹é—®é¢˜ï¼š</strong></p>
<p>1.åŠ¨æ€å±•ç¤ºæœåŠ¡çš„é“¾è·¯ï¼›</p>
<p>2.åˆ†ææœåŠ¡é“¾è·¯çš„ç“¶é¢ˆå¹¶å¯¹å…¶è¿›è¡Œè°ƒä¼˜ï¼›</p>
<p>3.å¿«é€Ÿè¿›è¡ŒæœåŠ¡é“¾è·¯çš„æ•…éšœå‘ç°ã€‚</p>
<h2 id="zipkinæ¶æ„">zipkinæ¶æ„</h2>
<p><strong>ZipKin å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</strong></p>
<ul>
<li><strong>ZipKin Server</strong> ï¼šç”¨æ¥ä½œä¸ºæ•°æ®çš„é‡‡é›†å­˜å‚¨ã€æ•°æ®åˆ†æä¸å±•ç¤ºï¼›</li>
<li><strong>ZipKin Client</strong> ï¼šåŸºäºä¸åŒçš„è¯­è¨€åŠæ¡†æ¶å°è£…çš„ä¸€äº›åˆ—å®¢æˆ·ç«¯å·¥å…·ï¼Œè¿™äº›å·¥å…·å®Œæˆäº†è¿½è¸ªæ•°æ®çš„ç”Ÿæˆä¸ä¸ŠæŠ¥åŠŸèƒ½ã€‚</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/5c1546e81af2c067128d5091dc127743.png" alt=""></p>
<p>Instrumented clientå’Œserveræ˜¯åˆ†åˆ«ä½¿ç”¨äº†ZipKin Clientçš„æœåŠ¡ï¼ŒZipkin Clientä¼šæ ¹æ®é…ç½®å°†è¿½è¸ªæ•°æ®å‘é€åˆ°Zipkin  Serverä¸­è¿›è¡Œæ•°æ®å­˜å‚¨ã€åˆ†æå’Œå±•ç¤ºã€‚</p>
<h4 id="zipkinæœåŠ¡ç«¯">zipkinæœåŠ¡ç«¯</h4>
<p>Zipkin (æœåŠ¡ç«¯)åŒ…å«å››ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯ collectorã€storageã€searchã€web UIã€‚</p>
<p><strong>1) collector ä¿¡æ¯æ”¶é›†å™¨</strong>: collector æ¥å—æˆ–è€…æ”¶é›†å„ä¸ªåº”ç”¨ä¼ è¾“çš„æ•°æ®ã€‚</p>
<p><strong>2) storage å­˜å‚¨ç»„ä»¶</strong>: zipkin é»˜è®¤ç›´æ¥å°†æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œæ­¤å¤–æ”¯æŒä½¿ç”¨ Cassandraã€ElasticSearch å’Œ Mysql ã€‚</p>
<p><strong>3) APIï¼ˆQueryï¼‰</strong> è´Ÿè´£æŸ¥è¯¢Storageä¸­å­˜å‚¨çš„æ•°æ®ï¼Œæä¾›ç®€å•çš„JSON APIè·å–æ•°æ®ï¼Œä¸»è¦æä¾›ç»™web UIä½¿ç”¨ã€‚</p>
<p><strong>4) web UI æœåŠ¡ç«¯å±•ç¤ºå¹³å°</strong>:ä¸»è¦æ˜¯æä¾›ç®€å•çš„ web ç•Œé¢ï¼Œç”¨å›¾è¡¨å°†é“¾è·¯ä¿¡æ¯æ¸…æ™°åœ°å±•ç¤ºç»™å¼€å‘äººå‘˜ã€‚</p>
<h3 id="zipkinå®¢æˆ·ç«¯">zipkinå®¢æˆ·ç«¯</h3>
<p><img src="http://120.26.79.238:9000/blog/img/9782c69779f42011b169990f01b2c809.png" alt=""></p>
<p>ZipKinå‡ ä¸ªæ¦‚å¿µ:</p>
<p>åœ¨è¿½è¸ªæ—¥å¿—ä¸­ï¼Œæœ‰å‡ ä¸ªåŸºæœ¬æ¦‚å¿µspanIdã€traceIdã€parentId</p>
<p>traceIdï¼šç”¨æ¥ç¡®å®šä¸€ä¸ªè¿½è¸ªé“¾çš„16å­—ç¬¦é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œåœ¨æŸä¸ªè¿½è¸ªé“¾ä¸­ä¿æŒä¸å˜ã€‚</p>
<p>spanIdï¼šåŒºåŸŸIdï¼Œåœ¨ä¸€ä¸ªè¿½è¸ªé“¾ä¸­spanIdå¯èƒ½å­˜åœ¨å¤šä¸ªï¼Œæ¯ä¸ªspanIdç”¨äºè¡¨æ˜åœ¨æŸä¸ªæœåŠ¡ä¸­çš„èº«ä»½ï¼Œä¹Ÿæ˜¯16å­—ç¬¦é•¿åº¦çš„å­—ç¬¦ä¸²ã€‚</p>
<p>parentIdï¼šåœ¨è·¨æœåŠ¡è°ƒç”¨è€…çš„spanIdä¼šä¼ é€’ç»™è¢«è°ƒç”¨è€…ï¼Œè¢«è°ƒç”¨è€…ä¼šå°†è°ƒç”¨è€…çš„spanIdä½œä¸ºè‡ªå·±çš„parentIdï¼Œç„¶åè‡ªå·±å†ç”ŸæˆspanIdã€‚</p>
<h2 id="å…·ä½“æ•´åˆæ­¥éª¤ï¼šMicrometer-tacing-brave-zipkin">å…·ä½“æ•´åˆæ­¥éª¤ï¼šMicrometer tacing + brave + zipkin</h2>
<p>ç¬¬ä¸€æ­¥ï¼šå…ˆè‡ªåŠ¨ZipkinServer:</p>
<blockquote>
<p>java -jar zipkin-server-3.3.1-exec.jar</p>
</blockquote>
<p>æˆ–è€…dockeræ–¹å¼ï¼š</p>
<blockquote>
<p>dockeræ–¹å¼ï¼š docker run -d -p 9411:9411 openzipkin/zipkin</p>
</blockquote>
<p>å¦‚æœæ˜¯æœ¬æœºå¯åŠ¨ï¼Œå¯åŠ¨åè®¿é—®ï¼š<a href="http://localhost:9411/">http://localhost:9411/</a> å³å¯ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šåœ¨å¾®æœåŠ¡ä¸­æ•´åˆzipkinå®¢æˆ·ç«¯ä¾èµ–ä¿¡æ¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- ç”¨äºç›‘æ§å’Œç®¡ç† Spring Boot åº”ç”¨ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- æ˜¯ Zipkin çš„ä¸€ä¸ªç»„ä»¶ï¼Œç”¨äºå°†åˆ†å¸ƒå¼è¿½è¸ªæ•°æ®ï¼ˆtrace dataï¼‰ä»åº”ç”¨ç¨‹åºå‘é€åˆ° Zipkin æœåŠ¡å™¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.zipkin.reporter2<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zipkin-reporter-brave<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ˜¯ Micrometer é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå°† Micrometer çš„æŒ‡æ ‡ï¼ˆmetricsï¼‰å’Œ Brave çš„åˆ†å¸ƒå¼è¿½è¸ªï¼ˆtracingï¼‰åŠŸèƒ½é›†æˆåœ¨ä¸€èµ· --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-tracing-bridge-brave<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!--ç”¨äºé›†æˆ Feign å®¢æˆ·ç«¯å’Œ Micrometer åº¦é‡åº“çš„æ¨¡å— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-micrometer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>12.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--ç”¨äºå¯¹åº”ç”¨ç¨‹åºä¸­çš„å…³é”®æ“ä½œè¿›è¡Œè§‚æµ‹ï¼ˆobservationï¼‰ï¼Œä»è€Œæ”¶é›†è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡å’Œè¿½è¸ªæ•°æ® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-observation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">     <span class="comment">&lt;!--æ•´åˆzipkinæ—¶æç¤ºä¿¡æ¯ç”¨åˆ°çš„ --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸ºio.micrometeråŒ…ä¸‹çš„jaråŒ…æä¾›ç‰ˆæœ¬ç®¡ç† --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-tracing-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ­¥ï¼šåœ¨å¾®æœåŠ¡ymlæ–‡ä»¶ä¸­é…ç½®:</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">base-url:</span> <span class="string">http://192.168.200.111:9411/</span>  <span class="comment">#zipkiné“¾æ¥åœ°å€</span></span><br><span class="line">    <span class="attr">discovery-client-enabled:</span> <span class="literal">false</span>  <span class="comment">#ä¸ç”¨å¼€å¯æœåŠ¡å‘ç°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">tracing:</span></span><br><span class="line">    <span class="attr">sampling:</span></span><br><span class="line">      <span class="attr">probability:</span> <span class="number">1.0</span>   <span class="comment">#é‡‡æ ·é¢‘ç‡</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">tracing:</span></span><br><span class="line">      <span class="attr">endpoint:</span> <span class="string">http://192.168.200.111:9411/api/v2/spans</span>  <span class="comment">#zipkinçš„è¿½è¸ªå…¥å£</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">$&#123;spring.application.name&#125;,%X&#123;traceId:-&#125;,%X&#123;spanId:-&#125;</span>  <span class="comment">#é‡‡é›†æ—¥å¿—æ ¼å¼</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬å››æ­¥ï¼šè®¿é—®è®¢å•å¾®æœåŠ¡æ¥å£ï¼š<a href="http://localhost:10200/api/order/findOrderByOrderId/101">http://localhost:10200/api/order/findOrderByOrderId/101</a></p>
<p>â€‹                è®¿é—®zipkinæœåŠ¡ï¼š<a href="http://192.168.200.111:9411/zipkin">http://192.168.200.111:9411/zipkin</a></p>
<p>å°±èƒ½çœ‹åˆ°å¾®æœåŠ¡è°ƒç”¨é“¾è·¯ã€æ¯ä¸ªé˜¶æ®µçš„æ—¶é—´æ¶ˆè€—åŠå“ªä¸ªå¾®æœåŠ¡å‡ºç°äº†å¼‚å¸¸ä¿¡æ¯ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>å£°æ˜å¼äº‹åŠ¡</title>
    <url>/2025/09/15/%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1/</url>
    <content><![CDATA[<h2 id="å£°æ˜å¼äº‹åŠ¡">å£°æ˜å¼äº‹åŠ¡</h2>
<blockquote>
<p><strong>ç¼–ç¨‹å¼äº‹åŠ¡</strong>ï¼šéœ€è¦æ‰‹åŠ¨å»å®ç°äº‹åŠ¡çš„åŠŸèƒ½å‘¢</p>
</blockquote>
<blockquote>
<p><strong>å£°æ˜å¼äº‹åŠ¡</strong>ï¼šåªéœ€è¦å£°æ˜äº‹åŠ¡ï¼Œå…·ä½“çš„åŠŸèƒ½ç”±æ¡†æ¶å®Œæˆã€‚</p>
</blockquote>
<p>äº‹åŠ¡ç‰¹æ€§ï¼š</p>
<ol>
<li>
<p><strong>åŸå­æ€§</strong>ï¼šäº‹åŠ¡è¢«è§†ä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„å•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</p>
</li>
<li>
<p><strong>ä¸€è‡´æ€§</strong>ï¼šäº‹åŠ¡å°†æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§è½¬æ¢åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€</p>
</li>
<li>
<p><strong>éš”ç¦»æ€§</strong>ï¼šå¤šä¸ªå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¸ä¼šå¹²æ‰°ï¼Œ</p>
<ol>
<li><strong>éš”ç¦»çº§åˆ«</strong>ï¼š
<ol>
<li><strong>è¯»æœªæäº¤ (Read Uncommitted)</strong>ï¼šæä¾›äº†æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå¯èƒ½å¯¼è‡´è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li>
<li><strong>è¯»å·²æäº¤ (Read Committed)</strong>ï¼šé˜²æ­¢è„è¯»ï¼Œä½†ä»ç„¶å¯èƒ½é‡åˆ°ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li>
<li><strong>å¯é‡å¤è¯» (Repeatable Read)</strong>ï¼šé˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†ä»ç„¶å¯èƒ½å‘ç”Ÿå¹»è¯»ã€‚==å¯¹æ­£åœ¨æ“ä½œçš„æ•°æ®åŠ é”ã€‚==</li>
<li><strong>åºåˆ—åŒ– (Serializable)</strong>ï¼šé˜²æ­¢æ‰€æœ‰å¹¶å‘é—®é¢˜ï¼Œä½†å¯èƒ½ä¼šå¼•èµ·è¾ƒé«˜çš„é”å®šå¼€é”€ã€‚==å¯¹è¡¨åŠ é”==</li>
</ol>
</li>
<li>è„è¯»ï¼šè¯»åˆ°äº†æœªæäº¤çš„æ•°æ®</li>
<li>ä¸å¯é‡å¤è¯»ï¼šåªèƒ½è¯»åˆ°å·²ç»æäº¤çš„æ•°æ®ï¼Œè¯»ä¸¤æ¬¡çš„æ•°æ®å¯èƒ½ä¸ä¸€æ ·</li>
<li>å¹»è¯»ï¼šå¯¹æ²¡æœ‰åŠ é”çš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œå½“å…¶ä»–äº‹åŠ¡æ“ä½œäº†ä¹‹åï¼Œå¯èƒ½ä¸¤æ¬¡è¯»åˆ°æ•°æ®ä¸ä¸€æ ·ã€‚</li>
</ol>
</li>
<li>
<p><strong>æŒä¹…æ€§</strong>ï¼š</p>
<p>ä¸€æ—¦äº‹åŠ¡è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ”¹å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå¹¶ä¸”ä¸èƒ½å› ä¸ºä»»ä½•ç³»ç»Ÿæ•…éšœè€Œä¸¢å¤±ã€‚</p>
<p>å³ä½¿æ˜¯åœ¨ç³»ç»Ÿå´©æºƒä¹‹åï¼Œä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå®ƒçš„ç»“æœä¹Ÿå¿…é¡»æ˜¯å¯ç”¨çš„ã€‚</p>
</li>
</ol>
<h3 id="åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡">åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡</h3>
<ol>
<li>
<p><strong>é…ç½®äº‹åŠ¡ç®¡ç†å™¨</strong></p>
<p>é…ç½®è¿æ¥å¯¹è±¡ï¼Œä¾èµ–æ•°æ®æº: å› ä¸ºäº‹çš„å¼€å¯æ˜¯Connectionå¯¹è±¡å¼€å¯çš„ï¼Œæ‰€ä»¥äº‹åŠ¡ç®¡ç†å°±ä¾èµ–æ•°æ®æºç®¡ç†å¯¹è±¡ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;DataSourceTransactionManager&quot;</span> &gt;</span></span><br><span class="line"> //æ•°æ®æº   </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;DataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>å¼€å¯äº‹åŠ¡æ³¨è§£é©±åŠ¨</strong>(è¿æ¥ç‚¹)</p>
<p>@Transactional   æ ‡è®°è¿æ¥ç‚¹çš„æ³¨è§£ã€‚ä¸€èˆ¬æ˜¯åŠ åœ¨Serviceå±‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">â€‹	==æ ‡è®°ä½ç½®==ï¼šç±»æˆ–æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### å£°æ˜å¼äº‹åŠ¡å±æ€§</span><br><span class="line"></span><br><span class="line">1. **äº‹åŠ¡åªè¯»**ï¼šreadOnly=&quot;false&quot;</span><br><span class="line"></span><br><span class="line">   åŠŸèƒ½ï¼šå¯¹äº==å…¨éƒ¨éƒ½æ˜¯æŸ¥è¯¢çš„æ“ä½œ==ï¼Œå¯ä»¥è®¾ç½®äº‹åŠ¡åªè¯»ï¼Œæ­¤æ—¶ä¼šé€šçŸ¥æ•°æ®åº“å½“å‰æ“ä½œä¸ºåªè¯»æ“ä½œï¼Œä¼šä»==æ•°æ®åº“å±‚é¢==ä¼˜åŒ–å½“å‰æ“ä½œã€‚æé«˜æ•ˆç‡. è‹¥æ“ä½œä¸­å­˜åœ¨å¢åˆ æ”¹æ“ä½œæ—¶ï¼Œä¼šæŠ¥é”™ Connection is read only</span><br><span class="line"></span><br><span class="line">   &gt; æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼Œä¼šå¯¹è¡¨åŠ é”ã€‚</span><br><span class="line"></span><br><span class="line">2. **è¶…æ—¶æ—¶é—´**ï¼šè¶…æ—¶å›æ»šï¼Œé‡Šæ”¾èµ„æº</span><br><span class="line"></span><br><span class="line">   timeout=&quot;-1&quot;   </span><br><span class="line"></span><br><span class="line">   -1:ä¸€ç›´ç­‰ ï¼Œé»˜è®¤å•ä½ç§’ã€‚</span><br><span class="line"></span><br><span class="line">   åœºæ™¯ï¼šäº‹åŠ¡è¶…è¿‡æŒ‡å®šæ—¶é—´æœªæ‰§è¡Œå®Œæ¯•ã€‚å¼ºåˆ¶å›æ»šï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸TransactionTimeOutException</span><br><span class="line"></span><br><span class="line">3. **å›æ»šç­–ç•¥**ï¼š</span><br><span class="line"></span><br><span class="line">   rollBackFor = å­—èŠ‚ç å¯¹è±¡</span><br><span class="line"></span><br><span class="line">   rollBackForClassName  = å…¨ç±»å</span><br><span class="line"></span><br><span class="line">   noRollBackFor</span><br><span class="line"></span><br><span class="line">   noRollBackForClassName</span><br><span class="line"></span><br><span class="line">   é»˜è®¤æ‰€æœ‰è¿è¡Œæ—¶å¼‚å¸¸å›æ»šã€‚</span><br><span class="line"></span><br><span class="line">   è®¾ç½®è§¦å‘æˆ–ä¸è§¦å‘å›æ»šçš„å¼‚å¸¸ç±»å‹ï¼š</span><br><span class="line"></span><br><span class="line">4. **éš”ç¦»çº§åˆ«**:</span><br><span class="line"></span><br><span class="line">   isoLation=&quot;DEFAULT&quot;</span><br><span class="line"></span><br><span class="line">   1. DEFAULT:é»˜è®¤éš”ç¦»çº§åˆ«ï¼Œæ•°æ®åº“å†³å®š</span><br><span class="line">   2. READ_UNCOMMITTED  ä¸å¯é‡å¤è¯»</span><br><span class="line">   3. READ_COMMITTED </span><br><span class="line">   4. Repeatable Read  å¯é‡å¤è¯»</span><br><span class="line">   5. SERVILAZIABLE åºåˆ—åŒ–</span><br><span class="line"></span><br><span class="line">5. **ä¼ æ’­è¡Œä¸º**ï¼š</span><br><span class="line"></span><br><span class="line">   propagation =&quot;REQUIRED &quot;</span><br><span class="line"></span><br><span class="line">   1. REQUIRED   è°ƒç”¨è€…çš„äº‹åŠ¡</span><br><span class="line"></span><br><span class="line">   2. REQUIRES\_NEW   è¢«è°ƒç”¨è€…çš„äº‹åŠ¡</span><br><span class="line"></span><br><span class="line">      | åç§°                 | å«ä¹‰                                                         |</span><br><span class="line">      | -------------------- | ------------------------------------------------------------ |</span><br><span class="line">      | REQUIRED <span class="symbol">&amp;#xA;</span>é»˜è®¤å€¼ | å½“å‰æ–¹æ³•å¿…é¡»å·¥ä½œåœ¨äº‹åŠ¡ä¸­ <span class="symbol">&amp;#xA;</span>å¦‚æœå½“å‰çº¿ç¨‹ä¸Šæœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡å¯ç”¨ï¼Œé‚£ä¹ˆå°±åœ¨è¿™ä¸ªäº‹åŠ¡ä¸­è¿è¡Œ <span class="symbol">&amp;#xA;</span>å¦‚æœå½“å‰çº¿ç¨‹ä¸Šæ²¡æœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡ï¼Œé‚£ä¹ˆå°±è‡ªå·±å¼€å¯æ–°äº‹åŠ¡ï¼Œåœ¨æ–°äº‹åŠ¡ä¸­è¿è¡Œ <span class="symbol">&amp;#xA;</span>æ‰€ä»¥å½“å‰æ–¹æ³•æœ‰å¯èƒ½å’Œå…¶ä»–æ–¹æ³•å…±ç”¨äº‹åŠ¡ <span class="symbol">&amp;#xA;</span>åœ¨å…±ç”¨äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼šå½“å‰æ–¹æ³•ä¼šå› ä¸ºå…¶ä»–æ–¹æ³•å›æ»šè€Œå—è¿ç´¯ |</span><br><span class="line">      | REQUIRES\_NEW        | å½“å‰æ–¹æ³•å¿…é¡»å·¥ä½œåœ¨äº‹åŠ¡ä¸­ <span class="symbol">&amp;#xA;</span>ä¸ç®¡å½“å‰çº¿ç¨‹ä¸Šæ˜¯å¦æœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡ï¼Œéƒ½è¦å¼€å¯æ–°äº‹åŠ¡ <span class="symbol">&amp;#xA;</span>åœ¨æ–°äº‹åŠ¡ä¸­è¿è¡Œ <span class="symbol">&amp;#xA;</span>ä¸ä¼šå’Œå…¶ä»–æ–¹æ³•å…±ç”¨äº‹åŠ¡ï¼Œé¿å…è¢«å…¶ä»–æ–¹æ³•è¿ç´¯ |</span><br><span class="line"></span><br><span class="line">   è¢«ä¼ æ’­çš„äº‹åŠ¡ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯äº‹åŠ¡æ˜¯å…¶è°ƒç”¨è€…çš„äº‹åŠ¡ã€‚</span><br><span class="line"></span><br><span class="line">   A-&gt;B,Aå’ŒBéƒ½æœ‰äº‹åŠ¡ï¼Œé»˜è®¤Bä½¿ç”¨çš„Açš„äº‹åŠ¡ã€‚==é’ˆå¯¹Bäº‹åŠ¡è®¾ç½®==ï¼Œä¸”å¿…é¡»ä¸ºä¸åŒç±»ä¸­çš„æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">### åŸºäºXMlçš„å£°æ˜å¼äº‹åŠ¡</span><br><span class="line"></span><br><span class="line">1. **é…ç½®äº‹åŠ¡ç®¡ç†å™¨**</span><br><span class="line"></span><br><span class="line">   ```xml</span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;DataSourceTransactionManager&quot;</span> &gt;</span></span><br><span class="line">    //æ•°æ®æº   </span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;DataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>è®¾ç½®äº‹åŠ¡é€šçŸ¥</strong> (è¿æ¥ç‚¹)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;tx&quot;</span> <span class="attr">tranaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">    //äº‹åŠ¡å±æ€§,å¿…é¡»æŒ‡å®šã€‚</span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;menthod()&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:method</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;add*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:method</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">&lt;aop:advisor&gt; æ ‡ç­¾ï¼šç”¨äºå°†ä¸€ä¸ªå·²ç»å®šä¹‰å¥½çš„Adviceå’Œä¸€ä¸ªPointcutç»‘å®šåœ¨ä¸€èµ·ã€‚</span></span><br><span class="line"><span class="comment">Advisoræ˜¯ä¸€ä¸ªç®€å•çš„åˆ‡é¢å®ç°ï¼Œå®ƒåªéœ€è¦ä¸€ä¸ªAdviceå’Œä¸€ä¸ªPointcutå°±å¯ä»¥å·¥ä½œã€‚</span></span><br><span class="line"><span class="comment">åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡advice-refå±æ€§å¼•ç”¨ä¸€ä¸ªå·²ç»å®šä¹‰å¥½çš„Adviceï¼Œé€šè¿‡pointcut-expressionæˆ–pointcut-refå±æ€§æ¥æŒ‡å®šPointcutã€‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    //</span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;tx&quot;</span> </span></span><br><span class="line"><span class="tag">                 <span class="attr">pointcut</span>=<span class="string">&quot;excution(* online.zorange.service..*(..) )&quot;</span>&gt;</span>				<span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼é”</title>
    <url>/2025/09/15/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
    <content><![CDATA[<h1>åˆ†å¸ƒå¼é”</h1>
<h2 id="åˆ†å¸ƒå¼é”ä¸»æµçš„å®ç°æ–¹æ¡ˆï¼š">åˆ†å¸ƒå¼é”ä¸»æµçš„å®ç°æ–¹æ¡ˆï¼š</h2>
<ol>
<li>åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”</li>
<li>åŸºäºç¼“å­˜ï¼ˆ Redisç­‰ï¼‰</li>
<li>åŸºäºZookeeper</li>
</ol>
<p>æ¯ä¸€ç§åˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆéƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š</p>
<ol>
<li>æ€§èƒ½ï¼šRedisæœ€é«˜</li>
<li>å¯é æ€§ï¼šzookeeperæœ€é«˜</li>
</ol>
<p>å› ä¸ºRediså…·å¤‡é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€é«˜å¹¶å‘çš„ç‰¹æ€§ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å°±åŸºäºRediså®ç°åˆ†å¸ƒå¼é”ã€‚</p>
<p>åˆ†å¸ƒå¼é”çš„å…³é”®æ˜¯å¤šè¿›ç¨‹å…±äº«çš„å†…å­˜æ ‡è®°(é”)ï¼Œå› æ­¤åªè¦æˆ‘ä»¬åœ¨Redisä¸­æ”¾ç½®ä¸€ä¸ªè¿™æ ·çš„æ ‡è®°(æ•°æ®)å°±å¯ä»¥äº†ã€‚ä¸è¿‡åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œä¸è¦å¿˜äº†æˆ‘ä»¬éœ€è¦å®ç°ä¸‹åˆ—ç›®æ ‡ï¼š</p>
<ul>
<li>å¤šè¿›ç¨‹å¯è§ï¼šå¤šè¿›ç¨‹å¯è§ï¼Œå¦åˆ™å°±æ— æ³•å®ç°åˆ†å¸ƒå¼æ•ˆæœ</li>
<li>é¿å…æ­»é”ï¼šæ­»é”çš„æƒ…å†µæœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬è¦æ€è€ƒå„ç§å¼‚å¸¸å¯¼è‡´æ­»é”çš„æƒ…å†µï¼Œä¿è¯é”å¯ä»¥è¢«é‡Šæ”¾</li>
<li>æ’å®ƒï¼šåŒä¸€æ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹è·å¾—é”</li>
<li>é«˜å¯ç”¨ï¼šé¿å…é”æœåŠ¡å®•æœºæˆ–å¤„ç†å¥½å®•æœºçš„è¡¥æ•‘æªæ–½(redisé›†ç¾¤æ¶æ„ï¼š1.ä¸»ä»å¤åˆ¶ 2.å“¨å…µ 3.clusteré›†ç¾¤)</li>
</ul>
<h3 id="åˆ†å¸ƒå¼é”ä½¿ç”¨çš„é€»è¾‘å¦‚ä¸‹ï¼š">åˆ†å¸ƒå¼é”ä½¿ç”¨çš„é€»è¾‘å¦‚ä¸‹ï¼š</h3>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">å°è¯•è·å–é”</span><br><span class="line"><span class="code">	æˆåŠŸï¼šæ‰§è¡Œä¸šåŠ¡ä»£ç     </span></span><br><span class="line"><span class="code">		æ‰§è¡Œä¸šåŠ¡  </span></span><br><span class="line"><span class="code">			try&#123;</span></span><br><span class="line"><span class="code">				è·å–é”</span></span><br><span class="line"><span class="code">				ä¸šåŠ¡ä»£ç -å®•æœº</span></span><br><span class="line"><span class="code">			&#125; catch()&#123;</span></span><br><span class="line"><span class="code">			&#125;finally&#123; </span></span><br><span class="line"><span class="code">				é‡Šæ”¾é”</span></span><br><span class="line"><span class="code">			&#125;</span></span><br><span class="line"><span class="code"> 	å¤±è´¥ï¼šç­‰å¾…,è¿›è¡Œè‡ªæ—‹ï¼›</span></span><br></pre></td></tr></table></figure>
<h2 id="åˆ†å¸ƒå¼é”ä¸‰ä¸ªæ“ä½œï¼š">åˆ†å¸ƒå¼é”ä¸‰ä¸ªæ“ä½œï¼š</h2>
<ol>
<li>åŠ é”</li>
<li>è§£é”</li>
<li>é‡è¯•</li>
</ol>
<p>ä¸ºäº†ç¡®ä¿åˆ†å¸ƒå¼é”å¯ç”¨ï¼Œæˆ‘ä»¬è‡³å°‘è¦ç¡®ä¿é”çš„å®ç°åŒæ—¶æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>äº’æ–¥æ€§ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚</li>
<li>ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚å³ä½¿æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æŒæœ‰é”çš„æœŸé—´å´©æºƒè€Œæ²¡æœ‰ä¸»åŠ¨è§£é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚</li>
<li>è§£é“ƒè¿˜é¡»ç³»é“ƒäººã€‚åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è‡ªå·±ä¸èƒ½æŠŠåˆ«äººåŠ çš„é”ç»™è§£äº†ã€‚</li>
<li>åŠ é”å’Œè§£é”å¿…é¡»å…·æœ‰åŸå­æ€§ã€‚</li>
<li>å®ç°å¯é‡å…¥é”ï¼ˆå¯é€‰ï¼‰</li>
<li>ä¸ºäº†é˜²æ­¢é”å¤±æ•ˆï¼Œé”è¦å…·å¤‡è‡ªåŠ¨ç»­æœŸ</li>
<li>é˜²æ­¢é›†ç¾¤æƒ…å†µä¸‹é”å¤±æ•ˆï¼Œå¯ä»¥ä½¿ç”¨Redlockç®—æ³•</li>
</ul>
<h2 id="å…³é”®ç†è§£">å…³é”®ç†è§£</h2>
<p>ä½¿ç”¨redisåšåˆ†å¸ƒå¼é”,ä¸»è¦ä¸‰ä¸ªå˜é‡<br>
lockName:  é”çš„åç§°,ç”¨äºæ ‡è®°ä¸€ä¸ªå…·ä½“çš„åŠŸèƒ½,ä¸åŒçš„åŠŸèƒ½ç”¨ä¸åŒçš„é”<br>
uuid:æ ‡è®°ä¸Šé”çš„å¯¹åº”è¿›ç¨‹,å½“ä¸€ä¸ªè¿›ç¨‹ä¸Šäº†é”ä¹‹å,å°±åªå…è®¸å½“å‰è¿›ç¨‹å†æ¬¡ä¸Šé”(å¯é‡å…¥),å…¶ä»–è¿›ç¨‹ç­‰å¾…<br>
expire:è¿‡æœŸæ—¶é—´</p>
<p>ç»­æœŸ:æœ‰æ—¶å€™é”çš„è¿‡æœŸæ—¶é—´ä¹‹å†…ä¸èƒ½å®Œæˆä¸šåŠ¡ä»£ç .å°±éœ€è¦åœ¨è¿‡æœŸæ—¶é—´è¿‡æœŸ1/3æ—¶,ä¸»åŠ¨å»ç»­æœŸ,ä¸èƒ½é˜»å¡ä¸šåŠ¡çº¿ç¨‹,ç”¨æ–°çº¿ç¨‹</p>
<ul>
<li>åŸå­æ€§:luaè„šæœ¬</li>
<li></li>
</ul>
<h2 id="åŸºäºredsiçš„åˆ†å¸ƒå¼é”å®ç°-aop">åŸºäºredsiçš„åˆ†å¸ƒå¼é”å®ç°(aop)</h2>
<p>ç»“æ„<br>
<img src="http://120.26.79.238:9000/blog/img/613c3e814a72d2912dbf1c2fa87fa0ef.png" alt=""></p>
<p>annotatioon</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/10/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RedisCaChe &#123;</span><br><span class="line">    String <span class="title function_">prefix</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>aop</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.spzx.common.redis.annotation.RedisCaChe;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/10/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCaCheAop</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate redisTemplate;</span><br><span class="line">    String data=<span class="string">&quot;:data:&quot;</span>;</span><br><span class="line">    String lock=<span class="string">&quot;:lock:&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(redisCaChe)&quot;)</span></span><br><span class="line">    Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint point, RedisCaChe redisCaChe)</span>   &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prefix</span> <span class="operator">=</span> redisCaChe.prefix();</span><br><span class="line">        Object[] args = point.getArgs();</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (args != <span class="literal">null</span> &amp;&amp; args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            suffix = Arrays.asList(args).stream().map(arg -&gt; arg.toString()).collect(Collectors.joining(<span class="string">&quot;:&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String dataKey=prefix + data + suffix;</span><br><span class="line">        <span class="comment">// å»redisæŸ¥æ‰¾</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> redisTemplate.opsForValue().get(dataKey);</span><br><span class="line">        <span class="keyword">if</span>(o!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> o;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//redisä¸å­˜åœ¨</span></span><br><span class="line">        String lockName=prefix+lock+suffix;</span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> redisTemplate.opsForValue().setIfAbsent(lockName, uuid, <span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                o = redisTemplate.opsForValue().get(dataKey);</span><br><span class="line">                <span class="keyword">if</span>(o!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> o;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">                redisTemplate.opsForValue().set(dataKey,proceed,<span class="number">10</span>,TimeUnit.MINUTES);</span><br><span class="line">                <span class="keyword">return</span> proceed;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                redisTemplate.delete(lockName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> point.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>å°†ä¸ªäººåšå®¢æ”¶å½•è¿› Bing</title>
    <url>/2023/05/03/%E5%B0%86%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%94%B6%E5%BD%95%E8%BF%9B%20Bing/</url>
    <content><![CDATA[<h1>Bing æ”¶å½•ä¸ªäººåšå®¢</h1>
<h2 id="âš™ï¸é…ç½®">âš™ï¸é…ç½®</h2>
<p>â€‹	1ï¸âƒ£<a href="https://www.bing.com/webmasters/about">ç™»å½•å¿…åº”ç½‘ç«™ç®¡ç†</a></p>
<p>â€‹	2ï¸âƒ£é€‰æ‹©ä» GSC å¯¼å…¥</p>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/20230504222950.png" alt=""></p>
<p>â€‹	3ï¸âƒ£ å°†ä¸‹è½½åˆ°çš„ xml æ–‡ä»¶æ”¾å…¥ç½‘ç«™èµ„æºæ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯ Hexo çš„ source æ–‡ä»¶å¤¹ä¸‹ã€‚</p>
<p>â€‹	4ï¸âƒ£ç„¶åä¸‰éƒ¨æ›²å°†ç½‘ç«™é‡æ–°éƒ¨ç½²ï¼Œhexo clean ã€hexo gã€hexo d</p>
<p>â€‹	5ï¸âƒ£é‡æ–°éƒ¨ç½²ä¹‹åå°±å¯ä»¥éªŒè¯äº†ï¼Œè¿™æ ·å°±å¯ä»¥æœç´¢åˆ°ç½‘ç«™äº†ã€‚</p>
<h2 id="â«ä¼˜åŒ–">â«ä¼˜åŒ–</h2>
<h3 id="æ·»åŠ ç½‘ç«™åœ°å›¾">æ·»åŠ ç½‘ç«™åœ°å›¾</h3>
<ol>
<li>
<p>ç”Ÿæˆç½‘ç«™åœ°å›¾ã€‚æˆ‘çš„æ˜¯ hexo çš„ï¼Œè¦ä¸‹è½½ä¸€ä¸ªå·¥å…·ã€‚</p>
</li>
<li>
<p>æ‰“å¼€ hexo ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ sitemap.xml</p>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-sitemap --save</span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½²</span></span><br><span class="line"></span><br><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>æäº¤ç½‘ç«™åœ°å›¾</li>
</ol>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/20230504222912.png" alt=""></p>
<ol start="4">
<li>æäº¤æˆåŠŸä¹‹åå‡ åˆ†é’Ÿå°±å¥½äº†</li>
</ol>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/20230504223031.png" alt=""></p>
<ol start="5">
<li>æäº¤æˆåŠŸåï¼Œæƒ³è¦å» bing æœç´¢è‡ªå·±ç½‘ç«™ä¸Šé¢çš„æ–‡ç« ï¼Œå¯ä»¥å» search.xml æ–‡ä»¶é‡Œé¢å¤åˆ¶ä½ è‡ªå·±å†™çš„ä¸€äº›æ–‡ç« æ®µè½ï¼Œæœåˆ°çš„æ¦‚ç‡ä¼šå¤§ä¸€ç‚¹ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>Records</category>
      </categories>
      <tags>
        <tag>Bing</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸ƒéš†è¿‡æ»¤å™¨</title>
    <url>/2025/09/15/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
    <content><![CDATA[<h2 id="BloomFilterã€å¸ƒéš†è¿‡æ»¤å™¨ã€‘">BloomFilterã€å¸ƒéš†è¿‡æ»¤å™¨ã€‘</h2>
<h3 id="ç®€ä»‹">ç®€ä»‹</h3>
<p><strong>æ¦‚è¿°</strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚<strong>å®ƒå®é™…ä¸Šç”±ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡(äºŒè¿›åˆ¶æ•°ç»„)å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°(hashå‡½æ•°)</strong>ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/e28a1126858cc8e592a68f6afe201093.png" alt=""></p>
<p><strong>ä½œç”¨</strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚</p>
<p><strong>æ·»åŠ å…ƒç´ </strong>ï¼šå°†å•†å“çš„id(id1)å­˜å‚¨åˆ°å¸ƒéš†è¿‡æ»¤å™¨</p>
<p><img src="http://120.26.79.238:9000/blog/img/0ac554d814eda4b516f389531c445c53.png" alt=""></p>
<p>å‡è®¾å½“å‰çš„å¸ƒéš†è¿‡æ»¤å™¨ä¸­æä¾›äº†ä¸‰ä¸ªhashå‡½æ•°ï¼Œæ­¤æ—¶å°±ä½¿ç”¨ä¸‰ä¸ªhashå‡½æ•°å¯¹id1è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œè¿ç®—ç»“æœåˆ†åˆ«ä¸ºï¼š2ã€5ã€10é‚£ä¹ˆå°±ä¼šæ•°ç»„ä¸­å¯¹åº”çš„ä½ç½®æ•°æ®æ›´æ”¹ä¸º1ã€‚</p>
<p><strong>åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨</strong>ï¼šä½¿ç”¨ç›¸åŒçš„hashå‡½æ•°å¯¹æ•°æ®è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ã€‚ç„¶ååˆ¤æ–­è¯¥å“ˆå¸Œå€¼æ‰€å¯¹åº”çš„æ•°ç»„ä½ç½®æ˜¯å¦éƒ½ä¸º1ï¼Œå¦‚æœä¸éƒ½æ˜¯1åˆ™è¯´æ˜è¯¥æ•°æ®<strong>è‚¯å®šä¸å­˜åœ¨</strong>ã€‚å¦‚æœéƒ½æ˜¯1è¯´æ˜è¯¥æ•°æ®<strong>å¯èƒ½</strong>å­˜åœ¨ï¼Œå› ä¸ºå“ˆå¸Œè¿ç®—å¯èƒ½å°±ä¼šå­˜åœ¨é‡å¤çš„æƒ…å†µã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://120.26.79.238:9000/blog/img/81dfdf3d6a9cf0d61482239ec90772eb.png" alt=""></p>
<p>å‡è®¾æ·»åŠ å®Œid1å’Œid2æ•°æ®ä»¥åï¼Œå¸ƒéš†è¿‡æ»¤å™¨ä¸­æ•°æ®çš„å­˜å‚¨æ–¹å¼å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé‚£ä¹ˆæ­¤æ—¶è¦åˆ¤æ–­id3å¯¹åº”çš„æ•°æ®åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ˜¯å¦å­˜åœ¨ï¼ŒæŒ‰ç…§ä¸Šè¿°çš„åˆ¤æ–­è§„åˆ™åº”è¯¥æ˜¯å­˜åœ¨ï¼Œä½†æ˜¯id3è¿™ä¸ªæ•°æ®åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­å‹æ ¹å°±ä¸å­˜åœ¨ï¼Œè¿™ç§æƒ…å†µå°±å±äºè¯¯åˆ¤ã€‚</p>
<p><strong>è¯¯åˆ¤ç‡</strong>ï¼šæ•°ç»„è¶Šå°è¯¯åˆ¤ç‡å°±è¶Šå¤§ï¼Œæ•°ç»„è¶Šå¤§è¯¯åˆ¤ç‡å°±è¶Šå°ï¼Œä½†æ˜¯åŒæ—¶å¸¦æ¥äº†æ›´å¤šçš„å†…å­˜æ¶ˆè€—ã€‚</p>
<p><strong>åˆ é™¤å…ƒç´ </strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨ä¸æ”¯æŒæ•°æ®çš„åˆ é™¤æ“ä½œ(å› ä¸ºæœ‰hashå†²çª,å¦‚æœæŠŠAçš„hashå€¼åˆ é™¤å¯èƒ½ä¼šå½±å“Bçš„æŸ¥è¯¢)ï¼Œå› ä¸ºå¦‚æœæ”¯æŒåˆ é™¤é‚£ä¹ˆæ­¤æ—¶å°±ä¼šå½±å“åˆ¤æ–­ä¸å­˜åœ¨çš„ç»“æœã€‚</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ol>
<li>
<p>å› ä¸ºæ˜¯äºŒè¿›åˆ¶0,1ï¼Œæ‰€ä»¥å ç”¨ç©ºé—´å¾ˆå°</p>
</li>
<li>
<p>ä¿®æ”¹å’ŒæŸ¥è¯¢é€Ÿåº¦å¿«</p>
</li>
</ol>
<p><img src="http://120.26.79.238:9000/blog/img/c9402d4a013c9737b5473c30d7316bd2.png" alt=""></p>
<h3 id="å¸ƒéš†è¿‡æ»¤å™¨çš„ä¼˜ç¼ºç‚¹">å¸ƒéš†è¿‡æ»¤å™¨çš„ä¼˜ç¼ºç‚¹</h3>
<p>ä¼˜ç‚¹ï¼šå ç”¨ç©ºé—´å°ã€æŸ¥è¯¢é€Ÿåº¦å¿«</p>
<p>ç¼ºç‚¹ï¼šå­˜åœ¨è¯¯å·®ç‡ã€ä¸æ”¯æŒåˆ é™¤æ“ä½œ</p>
<h2 id="redissonçš„å¸ƒéš†è¿‡æ»¤å™¨">redissonçš„å¸ƒéš†è¿‡æ»¤å™¨</h2>
<h3 id="1-åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨">1. åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * albumInfo BloomFilter</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> redissonClient</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RBloomFilter <span class="title function_">albumInfoBloomFilter</span><span class="params">(RedissonClient redissonClient)</span> &#123;</span><br><span class="line">    RBloomFilter&lt;Object&gt; bloomFilter = redissonClient.getBloomFilter(BFConstants.BF_ALBUM_INFO);</span><br><span class="line">    <span class="comment">// 1. è‹¥æ²¡æœ‰åˆ™åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (!bloomFilter.isExists()) &#123;</span><br><span class="line">        bloomFilter.tryInit(<span class="number">1000000L</span>, <span class="number">0.001d</span>);</span><br><span class="line">        log.info(<span class="string">&quot;&#123;&#125;å¸ƒéš†è¿‡æ»¤å™¨åˆå§‹åŒ–æˆåŠŸ&quot;</span>, BFConstants.BF_ALBUM_INFO);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bloomFilter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨çš„æ•°æ®">2.åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨çš„æ•°æ®</h3>
<blockquote>
<p>æœ¬è´¨ä¸Šå°±æ˜¯è®©æœåŠ¡åœ¨å¯åŠ¨çš„åŒæ—¶æ·»åŠ æ•°æ®<br>
1 : ApplicationRunner<br>
2: SpringApplicationListener<br>
3: @Bean<br>
4: CommandLineRunner<br>
5: @PostConstruct</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> &#123;</span><br><span class="line">      <span class="comment">//1. albumBloomFilter åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line">      CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">          RBloomFilter&lt;Object&gt; bloomFilterAlbum = redissonClient.getBloomFilter(BFConstants.BF_ALBUM_INFO);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//1.è·å–å…¨éƒ¨id</span></span><br><span class="line">          List&lt;Long&gt; albumInfoAllId = albumInfoMapper.getAlbumInfoAllId();</span><br><span class="line">          <span class="comment">//2.å°†idsåŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨</span></span><br><span class="line">          <span class="keyword">for</span> (Long albumId : albumInfoAllId) &#123;</span><br><span class="line">              bloomFilterAlbum.add(albumId);</span><br><span class="line">          &#125;</span><br><span class="line">          log.info(<span class="string">&quot;ApplicationRunnerå®ç°æœåŠ¡å¯åŠ¨åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨æ•°æ®æˆåŠŸ,ä¸€å…±æœ‰&#123;&#125;ä¸ªæ•°æ®&quot;</span>, bloomFilterAlbum.count());</span><br><span class="line">      &#125;, myExecutor);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-è¿è¡Œæ—¶è‡ªåŠ¨æ›´æ–°å¸ƒéš†è¿‡æ»¤å™¨">3. è¿è¡Œæ—¶è‡ªåŠ¨æ›´æ–°å¸ƒéš†è¿‡æ»¤å™¨</h3>
<blockquote>
<p>å®šæ—¶ä»»åŠ¡:</p>
</blockquote>
<ol>
<li>spring bootè‡ªå¸¦task :@Schedule</li>
<li>çº¿ç¨‹æ± çš„å®šæ—¶å’Œå»¶è¿Ÿä»»åŠ¡çš„æ–¹æ³•
<ul>
<li>1.å®šæ—¶ä»»åŠ¡scheduleAtFixedRate</li>
<li>2.schedule å»¶è¿Ÿä»»åŠ¡+è‡ªå·±å›è°ƒ</li>
</ul>
</li>
<li>åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>å¾®æœåŠ¡ç›‘æ§æŠ€æœ¯</title>
    <url>/2025/09/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7%E6%8A%80%E6%9C%AF/</url>
    <content><![CDATA[<h1>å¾®æœåŠ¡ç›‘æ§æŠ€æœ¯</h1>
<h2 id="SpringBoot-Actuatorçš„å…·ä½“ä½¿ç”¨">SpringBoot Actuatorçš„å…·ä½“ä½¿ç”¨</h2>
<h3 id="åœ¨è¢«ç›‘æ§çš„å¾®æœåŠ¡å¯¼å…¥ä¾èµ–">åœ¨è¢«ç›‘æ§çš„å¾®æœåŠ¡å¯¼å…¥ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SpringBoot Actuator --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®application-ymlæ–‡ä»¶">é…ç½®application.ymlæ–‡ä»¶</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment">#æš´éœ²æ‰€æœ‰çš„ç«¯ç‚¹</span></span><br><span class="line">      <span class="attr">base-path:</span> <span class="string">/boot</span> <span class="comment">#ç›‘æ§actuatorçš„åç§°,é»˜è®¤æ˜¯actuator,è¿™é‡Œæ”¹ä¸ºäº†boot</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span>  <span class="comment">#æŸ¥çœ‹å¥åº·çŠ¶æ€çš„è¯¦ç»†ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>
<h3 id="å¯åŠ¨å¾®æœåŠ¡åè®¿é—®">å¯åŠ¨å¾®æœåŠ¡åè®¿é—®</h3>
<p>å¯åŠ¨åè®¿é—®`<a href="http://xn--ip-fr5cz80cuvi">http://å¾®æœåŠ¡ip</a>:ç«¯å£å·/boot/ï¼Œè¿”å›æ­£ç¡®æ•°æ®è¡¨ç¤ºæµ‹è¯•é€šè¿‡</p>
<h3 id="ç«¯ç‚¹åˆ†ç±»">ç«¯ç‚¹åˆ†ç±»</h3>
<table>
<thead>
<tr>
<th>åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>/beans</td>
<td>æ˜¾ç¤ºæ‰€æœ‰çš„<code>Spring bean</code>åˆ—è¡¨</td>
</tr>
<tr>
<td>/caches</td>
<td>æ˜¾ç¤ºæ‰€æœ‰çš„ç¼“å­˜ç›¸å…³ä¿¡æ¯</td>
</tr>
<tr>
<td>/scheduledtasks</td>
<td>æ˜¾ç¤ºæ‰€æœ‰çš„å®šæ—¶ä»»åŠ¡ç›¸å…³ä¿¡æ¯</td>
</tr>
<tr>
<td>/loggers</td>
<td>æ˜¾ç¤ºæ‰€æœ‰çš„æ—¥å¿—ç›¸å…³ä¿¡æ¯</td>
</tr>
<tr>
<td>/configprops</td>
<td>æ˜¾ç¤ºæ‰€æœ‰çš„é…ç½®ä¿¡æ¯</td>
</tr>
<tr>
<td>/env</td>
<td>æ˜¾ç¤ºæ‰€æœ‰çš„ç¯å¢ƒå˜é‡ä¿¡æ¯</td>
</tr>
<tr>
<td>/mappings</td>
<td>æ˜¾ç¤ºæ‰€æœ‰æ§åˆ¶å™¨ç›¸å…³ä¿¡æ¯</td>
</tr>
<tr>
<td>/info</td>
<td>æ˜¾ç¤ºè‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯é…ç½®</td>
</tr>
<tr>
<td>/metrics</td>
<td>æ˜¾ç¤ºåº”ç”¨æŒ‡æ ‡ç›¸å…³ä¿¡æ¯</td>
</tr>
<tr>
<td>/health</td>
<td>æ˜¾ç¤ºå¥åº·æ£€æŸ¥çŠ¶æ€ä¿¡æ¯ï¼Œ<code>up</code>è¡¨ç¤ºæˆåŠŸ <code>down</code>è¡¨ç¤ºå¤±è´¥</td>
</tr>
<tr>
<td>/threaddump</td>
<td>æ˜¾ç¤ºç¨‹åºçº¿ç¨‹çš„ä¿¡æ¯</td>
</tr>
</tbody>
</table>
<h2 id="æ•´åˆå›¾å½¢åŒ–SpringBoot-Admin-SBA">æ•´åˆå›¾å½¢åŒ–SpringBoot Admin:SBA</h2>
<p>ä¸Šé¢æˆ‘ä»¬è®²äº†Spring Boot Actuator , å¯ä»¥é€šè¿‡httpåè®®è·å–ç³»ç»ŸçŠ¶æ€ä¿¡æ¯ , ä½†æ˜¯è¿”å›çš„æ˜¯JSONæ ¼å¼æ•°æ®, çœ‹èµ·æ¥ä¸å¤ªæ–¹é¢, è€Œä¸”è¿˜éœ€è¦è®°å¿†è·¯å¾„, æ¯”è¾ƒéº»çƒ¦ , Spring Boot Admin ç»™æˆ‘ä»¬æä¾›äº†æ›´åŠ å‹å¥½çš„å¯è§†åŒ–ç•Œ é¢æ¥æŸ¥çœ‹è¿™äº›ä¿¡æ¯ ! Spring Boot Admin æ˜¯ä¸€ä¸ªå¼€æºç¤¾åŒºé¡¹ç›®ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§ SpringBoot åº”ç”¨ç¨‹åºã€‚</p>
<p>åº”ç”¨ç¨‹åºä½œä¸ºSpring Boot Admin Client å‘ Spring Boot Admin Server æ³¨å†Œ , Client ä¼šå®šæ—¶å‘ Server å‘é€æ•°æ®, Server ä½¿ç”¨å‹å¥½ç•Œé¢å±• ç¤ºæ•°æ®ã€‚</p>
<p><img src="http://120.26.79.238:9000/blog/img/25f9d398b5b37b386699ab81e69f7650.png" alt=""></p>
<h3 id="æ­å»º-Admin-æœåŠ¡å™¨ç«¯">æ­å»º Admin æœåŠ¡å™¨ç«¯</h3>
<ol>
<li>
<p>åˆ›å»ºæ¨¡å— springboot-admin-server,å¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>2.åœ¨ä¸»å¯åŠ¨ç±»ä¸ŠåŠ @EnableAdminServer æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAdminServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(AdminApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ­å»ºAdminå®¢æˆ·ç«¯">æ­å»ºAdminå®¢æˆ·ç«¯</h3>
<p>åœ¨å„ä¸ªå¾®æœåŠ¡ï¼ˆAdminå®¢æˆ·ç«¯ï¼‰æ•´åˆAdminServer</p>
<p>ç¬¬ä¸€æ­¥ï¼šå¯¼å…¥Adminå®¢æˆ·ç«¯ä¾èµ–ä¿¡æ¯</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥ï¼šå‘ admin-server æ³¨å†Œçš„åœ°å€ä¸º <a href="http://localhost:8080">http://localhost:8080</a>ï¼Œæœ€åæš´éœ²è‡ªå·±çš„ actuator çš„æ‰€æœ‰ç«¯å£ä¿¡æ¯</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">boot:</span></span><br><span class="line">    <span class="attr">admin:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://localhost:8080</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•ï¼š</p>
<h3 id="åŠ¨æ€æ—¥å¿—ç›‘æ§åŠçº§åˆ«è°ƒæ•´">åŠ¨æ€æ—¥å¿—ç›‘æ§åŠçº§åˆ«è°ƒæ•´</h3>
<p>åœ¨å¾®æœåŠ¡çš„src/main/resourcesç›®å½•ä¸‹åˆ›å»ºlogback-spring.xmlæ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span>&gt;</span>logback<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ—¥å¿—çš„è¾“å‡ºç›®å½• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log.path&quot;</span> <span class="attr">value</span>=<span class="string">&quot;D://logs//spzx-cloud-user//logs&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ§åˆ¶å°æ—¥å¿—æ ¼å¼ï¼šå½©è‰²æ—¥å¿—--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- boldMagenta:ç²—çº¢--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- cyan:é’è‰² --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- white:ç™½è‰² --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE_LOG_PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%yellow(%date&#123;yyyy-MM-dd HH:mm:ss&#125;) %highlight([%-5level]) %green(%logger) %msg%n&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ–‡ä»¶æ—¥å¿—æ ¼å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;FILE_LOG_PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%date&#123;yyyy-MM-dd HH:mm:ss&#125; [%-5level] %thread %file:%line %logger %msg%n&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ç¼–ç --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ENCODING&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ§åˆ¶å°æ—¥å¿— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä¸´ç•Œå€¼è¿‡æ»¤å™¨ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>$&#123;ENCODING&#125;<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ–‡ä»¶æ—¥å¿— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.FileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;//log.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date&#123;yyyy-MM-dd HH:mm:ss&#125; %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>$&#123;ENCODING&#125;<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥ï¼šåœ¨å¾®æœåŠ¡çš„application.ymlæ–‡ä»¶ä¸­é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">logfile:</span></span><br><span class="line">      <span class="attr">external-file:</span> <span class="string">D://logs/spzx-cloud-user/info.log</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ­¥ï¼šå†æ¬¡è®¿é—®AdminæœåŠ¡å™¨ç«¯ï¼šå³å¯çœ‹åˆ°å®æ—¶ç›‘æ§æ—¥å¿—ã€å¹¶å¯ä»¥è°ƒèŠ‚æ—¥å¿—çš„çº§åˆ«ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>å¼‚æ­¥ç¼–æ’</title>
    <url>/2025/09/15/%E5%BC%82%E6%AD%A5%E7%BC%96%E6%8E%92/</url>
    <content><![CDATA[<h1>å¼‚æ­¥ç¼–æ’</h1>
<p>å¼‚æ­¥ï¼šå¤šçº¿ç¨‹</p>
<p>ç¼–æ’ï¼šæ‰§è¡Œé¡ºåº</p>
<p>CompletableFutureæ˜¯jdk8çš„æ–°ç‰¹æ€§,ä¸»è¦æ˜¯ç”¨äºå¼‚æ­¥è°ƒç”¨ï¼Œå†…éƒ¨å°è£…äº†çº¿ç¨‹æ± ,ä¹Ÿæ”¯æŒè‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œå¯ä»¥å°†è¯·æ±‚æˆ–è€…å¤„ç†è¿‡ç¨‹ï¼Œè¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚</p>
<p>å¼‚æ­¥æ‰§è¡Œä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± Executorå»åˆ›å»ºæ‰§è¡Œçš„ã€‚å¦‚æœä¸éœ€è¦æœ‰è¿”å›å€¼ï¼Œ ä»»åŠ¡å®ç°Runnableæ¥å£ï¼›å¦‚æœéœ€è¦æœ‰è¿”å›å€¼ï¼Œä»»åŠ¡å®ç°Callableæ¥å£ï¼Œè°ƒç”¨Executorçš„submitæ–¹æ³•ï¼Œå†ä½¿ç”¨Futureè·å–å³å¯ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹å­˜åœ¨å‰åä¾èµ–çš„è¯ï¼Œæˆ‘ä»¬æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿå…¶å®å¯ç”¨CompeletableFutureã€‚</p>
<p>CompeletableFutureå¯¹å‰åæœ‰ä¾èµ–é¡¸çš„å¼‚æ­¥ä»»åŠ¡çš„è°ƒç”¨æœ‰ç‚¹ç±»ä¼¼äºå‰é¢æˆ‘ä»¬å­¦è¿‡çš„axiosçš„å›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¹‹ä¸ºå¼‚æ­¥ç¼–æ’æŠ€æœ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>CompletableFuture:</span><br><span class="line">  completedFuture():ç±»ä¼¼äºCallableæ¥å£çš„å¤šçº¿ç¨‹</span><br><span class="line">  </span><br><span class="line">  runAsync(Runnable,ExecutorService):é€‚ç”¨äºæ— å‚æ— è¿”å›å€¼,å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± </span><br><span class="line">  runAsync(Runnable):é€‚ç”¨äºæ— å‚æ— è¿”å›å€¼,ä½¿ç”¨é»˜è®¤çš„çº¿ç¨‹æ± (ForkJoinPool)</span><br><span class="line">  </span><br><span class="line">  supply(Supplier,ExecutorService)ï¼šé€‚ç”¨äºæ— å‚æœ‰è¿”å›å€¼,å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± </span><br><span class="line">  supply(Supplier)ï¼šé€‚ç”¨äºæ— å‚æœ‰è¿”å›å€¼,ä½¿ç”¨é»˜è®¤çš„çº¿ç¨‹æ± (ForkJoinPool)</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  thenRunAync(Runnable,ExecutorService):è¡¨ç¤ºä½¿ç”¨æ–°çš„çº¿ç¨‹[è‡ªå®šä¹‰çº¿ç¨‹æ± ä¸­]ç»§ç»­å®ŒæˆæŸä¸ªä»»åŠ¡,æ— å‚æ— è¿”å›å€¼</span><br><span class="line">  thenRunAync(Runnable): è¡¨ç¤ºä½¿ç”¨æ–°çš„çº¿ç¨‹[é»˜è®¤çš„çº¿ç¨‹æ± ä¸­]ç»§ç»­å®ŒæˆæŸä¸ªä»»åŠ¡,æ— å‚æ— è¿”å›å€¼</span><br><span class="line">  thenRun(Runnable): è¡¨ç¤ºä½¿ç”¨ä¸Šä¸€ä¸ªçº¿ç¨‹ç»§ç»­å®ŒæˆæŸä¸ªä»»åŠ¡,æ— å‚æ— è¿”å›å€¼</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  thenAcceptAync(Consumer,ExecutorService):è¡¨ç¤ºä½¿ç”¨æ–°çš„çº¿ç¨‹[è‡ªå®šä¹‰çº¿ç¨‹æ± ä¸­]ç»§ç»­å®ŒæˆæŸä¸ªä»»åŠ¡,æœ‰å‚æ— è¿”å›å€¼</span><br><span class="line">  thenAcceptAync(Consumer): è¡¨ç¤ºä½¿ç”¨æ–°çš„çº¿ç¨‹[é»˜è®¤çš„çº¿ç¨‹æ± ä¸­]ç»§ç»­å®ŒæˆæŸä¸ªä»»åŠ¡,æœ‰å‚æ— è¿”å›å€¼</span><br><span class="line">  thenAccept(Consumer): è¡¨ç¤ºä½¿ç”¨ä¸Šä¸€ä¸ªçº¿ç¨‹ç»§ç»­å®ŒæˆæŸä¸ªä»»åŠ¡,æœ‰å‚æ— è¿”å›å€¼</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  thenApplyAync(Function,ExecutorService):è¡¨ç¤ºä½¿ç”¨æ–°çš„çº¿ç¨‹[è‡ªå®šä¹‰çº¿ç¨‹æ± ä¸­]ç»§ç»­å®ŒæˆæŸä¸ªä»»åŠ¡,æœ‰å‚æœ‰è¿”å›å€¼</span><br><span class="line">  thenApplytAync(Function): è¡¨ç¤ºä½¿ç”¨æ–°çš„çº¿ç¨‹[é»˜è®¤çš„çº¿ç¨‹æ± ä¸­]ç»§ç»­å®ŒæˆæŸä¸ªä»»åŠ¡,æœ‰å‚æœ‰è¿”å›å€¼</span><br><span class="line">  thenApply(Function): è¡¨ç¤ºä½¿ç”¨ä¸Šä¸€ä¸ªçº¿ç¨‹ç»§ç»­å®ŒæˆæŸä¸ªä»»åŠ¡,æœ‰å‚æœ‰è¿”å›å€¼</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  whenCompleteAsync(BiConsumer,threadPoolExecutor):è¡¨ç¤ºä½¿ç”¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹[è‡ªå®šçº¿ç¨‹æ± ],ä»»åŠ¡å¯ä»¥æ¥æ”¶åˆ°ä¸Šä¸€ä¸ªçº¿ç¨‹çš„è¿”å›ç»“æœå’Œå¼‚å¸¸ä¿¡æ¯,æ— è¿”å›å€¼</span><br><span class="line">  whenCompleteAsync(BiConsumer):è¡¨ç¤ºä½¿ç”¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹[é»˜è®¤çº¿ç¨‹æ± ],ä»»åŠ¡å¯ä»¥æ¥æ”¶åˆ°ä¸Šä¸€ä¸ªçº¿ç¨‹çš„è¿”å›ç»“æœå’Œå¼‚å¸¸ä¿¡æ¯,æ— è¿”å›å€¼</span><br><span class="line">  whenComplete(BiConsumer):</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  exceptionally(Function):è¡¨ç¤ºä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± ä¸­çš„æ–°çš„çº¿ç¨‹å¤„ç†è¿™ä¸ªå¼‚å¸¸ä¿¡æ¯ï¼Œè¿˜èƒ½æä¾›ä¸€ä¸ªé»˜è®¤çš„è¿”å›å€¼ã€‚</span><br><span class="line">  </span><br><span class="line">  handleAsync(Function,threadPoolExecutor)::è¡¨ç¤ºä½¿ç”¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹[è‡ªå®šçº¿ç¨‹æ± ],ä»»åŠ¡å¯ä»¥æ¥æ”¶åˆ°ä¸Šä¸€ä¸ªçº¿ç¨‹çš„è¿”å›ç»“æœå’Œå¼‚å¸¸ä¿¡æ¯,æœ‰è¿”å›å€¼</span><br><span class="line">  handleAsync(Function)::è¡¨ç¤ºä½¿ç”¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹[é»˜è®¤çº¿ç¨‹æ± ],ä»»åŠ¡å¯ä»¥æ¥æ”¶åˆ°ä¸Šä¸€ä¸ªçº¿ç¨‹çš„è¿”å›ç»“æœå’Œå¼‚å¸¸ä¿¡æ¯,æœ‰è¿”å›å€¼</span><br><span class="line">  handle(Function)::è¡¨ç¤ºä½¿ç”¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹[é»˜è®¤çº¿ç¨‹æ± ],ä»»åŠ¡å¯ä»¥æ¥æ”¶åˆ°ä¸Šä¸€ä¸ªçº¿ç¨‹çš„è¿”å›ç»“æœå’Œå¼‚å¸¸ä¿¡æ¯,æœ‰è¿”å›å€¼</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  ---------å½“ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼Œå†å»çº¿ç¨‹æ± ä¸­æ‹¿ä¸€ä¸ªæ–°çš„çº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚</span><br><span class="line">  </span><br><span class="line">  runAfterBothAsync(CompletionStage,Runnable,threadPoolExecutor):ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± æ–°çš„çº¿ç¨‹ï¼Œæ— å‚æ— è¿”å›å€¼</span><br><span class="line">  runAfterBothAsync(CompletionStage,Runnable)::ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± æ–°çš„çº¿ç¨‹ï¼Œæ— å‚æ— è¿”å›å€¼</span><br><span class="line">  runAfterBoth(CompletionStage,Runnable,threadPoolExecutor):ä½¿ç”¨åŸæ¥çš„çº¿ç¨‹ï¼Œæ— å‚æ— è¿”å›å€¼</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  thenAcceptBothAsync(CompletionStage,BiConsumer,threadPoolExecutor):æœ‰å‚æ— è¿”å›å€¼</span><br><span class="line">  thenAcceptBothAsync(CompletionStage,BiConsumer):æœ‰å‚æ— è¿”å›å€¼</span><br><span class="line">  thenAcceptBoth(CompletionStage,BiConsumer,threadPoolExecutor):æœ‰å‚æ— è¿”å›å€¼</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  thenCombineAsync(CompletionStage,BiFunction,threadPoolExecutor):æœ‰å‚æœ‰è¿”å›å€¼</span><br><span class="line">  thenCombineAsync(CompletionStage,BiFunction):æœ‰å‚æœ‰è¿”å›å€¼</span><br><span class="line">  thenCombine(CompletionStage,BiFunction):æœ‰å‚æœ‰è¿”å›å€¼</span><br><span class="line">  </span><br><span class="line">  CompletableFuture.allOf(CompletionStage ...):è¡¨ç¤ºä»»æ„å¤šä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼Œå†æ‰§è¡Œå•¥ï¼Ÿ</span><br><span class="line">  </span><br><span class="line">  -------------------------å½“ä¸¤ä¸ªçº¿ç¨‹ä»»ä½•ä¸€ä¸ªæ‰§è¡Œå®Œæˆä¹‹åï¼Œå†å»çº¿ç¨‹æ± ä¸­æ‹¿ä¸€ä¸ªæ–°çš„çº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚-----------</span><br><span class="line">  </span><br><span class="line">  Açº¿ç¨‹.runAfterEitherAsync(CompletionStage[Bçº¿ç¨‹],Runnable,threadPoolExecutor):</span><br><span class="line">  Açº¿ç¨‹.runAfterEitherAsync(CompletionStage[Bçº¿ç¨‹],Runnable):</span><br><span class="line">  Açº¿ç¨‹.runAfterEither(CompletionStage[Bçº¿ç¨‹],Runnable,threadPoolExecutor):</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  Açº¿ç¨‹.acceptAfterEitherAsync(CompletionStage[Bçº¿ç¨‹],Runnable,threadPoolExecutor):</span><br><span class="line">  Açº¿ç¨‹.acceptAfterEitherAsync(CompletionStage[Bçº¿ç¨‹],Runnable):</span><br><span class="line">  Açº¿ç¨‹.acceptfterEither(CompletionStage[Bçº¿ç¨‹],Runnable,threadPoolExecutor):</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">   Açº¿ç¨‹.applyToEitherAsync(CompletionStage[Bçº¿ç¨‹],Runnable,threadPoolExecutor):</span><br><span class="line">   Açº¿ç¨‹.applyToEitherAsync(CompletionStage[Bçº¿ç¨‹],Runnable):</span><br><span class="line">   Açº¿ç¨‹.applyToEitherAsync(CompletionStage[Bçº¿ç¨‹],Runnable,threadPoolExecutor):</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">   CompletableFuture.anyOf(CompletableFuture ...):ä»»æ„ä¸€ä¸ªçº¿ç¨‹å®Œæˆä¹‹åï¼Œéƒ½å¯ä»¥ç»§ç»­...</span><br><span class="line">   </span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>æ“ä½œæ—¥å¿—æ–¹æ¡ˆ</title>
    <url>/2025/04/27/%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<h1>ç›®æ ‡</h1>
<blockquote>
<p>è®°å½•å®ä½“ç±»å±æ€§çš„å˜åŒ–</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.scjt.jypm.project.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CompareType</span> &#123;</span><br><span class="line">    DEFAULT, <span class="comment">// é»˜è®¤ç›´æ¥æ¯”è¾ƒ</span></span><br><span class="line">    USER_NICKNAME, <span class="comment">// æ ¹æ®IDæŸ¥æ‰¾ç”¨æˆ·æ˜µç§°</span></span><br><span class="line">    BOOLEAN_TO_TEXT, <span class="comment">// 0/1 è½¬æ¢ä¸º å¦/æ˜¯</span></span><br><span class="line">    DICTIONARY, <span class="comment">// å­—å…¸ç±»å‹æ¯”è¾ƒ</span></span><br><span class="line">    DATE <span class="comment">// æ—¶é—´æ ¼å¼åŒ–æ¯”è¾ƒ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.scjt.jypm.project.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LogField &#123;</span><br><span class="line">    String <span class="title function_">name</span><span class="params">()</span>; <span class="comment">// å­—æ®µåç§°</span></span><br><span class="line">    CompareType <span class="title function_">type</span><span class="params">()</span> <span class="keyword">default</span> CompareType.DEFAULT; <span class="comment">// æ¯”è¾ƒç±»å‹</span></span><br><span class="line">    String <span class="title function_">dictType</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>; <span class="comment">// å­—å…¸ç±»å‹ï¼ˆä»… DICTIONARY ç±»å‹ä½¿ç”¨ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.scjt.jypm.project.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.scjt.jypm.project.annotation.CompareType;</span><br><span class="line"><span class="keyword">import</span> com.scjt.jypm.project.annotation.LogField;</span><br><span class="line"><span class="keyword">import</span> com.scjt.jypm.system.mapper.SysDictTypeMapper;</span><br><span class="line"><span class="keyword">import</span> com.scjt.jypm.system.mapper.SysUserMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogHelper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SysUserMapper sysUserMapper;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SysDictTypeMapper sysDictTypeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LogHelper</span><span class="params">(SysUserMapper sysUserMapper, SysDictTypeMapper sysDictTypeMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sysUserMapper = sysUserMapper;</span><br><span class="line">        <span class="built_in">this</span>.sysDictTypeMapper = sysDictTypeMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">formatValue</span><span class="params">(Object value, CompareType type, String dictType)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;ç©º&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> USER_NICKNAME:</span><br><span class="line">                <span class="keyword">return</span> getUserNickname(String.valueOf(value));</span><br><span class="line">            <span class="keyword">case</span> BOOLEAN_TO_TEXT:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>.equals(value) ? <span class="string">&quot;æ˜¯&quot;</span> : <span class="string">&quot;å¦&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> DICTIONARY:</span><br><span class="line">                <span class="keyword">return</span> getDictName(dictType, String.valueOf(value));</span><br><span class="line">            <span class="keyword">case</span> DATE:</span><br><span class="line">                <span class="keyword">return</span> value.toString(); <span class="comment">// ç›´æ¥è°ƒç”¨ toString</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> value.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getUserNickname</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(userId)</span><br><span class="line">                .flatMap(id -&gt; Optional.ofNullable(sysUserMapper.getNickNameById(id)))</span><br><span class="line">                .orElse(<span class="string">&quot;æœªçŸ¥ç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getDictName</span><span class="params">(String dictType, String value)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(value)</span><br><span class="line">                .flatMap(l -&gt; Optional.ofNullable(sysDictTypeMapper.selectDictTypeByTypeAndValue(dictType,value).getDictLabel()))</span><br><span class="line">                .orElse(<span class="string">&quot;ç©º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; List&lt;String&gt; <span class="title function_">compareObjects</span><span class="params">(T oldData, T newData)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        List&lt;String&gt; changeLog = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Class&lt;?&gt; clazz = oldData.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Field field : clazz.getDeclaredFields()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(LogField.class)) &#123;</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="type">LogField</span> <span class="variable">logField</span> <span class="operator">=</span> field.getAnnotation(LogField.class);</span><br><span class="line">                <span class="type">String</span> <span class="variable">fieldName</span> <span class="operator">=</span> logField.name();</span><br><span class="line">                <span class="type">CompareType</span> <span class="variable">type</span> <span class="operator">=</span> logField.type();</span><br><span class="line">                <span class="type">String</span> <span class="variable">dictType</span> <span class="operator">=</span> logField.dictType();</span><br><span class="line">                <span class="type">Object</span> <span class="variable">oldValue</span> <span class="operator">=</span> field.get(oldData);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">newValue</span> <span class="operator">=</span> field.get(newData);</span><br><span class="line"></span><br><span class="line">                <span class="type">String</span> <span class="variable">formattedOldValue</span> <span class="operator">=</span> formatValue(oldValue, type, dictType);</span><br><span class="line">                <span class="type">String</span> <span class="variable">formattedNewValue</span> <span class="operator">=</span> formatValue(newValue, type, dictType);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!Objects.equals(formattedOldValue, formattedNewValue)) &#123;</span><br><span class="line">                    changeLog.add(String.format(<span class="string">&quot;[%s] ä» %s ä¿®æ”¹ä¸º %s&quot;</span>, fieldName,</span><br><span class="line">                            defaultIfEmpty(formattedOldValue), defaultIfEmpty(formattedNewValue)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> changeLog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">defaultIfEmpty</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (value == <span class="literal">null</span> || value.isEmpty()) ? <span class="string">&quot;ç©º&quot;</span> : value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>æ•°æ®åº“</h1>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `prj_operation_log` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `prj_number` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é¡¹ç›®ç¼–å·&#x27;</span>,</span><br><span class="line">  `operation_type` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ“ä½œç±»å‹&#x27;</span>,</span><br><span class="line">  `operator` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ“ä½œäºº&#x27;</span>,</span><br><span class="line">  `operation_info` json <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ“ä½œä¿¡æ¯&#x27;</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¥æœŸ&#x27;</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ›´æ–°æ—¥æœŸ&#x27;</span>,</span><br><span class="line">  `log_type` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ—¥å¿—ç±»å‹ï¼ˆå­—å…¸ project_log_typeï¼‰&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">64</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci COMMENT<span class="operator">=</span><span class="string">&#x27;é¡¹ç›®åº“è¯¦æƒ…æ“ä½œæ—¥å¿—è¡¨&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>æ—¥å¿—æ”¶é›†</title>
    <url>/2025/09/15/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/</url>
    <content><![CDATA[<h2 id="æ—¥å¿—å¤„ç†çš„ç»„ä»¶">æ—¥å¿—å¤„ç†çš„ç»„ä»¶</h2>
<ul>
<li>æ”¶é›†</li>
<li>å­˜å‚¨</li>
<li>æ£€ç´¢</li>
</ul>
<h3 id="æ—¥å¿—æ”¶é›†çš„ç»„ä»¶">æ—¥å¿—æ”¶é›†çš„ç»„ä»¶</h3>
<ul>
<li>
<p>LogStash</p>
</li>
<li>
<p>FileBeat</p>
</li>
<li>
<p>Alloy</p>
</li>
<li>
<p>ProTail</p>
</li>
</ul>
<h3 id="æ—¥å¿—å­˜å‚¨ç»„ä»¶">æ—¥å¿—å­˜å‚¨ç»„ä»¶</h3>
<ul>
<li>
<p>Loki</p>
</li>
<li>
<p>ElaticSearch</p>
</li>
<li>
<p>Promentheus (æ—¶åºæ•°æ®åº“)</p>
</li>
</ul>
<h3 id="æ—¥å¿—çš„æ£€ç´¢ç»„ä»¶">æ—¥å¿—çš„æ£€ç´¢ç»„ä»¶</h3>
<ul>
<li>kibana</li>
<li>Grafana</li>
</ul>
<h2 id="æ—¥å¿—å¤„ç†çš„ä¸¤ç§è§£å†³æ–¹æ¡ˆ">æ—¥å¿—å¤„ç†çš„ä¸¤ç§è§£å†³æ–¹æ¡ˆ</h2>
<ul>
<li>é‡é‡çº§æ—¥å¿—: ELK
<ul>
<li>ElaticSerach (å­˜å‚¨)</li>
<li>LogStash (æ”¶é›†)</li>
<li>Kibana (æ£€ç´¢, å¯è§†åŒ–)</li>
</ul>
</li>
<li>è½»é‡çº§: GLA
<ul>
<li>Grafana (æ£€ç´¢)</li>
<li>Loki (å­˜å‚¨)
<ul>
<li>breakend</li>
<li>Loki write</li>
<li>Loki read</li>
<li>Nginx (gateWay)</li>
</ul>
</li>
<li>Alloy (æ”¶é›†)
<ul>
<li>é…ç½®æœåŠ¡æ ‡ç­¾, æ ¹æ®æ ‡ç­¾ä¿¡æ¯ç»™æ—¥å¿—è¿›è¡Œåˆ†ç±»</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="åŒºåˆ«">åŒºåˆ«:</h3>
<ul>
<li>
<p>ELK:</p>
<ul>
<li>
<p>Esä½¿ç”¨javaå¼€å‘, å¯åŠ¨æ—¶å ç”¨å†…å­˜å¤§</p>
</li>
<li>
<p>å­˜å‚¨: Esåœ¨å­˜å‚¨æ—¶, å°†æ—¥å¿—çš„æ‰€æœ‰æ¶ˆæ¯å­˜å‚¨èµ·æ¥, åœ¨æŸ¥æ‰¾æ—¶æ˜¯ä¸€æ¡æ¡æŸ¥æ‰¾,æ£€ç´¢é€Ÿåº¦æ…¢</p>
</li>
</ul>
</li>
<li>
<p>GLA:</p>
<ul>
<li>Lokiä½¿ç”¨goè¯­è¨€å¼€å‘, å ç”¨å†…å­˜å°</li>
<li>å¼•å…¥æºç¨‹ä¼˜åŒ–, é€Ÿåº¦æ›´å¿«</li>
<li>Lokiåœ¨å­˜å‚¨æ—¶, é€šè¿‡ç»™æ—¥å¿—æ‰“ä¸Šä¸åŒçš„æ ‡ç­¾, é€šè¿‡æ ‡ç­¾æ¥æŸ¥æ‰¾æ—¥å¿—, ä¹Ÿå°±æ˜¯å°†æ ‡ç­¾è®¾ç½®æœªç´¢å¼•, åœ¨æŸ¥æ‰¾æ—¥å¿—ä¿¡æ¯æ—¶, å¯ä»¥æ ¹æ®æ ‡ç­¾æŸ¥æ‰¾æ—¥å¿—, å¯ä»¥è¿‡æ»¤æ‰ä¸€äº›æ²¡ç”¨çš„æ—¥å¿—, æŸ¥æ‰¾é€Ÿåº¦ä¼šæ›´å¿«</li>
</ul>
</li>
</ul>
<h2 id="GLAåº•å±‚å·¥ä½œåŸç†">GLAåº•å±‚å·¥ä½œåŸç†</h2>
<h3 id="Lokiä¸­çš„ç»„ä»¶">Lokiä¸­çš„ç»„ä»¶</h3>
<ul>
<li>Nginx: ç½‘å…³, Lokiä¸­çš„ç»„ä»¶é€šè¿‡nginxè¿›è¡Œé€šä¿¡</li>
<li>backend:
<ul>
<li>ä½œç”¨æ˜¯å †æ”¶é›†çš„æ—¥å¿—åšå¤„ç†</li>
<li>å®ƒä¸»è¦ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆ</li>
<li>loki write:
<ol>
<li>æ—¥å¿—æ”¶é›†ç»„ä»¶, å°†æ—¥å¿—ä¿¡æ¯å‘é€ç»™loki write,  loki writeæ ¹æ®é…ç½®ä¸­çš„æ ‡ç­¾è§„åˆ™, ä¸ºè¯¥æ—¥å¿—æ‰“ä¸Šæ ‡ç­¾</li>
<li>å°†æ‰“å¥½çš„æ—¥å¿—å‘é€ç»™nginx, ç”±nginxå‘é€æ—¥å¿—ä¿¡æ¯,å­˜å‚¨åœ¨ä¸‰åˆ†å¯¹è±¡æˆ–æ–‡ä»¶å­˜å‚¨ä¸­,æ¯”å¦‚minio</li>
</ol>
</li>
<li>loki read: æ—¥å¿—è¯»å–ç»„ä»¶
<ol>
<li>åœ¨Grafanaå‘é€æ£€ç´¢è¯­å¥LogQLä¸ªLoki readæ—¶,loki read æ ¹æ®æ£€ç´¢è¯­å¥,åšå‡ºå¤„ç†</li>
<li>å¦‚ä½•å°†å¤„ç†å¥½çš„æ£€ç´¢è¯·æ±‚å‘ç”Ÿç»™nginx, ç”±nginx è¯·æ±‚ä¸‰æ–¹å­˜å‚¨ç»„ä»¶. è·å–åˆ°å¯¹åº”çš„æ—¥å¿—ä¿¡æ¯</li>
</ol>
</li>
</ul>
</li>
</ul>
<p><img src="http://120.26.79.238:9000/blog/img/f03a825845b16aa8e951731ea7f75da5.png" alt=""></p>
<h2 id="GLAä½¿ç”¨æµç¨‹">GLAä½¿ç”¨æµç¨‹</h2>
<p>[lokiå®˜ç½‘:](<a href="https://grafana.com/docs/loki/latest/">Grafana Loki | Grafana Loki documentation</a>) <a href="https://grafana.com/docs/loki/latest/">Grafana Loki | Grafana Loki documentation</a></p>
<p>Docker éƒ¨ç½²</p>
<ol>
<li>
<p>åˆ›å»ºæ–‡ä»¶å¤¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> evaluate-loki</span><br><span class="line"><span class="built_in">cd</span> evaluate-loki</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸‹è½½Lokiå’ŒAlloyçš„é»˜è®¤é…ç½®æ–‡ä»¶, ä¸‹è½½docker compose é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/grafana/loki/main/examples/getting-started/loki-config.yaml -O loki-config.yaml</span><br><span class="line">wget https://raw.githubusercontent.com/grafana/loki/main/examples/getting-started/alloy-local-config.yaml -O alloy-local-config.yaml</span><br><span class="line">wget https://raw.githubusercontent.com/grafana/loki/main/examples/getting-started/docker-compose.yaml -O docker-compose.yaml</span><br></pre></td></tr></table></figure>
<p>Lokiçš„é…ç½®æ–‡ä»¶: ä¸»è¦é…ç½®Lokiä¸­çš„ç»„ä»¶çš„ä¿¡æ¯: nginx \ write \ read  \  grafana \ minioçš„ä¿¡æ¯</p>
<p>Alloyçš„é…ç½®æ–‡ä»¶:  ä¸»è¦ç¼–å†™æ‹‰å–Logçš„æœåŠ¡ å’Œ Logçš„æ ‡ç­¾è§„åˆ™. åœ¨å­˜å‚¨å’Œæ£€ç´¢æ—¶, æ ¹æ®æ ‡ç­¾å­˜å‚¨å’Œæ£€ç´¢</p>
<ul>
<li>
<p><code>loki-config.yaml</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">http_listen_address:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">http_listen_port:</span> <span class="number">3100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">memberlist:</span></span><br><span class="line">  <span class="attr">join_members:</span> [<span class="string">&quot;read&quot;</span>, <span class="string">&quot;write&quot;</span>, <span class="string">&quot;backend&quot;</span>]</span><br><span class="line">  <span class="attr">dead_node_reclaim_time:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">gossip_to_dead_nodes_time:</span> <span class="string">15s</span></span><br><span class="line">  <span class="attr">left_ingesters_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">bind_addr:</span> [<span class="string">&#x27;0.0.0.0&#x27;</span>]</span><br><span class="line">  <span class="attr">bind_port:</span> <span class="number">7946</span></span><br><span class="line">  <span class="attr">gossip_interval:</span> <span class="string">2s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schema_config:</span></span><br><span class="line">  <span class="attr">configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">from:</span> <span class="number">2023-01-01</span></span><br><span class="line">      <span class="attr">store:</span> <span class="string">tsdb</span></span><br><span class="line">      <span class="attr">object_store:</span> <span class="string">s3</span></span><br><span class="line">      <span class="attr">schema:</span> <span class="string">v13</span></span><br><span class="line">      <span class="attr">index:</span></span><br><span class="line">        <span class="attr">prefix:</span> <span class="string">index_</span></span><br><span class="line">        <span class="attr">period:</span> <span class="string">24h</span></span><br><span class="line"><span class="attr">common:</span></span><br><span class="line">  <span class="attr">path_prefix:</span> <span class="string">/loki</span></span><br><span class="line">  <span class="attr">replication_factor:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">compactor_address:</span> <span class="string">http://backend:3100</span></span><br><span class="line">  <span class="attr">storage:</span></span><br><span class="line">    <span class="attr">s3:</span></span><br><span class="line">      <span class="attr">endpoint:</span> <span class="string">minio:9000</span></span><br><span class="line">      <span class="attr">insecure:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">bucketnames:</span> <span class="string">loki-data</span></span><br><span class="line">      <span class="attr">access_key_id:</span> <span class="string">loki</span></span><br><span class="line">      <span class="attr">secret_access_key:</span> <span class="string">supersecret</span></span><br><span class="line">      <span class="attr">s3forcepathstyle:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">ring:</span></span><br><span class="line">    <span class="attr">kvstore:</span></span><br><span class="line">      <span class="attr">store:</span> <span class="string">memberlist</span></span><br><span class="line"><span class="attr">ruler:</span></span><br><span class="line">  <span class="attr">storage:</span></span><br><span class="line">    <span class="attr">s3:</span></span><br><span class="line">      <span class="attr">bucketnames:</span> <span class="string">loki-ruler</span></span><br><span class="line"></span><br><span class="line"><span class="attr">compactor:</span></span><br><span class="line">  <span class="attr">working_directory:</span> <span class="string">/tmp/compactor</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>alloy-local-config.yaml</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">discovery.docker</span> <span class="string">&quot;flog_scrape&quot;</span> &#123;</span><br><span class="line">	<span class="string">host</span>             <span class="string">=</span> <span class="string">&quot;unix:///var/run/docker.sock&quot;</span></span><br><span class="line">	<span class="string">refresh_interval</span> <span class="string">=</span> <span class="string">&quot;5s&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">discovery.relabel</span> <span class="string">&quot;flog_scrape&quot;</span> &#123;</span><br><span class="line">	<span class="string">targets</span> <span class="string">=</span> []</span><br><span class="line"></span><br><span class="line">	<span class="string">rule</span> &#123;</span><br><span class="line">		<span class="string">source_labels</span> <span class="string">=</span> [<span class="string">&quot;__meta_docker_container_name&quot;</span>]</span><br><span class="line">		<span class="string">regex</span>         <span class="string">=</span> <span class="string">&quot;/(.*)&quot;</span></span><br><span class="line">		<span class="string">target_label</span>  <span class="string">=</span> <span class="string">&quot;container&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">loki.source.docker</span> <span class="string">&quot;flog_scrape&quot;</span> &#123;</span><br><span class="line">	<span class="string">host</span>             <span class="string">=</span> <span class="string">&quot;unix:///var/run/docker.sock&quot;</span></span><br><span class="line">	<span class="string">targets</span>          <span class="string">=</span> <span class="string">discovery.docker.flog_scrape.targets</span></span><br><span class="line">	<span class="string">forward_to</span>       <span class="string">=</span> [<span class="string">loki.write.default.receiver</span>]</span><br><span class="line">	<span class="string">relabel_rules</span>    <span class="string">=</span> <span class="string">discovery.relabel.flog_scrape.rules</span></span><br><span class="line">	<span class="string">refresh_interval</span> <span class="string">=</span> <span class="string">&quot;5s&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">loki.write</span> <span class="string">&quot;default&quot;</span> &#123;</span><br><span class="line">	<span class="string">endpoint</span> &#123;</span><br><span class="line">		<span class="string">url</span>       <span class="string">=</span> <span class="string">&quot;http://gateway:3100/loki/api/v1/push&quot;</span></span><br><span class="line">		<span class="string">tenant_id</span> <span class="string">=</span> <span class="string">&quot;tenant1&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="string">external_labels</span> <span class="string">=</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>docker-compose.yaml</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">loki:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">read:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/loki:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;-config.file=/etc/loki/config.yaml -target=read&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3101</span><span class="string">:3100</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7946</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9095</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./loki-config.yaml:/etc/loki/config.yaml</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [ <span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;wget --no-verbose --tries=1 --spider http://localhost:3100/ready || exit 1&quot;</span> ]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">networks:</span> <span class="string">&amp;loki-dns</span></span><br><span class="line">      <span class="attr">loki:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">write:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/loki:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;-config.file=/etc/loki/config.yaml -target=write&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3102</span><span class="string">:3100</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7946</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9095</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./loki-config.yaml:/etc/loki/config.yaml</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [ <span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;wget --no-verbose --tries=1 --spider http://localhost:3100/ready || exit 1&quot;</span> ]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="string">&lt;&lt;:</span> <span class="string">*loki-dns</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">alloy:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/alloy:latest</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./alloy-local-config.yaml:/etc/alloy/config.alloy:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">    <span class="attr">command:</span>  <span class="string">run</span> <span class="string">--server.http.listen-addr=0.0.0.0:12345</span> <span class="string">--storage.path=/var/lib/alloy/data</span> <span class="string">/etc/alloy/config.alloy</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">12345</span><span class="string">:12345</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gateway</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio</span></span><br><span class="line">    <span class="attr">entrypoint:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-euc</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        mkdir -p /data/loki-data &amp;&amp; \</span></span><br><span class="line"><span class="string">        mkdir -p /data/loki-ruler &amp;&amp; \</span></span><br><span class="line"><span class="string">        minio server /data</span></span><br><span class="line"><span class="string"></span>    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_ROOT_USER=loki</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_ROOT_PASSWORD=supersecret</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_PROMETHEUS_AUTH_TYPE=public</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_UPDATE=off</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9000</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./.data/minio:/data</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [ <span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost:9000/minio/health/live&quot;</span> ]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">15s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">20s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:latest</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_PATHS_PROVISIONING=/etc/grafana/provisioning</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_AUTH_ANONYMOUS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_AUTH_ANONYMOUS_ORG_ROLE=Admin</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gateway</span></span><br><span class="line">    <span class="attr">entrypoint:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-euc</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        mkdir -p /etc/grafana/provisioning/datasources</span></span><br><span class="line"><span class="string">        cat &lt;&lt;EOF &gt; /etc/grafana/provisioning/datasources/ds.yaml</span></span><br><span class="line"><span class="string">        apiVersion: 1</span></span><br><span class="line"><span class="string">        datasources:</span></span><br><span class="line"><span class="string">          - name: Loki</span></span><br><span class="line"><span class="string">            type: loki</span></span><br><span class="line"><span class="string">            access: proxy</span></span><br><span class="line"><span class="string">            url: http://gateway:3100</span></span><br><span class="line"><span class="string">            jsonData:</span></span><br><span class="line"><span class="string">              httpHeaderName1: &quot;X-Scope-OrgID&quot;</span></span><br><span class="line"><span class="string">            secureJsonData:</span></span><br><span class="line"><span class="string">              httpHeaderValue1: &quot;tenant1&quot;</span></span><br><span class="line"><span class="string">        EOF</span></span><br><span class="line"><span class="string">        /run.sh</span></span><br><span class="line"><span class="string"></span>    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [ <span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;wget --no-verbose --tries=1 --spider http://localhost:3000/api/health || exit 1&quot;</span> ]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/loki:latest</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./loki-config.yaml:/etc/loki/config.yaml</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3100&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;7946&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;-config.file=/etc/loki/config.yaml -target=backend -legacy-read-mode=false&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gateway</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">  <span class="attr">gateway:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">read</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">write</span></span><br><span class="line">    <span class="attr">entrypoint:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-euc</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        cat &lt;&lt;EOF &gt; /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="string">        user  nginx;</span></span><br><span class="line"><span class="string">        worker_processes  5;  ## Default: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">        <span class="string">events</span> &#123;</span><br><span class="line">          <span class="string">worker_connections</span>   <span class="number">1000</span><span class="string">;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="string">http</span> &#123;</span><br><span class="line">          <span class="string">resolver</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.11</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">          <span class="string">server</span> &#123;</span><br><span class="line">            <span class="string">listen</span>             <span class="number">3100</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">=</span> <span class="string">/</span> &#123;</span><br><span class="line">              <span class="string">return</span> <span class="number">200</span> <span class="string">&#x27;OK&#x27;</span><span class="string">;</span></span><br><span class="line">              <span class="string">auth_basic</span> <span class="string">off;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">=</span> <span class="string">/api/prom/push</span> &#123;</span><br><span class="line">              <span class="string">proxy_pass</span>       <span class="string">http://write:3100\$$request_uri;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">=</span> <span class="string">/api/prom/tail</span> &#123;</span><br><span class="line">              <span class="string">proxy_pass</span>       <span class="string">http://read:3100\$$request_uri;</span></span><br><span class="line">              <span class="string">proxy_set_header</span> <span class="string">Upgrade</span> <span class="string">\$$http_upgrade;</span></span><br><span class="line">              <span class="string">proxy_set_header</span> <span class="string">Connection</span> <span class="string">&quot;upgrade&quot;</span><span class="string">;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">~</span> <span class="string">/api/prom/.*</span> &#123;</span><br><span class="line">              <span class="string">proxy_pass</span>       <span class="string">http://read:3100\$$request_uri;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">=</span> <span class="string">/loki/api/v1/push</span> &#123;</span><br><span class="line">              <span class="string">proxy_pass</span>       <span class="string">http://write:3100\$$request_uri;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">=</span> <span class="string">/loki/api/v1/tail</span> &#123;</span><br><span class="line">              <span class="string">proxy_pass</span>       <span class="string">http://read:3100\$$request_uri;</span></span><br><span class="line">              <span class="string">proxy_set_header</span> <span class="string">Upgrade</span> <span class="string">\$$http_upgrade;</span></span><br><span class="line">              <span class="string">proxy_set_header</span> <span class="string">Connection</span> <span class="string">&quot;upgrade&quot;</span><span class="string">;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">~</span> <span class="string">/loki/api/.*</span> &#123;</span><br><span class="line">              <span class="string">proxy_pass</span>       <span class="string">http://read:3100\$$request_uri;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">EOF</span></span><br><span class="line">        <span class="string">/docker-entrypoint.sh</span> <span class="string">nginx</span> <span class="string">-g</span> <span class="string">&quot;daemon off;&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3100:3100&quot;</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;service&quot;</span>, <span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;status&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="attr">flog:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mingrammer/flog</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">-f</span> <span class="string">json</span> <span class="string">-d</span> <span class="string">200ms</span> <span class="string">-l</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>å¯åŠ¨docker compose</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è¿›å…¥Grafanaçš„ä¸»é¡µé¢: <a href="http://localhost:3000/">http://localhost:3000</a></p>
</li>
</ol>
<h2 id="æ—¥å¿—çš„LogQLè¯­å¥åˆ†ç±»">æ—¥å¿—çš„LogQLè¯­å¥åˆ†ç±»</h2>
<ul>
<li>jsonæ•°æ®</li>
<li>ç»“æ„åŒ–æ•°æ®</li>
<li>éç»“æ„åŒ–æ•°æ®</li>
</ul>
<p>å…·ä½“å¤„ç†: <a href="https://grafana.com/docs/loki/latest/query/analyzer/">Simple LogQL simulator | Grafana Loki documentation</a></p>
<blockquote>
<p>åœ¨éƒ¨ç½²å®¹å™¨æ—¶,å…ˆæŒ‡å®šæ—¥å¿—æ ¼å¼ä¸ºjsonæ ¼å¼,ä¾¿äºLogQLçš„ç¼–å†™</p>
</blockquote>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>æ—¥å¿—æ¡†æ¶</title>
    <url>/2025/09/15/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<h2 id="æ—¥å¿—æ¡†æ¶">æ—¥å¿—æ¡†æ¶</h2>
<p>é—¨é¢ï¼šç±»ä¼¼äºæ ‡å‡†å±‚ã€æ¥å£å±‚</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>JCLï¼ˆJakarta Commons Loggingï¼‰</td>
<td>é™ˆæ—§</td>
</tr>
<tr>
<td>SLF4Jï¼ˆSimple Logging Facade for Javaï¼‰</td>
<td>é€‚åˆï¼ˆ<strong>åŒä¸€ä½œè€…</strong>ï¼‰</td>
</tr>
<tr>
<td>jboss-logging</td>
<td>ç‰¹æ®Šä¸“ä¸šé¢†åŸŸä½¿ç”¨</td>
</tr>
</tbody>
</table>
<p>å®ç°</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>log4j</td>
<td>æœ€åˆç‰ˆï¼ˆ<strong>åŒä¸€ä½œè€…</strong>ï¼‰</td>
</tr>
<tr>
<td>JULï¼ˆjava.util.loggingï¼‰</td>
<td>JDKè‡ªå¸¦</td>
</tr>
<tr>
<td>log4j2</td>
<td>Apacheæ”¶è´­log4jåå…¨é¢é‡æ„ï¼Œå†…éƒ¨å®ç°å’Œlog4jå®Œå…¨ä¸åŒ</td>
</tr>
<tr>
<td>logback</td>
<td>ä¼˜é›…ã€å¼ºå¤§ï¼ˆ<strong>åŒä¸€ä½œè€…</strong>ï¼‰</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="ä½¿ç”¨ï¼š">ä½¿ç”¨ï¼š</h3>
<p>SLF4Jï¼ˆæ¥å£ï¼‰-&gt;logBak(å®ç°)</p>
<ol>
<li>
<p>ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>Logger</code>å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogTest</span>&#123;</span><br><span class="line">    </span><br><span class="line">    Logger logger= LogerFactory.getLogger(LogTest.class);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        logger.trance(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        logger.debug(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        logger.info(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        logger.warn(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        logger.error(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    &#125;        </span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½®æ–‡ä»¶<strong>logback.xml</strong>  åœ¨æ ¹è·¯å¾„ä¸‹ï¼Œå›ºå®šåç§°</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;60 seconds&quot;</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ—¥å¿—å­˜æ”¾è·¯å¾„ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log.path&quot;</span> <span class="attr">value</span>=<span class="string">&quot;logs/spzx-order&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ—¥å¿—è¾“å‡ºæ ¼å¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log.pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;20&#125; - [%method,%line] - %msg%n&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;log.pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ç³»ç»Ÿæ—¥å¿—è¾“å‡º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;file_info&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¾ªç¯æ”¿ç­–ï¼šåŸºäºæ—¶é—´åˆ›å»ºæ—¥å¿—æ–‡ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ—¥å¿—æ–‡ä»¶åæ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/info.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ—¥å¿—æœ€å¤§çš„å†å² 60å¤© --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>60<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;log.pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¿‡æ»¤çš„çº§åˆ« --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- åŒ¹é…æ—¶çš„æ“ä½œï¼šæ¥æ”¶ï¼ˆè®°å½•ï¼‰ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä¸åŒ¹é…æ—¶çš„æ“ä½œï¼šæ‹’ç»ï¼ˆä¸è®°å½•ï¼‰ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;file_error&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¾ªç¯æ”¿ç­–ï¼šåŸºäºæ—¶é—´åˆ›å»ºæ—¥å¿—æ–‡ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ—¥å¿—æ–‡ä»¶åæ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/error.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ—¥å¿—æœ€å¤§çš„å†å² 60å¤© --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>60<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;log.pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¿‡æ»¤çš„çº§åˆ« --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- åŒ¹é…æ—¶çš„æ“ä½œï¼šæ¥æ”¶ï¼ˆè®°å½•ï¼‰ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä¸åŒ¹é…æ—¶çš„æ“ä½œï¼šæ‹’ç»ï¼ˆä¸è®°å½•ï¼‰ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ç³»ç»Ÿæ¨¡å—æ—¥å¿—çº§åˆ«æ§åˆ¶  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.spzx&quot;</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Springæ—¥å¿—çº§åˆ«æ§åˆ¶  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework&quot;</span> <span class="attr">level</span>=<span class="string">&quot;warn&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ç³»ç»Ÿæ“ä½œæ—¥å¿—--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;file_info&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;file_error&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>@Slf4jæ³¨è§£ï¼Œè‡ªåŠ¨æ³¨å…¥logå¯¹è±¡</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>æƒé™èœå•</title>
    <url>/2023/11/16/%E6%9D%83%E9%99%90%E8%8F%9C%E5%8D%95/</url>
    <content><![CDATA[<h2 id="è¡¨">è¡¨</h2>
<h3 id="è§’è‰²è¡¨ï¼ˆroleï¼‰">è§’è‰²è¡¨ï¼ˆroleï¼‰</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> role (</span><br><span class="line">  id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  description <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="èœå•è¡¨ï¼ˆmenu">èœå•è¡¨ï¼ˆmenu)</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `menu` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `path` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `icon` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `description` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `pid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;çˆ¶çº§id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">9</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="è§’è‰²èœå•å…³ç³»ï¼ˆrole-menuï¼‰">è§’è‰²èœå•å…³ç³»ï¼ˆrole_menuï¼‰</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `role_menu` (</span><br><span class="line">  `role_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è§’è‰²id&#x27;</span>,</span><br><span class="line">  `menu_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;èœå•id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`role_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci COMMENT<span class="operator">=</span><span class="string">&#x27;è§’è‰²å’Œèœå•å…³ç³»è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure>
<hr>
<div class="note info no-icon modern"><ol>
<li><strong>é…ç½®è®¾ç½®</strong>ï¼šå­˜å‚¨åº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯ï¼Œå¦‚ç³»ç»Ÿè®¾ç½®ã€é€‰é¡¹å€¼ç­‰ã€‚</li>
<li><strong>æ•°æ®æ˜ å°„</strong>ï¼šç”¨äºæ˜ å°„æ•°æ®ï¼Œä¾‹å¦‚å°†çŠ¶æ€ä»£ç æ˜ å°„åˆ°çŠ¶æ€æè¿°ã€‚</li>
<li><strong>å‚ç…§åˆ—è¡¨</strong>ï¼šç”¨äºå­˜å‚¨å›ºå®šçš„æ•°æ®é›†åˆï¼Œå¦‚å›½å®¶ä»£ç ã€è¯­è¨€ä»£ç ã€è´§å¸ä»£ç ç­‰ã€‚</li>
<li><strong>æšä¸¾ç±»å‹</strong>ï¼šå­˜å‚¨ç¨‹åºä¸­ä½¿ç”¨çš„æšä¸¾å€¼å’Œå®ƒä»¬çš„æè¿°ã€‚</li>
</ol>
</div>
<h3 id="å­—å…¸ï¼ˆdict">å­—å…¸ï¼ˆdict)</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `dict` (</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åç§°&#x27;</span>,</span><br><span class="line">  `<span class="keyword">value</span>` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å†…å®¹&#x27;</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç±»å‹&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="æ“ä½œ">æ“ä½œ</h2>
<h3 id="èœå•ç®¡ç†">èœå•ç®¡ç†</h3>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/image-20231106182647363.png" alt=""></p>
<h3 id="è§’è‰²ç®¡ç†">è§’è‰²ç®¡ç†</h3>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/image-20231106182804891.png" alt=""></p>
<p><img src="http://orange-note-img.oss-cn-wuhan-lr.aliyuncs.com/blog/image-20231106182813462.png" alt=""></p>
<ul>
<li>åŠ¨æ€èœå•</li>
</ul>
<div class="note info no-icon modern"><p>ä¸åŒç”¨æˆ·åœ¨ç™»å½•æ—¶ï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²è·å–åˆ°å¯¹åº”çš„èœå•ï¼Œç„¶åä¼ ç»™èœå•ç»„ä»¶ asideï¼ŒåŠ¨æ€æ¸²æŸ“èœå•</p>
</div>
<ul>
<li>åŠ¨æ€è·¯ç”±</li>
</ul>
<p>åœ¨ router.js å†™ä¸€ä¸ªæ–¹æ³•ï¼ŒåŠ¨æ€æ·»åŠ è·¯ç”±,ç„¶åç™»å½•çš„æ—¶å€™è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨åˆ·æ–°æ—¶é‡æ–°è®¾ç½®è·¯ç”±</p>
<p><code>router.js</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–è·¯ç”±</span></span><br><span class="line"><span class="comment">// åˆ·æ–°é¡µé¢ä¼šä¸¢å¤±åŠ¨æ€æ·»åŠ çš„è·¯ç”±</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setRouters</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> storeMenus = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (storeMenus) &#123;</span><br><span class="line">    <span class="keyword">const</span> manageRouter = &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;manage&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../views/Manage.vue&quot;</span>),</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [],</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> menus = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(storeMenus).<span class="property">menus</span>;</span><br><span class="line">    menus.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">path</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> itemMneu = &#123;</span><br><span class="line">          <span class="attr">path</span>: item.<span class="property">path</span>.<span class="title function_">replace</span>(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">          <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../views/&quot;</span> + item.<span class="property">pagePath</span> + <span class="string">&quot;.vue&quot;</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        manageRouter.<span class="property">children</span>.<span class="title function_">push</span>(itemMneu);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">children</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        item.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> itemMneu = &#123;</span><br><span class="line">            <span class="attr">path</span>: item.<span class="property">path</span>.<span class="title function_">replace</span>(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">            <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../views/&quot;</span> + item.<span class="property">pagePath</span> + <span class="string">&quot;.vue&quot;</span>),</span><br><span class="line">          &#125;;</span><br><span class="line">          manageRouter.<span class="property">children</span>.<span class="title function_">push</span>(itemMneu);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// è·å–å½“å‰è·¯ç”±å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">const</span> currentRouter = router.<span class="title function_">getRoutes</span>().<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">name</span>);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰è·¯ç”±å¯¹è±¡æ˜¯å¦åŒ…å«manageè·¯ç”±</span></span><br><span class="line">    <span class="keyword">if</span> (!currentRouter.<span class="title function_">includes</span>(<span class="string">&quot;manage&quot;</span>)) &#123;</span><br><span class="line">      router.<span class="title function_">addRoute</span>(manageRouter);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//é‡æ–°æ·»åŠ è·¯ç”±</span></span><br><span class="line"><span class="title function_">setRouters</span>();</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>ç±»å‹è½¬æ¢å™¨ï¼ˆConverterï¼‰</title>
    <url>/2025/09/15/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%99%A8%EF%BC%88Converter%EF%BC%89/</url>
    <content><![CDATA[<h1>ç±»å‹è½¬æ¢å™¨ï¼ˆConverterï¼‰</h1>
<blockquote>
<p>åœ¨å‰ç«¯ä¼ è¿›åç«¯çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹æ—¶ï¼Œä½†æ˜¯åç«¯è·å–çš„æ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œæ­¤æ—¶åç«¯è·å–ä¸åˆ°å¯¹åº”æšä¸¾ç±»å¯¹è±¡</p>
<p>æ­¤æ—¶å°±éœ€è¦ä½¿ç”¨Coverter æ¥å°†Stringè½¬æ¢ä¸ºæšä¸¾ç±»å¯¹è±¡</p>
</blockquote>
<h2 id="è‡ªå®šä¹‰è½¬æ¢å™¨æ–¹æ³•">è‡ªå®šä¹‰è½¬æ¢å™¨æ–¹æ³•</h2>
<ul>
<li>
<p>æšä¸¾ç±»<code>ItemType</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ItemType</span> &#123;</span><br><span class="line"></span><br><span class="line">    APARTMENT(<span class="number">1</span>, <span class="string">&quot;å…¬å¯“&quot;</span>),</span><br><span class="line">    ROOM(<span class="number">2</span>, <span class="string">&quot;æˆ¿é—´&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Jsonvalue</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    ItemType(Integer code, String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li>
<p>å®šä¹‰è½¬æ¢å™¨æ–¹æ³•<code>StringToItemTypeConverter</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringToItemTypeConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, ItemType&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ItemType <span class="title function_">convert</span><span class="params">(String code)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ItemType value : ItemType.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value.getCode().equals(Integer.valueOf(code))) &#123;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;codeéæ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å°†è½¬æ¢å™¨æ–¹æ³•æ³¨å†Œåˆ°webMvcConfigurationä¸­ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringToItemTypeConverter stringToItemTypeConverter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">        registry.addConverter(<span class="built_in">this</span>.stringToItemTypeConverter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="è‡ªå®šä¹‰è½¬æ¢å™¨å·¥å‚">è‡ªå®šä¹‰è½¬æ¢å™¨å·¥å‚</h2>
<blockquote>
<p>å½“å¤šä¸ªæšä¸¾ç±»è¦è¿›è¡Œè½¬æ¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å·¥å‚ç»Ÿä¸€è½¬æ¢</p>
</blockquote>
<ol>
<li>
<p>è¦æ±‚ï¼šç»§æ‰¿åŒä¸€ä¸ªæšä¸¾ç±»<code>BaseEnum</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BaseEnum</span> &#123;</span><br><span class="line">    Integer <span class="title function_">getCode</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å®šä¹‰æšä¸¾ç±»å·¥å‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringToBaseEnumConverterFactory</span> <span class="keyword">implements</span> <span class="title class_">ConverterFactory</span>&lt;String, BaseEnum&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">BaseEnum</span>&gt; Converter&lt;String, T&gt; <span class="title function_">getConverter</span><span class="params">(Class&lt;T&gt; targetType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String, T&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> T <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">				<span class="comment">//Class.getEnumConstants() æ–¹æ³•æ˜¯ Java åå°„ API ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè·å–è¡¨ç¤ºæšä¸¾ç±»å‹çš„ Class å¯¹è±¡ä¸­æ‰€æœ‰æšä¸¾å¸¸é‡çš„æ•°ç»„</span></span><br><span class="line">                <span class="keyword">for</span> (T enumConstant : targetType.getEnumConstants()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (enumConstant.getCode().equals(Integer.valueOf(source))) &#123;</span><br><span class="line">                        <span class="keyword">return</span> enumConstant;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;éæ³•çš„æšä¸¾å€¼:&quot;</span> + source);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ³¨å†Œæšä¸¾ç±»å·¥å‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringToBaseEnumConverterFactory stringToBaseEnumConverterFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">        registry.addConverterFactory(<span class="built_in">this</span>.stringToBaseEnumConverterFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="HTTPMessageConverteræšä¸¾ç±»å‹è½¬æ¢">HTTPMessageConverteræšä¸¾ç±»å‹è½¬æ¢</h2>
<p><code>HttpMessageConverter</code>ä¾èµ–äºJsonåºåˆ—åŒ–æ¡†æ¶ï¼ˆé»˜è®¤ä½¿ç”¨Jacksonï¼‰ã€‚å…¶å¯¹æšä¸¾ç±»å‹çš„é»˜è®¤å¤„ç†è§„åˆ™ä¹Ÿæ˜¯æšä¸¾å¯¹è±¡å®ä¾‹ï¼ˆItemType.APARTMENTï¼‰å’Œå®ä¾‹åç§°ï¼ˆâ€œAPARTMENTâ€ï¼‰ç›¸äº’æ˜ å°„ã€‚ä¸è¿‡å…¶æä¾›äº†ä¸€ä¸ªæ³¨è§£<code>@JsonValue</code>ï¼ŒåŒæ ·åªéœ€åœ¨<code>ItemType</code>æšä¸¾ç±»çš„<code>code</code>å±æ€§ä¸Šå¢åŠ ä¸€ä¸ªæ³¨è§£<code>@JsonValue</code>ï¼ŒJacksonä¾¿å¯å®Œæˆä»<code>ItemType</code>å¯¹è±¡åˆ°<code>code</code>å±æ€§ä¹‹é—´çš„äº’ç›¸æ˜ å°„ã€‚å…·ä½“é…ç½®å¦‚ä¸‹ï¼Œè¯¦ç»†ä¿¡æ¯å¯å‚è€ƒJackson<a href="https://fasterxml.github.io/jackson-annotations/javadoc/2.8/com/fasterxml/jackson/annotation/JsonValue.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<blockquote>
<p>å½“å°†æšä¸¾ç±»å‘é€ç»™å‰ç«¯æ—¶ï¼Œä½¿ç”¨@Jsonvalueå¯ä»¥ï¼ŒæŒ‡å®šè¿”å›æšä¸¾å¯¹è±¡ä¸­çš„å­—æ®µ</p>
</blockquote>
<h1>TypeHandlerï¼ˆç±»å‹å¤„ç†å™¨ï¼‰</h1>
<blockquote>
<p>ä»æŒä¹…å±‚åˆ°æ•°æ®åº“ï¼Œå½“æ•°æ®åº“å­˜å‚¨çš„æ˜¯ä¸€ä¸ªString æˆ–å…¶ä»– å­—é¢é‡ï¼ŒæŒä¹…å±‚ç©¿å…¥çš„æ˜¯æšä¸¾ç±»ï¼Œæ­¤æ—¶ä¹Ÿéœ€è¦è¿›è¡Œç±»å‹å¤„ç†ï¼Œä½¿ç”¨çš„æ˜¯TypeHandlerï¼ŒMybatisPlusæä¾›çš„</p>
</blockquote>
<p>MybatisPlusæä¾›äº†ä¸€ä¸ª@EnumValueæ³¨è§£ï¼Œå°†æšä¸¾ç±»è½¬æ¢ä¸ºå­—é¢é‡ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>é¢è¯•é—®é¢˜</title>
    <url>/2025/09/15/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="1ã€é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨è¿‡MySQLä¼˜åŒ–">1ã€é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨è¿‡MySQLä¼˜åŒ–</h2>
<p>ä½¿ç”¨è¿‡:</p>
<p><strong>ç¼“å­˜å±‚é¢</strong>:   <code>ä½¿ç”¨ç¼“å­˜</code> \  <code>æé«˜ç¼“å­˜çš„å‘½ä¸­ç‡</code></p>
<ol>
<li>
<p>åœ¨æŸ¥æ‰¾ä¸“è¾‘è¯¦æƒ…é¡µæ—¶, å› ä¸ºä¸“è¾‘è¯¦æƒ…é¡µä¿¡æ¯éå¸¸å¤š, æ˜¯ç”¨æˆ·ç»å¸¸è®¿é—®çš„è¯·æ±‚, æ‰€ä»¥æˆ‘åœ¨å¤„ç†è¿™ç§è¯·æ±‚æ—¶ ,ä½¿ç”¨äº† redisä½œä¸ºç¼“å­˜æ¥é™ä½å¯¹mysql çš„è®¿é—®.</p>
<p>å¹¶ä¸”ä¸ºäº†å¤„ç†æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜, æˆ‘é‡‡ç”¨äº†å»¶è¿ŸåŒåˆ çš„æ–¹å¼æ¥,ç¡®ä¿äº†æ•°æ®åº“å’Œç¼“å­˜çš„æœ€ç»ˆä¸€è‡´æ€§</p>
</li>
</ol>
<p><strong>ä¸šåŠ¡ç»´åº¦å±‚é¢</strong>: <code>å‡å°‘ä¸å¿…è¦çš„sql</code> \  <code>æ‰¹é‡å¤„ç†</code></p>
<ol>
<li>åœ¨è¿›è¡Œå¤šä¸ªå£°éŸ³çš„æŸ¥æ‰¾æ—¶, ä¸ºäº†é¿å…å¤šæ¬¡æŸ¥æ‰¾æ•°æ®åº“, æˆ‘å°†åœ¨æŸ¥æ‰¾å£°éŸ³çš„è¯¦ç»†ä¿¡æ¯æ—¶, ä¸€æ¬¡æ€§å°†æ‰€æœ‰çš„å…¨éƒ¨idè¿›è¡Œè¿œç¨‹è°ƒç”¨, ä¸€æ¬¡æ€§æŸ¥æ‰¾å…¨éƒ¨çš„å£°éŸ³ä¿¡æ¯,é¿å…äº†ä¸€äº›ä¸å¿…è¦çš„æŸ¥æ‰¾</li>
</ol>
<p><strong>ç´¢å¼•ä¼˜åŒ–:</strong></p>
<ul>
<li>
<p><strong>å»ºç«‹ç´¢å¼•</strong> : <code>æ¡ä»¶ \ order \ group ä½¿ç”¨ç´¢å¼•</code>  \ <code>åŒºåˆ†åº¦é«˜çš„ä½¿ç”¨ä½¿ç”¨</code> \ <code>ç»å¸¸æŸ¥è¯¢çš„å­—æ®µ</code> \ <code>ä½¿ç”¨è¿è¡¨æŸ¥è¯¢,é¿å…å­æŸ¥è¯¢</code></p>
<ol>
<li>å› ä¸ºåœ¨é¡¹ç›®ä¸­,åœ¨å¯¹ä¸“è¾‘è¯¦ç»†è¿›è¡ŒæŸ¥æ‰¾æ—¶ ,è¿›è¡Œä½¿ç”¨ ä¸“è¾‘çš„ä»˜è´¹ç±»å‹æ¥æŸ¥æ‰¾ä¸“è¾‘ä¿¡æ¯, æˆ‘å¯¹price_typeè¿™ä¸ªå­—æ®µè®¾ç½®äº†ç´¢å¼•</li>
<li>åœ¨æŸ¥çœ‹ä¸“è¾‘çš„å…¨éƒ¨å£°éŸ³çš„æ¥å£ä¸­, éœ€è¦å¯¹å£°éŸ³ä¿¡æ¯è¿›è¡Œæ’åº, è€Œå£°éŸ³è¡¨ä¸­æœ‰ä¸ªå­—æ®µå°±æ˜¯ç”¨æ¥æ’åºçš„, orderè¿™ä¸ªå­—æ®µ,  æˆ‘å¯¹è¿™ä¸ªå­—æ®µä¹Ÿè®¾ç½®äº†ç´¢å¼•</li>
</ol>
</li>
<li>
<p><strong>é¿å…ç´¢å¼•å¤±æ•ˆ</strong>:<code>  è®¡ç®— + å‡½æ•°</code> \ <code> likeä»¥%å¼€å¤´</code> \ <code>is null \ is not null</code>  \ <code>é¿å…ç´¢å¼•ç±»å‹è½¬æ¢</code> \ <code>!= \ &lt;&gt;</code> \  <code>æ’åº: æ— è¿‡æ»¤</code> \  <code>å»ºç«‹å’Œä½¿ç”¨çš„é¡ºåºä¸ä¸€è‡´</code> \ <code>æ–¹æ³•å ASC \ DESC</code></p>
</li>
<li>
<p><strong>æŸ¥è¯¢ä¼˜åŒ–å™¨</strong>: <code>æ‰‹åŠ¨æŒ‡å®šé©±åŠ¨è¡¨</code> \ <code>é¿å…æ­»é”å’Œè§£å†³æ­»é”</code></p>
<ol>
<li>åœ¨ä¸“è¾‘å’Œå£°éŸ³è¡¨è¿›è¡Œè”æŸ¥æ—¶, ç”±äºå£°éŸ³çš„ä¿¡æ¯æ¯”ä¸“è¾‘è¡¨çš„è¡Œæ•°æ®å¤š, æ‰€ä»¥, æˆ‘åœ¨è¿›è¡Œè¿è¡¨æŸ¥è¯¢æ—¶, ä½¿ç”¨äº†STRAIGHT_JOINå…³é”®å­—, å°†è¿™ä¸¤ä¸ªè¡¨çš„è¿è¡¨æŸ¥è¯¢çš„é©±åŠ¨è¡¨è®¾ç½®ä¸ºä¸“è¾‘è¡¨</li>
</ol>
</li>
<li>
<p>**æ•°æ®å±‚é¢: ** <code>åˆ†åº“åˆ†è¡¨</code> \ <code>å†·çƒ­æ•°æ®åˆ†ç¦»</code> \ <code>å†å²æ•°æ®å½’æ¡£</code></p>
</li>
<li>
<p><strong>æ•°æ®åº“é…ç½®å±‚é¢</strong>:</p>
<ul>
<li>
<p>å®¢æˆ·ç«¯é…ç½®: <code>æœ€å¤§è¿æ¥æ± </code> \  <code>æœ€å°ç©ºé—²è¿æ¥æ•°</code> \ <code>ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´</code> \  <code>è¿æ¥çš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸ</code> \ <code>è·å–è¿æ¥çš„è¶…æ—¶æ—¶é—´</code></p>
</li>
<li>
<p>æœåŠ¡ç«¯å±‚é¢: <code>max_connectionsæœåŠ¡ç«¯çš„æœ€å¤§è¿æ¥æ•°151</code> \ <code>wait_timeoutå®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´</code> \ <code>æŸ¥è¯¢è¿æ¥æ•° show processlist</code> \ <code>ç»ˆæ­¢è¿æ¥kill connection </code></p>
<ol start="5">
<li>
<p>ä¼˜åŒ–I/O, è°ƒæ•´<code>innodb_buffer_pool_size</code>çš„å¤§å° , æ˜¯ç”¨äºç¼“å­˜æ•°æ®å’Œç´¢å¼•çš„åŒºåŸŸ</p>
</li>
<li>
<p>ä¼˜åŒ–JOIN, è°ƒæ•´<code>join_buffer_size</code>çš„å¤§å° , æ‰§è¡Œjoinæ—¶çš„æ•°æ®ç¼“å†²åŒº</p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<ol>
<li>å› ä¸ºåç»­é¡¹ç›®å¯èƒ½ä¼šå¯¹å£°éŸ³å’Œä¸“è¾‘è¿™ä¸¤ä¸ªè¡¨è¿›è¡Œåˆ†åº“åˆ†è¡¨, æ‰€ä»¥, æˆ‘åœ¨å¯¹è¿™ä¸¤ä¸ªè¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ‰¾æ—¶, æ²¡æœ‰ä½¿ç”¨æ•°æ®åº“çš„è‡ªå¢, è€Œæ˜¯ä½¿ç”¨äº†mybatis-plusçš„é›ªèŠ±ç®—æ³•</li>
<li>åœ¨è¿›è¡Œä¸€äº›sqlè¯­å¥ä¸æ¡ä»¶æŸ¥æ‰¾æ—¶ , æˆ‘ä¸€èˆ¬å¯¹ä¸ç¡®å®šä¸ºå­—ç¬¦ä¸²è¿˜æ˜¯intç±»å‹çš„å­—æ®µ, ä½¿ç”¨å­—ç¬¦ä¸²æ¥æŸ¥æ‰¾, å› ä¸º, å¦‚æœåœ¨æ•°æ®åº“ä¸­è¿™ä¸ªå­—æ®µä¸ºå­—ç¬¦ä¸² , é‚£å®ƒä½œä¸ºç´¢å¼•æ—¶, ä¸ä¼šå¤±æ•ˆ, å³ä½¿å®ƒåœ¨æ•°æ®åº“ä¸­ä¸ºintç±»å‹, å‘ç”Ÿäº†ç±»å‹è½¬æ¢,   ä¹Ÿæ˜¯è½¬æ¢sqlè¯­å¥ä¸­çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºintç±»å‹, å¹¶ä¸å½±å“ç´¢å¼•çš„ä½¿ç”¨</li>
<li>å°½é‡ä½¿è¿è¡¨æŸ¥è¯¢, å°‘ä½¿ç”¨å­æŸ¥è¯¢(ç‰¹åˆ—: æ·±åˆ†é¡µ)</li>
</ol>
<h2 id="2ã€é¡¹ç›®ä¸­çš„æ—¥å¿—å¦‚ä½•å¤„ç†">==2ã€é¡¹ç›®ä¸­çš„æ—¥å¿—å¦‚ä½•å¤„ç†==</h2>
<h2 id="3ã€å¦‚ä½•å’Œå‰ç«¯è¿›è¡Œæ•°æ®äº¤äº’">==3ã€å¦‚ä½•å’Œå‰ç«¯è¿›è¡Œæ•°æ®äº¤äº’==</h2>
<h2 id="4ã€é¡¹ç›®ä¸­é‡åˆ°è¿‡å“ªäº›é—®é¢˜">4ã€é¡¹ç›®ä¸­é‡åˆ°è¿‡å“ªäº›é—®é¢˜</h2>
<ol>
<li>
<p>ä½¿ç”¨<code>redis</code>åšç¼“å­˜å’Œåˆ†å¸ƒå¼é”æ—¶</p>
<ul>
<li>æ­»é”</li>
<li>è¯¯åˆ </li>
<li>é”è¿‡æœŸ</li>
<li>æ•°æ®åº“ å’Œ ç¼“å­˜æ•°æ®ä¸ä¸€è‡´</li>
</ul>
</li>
<li>
<p><code>ThreadLoca</code>lå¯¼è‡´å†…å­˜æ³„æ¼</p>
</li>
<li>
<p><code>åˆ†å¸ƒå¼äº‹åŠ¡</code>é—®é¢˜: RabbitMqçš„</p>
</li>
<li>
<p><code>RabbitMq</code>çš„ä¸‰ä¸ªé—®é¢˜</p>
<ul>
<li>æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’</li>
<li>æ¶ˆæ¯çš„å¯é æ€§æ¶ˆè´¹</li>
<li>æ¶ˆæ¯çš„å¹‚ç­‰æ€§å¤„ç†</li>
</ul>
</li>
<li>
<p>@Tranctional æœ¬åœ°<code>äº‹åŠ¡å¤±æ•ˆ</code></p>
<ul>
<li>
<p>å¼‚å¸¸è¢«æ•è·</p>
</li>
<li>
<p>æ–¹æ³•ä¸­è°ƒç”¨</p>
<p>è§£å†³åŠæ³•:</p>
<ol>
<li>
<p>åœ¨ç±»ä¸­å¾ªç¯ä¾èµ–è‡ªå·±, ç„¶åä½¿ç”¨ä¾èµ–å¯¹è±¡è°ƒç”¨, åœ¨SpringBootè¿™æ ·åš,å°±ä¼šæœ‰å¾ªç¯ä¾èµ–çš„é—®é¢˜, è§£å†³åŠæ³•: <code>allow-circular-references: true</code></p>
</li>
<li>
<p>ä½¿ç”¨AopContextå¯¹è±¡è·å–å½“å‰ç±»çš„ä»£ç†å¯¹è±¡, ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨è¯¥æ–¹æ³•</p>
<p>å¼€å¯<code>@EnableAspectJAutoProxy(exposeProxy = true)</code> æš´éœ²ä»£ç†å¯¹è±¡</p>
<p>ä½¿ç”¨<code>AopContext.currentProxy()</code>è·å–å½“å‰ç±»çš„ä»£ç†å¯¹è±¡</p>
</li>
<li>
<p>ä½¿ç”¨Applicationcontextå¯¹è±¡è·å–ä»£ç†å¯¹è±¡</p>
<p>ApplicationContext.getBean(MyClass.class)</p>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p>å¤šç«¯<code>é‡å¤æ¶ˆè´¹</code>é—®é¢˜</p>
<p>è§£å†³: åœ¨åšå¹‚ç­‰æ€§æ—¶, ä¸å†ä½¿ç”¨éšæœºå­—ç¬¦ä¸², è€Œæ˜¯æ ¹æ®ç”¨æˆ·å’Œå•†å“çš„idç”Ÿäº§token</p>
<p>åŸå› : åœ¨å¤šç«¯ä¸‹, ç”±äºæ˜¯éšæœºç”Ÿæˆçš„å¹‚ç­‰æ€§çš„token, ä¸å…·æœ‰ä»£è¡¨æ€§, å½“å¤šç«¯åŒä¸€ä¸ªç”¨æˆ·è´­ä¹°åŒä¸€ä»¶å•†å“æ—¶, å¹¶ä¸èƒ½åŒºåˆ†å‡ºæ¥, æ‰€ä»¥å°±å¯¼è‡´äº†é‡å¤æ¶ˆè´¹çš„é—®é¢˜,</p>
</li>
<li>
<p>ç›¸åŒæ–‡ä»¶ä¸åŒåå­—æ–‡ä»¶çš„<code>é‡å¤ä¸Šä¼ </code>é—®é¢˜</p>
<p>è§£å†³: åœ¨ä¸Šä¼ å‰é€šè¿‡MD5åŠ å¯†. ç„¶åä¸Šä¼ æ—¶, ä½¿ç”¨MDä½œä¸ºminioå¯¹è±¡çš„Objectå€¼, æ¯æ¬¡ä¸Šä¼ ä¹‹å‰,åªæœ‰minioçš„<code>statObject</code>  APIåˆ¤æ–­æ¡¶ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒçš„å¯¹è±¡.</p>
<p>å¦‚æœå­˜åœ¨, è·å–è¯¥å¯¹è±¡è¿”å›, å¦‚æœä¸å­˜åœ¨,ç›´æ¥ä¸Šä¼ </p>
</li>
<li>
<p><code>å¼‚æ­¥</code>æ—¶,æ•°æ®ä¸å®Œæ•´</p>
<p>è§£å†³: ä½¿ç”¨join  , Futruetaskçš„get(); \ countdownLatch</p>
</li>
<li>
<p><code>å¼‚æ­¥</code>æ—¶, ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± æ—¶, ä½¿ç”¨äº†LinkedBlocingQueue,æœªè®¾ç½®å¤§å°,å¯¼è‡´OOMå¼‚å¸¸</p>
</li>
<li>
<p><code>å¼‚æ­¥</code>æ—¶,ThreadLocalä¸­çš„æ•°æ®è·å–ä¸åˆ°</p>
</li>
<li>
<p><code>ç›‘å¬å™¨</code>SpringApplicationRunListener æ—¶, ç¬¬ä¸€æ¬¡è·å–ä¸åˆ°Beanå¯¹è±¡</p>
<p>åŸå› : åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶, æ˜¯springcloudçš„nacosç»„ä»¶è°ƒç”¨å¾—åˆ°, éœ€è¦å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨</p>
</li>
<li>
<p>ç›‘å¬å™¨SpringApplicationRunListenreæœªç”Ÿæ•ˆ,</p>
<p>ä½¿ç”¨SPIæœºåˆ¶æ³¨å…¥</p>
</li>
<li>
<p>OpenFeignçš„è¯·æ±‚å¤´ä¸­æ•°æ®ä¸¢å¤±</p>
<p>åŸå› : Openfeig åœ¨ç”Ÿæˆæ–°è¯·æ±‚æ¨¡æ¿æ—¶, æ²¡æœ‰è´Ÿè´£åŸè¯·æ±‚çš„è¯·æ±‚å¤´ä¸­çš„æ•°æ®, åªå¯¹@RequestParam å’Œ@RequestHeader åšäº†å¤„ç† ,</p>
<p>è§£å†³åŠæ³•:</p>
<ol>
<li>ä½œä¸ºå‚æ•°ä¼ é€’</li>
<li>ä½¿ç”¨@RequestHeader</li>
<li>ä½¿ç”¨RequestInterceptor: åœ¨Openç”Ÿæˆè¯·æ±‚å¯¹è±¡ä¹‹å‰, ä¼šè°ƒç”¨RequestInterceptorçš„applyæ–¹æ³•å¹¶ä¼ å…¥æ–°çš„è¯·æ±‚æ¨¡æ¿, æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°è¯¥æ¥å£, åœ¨é‡å†™çš„æ–¹æ³•ä¸­,ç»Ÿä¸€å¯¹è¿œç¨‹è°ƒç”¨çš„è¯·æ±‚æ¨¡æ¿åšå¤„ç†, æ­¤æ—¶, å°±å¯ä»¥æ ¹æ®SpringMVCçš„RequestContextHolderå¯¹è±¡è·å–åˆ°å‰ç«¯è¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯, ç„¶åå†å°†è¯·æ±‚å¤´è®¾ç½®è¿›Openfeinçš„è¯·æ±‚æ¨¡æ¿ä¸­, è¿™æ ·, OpenFeignåœ¨åˆ›å»ºè¯·æ±‚å¯¹è±¡æ—¶, è¯·æ±‚å¤´ä¸­å°±ä¼šæœ‰æˆ‘ä»¬è®¾ç½®è¿›å»çš„æ•°æ®äº†</li>
</ol>
</li>
<li>
<p>Redissonå¯¼è‡´å¤§é‡çº¿ç¨‹è¢«é˜»å¡  \  å¤§é‡çº¿ç¨‹è¢«æ­»é”</p>
<ol>
<li>åœ¨ä¸Šé”æ—¶,ä¸ä½¿ç”¨lock, ä½¿ç”¨tryLock,</li>
<li>æœªæ­£ç¡®ä½¿ç”¨Readissoné€ æˆ , ä½¿ç”¨try-finally, åœ¨finallyå—ä¸­é‡Šæ”¾é”, ç¡®ä¿é”èƒ½è¢«æ­£å¸¸æ˜¯å¦å’Œåœæ­¢é”ç»­æœŸ</li>
</ol>
</li>
<li>
<p>Long, BigDecimalè¿”å›ç»™å‰ç«¯æ—¶,ç²¾åº¦ä¸¢å¤±é—®é¢˜</p>
<p>è§£å†³æµç¨‹: åœ¨SpingMVCçš„é…ç½®æ–‡ä»¶ä¸­, å°†ä»–ä»¬çš„åºåˆ—åŒ–å™¨æ¢ä¸ºè‡ªå®šä¹‰çš„</p>
</li>
</ol>
<h2 id="5ã€é¡¹ç›®ä¸­æœ‰æ²¡æœ‰é‡åˆ°è¿‡å†…å­˜æ³„æ¼å’Œcpuè¢«æ‰“æ»¡ã€‚">5ã€é¡¹ç›®ä¸­æœ‰æ²¡æœ‰é‡åˆ°è¿‡å†…å­˜æ³„æ¼å’Œcpuè¢«æ‰“æ»¡ã€‚</h2>
<p>æœ‰:</p>
<ol>
<li>å†…å­˜æ³„æ¼: ä½¿ç”¨ThreadLocalä¼ é€’å‚æ•°æœªç§»é™¤</li>
<li>CPUå¤§æ»¡: ä½¿ç”¨redisåšç¼“å­˜å’Œåˆ†å¸ƒå¼é”æ—¶, åœ¨é«˜å¹¶å‘ä¸‹è‡ªæ—‹é€ æˆçš„  \  é«˜å¹¶å‘ä¸‹ å¤§é‡æ¶ˆæ¯å¤šæ¬¡é‡è¯• \</li>
</ol>
<h2 id="6ã€é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ç”¨åˆ°å¼‚æ­¥å¤šçº¿ç¨‹ä»¥åŠé‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ã€‚">6ã€é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ç”¨åˆ°å¼‚æ­¥å¤šçº¿ç¨‹ä»¥åŠé‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ã€‚</h2>
<ol>
<li>
<p><code>å¼‚æ­¥</code>æ—¶,æ•°æ®ä¸å®Œæ•´</p>
<p>è§£å†³: ä½¿ç”¨join  , Futruetaskçš„get(); \ countdownLatch</p>
</li>
<li>
<p><code>å¼‚æ­¥</code>æ—¶, ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± æ—¶, ä½¿ç”¨äº†LinkedBlocingQueue,æœªè®¾ç½®å¤§å°,å¯¼è‡´OOMå¼‚å¸¸</p>
</li>
<li>
<p><code>å¼‚æ­¥</code>æ—¶,ThreadLocalä¸­çš„æ•°æ®è·å–ä¸åˆ°</p>
</li>
</ol>
<h2 id="7ã€é¡¹ç›®ä¸­è®¾è®¡è¿‡å“ªäº›è¡¨ï¼Œå¯¹è¡¨çš„è®¾è®¡å¦‚ä½•è€ƒè™‘">7ã€é¡¹ç›®ä¸­è®¾è®¡è¿‡å“ªäº›è¡¨ï¼Œå¯¹è¡¨çš„è®¾è®¡å¦‚ä½•è€ƒè™‘</h2>
<p>åœ¨ä¸“è¾‘è¯¦æƒ…æ¨¡å—ä¸­, æˆ‘ä¸»è¦è®¾è®¡äº† album_info  \  track_info  \ å®ƒä»¬å„è‡ªçš„ç»Ÿè®¡è¡¨</p>
<ol>
<li>å¯¹äºalbum_info å’Œ track_infoè¡¨è®¾è®¡çš„è€ƒè™‘,</li>
<li>åå­—, é‡‡ç”¨å°å†™ + ä¸‹åˆ’çº¿</li>
<li>ä¸ä½¿ç”¨å¤–é”®, ä¿è¯è¡¨çš„ç‹¬ç«‹æ€§</li>
<li>è€ƒè™‘åˆ°æœªæ¥å¯èƒ½ä¼šå¯¹è¿™ä¸¤ä¸ªè¡¨è¿›è¡Œåˆ†è¡¨æ“ä½œ,æ‰€ä»¥åœ¨å¯¹è¿™ä¸¤ä¸ªè¡¨è®¾è®¡idæ—¶,å¹¶æ²¡æœ‰é‡‡ç”¨æ•°æ®çš„è‡ªå¢, è€Œæ˜¯ä½¿ç”¨äº†Mybatisçš„é›ªèŠ±ç®—æ³•.</li>
<li>å¯¹äºè¿™ä¸¤ä¸ªè¡¨çš„æ“ä½œä¼šç»å¸¸è¿›è¡Œè¿è¡¨æŸ¥è¯¢,æ ¹æ®ä¸“è¾‘çš„ä»˜è´¹ç±»å‹ è¿›è¡ŒæŸ¥è¯¢, å¯¹album_infoçš„price_typeå»ºç«‹ç´¢å¼•</li>
<li>åœ¨ä¸“è¾‘è¯¦æƒ…ä¸­, å±•ç¤ºå£°éŸ³åˆ—è¡¨æ—¶, éœ€è¦æ’åº, æˆ‘å•ç‹¬è®¾è®¡äº†ä¸€ä¸ªorderå­—æ®µ, å¹¶å¯¹è¿™ä¸ªå­—æ®µå»ºç«‹äº†ç´¢å¼•</li>
<li>å¯¹äºæ—¢å¯ä»¥ä½¿ç”¨intå‹å’Œstringå‹çš„å­—æ®µ, æˆ‘ä¸€èˆ¬è®¾ç½®ä¸ºintå‹, é¿å…å› ä¸ºç±»å‹è½¬æ¢å¯¼è‡´çš„ç´¢å¼•å¤±æ•ˆé—®é¢˜</li>
</ol>
<h2 id="8ã€é¡¹ç›®ä¸­ç”¨åˆ°è¿‡SpringCloudçš„å“ªäº›ç»„ä»¶">8ã€é¡¹ç›®ä¸­ç”¨åˆ°è¿‡SpringCloudçš„å“ªäº›ç»„ä»¶</h2>
<p>nacos \ openfeign \ gateway \ Sentinel</p>
<h2 id="9ã€è°ˆè°ˆä½ å¯¹SpringBootçš„è‡ªåŠ¨é…ç½®åŸç†">9ã€è°ˆè°ˆä½ å¯¹SpringBootçš„è‡ªåŠ¨é…ç½®åŸç†</h2>
<ol>
<li>
<p>æ ¸å¿ƒæ³¨è§£SpringBootApplication</p>
<p>åœ¨è¿™ä¸ªæ ¸å¿ƒæ³¨è§£ä¸‹æœ‰ä¸‰ä¸ªæ³¨è§£</p>
<ul>
<li>SpringBootConfiguaration  : è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªSpringBootçš„é…ç½®ç±»</li>
<li>EnableAutoConfiguaration : è¿™æ˜¯SpringBootçš„è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒæ³¨è§£</li>
<li>ComponentScanæ³¨è§£: ç”¨äºæ’é™¤ä¸€äº›ä¸éœ€è¦çš„ç»„ä»¶</li>
</ul>
</li>
<li>
<p>SpringBootConfiguarationæ³¨è§£çš„åŸç†</p>
<p>åœ¨SpringBooté¡¹ç›®ä¸­, æ¯ä¸ªé¡¹ç›®éƒ½ä¼šæœ‰ç›´æ¥æˆ–é—´æ¥ä¾èµ–äºspring -boot-starter åŒ… ,åœ¨è¿™ä¸ªåŒ…ä¸­åˆä¾èµ–äº†spring -boot- autoconfiguarationè¿™ä¸ªåŒ…, åœ¨è¿™ä¸ªåŒ…ä¸‹</p>
<p>springbootå·²ç»ç¼–å†™å¥½äº†142é…ç½®ç±», å®ƒä»¬å…¨ç±»åéƒ½å­˜å‚¨åœ¨resources/META-INF/spring/org.springframeword.boot.autoconfig.AutoConfiguration.importsæ–‡ä»¶ä¸­,</p>
<p>ä½†æ˜¯è¿™ä¸ä»£è¡¨è¿™142ä¸ªé…ç½®ç±»éƒ½ä¼šè¢«åŠ è½½.</p>
</li>
<li>
<p>ConditionXXX,SpringBootä¼šæ ¹æ®é…ç½®ç±»ä¸Šçš„Conditionæ³¨è§£,é€‰æ‹©æ€§çš„åŠ è½½é…ç½®ç±», ä¾‹å¦‚ConditionOnClass, åªæœ‰åœ¨å¼•å…¥å¯¹åº”é…ç½®ç±»æ‰€ä¾èµ–çš„åŒ…æ—¶, æ‰ä¼šåŠ è½½è¯¥é…ç½®ç±»</p>
<p>ConditionOnProperties, ä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„é…ç½®ä¿¡æ¯,æ¥é€‰æ‹©æ€§çš„åŠ è½½é…ç½®ç±»</p>
</li>
<li>
<p>SpringBootè¿˜ä¼šæ ¹æ®AutoConfigurationImportSelectoræ¥é¡ºåºæ€§çš„åŠ è½½é…ç½®æ–‡ä»¶</p>
</li>
</ol>
<h2 id="10ã€SpringBootå’ŒSpringCloudçš„é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºä»¥åŠä¼˜å…ˆçº§">==10ã€SpringBootå’ŒSpringCloudçš„é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºä»¥åŠä¼˜å…ˆçº§==</h2>
<p><strong>ä¼˜å…ˆçº§:</strong></p>
<p>é…ç½®ä¸­å¿ƒ &gt;  ç¯å¢ƒå˜é‡&gt; JVMç³»ç»Ÿå±æ€§ &gt; å‘½ä»¤è¡Œ &gt; bootstrap.properties &gt; bootstrap.yml &gt; applicatio.properties &gt; application.yml &gt; application-{profile}.properties &gt;</p>
<p>applicatoin-{profile}.yml</p>
<p><strong>åŠ è½½é¡ºåº</strong></p>
<p>bootstrap.properties &gt; bootstarp.yml &gt; é…ç½®ä¸­å¿ƒ &gt; application.properties &gt; application.yml &gt; application-{profile}.properties &gt; application-{profiles}.yml &gt;</p>
<p>å‘½ä»¤è¡Œ&gt; JVMé…ç½® &gt; ç¯å¢ƒå˜é‡</p>
<p>ç®€åŒ–:</p>
<p>åŠ è½½é¡ºåº: bootstrap.properties &gt; bootstrap.yml &gt; é…ç½®ä¸­å¿ƒ &gt; application.peoperties&gt; application.yml &gt; application-{profile}.bootstrap/yml</p>
<p>ä¼˜å…ˆçº§: é…ç½®ä¸­å¿ƒ &gt; bootstrap.properties &gt; bootstrap.yml &gt; application.properties &gt; application.yml  &gt; application-{profiles}.bootstrap/yml</p>
<h2 id="11ã€jvmè°ƒä¼˜äº†è§£è¿‡å“ªäº›">==11ã€jvmè°ƒä¼˜äº†è§£è¿‡å“ªäº›==</h2>
<ol>
<li>è‡ªå®šä¹‰å †å¤§å°
<ul>
<li>-Xmx100m : è®¾ç½®æœ€å¤§å †å¤§å°</li>
<li>-Xms100m :è®¾ç½®åˆå§‹å †å¤§å°</li>
<li>è°ƒæ•´å¹´è½»ä»£å’Œè€å¹´ä»£çš„å¤§å°<code>-XX:NewSize=1m</code>å’Œ<code> -XX:MaxNewSize=2m</code></li>
</ul>
</li>
<li>è®¾ç½®è™šæ‹Ÿæœºæ ˆçš„å¤§å°
<ul>
<li>-Xss256k</li>
</ul>
</li>
<li>æŒ‡å®šG1åƒåœ¾å›æ”¶å™¨
<ul>
<li>-XX:+UseG1GC</li>
</ul>
</li>
</ol>
<h2 id="12ã€è¿è¡Œæ—¶æ•°æ®åŒºçš„ç»„æˆä»¥åŠå„è‡ªç©ºé—´ä½œç”¨">12ã€è¿è¡Œæ—¶æ•°æ®åŒºçš„ç»„æˆä»¥åŠå„è‡ªç©ºé—´ä½œç”¨</h2>
<ul>
<li>
<ol>
<li>éå…±äº«åŒºåŸŸ</li>
</ol>
<p>è¿™äº›åŒºåŸŸæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹å‰¯æœ¬ã€‚</p>
<p>1.1 <strong>è™šæ‹Ÿæœºæ ˆï¼ˆJVM Stackï¼‰</strong></p>
<p>æ¯ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œæ ˆä¸­åŒ…å«äº†æ¯ä¸ªæ–¹æ³•è°ƒç”¨çš„çŠ¶æ€ä¿¡æ¯ã€‚æ¯å½“ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒJVM ä¼šä¸ºè¯¥æ–¹æ³•åˆ†é…ä¸€ä¸ªæ ˆå¸§ï¼ˆstack frameï¼‰ã€‚æ ˆå¸§ç”¨äºå­˜å‚¨ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼šæ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ï¼ŒåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ <code>int</code>ã€<code>float</code> ç­‰ï¼‰å’Œå¯¹è±¡å¼•ç”¨ï¼ˆä¾‹å¦‚å¯¹è±¡çš„å†…å­˜åœ°å€ï¼‰ã€‚å±€éƒ¨å˜é‡è¡¨çš„å¤§å°åœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œå› æ­¤éå¸¸é«˜æ•ˆã€‚</li>
<li><strong>åŠ¨æ€é“¾æ¥</strong>ï¼šä¸æ–¹æ³•ç›¸å…³çš„ç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå…è®¸åœ¨è¿è¡Œæ—¶è¿›è¡Œæ–¹æ³•è°ƒç”¨çš„è§£æã€‚</li>
<li><strong>æ–¹æ³•å‡ºå£</strong>ï¼šè®°å½•æ–¹æ³•æ‰§è¡Œå®Œæ¯•åè¿”å›çš„åœ°å€ï¼Œç”¨äºæ–¹æ³•æ‰§è¡Œå®Œæ¯•åè·³è½¬åˆ°æ­£ç¡®çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚</li>
<li><strong>æ“ä½œæ•°æ ˆ</strong>ï¼šå­˜å‚¨æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®ï¼Œæ¯”å¦‚è®¡ç®—ç»“æœï¼Œæˆ–è€…å­˜å‚¨æ“ä½œæ•°ã€‚æ“ä½œæ•°æ ˆçš„å¤§å°åœ¨ç¼–è¯‘æ—¶è®¾å®šï¼Œåœ¨æ‰§è¡Œæ—¶åŠ¨æ€å˜åŒ–ã€‚</li>
</ul>
<p>æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿæœºæ ˆï¼Œä¸”æ ˆçš„æ·±åº¦ç”±æ–¹æ³•çš„è°ƒç”¨æ·±åº¦å†³å®šã€‚å¦‚æœæ ˆæ·±åº¦è¶…è¿‡äº† JVM çš„æ ˆå¤§å°é™åˆ¶ï¼Œå°±ä¼šæŠ›å‡º <code>StackOverflowError</code>ã€‚</p>
<p>1.2 <strong>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</strong></p>
<p>æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸“é—¨ä¸ºæœ¬åœ°æ–¹æ³•ï¼ˆNative Methodï¼‰æœåŠ¡çš„åŒºåŸŸã€‚å®ƒä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ç”¨æ¥å¤„ç† Java ä»£ç ä¹‹å¤–ï¼ˆé€šå¸¸æ˜¯ä½¿ç”¨ Cã€C++ ç­‰è¯­è¨€ç¼–å†™ï¼‰çš„æœ¬åœ°æ–¹æ³•è°ƒç”¨çš„ã€‚</p>
<p>æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ ˆã€‚å®ƒä¿å­˜äº† JNIï¼ˆJava Native Interfaceï¼‰è°ƒç”¨æ‰€éœ€çš„æœ¬åœ°æ–¹æ³•ä¿¡æ¯ã€‚</p>
<p>1.3 <strong>PC ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</strong></p>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ PC å¯„å­˜å™¨ã€‚ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚å› ä¸º JVM æ˜¯åŸºäºæ ˆçš„æ‰§è¡Œæ¨¡å‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºæŒ‡ç¤ºå½“å‰çº¿ç¨‹æ‰§è¡Œåˆ°å“ªæ¡æŒ‡ä»¤ã€‚</p>
<ul>
<li><strong>å­—èŠ‚ç æŒ‡ä»¤</strong>ï¼šå½“çº¿ç¨‹æ‰§è¡Œçš„æ˜¯ Java æ–¹æ³•æ—¶ï¼ŒPC ä¼šæŒ‡å‘å½“å‰æ–¹æ³•çš„å­—èŠ‚ç åœ°å€ã€‚</li>
<li><strong>æœ¬åœ°æ–¹æ³•</strong>ï¼šå¦‚æœå½“å‰æ‰§è¡Œçš„æ˜¯æœ¬åœ°æ–¹æ³•ï¼ŒPC ç¨‹åºè®¡æ•°å™¨å€¼åˆ™ä¸º <code>0</code>ï¼Œè¡¨ç¤ºæœ¬åœ°æ–¹æ³•çš„æ‰§è¡Œä¸ Java ä»£ç æ— å…³ã€‚</li>
</ul>
<p>PC å¯„å­˜å™¨å¹¶ä¸ä¼šå½±å“æ–¹æ³•æ ˆçš„å†…å®¹ï¼Œä½†å®ƒå¸®åŠ© JVM å®šä½å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</p>
<ol start="2">
<li>å…±äº«åŒºåŸŸ</li>
</ol>
<p>è¿™äº›åŒºåŸŸæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ï¼Œå³æ‰€æœ‰çº¿ç¨‹è®¿é—®ç›¸åŒçš„å†…å­˜åŒºåŸŸã€‚</p>
<p>2.1 <strong>å †ï¼ˆHeapï¼‰</strong></p>
<p>å †æ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨å †ä¸­åˆ†é…å†…å­˜ã€‚å †çš„ä½œç”¨æ˜¯å­˜å‚¨å¯¹è±¡çš„å®ä¾‹æ•°æ®ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å…³æ³¨çš„é‡ç‚¹åŒºåŸŸã€‚</p>
<ul>
<li><strong>å¯¹è±¡åˆ†é…</strong>ï¼šå½“æˆ‘ä»¬é€šè¿‡ <code>new</code> å…³é”®å­—åˆ›å»ºå¯¹è±¡æ—¶ï¼ŒJVM ä¼šåœ¨å †ä¸­ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚å †ä¸­çš„å†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®ã€‚</li>
<li><strong>åƒåœ¾å›æ”¶</strong>ï¼šåƒåœ¾å›æ”¶ä¸»è¦å‘ç”Ÿåœ¨å †ä¸­ï¼Œé€šè¿‡æ ‡è®°æ¸…é™¤ã€å¤åˆ¶å›æ”¶æˆ– G1 GC ç­‰æ–¹å¼å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡å†…å­˜ã€‚</li>
</ul>
<p>å †ç©ºé—´çš„å¤§å°å¯ä»¥é€šè¿‡ JVM å‚æ•°æ¥æ§åˆ¶ï¼Œä¾‹å¦‚ <code>-Xms</code> è®¾ç½®åˆå§‹å †å¤§å°ï¼Œ<code>-Xmx</code> è®¾ç½®æœ€å¤§å †å¤§å°ã€‚å †çš„å¤§å°å½±å“åƒåœ¾å›æ”¶çš„é¢‘ç‡å’Œæ€§èƒ½ã€‚</p>
<p>2.2 <strong>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</strong>(JDK8ä»¥å‰å«æ°¸ä¹…ä»£) éƒ½æ˜¯å…ƒç©ºé—´å®ç°çš„ä¸€å¼ æ–¹å¼</p>
<p>æ–¹æ³•åŒºå­˜å‚¨çš„æ˜¯ç±»çš„ç›¸å…³ä¿¡æ¯ã€å¸¸é‡æ± ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘ï¼ˆJITï¼‰ç¼–è¯‘å™¨çš„ä»£ç ç­‰ã€‚æ–¹æ³•åŒºæ˜¯å…±äº«çš„ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®ã€‚æ–¹æ³•åŒºæ˜¯ JVM å†…å­˜çš„ä¸€ä¸ªéå¸¸é‡è¦çš„åŒºåŸŸï¼Œå®ƒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><strong>ç±»çš„å­—èŠ‚ç </strong>ï¼šæ–¹æ³•åŒºå­˜å‚¨æ¯ä¸ªç±»çš„ç»“æ„ä¿¡æ¯ï¼ˆå¦‚ç±»çš„å…ƒæ•°æ®ï¼‰ï¼ŒåŒ…æ‹¬ç±»çš„å­—æ®µã€æ–¹æ³•ã€çˆ¶ç±»ç­‰ã€‚</li>
<li><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼šè¿è¡Œæ—¶å¸¸é‡æ± å­˜å‚¨ç±»åŠ è½½è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å¸¸é‡ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²å­—é¢é‡ã€æ•°å­—å¸¸é‡ç­‰ã€‚å¸¸é‡æ± å­˜å‚¨çš„æ˜¯ä»ç±»å­—èŠ‚ç æ–‡ä»¶ä¸­æå–å‡ºæ¥çš„å¸¸é‡ä¿¡æ¯ã€‚</li>
<li><strong>é™æ€å˜é‡å’Œæ–¹æ³•</strong>ï¼šé™æ€å˜é‡å±äºç±»è€Œä¸å±äºå®ä¾‹ï¼Œä¿å­˜åœ¨æ–¹æ³•åŒºä¸­ã€‚</li>
<li><strong>JIT ç¼–è¯‘åçš„ä»£ç </strong>ï¼šå½“ JVM æ‰§è¡Œ <code>java</code> ç¨‹åºæ—¶ï¼Œä¸€äº›çƒ­ç‚¹ä»£ç ä¼šè¢«å³æ—¶ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œè¿™äº›ç¼–è¯‘åçš„æœºå™¨ç ä¹Ÿå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ã€‚</li>
</ul>
</li>
</ul>
<h2 id="13ã€åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ä»¥åŠè°ˆè°ˆCMSåƒåœ¾å›æ”¶å™¨çš„äº†è§£">13ã€åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ä»¥åŠè°ˆè°ˆCMSåƒåœ¾å›æ”¶å™¨çš„äº†è§£</h2>
<ul>
<li>
<p>åƒåœ¾çš„æ ‡è®°ç®—æ³•:</p>
<p>å¼•ç”¨è®¡æ•°æ³•  \ æ ¹å¯è¾¾æ€§ç®—æ³•</p>
</li>
<li>
<p>åƒåœ¾å›æ”¶ç®—æ³•:</p>
<ol>
<li>æ ‡è®°æ¸…é™¤æ³•</li>
<li>å¤åˆ¶ç®—æ³•</li>
<li>æ ‡è®°æ•´ç†æ¸…é™¤</li>
<li>åˆ†ä»£æ•´ç†: å°±æ˜¯å‰é¢ä¸¤ç§ç®—æ³•çš„æ··åˆä½¿ç”¨, å¹´è½»ä»£ä½¿ç”¨:å¤åˆ¶ç®—æ³• . è€å¹´ä»£ä½¿ç”¨æ ‡è¯†æ•´ç†æ¸…é™¤ç®—æ³•</li>
</ol>
</li>
<li>
<p>==CMSåƒåœ¾å›æ”¶å™¨ (å¹¶è¡Œ)==</p>
<p>CMS åƒåœ¾å›æ”¶å™¨ä¸»è¦ç”±ä¸¤ä¸ªé˜¶æ®µç»„æˆï¼šæ ‡è®°ï¼ˆMarkï¼‰é˜¶æ®µå’Œæ¸…ç†ï¼ˆSweepï¼‰é˜¶æ®µã€‚ä¸ä¼ ç»Ÿçš„ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ä¸åŒï¼ŒCMS æ—¨åœ¨é€šè¿‡å¹¶å‘å·¥ä½œæ¥ç¼©çŸ­åœé¡¿æ—¶é—´ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>åˆå§‹æ ‡è®°ï¼ˆInitial Markï¼‰</strong>ï¼š</p>
<ul>
<li>è¿™ä¸ªé˜¶æ®µä¼šæ ‡è®°æ‰€æœ‰çš„ â€œGC Rootâ€ï¼ˆå³æ´»åŠ¨å¯¹è±¡ï¼‰ã€‚å®ƒéœ€è¦åœæ­¢æ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼Œå› æ­¤ä¼šæœ‰è¾ƒçŸ­çš„åœé¡¿ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰</strong>ï¼š</p>
<ul>
<li>åœ¨æ­¤é˜¶æ®µï¼ŒCMS åƒåœ¾å›æ”¶å™¨ä¼šå¹¶å‘åœ°æ‰«ææ•´ä¸ªå †ä¸­çš„å¯¹è±¡ï¼Œæ ‡è®°å‡ºå“ªäº›å¯¹è±¡æ˜¯å¯è¾¾çš„ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¹¶è¡Œçš„ï¼Œä¸éœ€è¦æš‚åœåº”ç”¨çº¿ç¨‹ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘é¢„æ¸…ç†ï¼ˆConcurrent Precleanï¼‰</strong>ï¼š</p>
<ul>
<li>åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µåï¼ŒCMS ä¼šè¿›è¡Œä¸€ä¸ªé¢„æ¸…ç†è¿‡ç¨‹ï¼Œæ¸…ç†ä¸€äº›ç”±äºå¹¶å‘æ ‡è®°äº§ç”Ÿçš„åƒåœ¾å¯¹è±¡ã€‚</li>
</ul>
</li>
<li>
<p><strong>é‡æ–°æ ‡è®°ï¼ˆRemarkï¼‰</strong>ï¼š</p>
<ul>
<li>è¿™ä¸ªé˜¶æ®µéœ€è¦æš‚åœåº”ç”¨çº¿ç¨‹ï¼Œæ ‡è®°åœ¨å¹¶å‘æ ‡è®°æœŸé—´å‘ç”Ÿäº†å˜åŒ–çš„å¯¹è±¡ã€‚ç”±äºè¿™æ˜¯çŸ­æš‚çš„ï¼Œåœé¡¿æ—¶é—´ä¼šè¾ƒçŸ­ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘æ¸…ç†ï¼ˆConcurrent Sweepï¼‰</strong>ï¼š</p>
<ul>
<li>è¿™æ˜¯å¹¶å‘æ¸…ç†é˜¶æ®µï¼Œä¼šæ¸…é™¤é‚£äº›æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚ä¸ä¼ ç»Ÿçš„åƒåœ¾å›æ”¶å™¨ä¸åŒï¼ŒCMS åœ¨è¿™ä¸ªé˜¶æ®µä»ç„¶ä¸éœ€è¦æš‚åœåº”ç”¨çº¿ç¨‹ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘æ•´ç†ï¼ˆConcurrent Compactï¼‰</strong>ï¼ˆå¯é€‰ï¼‰ï¼š</p>
<ul>
<li>å¯¹äºä¸€äº›è¾ƒå¤§çš„å¯¹è±¡å’Œç¢ç‰‡ï¼ŒCMS è¿˜ä¼šè¿›è¡Œæ•´ç†é˜¶æ®µï¼Œé¿å…å†…å­˜ç¢ç‰‡åŒ–ã€‚è¿™ä¸ªé˜¶æ®µæœ‰æ—¶ä¼šè¢«ç¦ç”¨ï¼Œä»¥å‡å°‘åœé¡¿æ—¶é—´ã€‚</li>
</ul>
</li>
</ol>
<p>ä¼˜ç‚¹</p>
<ul>
<li><strong>å‡å°‘åœé¡¿æ—¶é—´</strong>ï¼šä¸å…¶ä»–åƒåœ¾å›æ”¶å™¨ç›¸æ¯”ï¼ŒCMS çš„æœ€å¤§ä¼˜åŠ¿æ˜¯å¯ä»¥å‡å°‘åœé¡¿æ—¶é—´ï¼Œå°¤å…¶åœ¨åº”ç”¨éœ€è¦é«˜å“åº”æ—¶ã€‚</li>
<li><strong>å¹¶å‘æ ‡è®°å’Œæ¸…ç†</strong>ï¼šé€šè¿‡å¹¶å‘çš„æ ‡è®°å’Œæ¸…ç†å·¥ä½œï¼ŒCMS å¯ä»¥åœ¨å¤§éƒ¨åˆ†æ—¶é—´é‡Œç»§ç»­åº”ç”¨çº¿ç¨‹çš„æ‰§è¡Œï¼Œé¿å…é•¿æ—¶é—´çš„åœé¡¿ã€‚</li>
</ul>
<p>ç¼ºç‚¹</p>
<ul>
<li><strong>å†…å­˜ç¢ç‰‡</strong>ï¼šç”±äº CMS ä¸ä¼šè¿›è¡Œå‹ç¼©ï¼Œå¯èƒ½å¯¼è‡´å †å†…å­˜ä¸­çš„ç¢ç‰‡åŒ–é—®é¢˜ã€‚å°¤å…¶åœ¨é•¿æ—¶é—´è¿è¡Œåï¼Œè¿™å¯èƒ½å¯¼è‡´ Full GC è¢«è§¦å‘ã€‚</li>
<li><strong>è¾ƒé«˜çš„ CPU å ç”¨</strong>ï¼šCMS åœ¨æ‰§è¡Œå¹¶å‘æ ‡è®°æ—¶ä¼šæ¶ˆè€—è¾ƒå¤šçš„ CPU èµ„æºã€‚</li>
<li><strong>åœé¡¿æ—¶é—´ä¸å¯é¢„æµ‹</strong>ï¼šè™½ç„¶ CMS å¯ä»¥å‡å°‘åœé¡¿æ—¶é—´ï¼Œä½†æŸäº›æƒ…å†µä¸‹ä»ç„¶ä¼šå‡ºç°è¾ƒé•¿çš„åœé¡¿ï¼Œå°¤å…¶æ˜¯åœ¨ Full GC æ—¶ã€‚</li>
</ul>
<p><strong>é…ç½®</strong></p>
<p>åœ¨å¯åŠ¨ Java ç¨‹åºæ—¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‚æ•°æ¥å¯ç”¨ CMS åƒåœ¾å›æ”¶å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-XX:+UseConcMarkSweepGC</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›é€‰é¡¹æ¥è°ƒæ•´åƒåœ¾å›æ”¶è¡Œä¸ºï¼Œå¦‚ï¼š</p>
<ul>
<li><code>-XX:CMSInitiatingOccupancyFraction=&lt;percentage&gt;</code>ï¼šè®¾ç½®è§¦å‘ CMS åƒåœ¾å›æ”¶çš„å †å†…å­˜å ç”¨é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 68%ã€‚</li>
<li><code>-XX:+UseCMSInitiatingOccupancyOnly</code>ï¼šåªä½¿ç”¨ä¸Šè¿°é˜ˆå€¼è§¦å‘åƒåœ¾å›æ”¶ã€‚</li>
<li><code>-XX:+DisableExplicitGC</code>ï¼šç¦ç”¨æ˜¾å¼çš„åƒåœ¾å›æ”¶è°ƒç”¨ï¼Œä»¥é¿å…å¯¹ CMS åƒåœ¾å›æ”¶äº§ç”Ÿå¹²æ‰°ã€‚</li>
</ul>
<p><strong>æ€»ç»“</strong></p>
<p>CMS åƒåœ¾å›æ”¶å™¨æ˜¯ä¸“ä¸ºé™ä½åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´è®¾è®¡çš„ã€‚å®ƒé€šè¿‡å¹¶å‘æ ‡è®°å’Œæ¸…ç†æ¥å‡å°‘åœé¡¿ï¼Œé€‚ç”¨äºå¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼ŒCMS åœ¨å†…å­˜ç¢ç‰‡æ–¹é¢çš„ç¼ºç‚¹å’Œé«˜ CPU å ç”¨ä½¿å¾—å®ƒå¹¶ä¸é€‚ç”¨äºæ‰€æœ‰åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨é•¿æœŸè¿è¡Œçš„ç³»ç»Ÿä¸­ã€‚åœ¨ Java 9 ä¹‹åï¼ŒJVM æ¨å‡ºäº† G1 åƒåœ¾å›æ”¶å™¨ï¼Œå®ƒè¢«è®¤ä¸ºæ˜¯å¯¹ CMS çš„æ›¿ä»£ï¼Œæä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œæ›´ç¨³å®šçš„å“åº”æ—¶é—´ã€‚</p>
</li>
</ul>
<h2 id="14ã€åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼æœ‰å“ªäº›executeå’Œsubmitçš„åŒºåˆ«">14ã€åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼æœ‰å“ªäº›executeå’Œsubmitçš„åŒºåˆ«</h2>
<ul>
<li>
<p>åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•:</p>
<ol>
<li>
<p>ä½¿ç”¨å·¥å…·ç±»Excutros.Executors.newCachedThreadPool();   é»˜è®¤æœ€å¤§çº¿ç¨‹æ± çš„æ•°é‡ä¸ºIntegeçš„æœ€å¤§å€¼</p>
</li>
<li>
<p>ä½¿ç”¨å·¥å…·ç±»çš„Executors.newFixedThreadPool(100);  å¯ä»¥æ‰‹åŠ¨æŒ‡å®šæœ€å¤§çº¿ç¨‹æ± </p>
</li>
<li>
<p>newSingleThreadExecutor(), åˆ›å»ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± , æäº¤çš„ä»»åŠ¡ä¼šé¡ºåºçš„æ‰§è¡Œ</p>
</li>
<li>
<p>è‡ªå®šä¹‰çº¿ç¨‹æ± ,new ThreadPoolExecutor();</p>
</li>
</ol>
</li>
<li>
<p>executeå’Œsubmitçš„åŒºåˆ«:</p>
<p><code>Executor</code> æ¥å£æä¾›äº†ä¸¤ç§æäº¤ä»»åŠ¡çš„æ–¹å¼ï¼š<code>execute()</code> å’Œ <code>submit()</code>ã€‚å®ƒä»¬çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä»»åŠ¡çš„ç±»å‹ã€è¿”å›å€¼å’Œå¼‚å¸¸å¤„ç†ä¸Šã€‚</p>
<ol>
<li>
<p>execute():</p>
<p><strong>å‚æ•°</strong>ï¼š <code>execute()</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå®ç°äº† <code>Runnable</code> æ¥å£çš„ä»»åŠ¡ã€‚<code>Runnable</code> ä»»åŠ¡æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ä»»åŠ¡ï¼Œå®ƒçš„ <code>run()</code> æ–¹æ³•æ²¡æœ‰è¿”å›ç»“æœã€‚</p>
<p><strong>è¿”å›å€¼</strong>ï¼š <code>execute()</code> æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œå®ƒåªèƒ½æäº¤ä»»åŠ¡å¹¶æ‰§è¡Œï¼Œä¸å…³å¿ƒä»»åŠ¡æ‰§è¡Œçš„ç»“æœã€‚</p>
</li>
<li>
<p>submit()</p>
<p><strong>å‚æ•°</strong>ï¼š <code>submit()</code> æ–¹æ³•æ—¢å¯ä»¥æ¥æ”¶å®ç°äº† <code>Runnable</code> æ¥å£çš„ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶å®ç°äº† <code>Callable</code> æ¥å£çš„ä»»åŠ¡ã€‚</p>
<ul>
<li><code>Runnable</code> æ˜¯ä¸è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</li>
<li><code>Callable</code> æ˜¯æœ‰è¿”å›å€¼çš„ä»»åŠ¡ï¼Œ<code>Callable.call()</code> æ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªç»“æœã€‚</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼š</p>
<ul>
<li>å¦‚æœä¼ é€’çš„æ˜¯ <code>Callable</code> ç±»å‹ä»»åŠ¡ï¼Œ<code>submit()</code> æ–¹æ³•è¿”å›çš„ <code>Future</code> å¯¹è±¡çš„ <code>get()</code> æ–¹æ³•ä¼šè¿”å›ä»»åŠ¡çš„ç»“æœã€‚</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="15ã€å¦‚ä½•å®ç°ä¸¤ä¸ªçº¿ç¨‹é€šä¿¡ï¼Œç¼–å†™ä¸€æ®µä»£ç ">15ã€å¦‚ä½•å®ç°ä¸¤ä¸ªçº¿ç¨‹é€šä¿¡ï¼Œç¼–å†™ä¸€æ®µä»£ç </h2>
<ul>
<li>
<p>æ¨¡æ¿:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. å®šä¹‰èµ„æºç±»ã€æ–¹æ³•</span><br><span class="line">2. èµ„æºç±»æ–¹æ³•ï¼š</span><br><span class="line">	åˆ¤æ–­ï¼ˆç¬¦åˆæ¡ä»¶å°±è¿è¡Œï¼Œä¸ç¬¦åˆå°±ç­‰å¾…ï¼‰</span><br><span class="line">	æ‰§è¡Œ</span><br><span class="line">	å”¤é†’</span><br><span class="line">3. é€šè¿‡å¤šçº¿ç¨‹æ“ä½œå…±äº«èµ„æº</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å®ç°ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadCommunicationTemplate</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SharedResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SharedResource</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Consumer</span>(resource), <span class="string">&quot;æ¶ˆè´¹è€…-&quot;</span> + i).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨ä¸€ä¸ªç”Ÿäº§è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Producer</span>(resource), <span class="string">&quot;ç”Ÿäº§è€…&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SharedResource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// å…±äº«èµ„æº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RESOURCE</span> <span class="operator">=</span> <span class="number">5</span>; <span class="comment">// æœ€å¤§èµ„æºå®¹é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–èµ„æºï¼ˆæ¶ˆè´¹è€…ï¼‰</span></span><br><span class="line">    <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (resource &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; ç­‰å¾…èµ„æº...&quot;</span>);</span><br><span class="line">            wait(); <span class="comment">// ç­‰å¾…èµ„æº</span></span><br><span class="line">        &#125;</span><br><span class="line">        resource--;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ¶ˆè´¹èµ„æºï¼Œå½“å‰èµ„æº: &quot;</span> + resource);</span><br><span class="line">        notifyAll(); <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿäº§èµ„æºï¼ˆç”Ÿäº§è€…ï¼‰</span></span><br><span class="line">    <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (resource &gt;= MAX_RESOURCE) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; èµ„æºå·²æ»¡ï¼Œç­‰å¾…æ¶ˆè´¹...&quot;</span>);</span><br><span class="line">            wait(); <span class="comment">// ç­‰å¾…æ¶ˆè´¹</span></span><br><span class="line">        &#125;</span><br><span class="line">        resource++;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; ç”Ÿäº§èµ„æºï¼Œå½“å‰èµ„æº: &quot;</span> + resource);</span><br><span class="line">        notifyAll(); <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿäº§è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SharedResource resource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(SharedResource resource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.resource = resource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                resource.produce(); <span class="comment">// ç”Ÿäº§èµ„æº</span></span><br><span class="line">                Thread.sleep(<span class="number">500</span>);  <span class="comment">// æ¨¡æ‹Ÿç”Ÿäº§è¿‡ç¨‹çš„å»¶è¿Ÿ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SharedResource resource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(SharedResource resource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.resource = resource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                resource.consume(); <span class="comment">// æ¶ˆè´¹èµ„æº</span></span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);  <span class="comment">// æ¨¡æ‹Ÿæ¶ˆè´¹è¿‡ç¨‹çš„å»¶è¿Ÿ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="16ã€volatileçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•ç†è§£JMMå†…å­˜æ¨¡å‹">16ã€volatileçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•ç†è§£JMMå†…å­˜æ¨¡å‹</h2>
<ul>
<li>
<p>valatileçš„ä½œç”¨ :</p>
<ol>
<li>
<p>ä¿è¯å¯è§æ€§</p>
<p>ä¿è¯åœ¨å¤šçº¿ç¨‹ä¸‹, å˜é‡çš„æ”¹å˜èƒ½è¢«åŠæ—¶ç›‘å¬åˆ°</p>
</li>
<li>
<p>ä¸èƒ½ä¿è¯åŸå­æ€§</p>
</li>
<li>
<p>ä¿è¯é¡ºåºæ€§ : JVMåœ¨è¿è¡Œæ–¹æ³•æ—¶, ä¼šåœ¨ä¸å…è®¸è¿è¡Œç»“æœçš„å‰æä¸‹, æ”¹å˜ä»£ç æ‰§è¡Œçš„é¡ºåº ,ä½†æ˜¯åœ¨å¤šçº¿ç¨‹ä¸‹, å¦‚æœæ”¹å˜ä»£ç æ‰§è¡Œé¡ºåº,å¯èƒ½ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„ç»“æœ</p>
</li>
</ol>
</li>
<li>
<p>==JVMå†…å­˜æ¨¡å‹==</p>
<p>VM å†…å­˜æ¨¡å‹</p>
<p>JVM å†…å­˜æ¨¡å‹ä¸»è¦ç”± <strong>ä¸»å†…å­˜</strong> å’Œ <strong>å·¥ä½œå†…å­˜</strong> ä¸¤éƒ¨åˆ†ç»„æˆã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å·¥ä½œå†…å­˜ï¼Œè€Œå…±äº«çš„ä¸»å†…å­˜åˆ™ç”±æ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚</p>
<ol>
<li><strong>ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰</strong></li>
</ol>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šä¸»å†…å­˜æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸã€‚æ‰€æœ‰çº¿ç¨‹éƒ½é€šè¿‡ä¸»å†…å­˜æ¥äº¤æ¢æ•°æ®ã€‚</li>
<li><strong>å†…å®¹</strong>ï¼šä¸»å†…å­˜ä¸­å­˜å‚¨äº†æ‰€æœ‰å®ä¾‹å˜é‡ã€é™æ€å˜é‡ã€ä»¥åŠå¸¸é‡ã€‚</li>
<li><strong>ä½œç”¨</strong>ï¼šä¸»å†…å­˜ç¡®ä¿æ‰€æœ‰çº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹èƒ½å¤Ÿè¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ï¼Œæ˜¯çº¿ç¨‹é—´é€šä¿¡çš„åŸºç¡€ã€‚</li>
</ul>
<ol start="2">
<li><strong>å·¥ä½œå†…å­˜ï¼ˆWorking Memoryï¼‰</strong></li>
</ol>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ã€‚å·¥ä½œå†…å­˜ä¿å­˜ç€çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å˜é‡çš„å‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ç§æœ‰çš„å†…å­˜ã€‚</li>
<li><strong>å†…å®¹</strong>ï¼šçº¿ç¨‹åœ¨å·¥ä½œå†…å­˜ä¸­å­˜å‚¨äº†ä»ä¸»å†…å­˜ä¸­è¯»å–çš„æ•°æ®å‰¯æœ¬ï¼ˆé€šå¸¸æ˜¯æ ˆå¸§ï¼‰ã€‚</li>
<li><strong>ä½œç”¨</strong>ï¼šå·¥ä½œå†…å­˜ä¸ç›´æ¥æ“ä½œä¸»å†…å­˜ä¸­çš„æ•°æ®ï¼Œè€Œæ˜¯ä»ä¸»å†…å­˜å¤åˆ¶æ•°æ®åˆ°å·¥ä½œå†…å­˜ä¸­ï¼Œçº¿ç¨‹å¯¹æ•°æ®çš„æ“ä½œéƒ½æ˜¯åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­è¿›è¡Œçš„ï¼Œä¿®æ”¹æ•°æ®åä¼šåŒæ­¥åˆ°ä¸»å†…å­˜ã€‚</li>
</ul>
<ol start="3">
<li><strong>å†…å­˜äº¤äº’ä¸å…±äº«æœºåˆ¶</strong></li>
</ol>
<ul>
<li><strong>åŸå­æ€§</strong>ï¼šJVM å†…å­˜æ¨¡å‹ä¸­æœ‰ä¸€å¥—åŸå­æ€§æ“ä½œæœºåˆ¶ï¼Œç¡®ä¿åŸºæœ¬æ•°æ®ç±»å‹æ“ä½œï¼ˆå¦‚åŠ ã€å‡ï¼‰èƒ½å¤Ÿåœ¨å¤šä¸ªçº¿ç¨‹é—´æ­£ç¡®åŒæ­¥ã€‚</li>
<li><strong>å¯è§æ€§</strong>ï¼šä¸ºäº†ä¿è¯çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼ŒJVM æä¾›äº†å„ç§åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ <code>volatile</code> å…³é”®å­—ï¼‰ï¼Œä¿è¯çº¿ç¨‹å¯¹å…±äº«å˜é‡çš„æ›´æ–°èƒ½å¤Ÿç«‹å³è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ã€‚</li>
<li><strong>æœ‰åºæ€§</strong>ï¼šå·¥ä½œå†…å­˜ä¸­çš„æŒ‡ä»¤æ‰§è¡Œé¡ºåºå’Œå†…å­˜è®¿é—®é¡ºåºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½å¹¶ä¸ç›¸åŒï¼ŒJVM æä¾›äº†æœ‰åºæ€§ä¿è¯ï¼Œé€šè¿‡ <code>synchronized</code> ç­‰å…³é”®å­—æ¥æ§åˆ¶ã€‚</li>
</ul>
<ol start="4">
<li><strong>å†…å­˜å±éšœä¸é”æœºåˆ¶</strong></li>
</ol>
<ul>
<li><strong>å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰</strong>ï¼šå®ƒæ˜¯ä¿è¯çº¿ç¨‹å¯¹å…±äº«å˜é‡è®¿é—®é¡ºåºçš„æœºåˆ¶ã€‚é€šè¿‡åœ¨å…³é”®ä½ç½®æ’å…¥å†…å­˜å±éšœï¼ŒJVM å¯ä»¥ç¡®ä¿çº¿ç¨‹åœ¨æ‰§è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œä¸ä¼šå°†æ“ä½œä¹±åºæ‰§è¡Œã€‚</li>
<li><strong>é”æœºåˆ¶</strong>ï¼š<code>synchronized</code>ã€<code>ReentrantLock</code> ç­‰é”æœºåˆ¶ç”¨äºç¡®ä¿çº¿ç¨‹å¯¹å…±äº«æ•°æ®çš„äº’æ–¥è®¿é—®ã€‚</li>
</ul>
</li>
</ul>
<h2 id="17ã€MySQLäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä»¥åŠä¸åŒéš”ç¦»çº§åˆ«çš„é—®é¢˜">17ã€MySQLäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä»¥åŠä¸åŒéš”ç¦»çº§åˆ«çš„é—®é¢˜</h2>
<ul>
<li>
<p>éš”ç¦»çº§åˆ«</p>
<ol>
<li>
<p>è¯»æœªæäº¤</p>
<p>é—®é¢˜: è„è¯»</p>
</li>
<li>
<p>è¯»å·²æäº¤</p>
<p>é—®é¢˜: ä¸å¯é‡å¤è¯»</p>
</li>
<li>
<p>å¯é‡å¤è¯»</p>
<p>é—®é¢˜: å¹»è¯»</p>
</li>
<li>
<p>ä¸²è¡ŒåŒ–</p>
</li>
</ol>
</li>
</ul>
<h2 id="18ã€MySQLç´¢å¼•å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›">18ã€MySQLç´¢å¼•å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›</h2>
<ul>
<li>
<p>ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ã€‚ï¼ˆç»“è®ºï¼‰</p>
<ol>
<li>å‡½æ•° å’Œ è®¡ç®—</li>
<li>is null \ is not null</li>
<li>!= &lt;&gt;</li>
<li>ç±»å‹è½¬æ¢(å¯èƒ½)</li>
<li>Likeä»¥%å¼€å¤´</li>
<li>å®šä¹‰ç´¢å¼•å’Œä½¿ç”¨ç´¢å¼•çš„é¡ºåºä¸åŒ</li>
<li>æ’åºä¸­æ— è¿‡æ»¤</li>
<li>èŒƒå›´æŸ¥è¯¢å³è¾¹çš„ç´¢å¼•å¤±æ•ˆ</li>
<li>æ’åºæ—¶ä¸€ä¸ªå‡åº(ASE) ä¸€ä¸ªé™åº(DESC)</li>
</ol>
</li>
<li>
<p>å¤±æ•ˆçš„åŸå› ï¼ˆåŸç†ï¼‰</p>
</li>
<li>
<p>å¦‚ä½•ç†è§£ç´¢å¼•ã€‚ï¼ˆç†è§£ï¼‰</p>
<ul>
<li>
<p>æ ¹æ®ç‰©ç†ç»“æ„æ¥åŒºåˆ†:èšç°‡ç´¢å¼• \ éèšç°‡ç´¢å¼• (å¶å­èŠ‚ç‚¹æ˜¯å¦å­˜å‚¨å®Œæ•´æ•°æ®åŒºåˆ†)</p>
<p>ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„, åœ¨mysqlä¸­,ç´¢å¼•çš„æ•°æ®ç»“æ„ä¸ºB+æ•°, B+æ•°çš„åº•å±‚,</p>
</li>
<li>
<p>å››ç§ç±»å‹çš„æ•°æ®:</p>
<p>0 ä»£è¡¨: å­˜å‚¨çš„æ˜¯ç´¢å¼•å€¼å’Œå®Œæ•´æ•°æ®</p>
<p>1ä»£è¡¨: ç›®å½•é¡¹</p>
<p>2 ä»£è¡¨: å½“å‰é¡µä¸­çš„æœ€å°å€¼</p>
<p>3 ä»£è¡¨: å½“å‰é¡µä¸­çš„æœ€å¤§å€¼</p>
</li>
<li>
<p>ä»¥é¡µä¸ºå•ä½, æ¯é¡µå¤§å°ä¸º16kb</p>
</li>
<li>
<p>åˆ†ä¸ºå¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹,</p>
</li>
<li>
<p>åœ¨éå¶å­èŠ‚ç‚¹ä¸­:</p>
<ul>
<li>å­˜å‚¨çš„æ˜¯ç›®å½•é¡¹ å’Œ å½“å‰ç›®å½•ä¸‹çš„æœ€å¤§å€¼å’Œæœ€å°å€¼</li>
<li>æ¯ä¸ªç›®å½•é¡¹ä¸­åˆå­˜å‚¨ç€ç´¢å¼•å€¼å’Œå½“å‰ç›®å½•é¡¹ä¸‹çš„æœ€å°å€¼</li>
</ul>
</li>
<li>
<p>åœ¨å¶å­èŠ‚ç‚¹ä¸­</p>
<ul>
<li>å½“å‰é¡µä¸­çš„æœ€å¤§ç´¢å¼•å€¼å’Œæœ€å°ç´¢å¼•å€¼</li>
<li>æ•°æ®é¡¹: å­˜å‚¨ç€ç´¢å¼•å€¼å’Œå®Œæ•´çš„æ•°æ®</li>
</ul>
</li>
<li>
<p>é¡µä¸­æ¯ä¸ªæ•°æ®ä»¥å•é“¾è¡¨å­˜å‚¨</p>
</li>
<li>
<p>åœ¨é¡µäºé¡µä¹‹é—´åˆ™æ˜¯é€šè¿‡åŒé“¾è¡¨å½¢å¼å­˜å‚¨.</p>
</li>
</ul>
</li>
</ul>
<h2 id="19ã€-MySQLäº‹åŠ¡çš„å››å¤§ç‰¹æ€§å¦‚ä½•å®ç°">19ã€==MySQLäº‹åŠ¡çš„å››å¤§ç‰¹æ€§å¦‚ä½•å®ç°==</h2>
<p>â€‹	MySQL äº‹åŠ¡çš„å››å¤§ç‰¹æ€§é€šå¸¸è¢«ç§°ä¸º <strong>ACID</strong> ç‰¹æ€§ï¼Œå®ƒä»¬åŒ…æ‹¬ <strong>åŸå­æ€§ (Atomicity)</strong>ã€<strong>ä¸€è‡´æ€§ (Consistency)</strong>ã€<strong>éš”ç¦»æ€§ (Isolation)</strong> å’Œ <strong>æŒä¹…æ€§ (Durability)</strong>ã€‚æ¯ä¸ªç‰¹æ€§éƒ½é€šè¿‡ä¸åŒçš„æœºåˆ¶å’Œè®¾è®¡æ¥ä¿è¯äº‹åŠ¡åœ¨æ•°æ®åº“æ“ä½œä¸­çš„æ­£ç¡®æ€§ä¸å¯é æ€§ã€‚</p>
<p><strong>åŸå­æ€§</strong>ï¼šé€šè¿‡<code>æ—¥å¿—</code>å’Œ<code>å›æ»šæœºåˆ¶</code>ç¡®ä¿äº‹åŠ¡çš„å…¨éƒ¨æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚( <strong>redo log</strong>)</p>
<p><strong>ä¸€è‡´æ€§</strong>ï¼šé€šè¿‡æ•°æ®çš„<code>å®Œæ•´æ€§çº¦æŸ</code>ã€<code>éªŒè¯</code>ä»¥åŠ<code>äº‹åŠ¡éš”ç¦»çº§åˆ«</code>æ¥ç¡®ä¿æ•°æ®åº“ä¿æŒä¸€è‡´çš„çŠ¶æ€ã€‚</p>
<p><strong>éš”ç¦»æ€§</strong>ï¼šé€šè¿‡<code>é”æœºåˆ¶</code>å’Œ<code>äº‹åŠ¡éš”ç¦»çº§åˆ«</code>ç¡®ä¿äº‹åŠ¡å¹¶å‘æ—¶äº’ä¸å¹²æ‰°ï¼Œé¿å…æ•°æ®çš„ä¸ä¸€è‡´ã€‚</p>
<p><strong>æŒä¹…æ€§</strong>ï¼šé€šè¿‡<code>äº‹åŠ¡æ—¥å¿—</code>å’Œ<code>åˆ·æ–°æœºåˆ¶</code>ç¡®ä¿å·²æäº¤çš„äº‹åŠ¡æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒä¹Ÿèƒ½æ¢å¤ã€‚</p>
<ol>
<li><strong>åŸå­æ€§ (Atomicity)</strong></li>
</ol>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šåŸå­æ€§ä¿è¯äº‹åŠ¡å†…çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚å¦‚æœäº‹åŠ¡ä¸­çš„æŸä¸ªæ“ä½œå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡ä¼šå›æ»šï¼Œæ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚äº‹åŠ¡è¢«è§†ä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„å•å…ƒã€‚</li>
<li>å®ç°æ–¹å¼
<ul>
<li><strong>æ—¥å¿—æœºåˆ¶</strong>ï¼šMySQL ä½¿ç”¨ <strong>äº‹åŠ¡æ—¥å¿—</strong>ï¼ˆå¦‚ InnoDB çš„ <strong>redo log</strong>ï¼‰æ¥ä¿è¯åŸå­æ€§ã€‚äº‹åŠ¡æ“ä½œçš„æ¯ä¸€æ­¥éƒ½ä¼šè¢«è®°å½•åˆ°æ—¥å¿—ä¸­ã€‚å¦‚æœäº‹åŠ¡å¤±è´¥æˆ–éœ€è¦å›æ»šï¼ŒMySQL ä¼šæ ¹æ®æ—¥å¿—æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚</li>
<li><strong>å›æ»šæœºåˆ¶</strong>ï¼šé€šè¿‡å›æ»šï¼ˆrollbackï¼‰å‘½ä»¤æˆ–è‡ªåŠ¨å›æ»šæ¥æ’¤é”€æœªæäº¤çš„äº‹åŠ¡æ“ä½œï¼Œç¡®ä¿æ•°æ®åº“çš„åŸå­æ€§ã€‚</li>
<li><strong>å†™å‰æ—¥å¿—ï¼ˆWrite-Ahead Logging, WALï¼‰</strong>ï¼šMySQL ä¸­çš„ InnoDB å­˜å‚¨å¼•æ“é‡‡ç”¨ WAL åè®®ï¼Œç¡®ä¿æ‰€æœ‰ä¿®æ”¹æ•°æ®çš„æ“ä½œåœ¨è¢«æäº¤ä¹‹å‰ä¼šå…ˆå†™å…¥æ—¥å¿—ï¼Œä»è€Œä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>ä¸€è‡´æ€§ (Consistency)</strong></li>
</ol>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šä¸€è‡´æ€§ä¿è¯äº‹åŠ¡çš„æ‰§è¡Œä¼šä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚åœ¨äº‹åŠ¡å¼€å§‹å‰å’Œç»“æŸåï¼Œæ•°æ®åº“ä¸­çš„æ•°æ®å¿…é¡»æ»¡è¶³æ‰€æœ‰çš„çº¦æŸã€è§¦å‘å™¨ç­‰ã€‚</li>
<li>å®ç°æ–¹å¼
<ul>
<li><strong>å¤–é”®çº¦æŸ</strong>ã€<strong>CHECK çº¦æŸ</strong>ã€<strong>å”¯ä¸€æ€§çº¦æŸ</strong>ç­‰å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚äº‹åŠ¡çš„æ‰§è¡Œä¸ä¼šè¿åè¿™äº›çº¦æŸï¼Œå³ä½¿åœ¨äº‹åŠ¡çš„å¤„ç†ä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®å˜åŒ–ä¹Ÿå¿…é¡»ä¿è¯è¿™äº›çº¦æŸä¸è¢«ç ´åã€‚</li>
<li><strong>æ•°æ®éªŒè¯</strong>ï¼šMySQL ä¼šåœ¨äº‹åŠ¡çš„å¼€å§‹å’Œæäº¤å‰éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ã€‚ä¾‹å¦‚ï¼Œäº‹åŠ¡ä¸­çš„ INSERTã€UPDATE å’Œ DELETE æ“ä½œä¼šç¡®ä¿æ•°æ®ä¸ä¼šè¿åæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸã€‚</li>
<li><strong>äº‹åŠ¡éš”ç¦»çº§åˆ«</strong>ï¼šé€šè¿‡è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ˆå¦‚ <strong>READ COMMITTED</strong>ã€<strong>REPEATABLE READ</strong> ç­‰ï¼‰æ¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ç­‰é—®é¢˜ï¼Œä»è€Œä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚</li>
</ul>
</li>
</ul>
<ol start="3">
<li><strong>éš”ç¦»æ€§ (Isolation)</strong></li>
</ol>
<ul>
<li>
<p><strong>å®šä¹‰</strong>ï¼šéš”ç¦»æ€§ä¿è¯å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸ä¼šå—åˆ°å…¶ä»–äº‹åŠ¡çš„å¹²æ‰°ã€‚æ¯ä¸ªäº‹åŠ¡çœ‹èµ·æ¥éƒ½æ˜¯åœ¨ç‹¬ç«‹æ‰§è¡Œçš„ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•çœ‹åˆ°å½“å‰äº‹åŠ¡çš„ä¸­é—´ç»“æœã€‚</p>
</li>
<li>
<p>å®ç°æ–¹å¼</p>
<ul>
<li>
<p>äº‹åŠ¡éš”ç¦»çº§åˆ«</p>
<p>ï¼šMySQL æä¾›äº†å¤šç§éš”ç¦»çº§åˆ«æ¥æ§åˆ¶äº‹åŠ¡ä¹‹é—´çš„å¯è§æ€§ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>READ UNCOMMITTED</strong>ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼ˆè„è¯»ï¼‰ã€‚</li>
<li><strong>READ COMMITTED</strong>ï¼šäº‹åŠ¡åªèƒ½è¯»å–å·²æäº¤äº‹åŠ¡çš„æ•°æ®ï¼ˆé¿å…è„è¯»ï¼Œä½†ä»å¯èƒ½å­˜åœ¨ä¸å¯é‡å¤è¯»ï¼‰ã€‚</li>
<li><strong>REPEATABLE READ</strong>ï¼šä¿è¯äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼ˆé¿å…è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼‰ï¼ŒInnoDB ä½¿ç”¨è¯¥éš”ç¦»çº§åˆ«ã€‚</li>
<li><strong>SERIALIZABLE</strong>ï¼šæœ€ä¸¥æ ¼çš„éš”ç¦»çº§åˆ«ï¼Œå¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œé¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li>
</ul>
</li>
<li>
<p>é”æœºåˆ¶</p>
<p>ï¼šMySQL ä½¿ç”¨è¡Œé”å’Œè¡¨é”æ¥æ§åˆ¶äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚è¡Œé”å¯ä»¥é˜²æ­¢å…¶ä»–äº‹åŠ¡å¯¹æ­£åœ¨æ“ä½œçš„è®°å½•è¿›è¡Œä¿®æ”¹ï¼Œä»è€Œä¿è¯äº‹åŠ¡éš”ç¦»æ€§ã€‚</p>
<ul>
<li><strong>è¡Œçº§é”ï¼ˆInnoDBçš„è¡Œé”ï¼‰</strong>ï¼šå¯ä»¥å¯¹æ•°æ®è¡ŒåŠ é”ï¼Œå…è®¸å¹¶å‘æ“ä½œä¸åŒæ•°æ®è¡Œã€‚</li>
<li><strong>è¡¨çº§é”ï¼ˆMyISAMçš„è¡¨é”ï¼‰</strong>ï¼šå¯¹æ•´ä¸ªè¡¨åŠ é”ï¼Œé€‚ç”¨äºå¯¹è¡¨æ“ä½œçš„äº‹åŠ¡ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="4">
<li><strong>æŒä¹…æ€§ (Durability)</strong></li>
</ol>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šæŒä¹…æ€§ä¿è¯ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå…¶å¯¹æ•°æ®åº“çš„ä¿®æ”¹æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒä¹Ÿä¸ä¼šä¸¢å¤±æ•°æ®ã€‚</li>
<li>å®ç°æ–¹å¼
<ul>
<li><strong>æäº¤æ—¥å¿—</strong>ï¼šMySQL ä½¿ç”¨äº‹åŠ¡æ—¥å¿—ï¼ˆå¦‚ <strong>redo log</strong>ï¼‰æ¥ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚å³ä½¿æ•°æ®åº“å‘ç”Ÿå´©æºƒï¼Œå·²æäº¤çš„äº‹åŠ¡ä¹Ÿèƒ½é€šè¿‡æ—¥å¿—æ¢å¤ã€‚</li>
<li><strong>åˆ·æ–°æ—¥å¿—</strong>ï¼šMySQL ä¼šç¡®ä¿åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œæ‰€æœ‰æ“ä½œè®°å½•éƒ½ä¼šè¢«åˆ·æ–°åˆ°ç£ç›˜ä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼Œç¡®ä¿æ•°æ®æŒä¹…åŒ–ã€‚</li>
<li><strong>åŒå†™ç¼“å†²ï¼ˆDoublewrite Bufferï¼‰</strong>ï¼šInnoDB ä½¿ç”¨åŒå†™ç¼“å†²æŠ€æœ¯ï¼Œåœ¨å†™å…¥æ•°æ®é¡µæ—¶ï¼Œå…ˆå†™å…¥ç¼“å†²åŒºï¼Œå†å†™å…¥ç£ç›˜ï¼Œç¡®ä¿å³ä½¿åœ¨å´©æºƒçš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šä¸¢å¤±æ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<h2 id="20ã€è°ˆè°ˆä½ å¯¹MvCCçš„ç†è§£">==20ã€è°ˆè°ˆä½ å¯¹MvCCçš„ç†è§£==</h2>
<p><strong>MVCC</strong>ï¼ˆMulti-Version Concurrency Controlï¼Œ<code>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</code>ï¼‰æ˜¯ä¸€ç§æ•°æ®åº“å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œç”¨äºæé«˜æ•°æ®åº“åœ¨<code>å¤šç”¨æˆ·</code>ç¯å¢ƒä¸­çš„æ€§èƒ½ï¼Œé¿å…äº‹åŠ¡é—´çš„å†²çªï¼Œå¹¶ç¡®ä¿æ•°æ®åº“çš„<code>ä¸€è‡´æ€§</code>å’Œ<code>éš”ç¦»æ€§</code>ã€‚MVCC é€šè¿‡ä¸ºæ¯ä¸ªäº‹åŠ¡æä¾›æ•°æ®çš„<code>ä¸åŒç‰ˆæœ¬</code>æ¥<code>é¿å…åŠ é”</code>ï¼Œä»è€Œå®ç°æ›´é«˜æ•ˆçš„<code>å¹¶å‘è®¿é—®</code>ã€‚</p>
<p><strong>MVCC çš„åŸºæœ¬åŸç†ï¼š</strong></p>
<ol>
<li><strong>ç‰ˆæœ¬æ§åˆ¶</strong><br>
æ¯æ¡æ•°æ®åœ¨æ•°æ®åº“ä¸­éƒ½æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬åŒ…å«æ•°æ®çš„ä¸€ä¸ªçŠ¶æ€ã€‚æ¯å½“æ•°æ®å‘ç”Ÿæ›´æ–°æ—¶ï¼Œæ•°æ®åº“ä¸ä¼šç›´æ¥ä¿®æ”¹ç°æœ‰æ•°æ®ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œå¹¶ç»™è¯¥ç‰ˆæœ¬åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ—¶é—´æˆ³æˆ–ç‰ˆæœ¬å·ã€‚</li>
<li><strong>äº‹åŠ¡è§†å›¾</strong><br>
æ¯ä¸ªäº‹åŠ¡åœ¨å¼€å§‹æ—¶ï¼Œéƒ½ä¼šçœ‹åˆ°æ•°æ®åº“çš„ä¸€ä¸ªä¸€è‡´çš„å¿«ç…§è§†å›¾ï¼Œè€Œè¿™ä¸ªè§†å›¾æ˜¯ç”±æ‰€æœ‰å·²æäº¤çš„äº‹åŠ¡çš„æ•°æ®ç‰ˆæœ¬æ„æˆçš„ã€‚ä¸åŒäº‹åŠ¡å¯ä»¥çœ‹åˆ°ä¸åŒçš„æ•°æ®ç‰ˆæœ¬ï¼Œé¿å…äº†å› é”ç«äº‰è€Œå¯¼è‡´çš„æ€§èƒ½ç“¶é¢ˆã€‚</li>
<li><strong>äº‹åŠ¡éš”ç¦»</strong><br>
MVCC çš„å®ç°ä½¿å¾—æ•°æ®åº“åœ¨ä¸åŒäº‹åŠ¡ä¹‹é—´èƒ½å¤Ÿç‹¬ç«‹è¯»å–æ•°æ®ï¼Œå¹¶ä¸”æ¯ä¸ªäº‹åŠ¡åªèƒ½çœ‹åˆ°å®ƒå¼€å§‹æ—¶çš„å¿«ç…§æ•°æ®ï¼Œä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡çš„ä¿®æ”¹å½±å“ã€‚å› æ­¤ï¼ŒMVCC èƒ½å¤Ÿå®ç°ç±»ä¼¼äº <strong>å¯é‡å¤è¯»</strong>ï¼ˆRepeatable Readï¼‰å’Œ <strong>è¯»å·²æäº¤</strong>ï¼ˆRead Committedï¼‰çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</li>
<li><strong>åˆ é™¤å’Œå›æ”¶</strong><br>
æ•°æ®çš„æ—§ç‰ˆæœ¬ä¸ä¼šç«‹å³åˆ é™¤ï¼Œè€Œæ˜¯æ ‡è®°ä¸ºå·²è¿‡æ—¶ã€‚å½“ä¸€ä¸ªäº‹åŠ¡æäº¤æ—¶ï¼Œå®ƒä¼šæŠŠå¯¹æ•°æ®çš„ä¿®æ”¹å†™å…¥ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œæ—§ç‰ˆæœ¬å°†è¢«æ ‡è®°ä¸ºæ— æ•ˆã€‚æ•°æ®åº“ä¼šå®šæœŸå›æ”¶è¿™äº›æ— æ•ˆçš„æ•°æ®ç‰ˆæœ¬ï¼Œä»¥é‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚</li>
</ol>
<p><strong>MVCC çš„å·¥ä½œæœºåˆ¶ï¼š</strong></p>
<ul>
<li><strong>è¯»å–æ•°æ®ï¼š</strong> å½“äº‹åŠ¡è¯»å–æ•°æ®æ—¶ï¼Œå®ƒä¼šçœ‹åˆ°åœ¨è¯¥äº‹åŠ¡å¼€å§‹ä¹‹å‰å·²ç»æäº¤çš„æ‰€æœ‰æ•°æ®ç‰ˆæœ¬ï¼Œç¡®ä¿è¯»å–åˆ°çš„æ˜¯ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ï¼ˆå¿«ç…§ï¼‰ã€‚</li>
<li><strong>æ›´æ–°æ•°æ®ï¼š</strong> å½“äº‹åŠ¡ä¿®æ”¹æ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¼šä¸ºè¯¥æ•°æ®åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œæ–°çš„ç‰ˆæœ¬åªå¯¹å½“å‰äº‹åŠ¡å¯è§ã€‚å…¶ä»–äº‹åŠ¡ä¸ä¼šçœ‹åˆ°è¯¥ä¿®æ”¹ï¼Œç›´åˆ°è¯¥äº‹åŠ¡æäº¤ã€‚</li>
<li><strong>åˆ é™¤æ•°æ®ï¼š</strong> å½“äº‹åŠ¡åˆ é™¤æ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¼šå°†æ•°æ®æ ‡è®°ä¸ºåˆ é™¤ï¼Œä½†å®é™…çš„ç‰©ç†åˆ é™¤æ“ä½œä¼šå»¶è¿Ÿåˆ°æ•°æ®ä¸å†è¢«ä»»ä½•äº‹åŠ¡è®¿é—®æ—¶æ‰è¿›è¡Œã€‚</li>
<li><strong>æäº¤å’Œå›æ»šï¼š</strong> å½“äº‹åŠ¡æäº¤æ—¶ï¼Œå®ƒæ‰€ä¿®æ”¹çš„æ•°æ®ç‰ˆæœ¬å˜æˆå¯è§ï¼›å½“äº‹åŠ¡å›æ»šæ—¶ï¼Œæ‰€æœ‰å®ƒåˆ›å»ºçš„ç‰ˆæœ¬éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚</li>
</ul>
<p><strong>MVCC çš„ä¼˜åŠ¿ï¼š</strong></p>
<ol>
<li><strong>æé«˜å¹¶å‘æ€§</strong>ï¼šå› ä¸ºè¯»æ“ä½œä¸éœ€è¦åŠ é”ï¼Œå¤šä¸ªäº‹åŠ¡å¯ä»¥å¹¶å‘è¯»å–æ•°æ®ï¼Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚</li>
<li><strong>å‡å°‘æ­»é”</strong>ï¼šç”±äºè¯»æ“ä½œä¸æ¶‰åŠé”ï¼Œäº‹åŠ¡é—´çš„å†²çªè¾ƒå°‘ï¼Œä»è€Œå‡å°‘äº†æ­»é”çš„å‘ç”Ÿã€‚</li>
<li><strong>æé«˜æ€§èƒ½</strong>ï¼šäº‹åŠ¡å¯¹æ•°æ®çš„ä¿®æ”¹ä¸ä¼šç«‹å³å½±å“åˆ°å…¶ä»–äº‹åŠ¡ï¼Œå› æ­¤é¿å…äº†è¯»å†™é”çš„äº‰ç”¨ï¼Œå‡å°‘äº†æ€§èƒ½ç“¶é¢ˆã€‚</li>
<li><strong>äº‹åŠ¡éš”ç¦»æ€§</strong>ï¼šMVCC èƒ½ä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ï¼Œå¤šä¸ªäº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°ï¼Œèƒ½å¤Ÿä¿è¯â€œå¯é‡å¤è¯»â€æˆ–æ›´é«˜çš„éš”ç¦»çº§åˆ«ã€‚</li>
</ol>
<p><strong>MVCC çš„ç¼ºç‚¹ï¼š</strong></p>
<ol>
<li><strong>ç©ºé—´æ¶ˆè€—</strong>ï¼šæ¯æ¬¡æ›´æ–°æ•°æ®éƒ½ä¼šäº§ç”Ÿæ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œå› æ­¤éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´æ¥ç»´æŠ¤æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ã€‚</li>
<li><strong>ç‰ˆæœ¬å›æ”¶å¤æ‚æ€§</strong>ï¼šç”±äºæ—§ç‰ˆæœ¬çš„æ•°æ®ä¸èƒ½ç«‹å³åˆ é™¤ï¼Œæ•°æ®åº“éœ€è¦é¢å¤–çš„æœºåˆ¶æ¥å®šæœŸæ¸…ç†è¿™äº›è¿‡æœŸç‰ˆæœ¬ã€‚</li>
<li><strong>å¤æ‚çš„å¹¶å‘æ§åˆ¶</strong>ï¼šå°½ç®¡ MVCC å…è®¸å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚äº‹åŠ¡ä¹‹é—´çš„å†™å†²çªï¼‰éœ€è¦æ›´å¤æ‚çš„å†²çªæ£€æµ‹å’Œè§£å†³æœºåˆ¶ã€‚</li>
</ol>
<h2 id="è¡¥å……ï¼šç¼–å†™ä¸€ä¸ªç”Ÿæˆè€…æ¶ˆæ¯è€…æ¨¡å‹ã€‚ã€ä¸¤ä¸ªçº¿ç¨‹-ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ã€‘">è¡¥å……ï¼šç¼–å†™ä¸€ä¸ªç”Ÿæˆè€…æ¶ˆæ¯è€…æ¨¡å‹ã€‚ã€ä¸¤ä¸ªçº¿ç¨‹+ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ã€‘</h2>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.zorange.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.SynchronousQueue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> orange</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/11/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PSBTemplate</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> SynchronousQueue&lt;Integer&gt; shareBlockQueue=<span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CConsumer</span> <span class="variable">cConsumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CConsumer</span>(shareBlockQueue);</span><br><span class="line">        <span class="type">PProducer</span> <span class="variable">pProducer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PProducer</span>(shareBlockQueue);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(cConsumer,<span class="string">&quot;æ¶ˆè´¹è€…&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(pProducer,<span class="string">&quot;ç”Ÿäº§è€…&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PProducer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;Integer&gt; blockingQueue;</span><br><span class="line">    <span class="keyword">public</span>  <span class="title function_">PProducer</span><span class="params">(BlockingQueue arrayBlockingQueue)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.blockingQueue=arrayBlockingQueue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               blockingQueue.put(<span class="number">1</span>);</span><br><span class="line">           &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;é˜Ÿåˆ—æ»¡äº†&quot;</span>);</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">           &#125;</span><br><span class="line">           System.out.println(Thread.currentThread().getName()+<span class="string">&quot;ç”Ÿäº§1ä¸ª, è¿˜å‰©&quot;</span>+blockingQueue.size());</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               Thread.sleep(<span class="number">500</span>);</span><br><span class="line">           &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…</span></span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">CConsumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;Integer&gt; blockingQueue;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CConsumer</span><span class="params">(BlockingQueue arrayBlockingQueue)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.blockingQueue=arrayBlockingQueue;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">         <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">             <span class="type">Integer</span> <span class="variable">poll</span> <span class="operator">=</span> blockingQueue.poll();</span><br><span class="line">             System.out.println(Thread.currentThread().getName()+<span class="string">&quot;æ¶ˆè´¹1ä¸ª, è¿˜å‰©&quot;</span>+blockingQueue.size());</span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                 Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">             &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>å¤ä¹ ï¼šå…ˆåŸç†åœ¨æ¨ç»“è®º</p>
<p>é¢è¯•ï¼šå…ˆè¯´ç»“è®ºåœ¨è§£é‡ŠåŸç†ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
  <entry>
    <title>è‡ªå®šä¹‰çº¿ç¨‹æ± </title>
    <url>/2025/09/15/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    <content><![CDATA[<h1>è‡ªå®šä¹‰çº¿ç¨‹æ± </h1>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> online.orange.blog.web.config;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomThreadConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_THREAD_QUEUE_SIZE</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">     <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_THREAD_KEEP_ALIVE_TIME</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">     <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_THREAD_LIFE_TIME</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">     <span class="keyword">final</span> <span class="type">String</span> <span class="variable">THREAD_POOL_NAME</span> <span class="operator">=</span> <span class="string">&quot;orange-blog-&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * setCorePoolSize(coreSize)ï¼šè®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆCPUæ ¸å¿ƒæ•°ï¼‰</span></span><br><span class="line"><span class="comment">     * setMaxPoolSize(coreSize * 2)ï¼šæœ€å¤§çº¿ç¨‹æ•°ä¸ºæ ¸å¿ƒçº¿ç¨‹æ•°çš„2å€</span></span><br><span class="line"><span class="comment">     * setQueueCapacity(DEFAULT_THREAD_QUEUE_SIZE)ï¼šä»»åŠ¡é˜Ÿåˆ—å®¹é‡100</span></span><br><span class="line"><span class="comment">     * setKeepAliveSeconds(DEFAULT_THREAD_KEEP_ALIVE_TIME)ï¼šéæ ¸å¿ƒçº¿ç¨‹ç©ºé—²1000ç§’åå›æ”¶</span></span><br><span class="line"><span class="comment">     * setThreadNamePrefix(THREAD_POOL_NAME)ï¼šçº¿ç¨‹åå‰ç¼€&quot;orange-blog-&quot;</span></span><br><span class="line"><span class="comment">     * setWaitForTasksToCompleteOnShutdown(true)ï¼šåº”ç”¨å…³é—­æ—¶ç­‰å¾…ä»»åŠ¡å®Œæˆ</span></span><br><span class="line"><span class="comment">     * setAwaitTerminationSeconds(DEFAULT_THREAD_LIFE_TIME)ï¼šæœ€å¤šç­‰å¾…1000ç§’</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ThreadPoolTaskExecutor <span class="title function_">OrangeBLogThreadPoolExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">coreSize</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors();</span><br><span class="line">        <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">        executor.setCorePoolSize(coreSize);</span><br><span class="line">        executor.setMaxPoolSize(coreSize * <span class="number">2</span>);</span><br><span class="line">        executor.setQueueCapacity(DEFAULT_THREAD_QUEUE_SIZE);</span><br><span class="line">        executor.setKeepAliveSeconds(DEFAULT_THREAD_KEEP_ALIVE_TIME);</span><br><span class="line">        executor.setThreadNamePrefix(THREAD_POOL_NAME);</span><br><span class="line">        executor.setWaitForTasksToCompleteOnShutdown(<span class="literal">true</span>);</span><br><span class="line">        executor.setAwaitTerminationSeconds(DEFAULT_THREAD_LIFE_TIME);</span><br><span class="line">        executor.initialize();</span><br><span class="line">        log.info(<span class="string">&quot;OrangeBLogThreadPoolExecutor init success&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
  </entry>
</search>
